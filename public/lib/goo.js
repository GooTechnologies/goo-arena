!function(a){function b(c){if(d[c])return d[c].exports;var e=d[c]={exports:{},id:c,loaded:!1};return a[c].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c=window.webpackJsonp;window.webpackJsonp=function(f,g){for(var h,i,j=0,k=[];j<f.length;j++)i=f[j],e[i]&&k.push.apply(k,e[i]),e[i]=0;for(h in g)a[h]=g[h];for(c&&c(f,g);k.length;)k.shift().call(null,b);return g[0]?(d[0]=0,b(0)):void 0};var d={},e={9:0};return b.e=function(a,c){if(0===e[a])return c.call(null,b);if(void 0!==e[a])e[a].push(c);else{e[a]=[c];var d=document.getElementsByTagName("head")[0],f=document.createElement("script");f.type="text/javascript",f.charset="utf-8",f.async=!0,f.src=b.p+""+a+".out/"+({0:"ammopack",1:"animationpack",2:"box2dpack",3:"cannonpack",4:"debugpack",5:"fsmpack",6:"gamepadpack",7:"geometrypack",8:"gizmopack",10:"linerenderpack",11:"logicpack",12:"p2pack",13:"particlepack",14:"passpack",15:"physicspack",16:"quadpack",17:"scriptpack",18:"soundmanager2pack",19:"terrainpack",20:"timelinepack",21:"waterpack"}[a]||a)+".js",d.appendChild(f)}},b.m=a,b.c=d,b.p="",b(0)}([function(a,b,c){a.exports=c(300)},,,function(a,b,c){function d(){}function e(a,b){b.skeletonMap=b.skeletonMap||{originals:[],clones:[]};var c,d=b.skeletonMap.originals.indexOf(a);return-1===d?(c=a.clone(),b.skeletonMap.originals.push(a),b.skeletonMap.clones.push(c)):c=b.skeletonMap.clones[d],c}function f(a,b,c){var d=a.createEntity(b.name);d._tags=i.cloneSet(b._tags),d._attributes=i.cloneMap(b._attributes),d._hidden=b._hidden,d["static"]=b["static"];for(var h=0;h<b._components.length;h++){var j=b._components[h];if("TransformComponent"===j.type)d.transformComponent.transform.copy(j.transform);else if("MeshDataComponent"===j.type){var k=j.clone(c);j.currentPose&&(k.currentPose=e(j.currentPose,c)),d.setComponent(k)}else if("AnimationComponent"===j.type){var l=j.clone();l._skeletonPose=e(j._skeletonPose,c),d.setComponent(l)}else if("ScriptComponent"===j.type){for(var m=new j.constructor,n=0;n<j.scripts.length;n++){var o,p=j.scripts[n],q=p.externals?p.externals.key||p.externals.name:null;q&&g.getScript(q)?o=g.create(q,p.parameters):(o={externals:p.externals,name:(p.name||"")+"_clone",enabled:!!p.enabled},p.parameters&&(o.parameters=i.deepClone(p.parameters)),p.setup&&(o.setup=p.setup),p.update&&(o.update=p.update),p.cleanup&&(o.cleanup=p.cleanup),p.fixedUpdate&&(o.fixedUpdate=p.fixedUpdate),p.lateUpdate&&(o.lateUpdate=p.lateUpdate),p.argsUpdated&&(o.argsUpdated=p.argsUpdated),p.enter&&(o.enter=p.enter),p.exit&&(o.exit=p.exit),m.scripts.push(o))}d.setComponent(m),a.getSystem("ScriptSystem").manualSetup&&j.scripts[0].context&&m.setup(d)}else j.clone?d.setComponent(j.clone(c)):d.setComponent(j)}for(var n=0;n<b.transformComponent.children.length;n++){var r=b.transformComponent.children[n],s=f(a,r.entity,c);d.transformComponent.attachChild(s.transformComponent)}return c.callback&&c.callback(d),d}var g=c(4),h=c(7),i=c(6);d.clone=function(a,b,c){return c=c||{},f(a,b,c)},d.getRoot=function(a){for(;a.transformComponent.parent;)a=a.transformComponent.parent.entity;return a},d.updateWorldTransform=i.warnOnce("EntityUtils.updateWorldTransform is deprecated. Please use entity.transformComponent.sync instead",function(a){a.updateWorldTransform();for(var b=0;b<a.children.length;b++)d.updateWorldTransform(a.children[b])}),d.getTotalBoundingBox=function(a){var b=new h,c=!0;if(a.traverse(function(a){if(a.meshRendererComponent)if(c){var d=a.meshRendererComponent.worldBound;d instanceof h?b.copy(d):(b.center.set(d.center),b.xExtent=b.yExtent=b.zExtent=d.radius),c=!1}else b.merge(a.meshRendererComponent.worldBound)}),c){var d=a.transformComponent.worldTransform.translation;b=new h(d.clone(),.001,.001,.001)}return b},a.exports=d},function(a,b,c){var d=c(5),e=c(6),f={},g={};g.register=function(a){var b=a.externals.key||a.externals.name;return f[b]?void console.warn("Script already registered for key "+b):(d.fillDefaultNames(a.externals.parameters),void(f[b]=a))},g.addClass=e.warnOnce("Scripts.addClass is deprecated; please consider using the global goo object instead",function(){}),g.getClasses=e.warnOnce("Scripts.getClasses is deprecated; please consider using the global goo object instead",function(){return window.goo}),g.getScript=function(a){return f[a]},g.create=function(a,b){var c;if("string"==typeof a){if(c=f[a],!c)throw new Error('Script "'+a+'" is not registered')}else"function"==typeof a&&(c=a);var g=c();return g.parameters={},g.environment=null,g.externals=c.externals,c.externals&&(d.fillDefaultNames(g.externals.parameters),d.fillDefaultValues(g.parameters,c.externals.parameters)),b&&e.extend(g.parameters,b),g},g.allScripts=function(){for(var a={},b=Object.keys(f),c=0;c<b.length;c++){var d=b[c];a[d]=f[d]}return a},a.exports=g},function(a,b,c){function d(){}var e=c(6);d.DEFAULTS_BY_TYPE={array:[],"float":0,"int":0,string:"",vec2:[0,0],vec3:[0,0,0],vec4:[0,0,0,0],"boolean":!1,animation:null,camera:null,entity:null,image:null,sound:null,texture:null,json:null,text:null},d.REF_TYPES=["animation","camera","entity","image","sound","texture","json","text"],d.isRefType=function(a){return e.contains(d.REF_TYPES,a)},d.TYPE_VALIDATORS=function(){var a=function(a){return function(b){return Array.isArray(b)&&b.length===a}},b=function(a){function b(b){return e.isString(b)&&e.getExtension(b)===a}function c(c){return c&&b(c[a+"Ref"])}return function(a){return b(a)||c(a)}};return{array:e.isArray,"float":e.isNumber,number:e.isNumber,string:e.isString,"boolean":e.isBoolean,"int":e.isInteger,vec2:a(2),vec3:a(3),vec4:a(4),animation:b("animation"),camera:b("camera"),entity:b("entity"),image:b("image"),sound:b("sound"),texture:b("texture"),json:b("json"),text:b("text")}}(),d.PARAMETER_TYPES=["string","int","float","vec2","vec3","vec4","boolean","texture","sound","camera","entity","animation","json","text"],d.PARAMETER_CONTROLS=function(){var a={string:["key"],"int":["spinner","slider","jointSelector"],"float":["spinner","slider"],vec2:[],vec3:["color"],vec4:["color"],"boolean":["checkbox"],texture:[],sound:[],camera:[],entity:[],animation:[],json:[],text:[]};for(var b in a)Array.prototype.push.apply(a[b],["dropdown","select"]);return a}(),d.PROPERTY_TYPES=[{prop:"key",type:"string",mustBeDefined:!0,minLength:1},{prop:"type",type:"string",mustBeDefined:!0,minLength:1,getAllowedValues:function(){return d.PARAMETER_TYPES}},{prop:"control",type:"string",getAllowedValues:function(a){return d.PARAMETER_CONTROLS[a.type]}},{prop:"name",type:"string"},{prop:"min",type:"number"},{prop:"max",type:"number"},{prop:"scale",type:"number"},{prop:"decimals",type:"number"},{prop:"precision",type:"number"},{prop:"exponential",type:"boolean"}],d.fillDefaultValues=function(a,b){if(b instanceof Array){var c=[];b.forEach(function(b){b&&"string"==typeof b.key&&((null===b["default"]||void 0===b["default"])&&(b["default"]=e.deepClone(d.DEFAULTS_BY_TYPE[b.type])),c.push(b.key),"undefined"==typeof a[b.key]&&(a[b.key]=e.clone(b["default"])))});for(var f in a)-1===c.indexOf(f)&&"enabled"!==f&&delete a[f]}},d.fillDefaultNames=function(a){function b(a){if("string"!=typeof a||0===a.length)return"";var b=a[0].toUpperCase()+a.slice(1);return b.replace(/(.)([A-Z])/g,"$1 $2")}a instanceof Array&&a.forEach(function(a){a&&"undefined"==typeof a.name&&(a.name=b(a.key))})},d.getKey=function(a){return d._keys[a]?d._keys[a]:a.charCodeAt(0)},d._keys={Backspace:8,Tab:9,Enter:13,Shift:16,Ctrl:17,Alt:18,Meta:91,Pause:19,Capslock:20,Esc:27,Space:32,Pageup:33,Pagedown:34,End:35,Home:36,Leftarrow:37,Uparrow:38,Rightarrow:39,Downarrow:40,Insert:45,Delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,"0numpad":96,"1numpad":97,"2numpad":98,"3numpad":99,"4numpad":100,"5numpad":101,"6numpad":102,"7numpad":103,"8numpad":104,"9numpad":105,Multiply:106,Plus:107,Minus:109,Dot:110,Slash1:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,Equals:187,Comma:188,Slash:191,Backslash:220},d._keyInverse=function(a){for(var b={},c=Object.keys(a),d=0;d<c.length;d++)b[a[c[d]]]=c[d];return b}(d._keys),d.keyForCode=function(a){return d._keyInverse[a]},a.exports=d},function(a,b){function c(){}c.contains=function(a,b){return-1!==a.indexOf(b)},c.find=function(a,b){for(var c=0;c<a.length;++c){var d=a[c];if(b(d,c))return d}return void 0},c.defaults=function(a,b){for(var c=Object.keys(b),d=0;d<c.length;d++){var e=c[d];("undefined"==typeof a[e]||null===a[e])&&(a[e]=b[e])}return a},c.copyOptions=function(a,b,d){var e=Object.keys(d);if(b)for(var f=0;f<e.length;f++){var g=e[f],h=b[g];a[g]="undefined"==typeof h||null===h?d[g]:h}else c.extend(a,d);return a},c.extend=function(a,b){if(b){for(var c=Object.keys(b),d=0;d<c.length;d++){var e=c[d];a[e]=b[e]}return a}},c.clone=function(a){return c.isObject(a)?Array.isArray(a)?a.slice():c.extend({},a):a};var d=Array.prototype.forEach;c.each=c.forEach=function(a,b,c,e){if("undefined"!=typeof a&&null!==a)if(d&&a.forEach===d)a.forEach(b,c);else if(a.length===+a.length)for(var f=0,g=a.length;g>f;f++)b.call(c,a[f],f,a);else{var h=Object.keys(a);void 0!==e&&h.sort(function(b,c){return a[b][e]-a[c][e]});for(var f=0,i=h.length;i>f;f++)b.call(c,a[h[f]],h[f],a)}},c.map=function(a,b,d,e){var f=[];return c.forEach(a,function(c,e){f.push(b.call(d,c,e,a))},d,e),f},c.deepClone=function(a){if(null===a||"object"!=typeof a)return a;if("[object ArrayBuffer]"===Object.prototype.toString.call(a.buffer))return new a.constructor(a);if(a instanceof Array)return a.map(c.deepClone);if(a.nodeType&&"function"==typeof a.cloneNode)return a.cloneNode(!0);for(var b={},d=Object.keys(a),e=0;e<d.length;e++){var f=d[e];b[f]=c.deepClone(a[f])}return b},c.shallowSelectiveClone=function(a,b){var c={};return b.forEach(function(b){c[b]=a[b]}),c},c.cloneMap=function(a){var b=new Map;return a.forEach(function(a,c){b.set(c,a)}),b},c.cloneSet=function(a){var b=new Set;return a.forEach(function(a){b.add(a)}),b},c.warnOnce=function(a,b){var c=!1;return function(){return c||(console.warn(a),c=!0),b.apply(this,arguments)}},c.constant=function(a){return function(){return a}},c.property=function(a){return function(b){return b[a]}},c.isArray=function(a){return Array.isArray(a)},c.isObject=function(a){return a===Object(a)},c.isString=function(a){return"string"==typeof a},c.isBoolean=function(a){return a===!0||a===!1},c.isNumber=function(a){return"number"==typeof a},c.isInteger=function(a){return c.isNumber(a)&&a%1===0},c.getExtension=function(a){if(c.isString(a)){var b=a.lastIndexOf(".");if(b>=-1)return a.substr(b+1).toLowerCase()}return""},a.exports=c},function(a,b,c){function d(a,b,c,d){f.call(this,a),this.xExtent=void 0!==b?b:1,this.yExtent=void 0!==c?c:1,this.zExtent=void 0!==d?d:1}for(var e=c(8),f=c(12),g=c(13),h=c(9),i=new e,j=new e,k=new e,l=[],m=0;8>m;m++)l.push(new e);d.prototype=Object.create(f.prototype),d.prototype.constructor=d,d.prototype.computeFromPoints=function(a){var b=a.length;if(!(3>b)){var c=this.min,d=this.max,e=k;c.setDirect(a[0],a[1],a[2]),d.setDirect(a[0],a[1],a[2]);for(var f,g,h,i=3;b>i;i+=3)f=a[i+0],g=a[i+1],h=a[i+2],c.x=f<c.x?f:c.x,c.y=g<c.y?g:c.y,c.z=h<c.z?h:c.z,d.x=f>d.x?f:d.x,d.y=g>d.y?g:d.y,d.z=h>d.z?h:d.z;e.set(d).sub(c).scale(.5),this.xExtent=e.x,this.yExtent=e.y,this.zExtent=e.z,this.center.set(d).add(c).scale(.5)}},d.prototype.containsPoint=function(a){var b=this.center,c=a.x-b.x,d=a.y-b.y,e=a.z-b.z;return c>=-this.xExtent&&c<=this.xExtent&&d>=-this.yExtent&&d<=this.yExtent&&e>=-this.zExtent&&e<=this.zExtent};var n=[];d.prototype.computeFromPrimitives=function(a,b,c,e,f){if(!(0>=f-e)){var g=i.setDirect(1/0,1/0,1/0),h=j.setDirect(-(1/0),-(1/0),-(1/0)),k=n;k.length=0;for(var l=e;f>l;l++){k=a.getPrimitiveVertices(c[l],b,k);for(var m=0;m<k.length;m++)d.checkMinMax(g,h,k[m])}this.center.copy(g.add(h)),this.center.scale(.5),this.xExtent=h.x-this.center.x,this.yExtent=h.y-this.center.y,this.zExtent=h.z-this.center.z}},d.checkMinMax=function(a,b,c){c.x<a.x&&(a.x=c.x),c.x>b.x&&(b.x=c.x),c.y<a.y&&(a.y=c.y),c.y>b.y&&(b.y=c.y),c.z<a.z&&(a.z=c.z),c.z>b.z&&(b.z=c.z)},d.prototype.transform=function(a,b){null===b&&(b=new d);var c=l;this.getCorners(c);for(var e=0;8>e;e++)c[e].applyPostPoint(a.matrix);for(var f=c[0].x,g=c[0].y,h=c[0].z,i=f,j=g,k=h,e=1;8>e;e++){var m=c[e].x,n=c[e].y,o=c[e].z;f=Math.min(f,m),g=Math.min(g,n),h=Math.min(h,o),i=Math.max(i,m),j=Math.max(j,n),k=Math.max(k,o)}var p=.5*(i+f),q=.5*(j+g),r=.5*(k+h);return b.center.setDirect(p,q,r),b.xExtent=i-p,b.yExtent=j-q,b.zExtent=k-r,b},d.prototype.getCorners=function(a){var b=this.xExtent,c=this.yExtent,d=this.zExtent,e=this.center;return a[0].setDirect(e.x+b,e.y+c,e.z+d),a[1].setDirect(e.x+b,e.y+c,e.z-d),a[2].setDirect(e.x+b,e.y-c,e.z+d),a[3].setDirect(e.x+b,e.y-c,e.z-d),a[4].setDirect(e.x-b,e.y+c,e.z+d),a[5].setDirect(e.x-b,e.y+c,e.z-d),a[6].setDirect(e.x-b,e.y-c,e.z+d),a[7].setDirect(e.x-b,e.y-c,e.z-d),a},d.prototype.whichSide=function(a){var b=a.normal,c=this.center,d=Math.abs(this.xExtent*b.x)+Math.abs(this.yExtent*b.y)+Math.abs(this.zExtent*b.z),e=b.x*c.x+b.y*c.y+b.z*c.z-a.constant;return-d>e?f.Inside:e>d?f.Outside:f.Intersects},d.prototype._pseudoDistance=function(a,b){var c=a.normal,d=b;return c.x*d.x+c.y*d.y+c.z*d.z-a.constant},d.prototype._maxAxis=function(a){return Math.max(Math.abs(a.x),Math.max(Math.abs(a.y),Math.abs(a.z)))},d.prototype.toString=function(){var a=Math.round(10*this.center.x)/10,b=Math.round(10*this.center.y)/10,c=Math.round(10*this.center.z)/10;return"["+a+","+b+","+c+"] - ["+this.xExtent+","+this.yExtent+","+this.zExtent+"]"},d.prototype.intersects=function(a){return a.intersectsBoundingBox(this)},d.prototype.intersectsBoundingBox=function(a){return this.center.x+this.xExtent<a.center.x-a.xExtent||this.center.x-this.xExtent>a.center.x+a.xExtent?!1:this.center.y+this.yExtent<a.center.y-a.yExtent||this.center.y-this.yExtent>a.center.y+a.yExtent?!1:this.center.z+this.zExtent<a.center.z-a.zExtent||this.center.z-this.zExtent>a.center.z+a.zExtent?!1:!0},d.prototype.intersectsSphere=function(a){this.min.x=this.center.x-this.xExtent,this.min.y=this.center.y-this.yExtent,this.min.z=this.center.z-this.zExtent,this.max.x=this.center.x+this.xExtent,this.max.y=this.center.y+this.yExtent,this.max.z=this.center.z+this.zExtent;var b=Math.pow(a.radius,2),c=0;return a.center.x<this.min.x?c+=Math.pow(a.center.x-this.min.x,2):a.center.x>this.max.x&&(c+=Math.pow(a.center.x-this.max.x,2)),a.center.y<this.min.y?c+=Math.pow(a.center.y-this.min.y,2):a.center.y>this.max.y&&(c+=Math.pow(a.center.y-this.max.y,2)),a.center.z<this.min.z?c+=Math.pow(a.center.z-this.min.z,2):a.center.z>this.max.z&&(c+=Math.pow(a.center.z-this.max.z,2)),b>=c},d.prototype.testStaticAABBAABB=function(a,b){var c=this,d=a,f={mtvDistance:1e10,mtvAxis:new e};return this.testAxisStatic(e.UNIT_X,c.center.x-c.xExtent,c.center.x+c.xExtent,d.center.x-d.xExtent,d.center.x+d.xExtent,f)&&this.testAxisStatic(e.UNIT_Y,c.center.y-c.yExtent,c.center.y+c.yExtent,d.center.y-d.yExtent,d.center.y+d.yExtent,f)&&this.testAxisStatic(e.UNIT_Z,c.center.z-c.zExtent,c.center.z+c.zExtent,d.center.z-d.zExtent,d.center.z+d.zExtent,f)?(b&&(b.isIntersecting=!0,b.normal=f.mtvAxis,b.penetration=1.001*Math.sqrt(f.mtvDistance)),!0):!1},d.prototype.testAxisStatic=function(a,b,c,d,f,g){var h=a.dot(a);if(1e-6>h)return!0;var i=f-b,j=c-d;if(0>=i||0>=j)return!1;var k=j>i?i:-j,l=(new e).copy(a).scale(k/h),m=l.dot(l);return m<g.mtvDistance&&(g.mtvDistance=m,g.mtvAxis=a),!0},d.prototype.intersectsRay=function(a){var b=i.set(a.origin).sub(this.center),c=a.direction,e=[0,1/0],f=this.xExtent;f<h.ZERO_TOLERANCE&&f>=0&&(f=h.ZERO_TOLERANCE);var g=this.yExtent;g<h.ZERO_TOLERANCE&&g>=0&&(g=h.ZERO_TOLERANCE);var j=this.zExtent;j<h.ZERO_TOLERANCE&&j>=0&&(j=h.ZERO_TOLERANCE);var k=d.clip(c.x,-b.x-f,e)&&d.clip(-c.x,b.x-f,e)&&d.clip(c.y,-b.y-g,e)&&d.clip(-c.y,b.y-g,e)&&d.clip(c.z,-b.z-j,e)&&d.clip(-c.z,b.z-j,e);return!k||0===e[0]&&e[1]===1/0?!1:!0},d.prototype.intersectsRayWhere=function(a){var b=i.copy(a.origin).sub(this.center),c=a.direction,f=[0,1/0],g=this.xExtent;g<h.ZERO_TOLERANCE&&g>=0&&(g=h.ZERO_TOLERANCE);var j=this.yExtent;j<h.ZERO_TOLERANCE&&j>=0&&(j=h.ZERO_TOLERANCE);var k=this.zExtent;k<h.ZERO_TOLERANCE&&k>=0&&(k=h.ZERO_TOLERANCE);var l=d.clip(c.x,-b.x-g,f)&&d.clip(-c.x,b.x-g,f)&&d.clip(c.y,-b.y-j,f)&&d.clip(-c.y,b.y-j,f)&&d.clip(c.z,-b.z-k,f)&&d.clip(-c.z,b.z-k,f);if(l&&(0!==f[0]||f[1]!==1/0)){if(f[1]>f[0]){var m=f,n=[new e(a.direction).scale(m[0]).add(a.origin),new e(a.direction).scale(m[1]).add(a.origin)];return{distances:m,points:n}}var m=[f[0]],n=[new e(a.direction).scale(m[0]).add(a.origin)];return{distances:m,points:n}}return null},d.clip=function(a,b,c){return a>0?b>a*c[1]?!1:(b>a*c[0]&&(c[0]=b/a),!0):0>a?b>a*c[0]?!1:(b>a*c[1]&&(c[1]=b/a),!0):0>=b},d.prototype.merge=function(a){return a instanceof d?this.mergeBox(a.center,a.xExtent,a.yExtent,a.zExtent,this):a instanceof g?this.mergeBox(a.center,a.radius,a.radius,a.radius,this):this},d.prototype.mergeBox=function(a,b,c,e,f){f||(f=new d);var g=i,h=j;return g.x=this.center.x-this.xExtent,g.x>a.x-b&&(g.x=a.x-b),g.y=this.center.y-this.yExtent,g.y>a.y-c&&(g.y=a.y-c),g.z=this.center.z-this.zExtent,g.z>a.z-e&&(g.z=a.z-e),h.x=this.center.x+this.xExtent,h.x<a.x+b&&(h.x=a.x+b),h.y=this.center.y+this.yExtent,h.y<a.y+c&&(h.y=a.y+c),h.z=this.center.z+this.zExtent,h.z<a.z+e&&(h.z=a.z+e),f.center.set(h).add(g).scale(.5),f.xExtent=h.x-f.center.x,f.yExtent=h.y-f.center.y,f.zExtent=h.z-f.center.z,f},d.prototype.copy=function(a){return f.prototype.copy.call(this,a),this.xExtent=a.xExtent,this.yExtent=a.yExtent,this.zExtent=a.zExtent,this};var o=!1;d.prototype.clone=function(){return arguments.length>0&&!o&&(o=!0,console.warn('BoundingBox::clone no longer takes an optional "store" parameter; please use BoundingBox::copy instead')),new d(this.center,this.xExtent,this.yExtent,this.zExtent)},a.exports=d},function(a,b,c){function d(a,b,c){0===arguments.length?(this.x=0,this.y=0,this.z=0):1===arguments.length&&"object"==typeof arguments[0]?arguments[0]instanceof d?this.copy(arguments[0]):(this.x=arguments[0][0],this.y=arguments[0][1],this.z=arguments[0][2]):(this.x=a,this.y=b,this.z=c)}var e=c(6),f=c(9),g=c(10),h=c(11);d.prototype=Object.create(g.prototype),d.prototype.constructor=d,g.setupAliases(d.prototype,[["u","r"],["v","g"],["w","b"]]),d.ZERO=new d(0,0,0),d.ONE=new d(1,1,1),d.UNIT_X=new d(1,0,0),d.UNIT_Y=new d(0,1,0),d.UNIT_Z=new d(0,0,1),d.prototype.getComponent=function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z}},d.prototype.setComponent=function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b}return this},d.prototype.add=function(a){return a instanceof d?(this.x+=a.x,this.y+=a.y,this.z+=a.z):a instanceof h?(console.warn("Passing a Vector4 argument to Vector3.prototype.add is deprecated. Consider using .addDirect instead."),this.x+=a.x,this.y+=a.y,this.z+=a.z):"object"==typeof a&&"number"==typeof a.length?(console.warn("Passing arrays to Vector3.prototype.add is deprecated - use Vector3.prototype.addDirect instead."),this.x+=a[0],this.y+=a[1],this.z+=a[2]):"number"==typeof a?(console.warn("Passing numbers to Vector3.prototype.add is deprecated - use Vector3.prototype.addDirect instead."),this.x+=a,this.y+=a,this.z+=a):console.warn("Vector3.prototype.add only supports vector arguments now."),this},d.prototype.addDirect=function(a,b,c){return this.x+=a,this.y+=b,this.z+=c,this},d.prototype.sub=function(a){return this.x-=a.x,this.y-=a.y,this.z-=a.z,this},d.prototype.subDirect=function(a,b,c){return this.x-=a,this.y-=b,this.z-=c,this},d.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},d.prototype.mul=function(a){return"number"==typeof a?(console.warn("Vector3.prototype.mul only accepts vector arguments now. Please use Vector3.prototype.scale instead."),this.x*=a,this.y*=a,this.z*=a):(this.x*=a.x,this.y*=a.y,this.z*=a.z),this},d.prototype.mulDirect=function(a,b,c){return this.x*=a,this.y*=b,this.z*=c,this},d.prototype.scale=function(a){return this.x*=a,this.y*=a,this.z*=a,this},d.prototype.div=function(a){return"number"==typeof a?(console.warn("Passing a number argument to Vector3.prototype.div is deprecated. Use Vector3.prototype.divDirect instead."),this.x/=a,this.y/=a,this.z/=a):(this.x/=a.x,this.y/=a.y,this.z/=a.z),this},d.prototype.divDirect=function(a,b,c){return this.x/=a,this.y/=b,this.z/=c,this},d.prototype.dot=function(a){return this.x*a.x+this.y*a.y+this.z*a.z},d.prototype.dotDirect=function(a,b,c){return this.x*a+this.y*b+this.z*c},d.prototype.equals=function(a){var b=f.EPSILON;return Math.abs(this.x-a.x)<=b&&Math.abs(this.y-a.y)<=b&&Math.abs(this.z-a.z)<=b},d.prototype.equalsDirect=function(a,b,c){var d=f.EPSILON;return Math.abs(this.x-a)<=d&&Math.abs(this.y-b)<=d&&Math.abs(this.z-c)<=d},d.prototype.cross=function(a){var b=this.x,c=this.y,d=this.z;return this.x=a.z*c-a.y*d,this.y=a.x*d-a.z*b,this.z=a.y*b-a.x*c,this},d.prototype.crossDirect=function(a,b,c){var d=this.x,e=this.y,f=this.z;return this.x=c*e-b*f,this.y=a*f-c*d,this.z=b*d-a*e,this},d.prototype.lerp=function(a,b){return this.x+=(a.x-this.x)*b,this.y+=(a.y-this.y)*b,this.z+=(a.z-this.z)*b,this},function(){var a=new d;d.prototype.reflect=function(b){return a.copy(b),a.scale(2*this.dot(b)),this.sub(a),this}}(),d.prototype.set=function(a){return a instanceof d||a instanceof h?(this.x=a.x,this.y=a.y,this.z=a.z):(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2]),this},d.prototype.setDirect=function(a,b,c){return this.x=a,this.y=b,this.z=c,this},d.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},d.prototype.length=function(){return Math.sqrt(this.lengthSquared())},d.prototype.normalize=function(){var a=this.length();return a<f.EPSILON?(this.x=0,this.y=0,this.z=0):(this.x/=a,this.y/=a,this.z/=a),this},d.prototype.unsafeNormalize=function(){var a=this.length();return this.x/=a,this.y/=a,this.z/=a,this},d.prototype.distanceSquared=function(a){var b=this.x-a.x,c=this.y-a.y,d=this.z-a.z;return b*b+c*c+d*d},d.prototype.distance=function(a){return Math.sqrt(this.distanceSquared(a))},d.prototype.applyPre=function(a){var b=a.data,c=this.x,d=this.y,e=this.z;return this.x=b[0]*c+b[1]*d+b[2]*e,this.y=b[3]*c+b[4]*d+b[5]*e,this.z=b[6]*c+b[7]*d+b[8]*e,this},d.prototype.applyPost=function(a){var b=a.data,c=this.x,d=this.y,e=this.z;return this.x=b[0]*c+b[3]*d+b[6]*e,this.y=b[1]*c+b[4]*d+b[7]*e,this.z=b[2]*c+b[5]*d+b[8]*e,this},d.prototype.applyPostPoint=function(a){var b=a.data,c=this.x,d=this.y,e=this.z;return this.x=b[0]*c+b[4]*d+b[8]*e+b[12],this.y=b[1]*c+b[5]*d+b[9]*e+b[13],this.z=b[2]*c+b[6]*d+b[10]*e+b[14],this},d.prototype.applyPostVector=function(a){var b=a.data,c=this.x,d=this.y,e=this.z;return this.x=b[0]*c+b[4]*d+b[8]*e,this.y=b[1]*c+b[5]*d+b[9]*e,this.z=b[2]*c+b[6]*d+b[10]*e,this},d.prototype.clone=function(){return new d(this.x,this.y,this.z)},d.prototype.copy=d.prototype.set,d.prototype.copyTo=function(a){return a.x=this.x,a.y=this.y,a.z=this.z,this},d.prototype.toArray=function(){return[this.x,this.y,this.z]},d.fromArray=function(a){return new d(a[0],a[1],a[2])},d.fromAny=function(){if(3===arguments.length)return d.fromArray(arguments);if(arguments[0]instanceof Array)return d.fromArray(arguments[0]);var a=arguments[0];return new d(a.x,a.y,a.z)},d.prototype.setArray=function(a){return this.x=a[0],this.y=a[1],this.z=a[2],this},Object.defineProperty(d.prototype,"data",{get:e.warnOnce("The .data property of Vector3 was removed. Please use the .x, .y and .z properties instead.",function(){var a=[],b=this;return Object.defineProperties(a,{0:{get:function(){return b.x},set:function(a){b.x=a}},1:{get:function(){return b.y},set:function(a){b.y=a}},2:{get:function(){return b.z},set:function(a){b.z=a}}}),a})}),d.prototype.setVector=e.warnOnce("The setVector method of Vector3 is deprecated. Please use the set method instead.",function(a){return this.set(a)}),d.add=e.warnOnce("Vector3.add is deprecated. Use Vector3.prototype.add instead.",function(a,b,c){"number"==typeof a&&(a=[a,a,a]),"number"==typeof b&&(b=[b,b,b]),c||(c=new d);var e=a.data||a,f=b.data||b;return c.data[0]=e[0]+f[0],c.data[1]=e[1]+f[1],c.data[2]=e[2]+f[2],c}),d.cross=e.warnOnce("Vector3.cross is deprecated. Use Vector3.prototype.cross instead.",function(a,b,c){c||(c=new d);var e=a.data||a,f=b.data||b,g=f[2]*e[1]-f[1]*e[2],h=f[0]*e[2]-f[2]*e[0],i=f[1]*e[0]-f[0]*e[1];return c.data[0]=g,c.data[1]=h,c.data[2]=i,c}),d.distance=e.warnOnce("Vector3.distance is deprecated. Use Vector3.prototype.distance instead.",function(a,b){return Math.sqrt(d.distanceSquared(a,b))}),d.distanceSquared=e.warnOnce("Vector3.distanceSquared is deprecated. Use Vector3.prototype.distanceSquared instead.",function(a,b){var c=a.x-b.x,d=a.y-b.y,e=a.z-b.z;return c*c+d*d+e*e}),d.div=e.warnOnce("Vector3.div is deprecated. Use Vector3.prototype.div instead.",function(a,b,c){if(c||(c=new d),"number"==typeof a){var e=b.data||b;c.data[0]=a/e[0],c.data[1]=a/e[1],c.data[2]=a/e[2]}else if("number"==typeof b){var f=1/b,g=a.data||a;c.data[0]=g[0]*f,c.data[1]=g[1]*f,c.data[2]=g[2]*f}else{var g=a.data||a,e=b.data||b;c.data[0]=g[0]/e[0],c.data[1]=g[1]/e[1],c.data[2]=g[2]/e[2]}return c}),d.dot=e.warnOnce("Vector3.dot is deprecated. Use Vector3.prototype.dot instead.",function(a,b){"number"==typeof a&&(a=[a,a,a]),"number"==typeof b&&(b=[b,b,b]);var c=a.data||a,d=b.data||b;return c[0]*d[0]+c[1]*d[1]+c[2]*d[2]}),d.mul=e.warnOnce("Vector3.mul is deprecated. Use Vector3.prototype.mul instead.",function(a,b,c){if(c||(c=new d),"number"==typeof a){var e=b.data||b;c.data[0]=a*e[0],c.data[1]=a*e[1],c.data[2]=a*e[2]}else if("number"==typeof b){var f=a.data||a;c.data[0]=f[0]*b,c.data[1]=f[1]*b,c.data[2]=f[2]*b}else{var f=a.data||a,e=b.data||b;c.data[0]=f[0]*e[0],c.data[1]=f[1]*e[1],c.data[2]=f[2]*e[2]}return c}),d.prototype.addVector=e.warnOnce("Vector3.prototype.addVector is deprecated. Use Vector3.prototype.add instead.",function(a){return this.x+=a.x,this.y+=a.y,this.z+=a.z,this}),d.prototype.mulVector=e.warnOnce("Vector3.prototype.mulVector is deprecated. Use .mul instead.",function(a){return this.x*=a.x,this.y*=a.y,this.z*=a.z,this}),d.prototype.dotVector=e.warnOnce("Vector3.prototype.dotVector is deprecated. Use .dot instead.",function(a){var b=this.data,c=a.data;return b[0]*c[0]+b[1]*c[1]+b[2]*c[2]}),d.prototype.invert=e.warnOnce("Vector3.prototype.invert is deprecated. Use .negate instead.",function(){return this.x=0-this.x,this.y=0-this.y,this.z=0-this.z,this}),d.prototype.subVector=e.warnOnce("Vector3.prototype.subVector is deprecated. Use .sub instead.",function(a){return this.x-=a.x,this.y-=a.y,this.z-=a.z,this}),d.sub=e.warnOnce("Vector3.sub is deprecated. Use Vector3.prototype.sub instead.",function(a,b,c){"number"==typeof a&&(a=[a,a,a]),"number"==typeof b&&(b=[b,b,b]),c||(c=new d);var e=a.data||a,f=b.data||b;return c.data[0]=e[0]-f[0],c.data[1]=e[1]-f[1],c.data[2]=e[2]-f[2],c}),a.exports=d},function(a,b){function c(){}c.DEG_TO_RAD=Math.PI/180,c.RAD_TO_DEG=180/Math.PI,c.HALF_PI=.5*Math.PI,c.TWO_PI=2*Math.PI,c.EPSILON=1e-5,c.radFromDeg=function(a){return a*c.DEG_TO_RAD},c.degFromRad=function(a){return a*c.RAD_TO_DEG},c.lerp=function(a,b,c){return b===c?b:b+(c-b)*a},c.clamp=function(a,b,c){return c>b?b>a?b:a>c?c:a:c>a?c:a>b?b:a},c.radialClamp=function(a,b,d){var e=(b+d)/2+(d>b?Math.PI:0),f=c.moduloPositive(a-e,c.TWO_PI),g=c.moduloPositive(b-e,c.TWO_PI),h=c.moduloPositive(d-e,c.TWO_PI);return 0>a&&b>0?b-=c.TWO_PI:a>0&&0>b&&(b+=c.TWO_PI),a>c.TWO_PI&&d<c.TWO_PI&&(d+=c.TWO_PI),g>f?b:f>h?d:a},c.moduloPositive=function(a,b){var c=a%b;return c+=0>c?b:0},c.scurve3=function(a){return(-2*a+3)*a*a},c.scurve5=function(a){return((6*a-15)*a+10)*a*a*a},c.sphericalToCartesian=function(a,b,c,d){var e=a*Math.cos(c);d.x=e*Math.cos(b),d.y=a*Math.sin(c),d.z=e*Math.sin(b)},c.cartesianToSpherical=function(a,b,c,d){var e=Math.sqrt(a*a+c*c);d.x=Math.sqrt(a*a+b*b+c*c),d.y=Math.atan2(c,a),d.z=Math.atan2(b,e)},c.getTriangleNormal=function(a,b,c,d,e,f,g,h,i){var j=d-a,k=e-b,l=f-c,m=g-a,n=h-b,o=i-c,p=k*o-l*n,q=l*m-j*o,r=j*n-k*m;return[p,q,r]},c.isPowerOfTwo=function(a){return 0===(a&a-1)},c.nearestPowerOfTwo=function(a){return a--,a|=a>>1,a|=a>>2,a|=a>>4,a|=a>>8,a|=a>>16,a++,a},c.nearestHigherPowerOfTwo=c.nearestPowerOfTwo,c.closeTo=function(a,b,c){return c="undefined"!=typeof c?c:.001,Math.abs(a-b)<=c},c.sign=function(a){return 0>a?-1:a>0?1:0},c.triangleArea=function(a,b,c){return Math.abs(a.x*b.y+b.x*c.y+c.x*a.y-b.y*c.x-c.y*a.x-a.y*b.x)/2},c.barycentricInterpolation=function(a,b,d,e){var f=c.triangleArea(b,d,e),g=c.triangleArea(a,d,e),h=c.triangleArea(a,b,e),i=f+g+h;if(!i){if(e[0]===a[0]&&e[2]===a[2])return a;if(e[0]===b[0]&&e[2]===b[2])return b;if(e[0]===d[0]&&e[2]===d[2])return d}return e.z=(f*a.z+g*b.z+h*d.z)/i,e},c.smoothstep=function(a,b,d){return d=c.clamp((d-a)/(b-a),0,1),d*d*(3-2*d)},c.randomSeed=1337,c.fastRandom=function(){return c.randomSeed=(9301*c.randomSeed+49297)%233280,c.randomSeed/233280},c.floatToHalfFloat=function(){var a=new Float32Array(1),b=new Int32Array(a.buffer);return function(c){a[0]=c;var d=b[0],e=d>>16&32768,f=(2147483647&d)+4096;return f>=1199570944?(2147483647&d)>=1199570944?2139095040>f?31744|e:31744|e|(8388607&d)>>13:31743|e:f>=947912704?e|f-939524096>>13:855638016>f?e:(f=(2147483647&d)>>23,e|(8388607&d|8388608)+(8388608>>>f-102)>>126-f)}}(),c.warnNaN=function(a,b){var c=a[b];Object.defineProperty(a,b,{get:function(){return c},set:function(a){if(isNaN(a))throw new Error("Tried to assign NaN to "+b);c=a}})},a.exports=c},function(a,b,c){function d(a){this._size=a}var e=c(6),f=c(9),g=["x","y","z","w"];d.setupAliases=function(a,b){b.forEach(function(b,c){var d=g[c];b.forEach(function(b){Object.defineProperty(a,b,{get:function(){return this[d]},set:function(a){this[d]=a}})})})},Object.defineProperty(d.prototype,"data",{get:e.warnOnce("The .data property of Vector was removed, please use the .x, .y, .z, .w properties instead.",function(){var a=[],b=this;return Object.defineProperties(a,{0:{get:function(){return b.x},set:function(a){b.x=a}},1:{get:function(){return b.y},set:function(a){b.y=a}},2:{get:function(){return b.z},set:function(a){b.z=a}},3:{get:function(){return b.w},set:function(a){b.w=a}}}),a})}),d.add=e.warnOnce("Vector.add is deprecated.",function(a,b,c){var e=a.data||a,f=b.data||b,g=a._size;c||(c=new d(g));for(var h=0;g>h;h++)c.data[h]=e[h]+f[h];return c}),d.prototype.add=e.warnOnce("Vector.prototype.add is deprecated.",function(a){return d.add(this,a,this)}),d.sub=e.warnOnce("Vector.sub is deprecated.",function(a,b,c){var e=a.data||a,f=b.data||b,g=a._size;c||(c=new d(g));for(var h=0;g>h;h++)c.data[h]=e[h]-f[h];return c}),d.prototype.sub=e.warnOnce("Vector.prototype.sub is deprecated.",function(a){return d.sub(this,a,this)}),d.mul=e.warnOnce("Vector.mul is deprecated.",function(a,b,c){var e=a.data||a,f=b.data||b,g=a._size;c||(c=new d(g));for(var h=0;g>h;h++)c.data[h]=e[h]*f[h];return c}),d.prototype.mul=e.warnOnce("Vector.prototype.mul is deprecated.",function(a){return d.mul(this,a,this)}),d.div=e.warnOnce("Vector.div is deprecated.",function(a,b,c){var e=a.data||a,f=b.data||b,g=a._size;c||(c=new d(g));for(var h=0;g>h;h++)c.data[h]=e[h]/f[h];return c}),d.prototype.div=e.warnOnce("Vector.prototype.div is deprecated.",function(a){return d.div(this,a,this)}),d.copy=e.warnOnce("Vector.copy is deprecated.",function(a,b){var c=a._size;b||(b=new d(c));for(var e=0;c>e;e++)b.data[e]=a.data[e];return b}),d.prototype.copy=e.warnOnce("Vector.prototype.copy  is deprecated.",function(a){for(var b=a._size,c=0;b>c;c++)this.data[c]=a.data[c];return this}),d.dot=e.warnOnce("Vector.dot is deprecated.",function(a,b){for(var c=a.data||a,d=b.data||b,e=a._size,f=0,g=0;e>g;g++)f+=c[g]*d[g];return f}),d.prototype.dot=e.warnOnce("Vector.prototype.dot is deprecated.",function(a){return d.dot(this,a)}),d.apply=e.warnOnce("Vector.apply is deprecated.",function(a,b,c){
var e=a.rows,f=a.cols,g=b._size;if(c||(c=new d(e)),c===b)return d.copy(d.apply(a,b),c);for(var h=0;f>h;h++)for(var i=h*e,j=0;e>j;j++){for(var k=0,l=0;g>l;l++)k+=a.data[l*a.rows+j]*b.data[l];c.data[i+j]=k}return c}),d.prototype.apply=e.warnOnce("Vector.prototype.apply is deprecated.",function(a){return d.apply(a,this,this)}),d.equals=e.warnOnce("Vector.equals is deprecated.",function(a,b){var c=a._size;if(c!==b._size)return!1;for(var d=0;c>d;d++)if(!(Math.abs(a.data[d]-b.data[d])<=f.EPSILON))return!1;return!0}),d.prototype.equals=e.warnOnce("Vector.prototype.equals is deprecated.",function(a){return d.equals(this,a)}),d.distanceSquared=e.warnOnce("Vector.distanceSquared is deprecated.",function(a,b){return d.sub(a,b).lengthSquared()}),d.prototype.distanceSquared=e.warnOnce("Vector.prototype.distanceSquared is deprecated.",function(a){return d.sub(this,a).lengthSquared()}),d.distance=e.warnOnce("Vector.distance is deprecated.",function(a,b){return d.sub(a,b).length()}),d.prototype.distance=e.warnOnce("Vector.prototype.distance is deprecated.",function(a){return d.sub(this,a).length()}),d.prototype.lengthSquared=e.warnOnce("Vector.prototype.lengthSquared is deprecated.",function(){return d.dot(this,this)}),d.prototype.length=e.warnOnce("Vector.prototype.length is deprecated.",function(){return Math.sqrt(d.dot(this,this))}),d.prototype.scale=e.warnOnce("Vector.prototype.scale is deprecated.",function(a){for(var b=this._size-1;b>=0;b--)this.data[b]*=a;return this}),d.prototype.invert=e.warnOnce("Vector.prototype.invert is deprecated.",function(){for(var a=0;a<this._size;a++)this.data[a]=0-this.data[a];return this}),d.prototype.normalize=e.warnOnce("Vector.prototype.normalize is deprecated.",function(){var a=this.length(),b=this._size;if(a<f.EPSILON)for(var c=0;b>c;c++)this.data[c]=0;else{a=1/a;for(var c=0;b>c;c++)this.data[c]*=a}return this}),d.prototype.clone=e.warnOnce("Vector.prototype.clone is deprecated.",function(){return d.copy(this)}),d.prototype.set=e.warnOnce("Vector.prototype.set is deprecated.",function(){if(1===arguments.length&&"object"==typeof arguments[0])if(arguments[0]instanceof d)this.copy(arguments[0]);else for(var a=0;a<arguments[0].length;a++)this.data[a]=arguments[0][a];else for(var a=0;a<arguments.length;a++)this.data[a]=arguments[a];return this}),d.prototype.toString=e.warnOnce("Vector.prototype.toString is deprecated.",function(){var a="";a+="[";for(var b=0;b<this._size;b++)a+=this.data[b],a+=b!==this._size-1?", ":"";return a+="]"}),a.exports=d},function(a,b,c){function d(a,b,c,e){0===arguments.length?(this.x=0,this.y=0,this.z=0,this.w=0):1===arguments.length&&"object"==typeof arguments[0]?arguments[0]instanceof d?this.copy(arguments[0]):(this.x=arguments[0][0],this.y=arguments[0][1],this.z=arguments[0][2],this.w=arguments[0][3]):(this.x=a,this.y=b,this.z=c,this.w=e)}var e=c(6),f=c(9),g=c(10);d.prototype=Object.create(g.prototype),d.prototype.constructor=d,g.setupAliases(d.prototype,[["r"],["g"],["b"],["a"]]),d.ZERO=new d(0,0,0,0),d.ONE=new d(1,1,1,1),d.UNIT_X=new d(1,0,0,0),d.UNIT_Y=new d(0,1,0,0),d.UNIT_Z=new d(0,0,1,0),d.UNIT_W=new d(0,0,0,1),d.prototype.getComponent=function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w}},d.prototype.setComponent=function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;case 3:this.w=b}return this},d.prototype.add=function(a){return this.x+=a.x,this.y+=a.y,this.z+=a.z,this.w+=a.w,this},d.prototype.addDirect=function(a,b,c,d){return this.x+=a,this.y+=b,this.z+=c,this.w+=d,this},d.prototype.sub=function(a){return this.x-=a.x,this.y-=a.y,this.z-=a.z,this.w-=a.w,this},d.prototype.subDirect=function(a,b,c,d){return this.x-=a,this.y-=b,this.z-=c,this.w-=d,this},d.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},d.prototype.mul=function(a){return this.x*=a.x,this.y*=a.y,this.z*=a.z,this.w*=a.w,this},d.prototype.mulDirect=function(a,b,c,d){return this.x*=a,this.y*=b,this.z*=c,this.w*=d,this},d.prototype.scale=function(a){return this.x*=a,this.y*=a,this.z*=a,this.w*=a,this},d.prototype.div=function(a){return this.x/=a.x,this.y/=a.y,this.z/=a.z,this.w/=a.w,this},d.prototype.divDirect=function(a,b,c,d){return this.x/=a,this.y/=b,this.z/=c,this.w/=d,this},d.prototype.dot=function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w},d.prototype.dotDirect=function(a,b,c,d){return this.x*a+this.y*b+this.z*c+this.w*d},d.prototype.equals=function(a){return Math.abs(this.x-a.x)<=f.EPSILON&&Math.abs(this.y-a.y)<=f.EPSILON&&Math.abs(this.z-a.z)<=f.EPSILON&&Math.abs(this.w-a.w)<=f.EPSILON},d.prototype.equalsDirect=function(a,b,c,d){return Math.abs(this.x-a)<=f.EPSILON&&Math.abs(this.y-b)<=f.EPSILON&&Math.abs(this.z-c)<=f.EPSILON&&Math.abs(this.w-d)<=f.EPSILON},d.prototype.lerp=function(a,b){return this.x+=(a.x-this.x)*b,this.y+=(a.y-this.y)*b,this.z+=(a.z-this.z)*b,this.w+=(a.w-this.w)*b,this},function(){var a=new d;d.prototype.reflect=function(b){return a.copy(b),a.scale(2*this.dot(b)),this.sub(a),this}}(),d.prototype.set=function(a){return a instanceof d?(this.x=a.x,this.y=a.y,this.z=a.z,this.w=a.w):(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2],this.w=arguments[3]),this},d.prototype.setDirect=function(a,b,c,d){return this.x=a,this.y=b,this.z=c,this.w=d,this},d.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},d.prototype.length=function(){return Math.sqrt(this.lengthSquared())},d.prototype.normalize=function(){var a=this.length();return a<f.EPSILON?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x/=a,this.y/=a,this.z/=a,this.w/=a),this},d.prototype.unsafeNormalize=function(){var a=this.length();return this.x/=a,this.y/=a,this.z/=a,this.w/=a,this},d.prototype.distanceSquared=function(a){var b=this.x-a.x,c=this.y-a.y,d=this.z-a.z,e=this.w-a.w;return b*b+c*c+d*d+e*e},d.prototype.distance=function(a){return Math.sqrt(this.distanceSquared(a))},d.prototype.applyPre=function(a){var b=a.data,c=this.x,d=this.y,e=this.z,f=this.w;return this.x=b[0]*c+b[1]*d+b[2]*e+b[3]*f,this.y=b[4]*c+b[5]*d+b[6]*e+b[7]*f,this.z=b[8]*c+b[9]*d+b[10]*e+b[11]*f,this.w=b[12]*c+b[13]*d+b[14]*e+b[15]*f,this},d.prototype.applyPost=function(a){var b=a.data,c=this.x,d=this.y,e=this.z,f=this.w;return this.x=b[0]*c+b[4]*d+b[8]*e+b[12]*f,this.y=b[1]*c+b[5]*d+b[9]*e+b[13]*f,this.z=b[2]*c+b[6]*d+b[10]*e+b[14]*f,this.w=b[3]*c+b[7]*d+b[11]*e+b[15]*f,this},d.prototype.clone=function(){return new d(this.x,this.y,this.z,this.w)},d.prototype.copy=d.prototype.set,d.prototype.copyTo=function(a){return a.x=this.x,a.y=this.y,a.z=this.z,a.w=this.w,this},d.fromArray=function(a){return new d(a[0],a[1],a[2],a[3])},d.fromAny=function(){if(4===arguments.length)return d.fromArray(arguments);if(arguments[0]instanceof Array)return d.fromArray(arguments[0]);var a=arguments[0];return new d(a.x,a.y,a.z,a.w)},d.prototype.setArray=function(a){return this.x=a[0],this.y=a[1],this.z=a[2],this.w=a[3],this},d.prototype.toArray=function(){return[this.x,this.y,this.z,this.w]},Object.defineProperty(d.prototype,"data",{get:e.warnOnce("The .data property of Vector4 was removed. Please use the .x, .y, .z and .w properties instead.",function(){var a=[],b=this;return Object.defineProperties(a,{0:{get:function(){return b.x},set:function(a){b.x=a}},1:{get:function(){return b.y},set:function(a){b.y=a}},2:{get:function(){return b.z},set:function(a){b.z=a}},3:{get:function(){return b.w},set:function(a){b.w=a}}}),a})}),d.prototype.setVector=e.warnOnce("The setVector method of Vector4 is deprecated. Please use the set method instead.",function(a){return this.set(a)}),d.add=e.warnOnce("Vector4.add is deprecated. Use Vector4.prototype.add instead.",function(a,b,c){"number"==typeof a&&(a=[a,a,a,a]),"number"==typeof b&&(b=[b,b,b,b]),c||(c=new d);var e=a.data||a,f=b.data||b;return c.data[0]=e[0]+f[0],c.data[1]=e[1]+f[1],c.data[2]=e[2]+f[2],c.data[3]=e[3]+f[3],c}),d.sub=e.warnOnce("Vector4.sub is deprecated. Use Vector4.prototype.sub instead.",function(a,b,c){"number"==typeof a&&(a=[a,a,a,a]),"number"==typeof b&&(b=[b,b,b,b]),c||(c=new d);var e=a.data||a,f=b.data||b;return c.data[0]=e[0]-f[0],c.data[1]=e[1]-f[1],c.data[2]=e[2]-f[2],c.data[3]=e[3]-f[3],c}),d.mul=e.warnOnce("Vector4.mul is deprecated. Use Vector4.prototype.mul instead.",function(a,b,c){"number"==typeof a&&(a=[a,a,a,a]),"number"==typeof b&&(b=[b,b,b,b]),c||(c=new d);var e=a.data||a,f=b.data||b;return c.data[0]=e[0]*f[0],c.data[1]=e[1]*f[1],c.data[2]=e[2]*f[2],c.data[3]=e[3]*f[3],c}),d.div=e.warnOnce("Vector4.div is deprecated. Use Vector4.prototype.div instead.",function(a,b,c){"number"==typeof a&&(a=[a,a,a,a]),"number"==typeof b&&(b=[b,b,b,b]),c||(c=new d);var e=a.data||a,f=b.data||b;return c.data[0]=e[0]/f[0],c.data[1]=e[1]/f[1],c.data[2]=e[2]/f[2],c.data[3]=e[3]/f[3],c}),d.dot=e.warnOnce("Vector4.dot is deprecated. Use Vector4.prototype.dot instead.",function(a,b){"number"==typeof a&&(a=[a,a,a,a]),"number"==typeof b&&(b=[b,b,b,b]);var c=a.data||a,d=b.data||b;return c[0]*d[0]+c[1]*d[1]+c[2]*d[2]+c[3]*d[3]}),d.prototype.addVector=e.warnOnce("Vector4.prototype.addVector is deprecated. Use .add instead.",function(a){return this.data[0]+=a.data[0],this.data[1]+=a.data[1],this.data[2]+=a.data[2],this.data[3]+=a.data[3],this}),d.prototype.dotVector=e.warnOnce("Vector4.prototype.dotVector is deprecated. Use .dot instead.",function(a){var b=this.data,c=a.data;return b[0]*c[0]+b[1]*c[1]+b[2]*c[2]+b[3]*c[3]}),d.prototype.mulVector=e.warnOnce("Vector4.prototype.mulVector is deprecated. Use .mul instead.",function(a){return this.data[0]*=a.data[0],this.data[1]*=a.data[1],this.data[2]*=a.data[2],this.data[3]*=a.data[3],this}),d.prototype.setVector=e.warnOnce("Vector4.prototype.setVector is deprecated. Use .set instead.",function(a){return this.data[0]=a.data[0],this.data[1]=a.data[1],this.data[2]=a.data[2],this.data[3]=a.data[3],this}),d.prototype.subVector=e.warnOnce("Vector4.prototype.subVector is deprecated. Use .sub instead.",function(a){return this.data[0]-=a.data[0],this.data[1]-=a.data[1],this.data[2]-=a.data[2],this.data[3]-=a.data[3],this}),a.exports=d},function(a,b,c){function d(a){this.center=new e,a&&this.center.set(a),this.min=new e(1/0,1/0,1/0),this.max=new e(-(1/0),-(1/0),-(1/0))}var e=c(8);d.prototype.copy=function(a){return this.center.copy(a.center),this.min.copy(a.min),this.min.copy(a.min),this},d.Outside=0,d.Inside=1,d.Intersects=2,a.exports=d},function(a,b,c){function d(a,b){g.call(this,a),this.radius=void 0!==b?b:1}var e=c(8),f=c(9),g=c(12),h=c(14),i=new e;d.prototype=Object.create(g.prototype),d.prototype.constructor=d,d.prototype.computeFromPoints=function(a){var b=a.length;if(!(3>b)){var c=this.min,d=this.max,e=i;c.setDirect(a[0],a[1],a[2]),d.setDirect(a[0],a[1],a[2]);for(var f,g,h,j=3;b>j;j+=3)f=a[j+0],g=a[j+1],h=a[j+2],c.x=f<c.x?f:c.x,c.y=g<c.y?g:c.y,c.z=h<c.z?h:c.z,d.x=f>d.x?f:d.x,d.y=g>d.y?g:d.y,d.z=h>d.z?h:d.z;for(var k,l=d.add(c).scale(.5),m=0,j=0;b>j;j+=3)e.setDirect(a[j],a[j+1],a[j+2]),k=e.sub(l).lengthSquared(),k>m&&(m=k);this.radius=Math.sqrt(m),this.center.set(l)}},function(){var a=new e;d.prototype.containsPoint=function(b){return a.set(b).sub(this.center).lengthSquared()<=Math.pow(this.radius,2)}}(),d.prototype.computeFromPrimitives=function(a,b,c,d,f){if(!(0>=f-d)){for(var g=[],i=[],j=h.getVertexCount(a.indexModes[b]),k=0,l=d;f>l;l++){i=a.getPrimitiveVertices(c[l],b,i);for(var m=0;j>m;m++)g[k++]=(new e).set(i[m])}this.averagePoints(g)}},d.prototype.averagePoints=function(a){this.center.set(a[0]);for(var b=1;b<a.length;b++)this.center.add(a[b]);var c=1/a.length;this.center.scale(c);for(var d=0,b=0;b<a.length;b++){var e=i.copy(a[b]).sub(this.center),f=e.lengthSquared();f>d&&(d=f)}this.radius=Math.sqrt(d)+1e-5},d.prototype.transform=function(a,b){null===b&&(b=new d),a.applyForward(this.center,b.center);var c=a.scale;return b.radius=Math.abs(this._maxAxis(c)*this.radius),b},d.prototype.whichSide=function(a){var b=a.normal,c=this.center,d=b.x*c.x+b.y*c.y+b.z*c.z-a.constant;return d<-this.radius?g.Inside:d>this.radius?g.Outside:g.Intersects},d.prototype._pseudoDistance=function(a,b){return a.normal.x*b.x+a.normal.y*b.y+a.normal.z*b.z-a.constant},d.prototype._maxAxis=function(a){return Math.max(Math.abs(a.x),Math.max(Math.abs(a.y),Math.abs(a.z)))},d.prototype.toString=function(){var a=Math.round(10*this.center.x)/10,b=Math.round(10*this.center.y)/10,c=Math.round(10*this.center.z)/10,d=Math.round(10*this.radius)/10;return"["+a+","+b+","+c+"] - "+d},d.prototype.intersects=function(a){return a.intersectsSphere(this)},d.prototype.intersectsBoundingBox=function(a){a.min.x=a.center.x-a.xExtent,a.min.y=a.center.y-a.yExtent,a.min.z=a.center.z-a.zExtent,a.max.x=a.center.x+a.xExtent,a.max.y=a.center.y+a.yExtent,a.max.z=a.center.z+a.zExtent;var b=Math.pow(this.radius,2),c=0;return this.center.x<a.min.x?c+=Math.pow(this.center.x-a.min.x,2):this.center.x>a.max.x&&(c+=Math.pow(this.center.x-a.max.x,2)),this.center.y<a.min.y?c+=Math.pow(this.center.y-a.min.y,2):this.center.y>a.max.y&&(c+=Math.pow(this.center.y-a.max.y,2)),this.center.z<a.min.z?c+=Math.pow(this.center.z-a.min.z,2):this.center.z>a.max.z&&(c+=Math.pow(this.center.z-a.max.z,2)),b>=c},d.prototype.intersectsSphere=function(a){var b=i.set(this.center).sub(a.center),c=this.radius+a.radius;return b.dot(b)<=c*c},d.prototype.intersectsRay=function(a){if(!this.center)return!1;var b=a.origin.clone().sub(this.center),c=b.dot(b)-this.radius*this.radius;if(0>=c)return!0;var d=a.direction.dot(b);return d>=0?!1:d*d>=c},d.prototype.intersectsRayWhere=function(a){var b,c,d,f=(new e).copy(a.origin).sub(this.center),g=f.dot(f)-this.radius*this.radius;if(0>=g){b=a.direction.dot(f),c=b*b-g,d=Math.sqrt(c);var h=[d-b],i=[(new e).copy(a.direction).scale(h[0]).add(a.origin)];return{distances:h,points:i}}if(b=a.direction.dot(f),b>=0)return null;if(c=b*b-g,0>c)return null;if(c>=1e-5){d=Math.sqrt(c);var h=[-b-d,-b+d],i=[(new e).copy(a.direction).scale(h[0]).add(a.origin),(new e).copy(a.direction).scale(h[1]).add(a.origin)];return{distances:h,points:i}}var h=[-b],i=[(new e).copy(a.direction).scale(h[0]).add(a.origin)];return{distances:h,points:i}},d.prototype.merge=function(a){if(a instanceof d)return this.mergeSphere(a.center,a.radius,this);var b=i.setDirect(a.xExtent,a.yExtent,a.zExtent).length();return this.mergeSphere(a.center,b,this)},d.prototype.mergeSphere=function(a,b,c){c||(c=new d);var e=i.set(a).sub(this.center),g=e.lengthSquared(),h=b-this.radius,j=h*h;if(j>=g)return 0>=h?(c.center.set(this.center),c.radius=this.radius,c):(c.center.set(a),c.radius=b,c);var k=Math.sqrt(g),l=c.center;if(k>f.EPSILON){var m=(k+h)/(2*k);l.add(e.scale(m))}return c.radius=.5*(k+this.radius+b),c},d.prototype.copy=function(a){return g.prototype.copy.call(this,a),this.radius=a.radius,this};var j=!1;d.prototype.clone=function(){return arguments.length>0&&!j&&(j=!0,console.warn('BoundingSphere::clone no longer takes an optional "store" parameter; please use BoundingSphere::copy instead')),new d(this.center,this.radius)},a.exports=d},function(a,b,c){function d(a,b,c){this.attributeMap=a,this.vertexCount=this._vertexCountStore=void 0!==b?b:0,this.indexCount=void 0!==c?c:0,this.primitiveCounts=[0],this.vertexData=null,this.indexData=null,this.dataViews={},this.indexLengths=null,this.indexModes=["Triangles"],this.type=d.MESH,this.paletteMap=void 0,this.weightsPerVertex=void 0,this.boundingBox=void 0,this.store=void 0,this.wireframeData=void 0,this.flatMeshData=void 0,this.__boundingTree=void 0,this._attributeDataNeedsRefresh=!1,this._dirtyAttributeNames=new Set,this.rebuildData(this.vertexCount,this.indexCount)}function e(a){for(var b={},c=0;c<a.length;c++){var d=a[c];if(void 0===q[d])throw new Error("No default attribute named: "+d);b[d]=l.deepClone(q[d])}return b}var f=c(15),g=c(18),h=c(16),i=c(19),j=c(8),k=c(11),l=c(6);d.MESH=0,d.SKINMESH=1,d.prototype.rebuildData=function(a,b,c){var d={},e=null;if(c){for(var f=Object.keys(this.attributeMap),g=0;g<f.length;g++){var h=f[g],i=this.dataViews[h];i&&(d[h]=i)}b>0&&this.indexData&&(e=this.indexData.data)}if(this.rebuildVertexData(a),this.rebuildIndexData(b),c){for(var f=Object.keys(this.attributeMap),g=0;g<f.length;g++){var h=f[g],j=d[h];j&&this.dataViews[h].set(j)}b>0&&e&&this.indexData.data.set(e)}},d.prototype.rebuildVertexData=function(a){if(isNaN(a)||(this.vertexCount=a,this._vertexCountStore=this.vertexCount),this.vertexCount>0){for(var b=0,c=Object.keys(this.attributeMap),d=0;d<c.length;d++){var e=this.attributeMap[c[d]];b+=g.getByteSize(e.type)*e.count}this.vertexData=new f(new ArrayBuffer(b*this.vertexCount),"ArrayBuffer"),this.generateAttributeData()}},d.prototype.rebuildIndexData=function(a){if(void 0!==a&&(this.indexCount=a),this.indexCount>0){var b=h.createIndexBuffer(this.indexCount,this.vertexCount);this.indexData=new f(b,"ElementArrayBuffer")}else this.indexData=null,this.indexLengths=null,this.indexModes=["Triangles"]},d.prototype.setVertexDataUpdated=function(){this.vertexData._dataNeedsRefresh=!0},d.prototype.setAttributeDataUpdated=function(a){this._dirtyAttributeNames.add(a),this._attributeDataNeedsRefresh=!0},d.prototype.getSectionCount=function(){return this.indexLengths?this.indexLengths.length:1},d.prototype.getPrimitiveCount=function(a){return a>=0&&a<this.primitiveCounts.length?this.primitiveCounts[a]:0},d.prototype.getPrimitiveVertices=function(a,b,c){var e=this.getPrimitiveCount(b);if(a>=e||0>a)throw new Error("Invalid primitiveIndex '"+a+"'.  Count is "+e);var f=this.indexModes[b],g=d.getVertexCount(f),h=c||[];h.length=g;for(var i=this.getAttributeBuffer(d.POSITION),k=0;g>k;k++)if(h[k]||(h[k]=new j),this.getIndexBuffer()){var l=this.getIndexBuffer()[this.getVertexIndex(a,k,b)];h[k].x=i[3*l+0],h[k].y=i[3*l+1],h[k].z=i[3*l+2]}else{var l=this.getVertexIndex(a,k,b);h[k].x=i[3*l+0],h[k].y=i[3*l+1],h[k].z=i[3*l+2]}return h},d.prototype.getVertexIndex=function(a,b,c){for(var e=0,f=0;c>f;f++)e+=this.indexLengths[f];switch(this.indexModes[c]){case"Triangles":e+=3*a+b;break;case"TriangleStrip":e+=a+b;break;case"TriangleFan":e+=0===b?0:a+b;break;case"Points":e+=a;break;case"Lines":e+=2*a+b;break;case"LineStrip":case"LineLoop":e+=a+b;break;default:return d.logger.warning("unimplemented index mode: "+this.indexModes[c]),-1}return e},d.prototype.getTotalPrimitiveCount=function(){for(var a=0,b=0,c=this.primitiveCounts.length;c>b;b++)a+=this.primitiveCounts[b];return a},d.prototype.updatePrimitiveCounts=function(){var a=this.indexData?this.indexData.data.length:this.vertexCount,b=this.getSectionCount();this.primitiveCounts.length!==b&&(this.primitiveCounts=[]);for(var c=0;b>c;c++){var e=this.indexLengths?this.indexLengths[c]:a,f=d.getPrimitiveCount(this.indexModes[c],e);this.primitiveCounts[c]=f}},d.getPrimitiveCount=function(a,b){switch(a){case"Triangles":return b/3;case"TriangleFan":case"TriangleStrip":return b-2;case"Lines":return b/2;case"LineStrip":return b-1;case"LineLoop":return b;case"Points":return b;default:throw new Error("unimplemented index mode: "+a)}},d.getVertexCount=function(a){switch(a){case"Triangles":case"TriangleFan":case"TriangleStrip":return 3;case"Lines":case"LineStrip":case"LineLoop":return 2;case"Points":return 1;default:throw new Error("unimplemented index mode: "+a)}};var m={Byte:Int8Array,UnsignedByte:Uint8Array,UnsignedByteClamped:Uint8ClampedArray,Short:Int16Array,UnsignedShort:Uint16Array,Int:Int32Array,UnsignedInt:Uint32Array,Float:Float32Array};d.prototype.generateAttributeData=function(){var a,b=this.vertexData.data,c=0;for(var d in this.attributeMap){var e=this.attributeMap[d];e.offset=c;var f=this.vertexCount*e.count;c+=f*g.getByteSize(e.type);var h=m[e.type];if(!h)throw new Error("Unsupported DataType: "+e.type);a=new h(b,e.offset,f),this.dataViews[d]=a,e.hashKey=e.count+"_"+e.type+"_"+e.stride+"_"+e.offset+"_"+e.normalized}},d.prototype.deIndex=function(){var a=this.getIndexBuffer();if(a){for(var b={},c=Object.keys(this.attributeMap),d=0,e=c.length;e>d;d++)for(var f=c[d],g=this.attributeMap[f],h=this.getAttributeBuffer(f),i=b[f]=[],j=0;j<a.length;j++)for(var k=a[j],l=0;l<g.count;l++)i[j*g.count+l]=h[k*g.count+l];this.rebuildData(this.indexCount,0);for(var d=0,e=c.length;e>d;d++){var f=c[d],h=this.getAttributeBuffer(f);h.set(b[f])}this.setVertexDataUpdated()}},d.prototype.makeInterleavedData=function(){var a=0,b=0;for(var c in this.attributeMap){var d=this.attributeMap[c];d.offset=a,a+=d.count*g.getByteSize(d.type)}var e=new f(new ArrayBuffer(a*this.vertexCount),this.vertexData.target);e._dataUsage=this.vertexData._dataUsage,e._dataNeedsRefresh=!0;var h=new DataView(e.data);for(var c in this.attributeMap){var i=this.dataViews[c],d=this.attributeMap[c];d.stride=a;for(var b=d.offset,j=d.count,k=g.getByteSize(d.type),l=this.getDataMethod(d.type),m=h[l],n=0;n<this.vertexCount;n++)for(var o=0;j>o;o++)m.apply(h,[b+a*n+o*k,i[n*j+o],!0])}this.vertexData=e},d.prototype.getDataMethod=function(a){switch(a){case"Byte":return"setInt8";case"UnsignedByte":return"setUInt8";case"Short":return"setInt16";case"UnsignedShort":return"setUInt16";case"Int":return"setInt32";case"HalfFloat":return"setInt16";case"Float":return"setFloat32"}},d.prototype.getAttributeBuffer=function(a){return this.dataViews[a]},d.prototype.getIndexData=function(){return this.indexData},d.prototype.getIndexBuffer=function(){return null!==this.indexData?this.indexData.data:null},d.prototype.getIndexLengths=function(){return this.indexLengths},d.prototype.getIndexModes=function(){return this.indexModes},d.prototype.resetVertexCount=function(){this.vertexCount=this._vertexCountStore},d.prototype.applyTransform=function(a,b){var c=new j,e=this.getAttributeBuffer(a),f=e.length;if(a===d.POSITION)for(var g=0;f>g;g+=3)c.setDirect(e[g+0],e[g+1],e[g+2]),c.applyPostPoint(b.matrix),e[g+0]=c.x,e[g+1]=c.y,e[g+2]=c.z;else if(a===d.NORMAL)for(var g=0;f>g;g+=3)c.setDirect(e[g+0],e[g+1],e[g+2]),c.applyPost(b.rotation),e[g+0]=c.x,e[g+1]=c.y,e[g+2]=c.z;else if(a===d.TANGENT)for(var g=0;f>g;g+=3)c.setDirect(e[g+0],e[g+1],e[g+2]),c.applyPost(b.rotation),e[g+0]=c.x,e[g+1]=c.y,e[g+2]=c.z;return this},d.prototype.applyFunction=function(a,b){var c,d,e=this.getAttributeBuffer(a),f=e.length,g=this.attributeMap[a].count;switch(g){case 1:for(var h=0;f>h;h++)e[h]=b(e[h]);break;case 2:c=new i;for(var h=0;f>h;h+=2)c.setDirect(e[h+0],e[h+1]),d=b(c),e[h+0]=d.x,e[h+1]=d.y;break;case 3:c=new j;for(var h=0;f>h;h+=3)c.setDirect(e[h+0],e[h+1],e[h+2]),d=b(c),e[h+0]=d.x,e[h+1]=d.y,e[h+2]=d.z;break;case 4:c=new k;for(var h=0;f>h;h+=4)c.setDirect(e[h+0],e[h+1],e[h+2],e[h+3]),d=b(c),e[h+0]=d.x,e[h+1]=d.y,e[h+2]=d.z,e[h+3]=d.w}return this},d.prototype.getNormalsMeshData=function(a){if(void 0!==this.getAttributeBuffer("POSITION")&&void 0!==this.getAttributeBuffer("NORMAL")){a=void 0!==a?a:1;for(var b=[],c=[],e=this.dataViews.POSITION.length/3,f=0;e>f;f++)b.push(this.dataViews.POSITION[3*f+0],this.dataViews.POSITION[3*f+1],this.dataViews.POSITION[3*f+2],this.dataViews.POSITION[3*f+0]+this.dataViews.NORMAL[3*f+0]*a,this.dataViews.POSITION[3*f+1]+this.dataViews.NORMAL[3*f+1]*a,this.dataViews.POSITION[3*f+2]+this.dataViews.NORMAL[3*f+2]*a);for(var f=0;2*e>f;f+=2)c.push(f,f+1);var g=new d(d.defaultMap([d.POSITION]),b.length,c.length);return g.getAttributeBuffer(d.POSITION).set(b),g.getIndexBuffer().set(c),g.indexModes[0]="Lines",g}},d.prototype.buildWireframeData=function(){var a=l.deepClone(this.attributeMap),b=new d(a,this.vertexCount,0);b.indexModes[0]="Lines";var c,e=this.getIndexBuffer(),f=this;c=e?function(a,b,c){return e[f.getVertexIndex(a,b,c)]}:function(a,b,c){return f.getVertexIndex(a,b,c)};var g=[],h=0;this.updatePrimitiveCounts();for(var i=0;i<this.getSectionCount();i++)for(var j=this.indexModes[i],k=this.getPrimitiveCount(i),m=0;k>m;m++)switch(j){case"Triangles":case"TriangleFan":case"TriangleStrip":var n=c(m,0,i),o=c(m,1,i),p=c(m,2,i);g[h+0]=n,g[h+1]=o,g[h+2]=o,g[h+3]=p,g[h+4]=p,g[h+5]=n,h+=6;break;case"Lines":case"LineStrip":var n=c(m,0,i),o=c(m,1,i);g[h+0]=n,g[h+1]=o,h+=2;break;case"LineLoop":var n=c(m,0,i),o=c(m,1,i);m===k-1&&(o=c(0,0,i)),g[h+0]=n,g[h+1]=o,h+=2;break;case"Points":}if(h>0){b.rebuildIndexData(h);for(var q in a)b.getAttributeBuffer(q).set(this.getAttributeBuffer(q));b.getIndexBuffer().set(g)}return b.paletteMap=this.paletteMap,b.weightsPerVertex=this.weightsPerVertex,b};var n=new j,o=new j,p=new j;d.prototype.buildFlatMeshData=function(){var a=this.getIndexBuffer();if(null===a)return console.debug("No indices, probably a point mesh"),this;var b=l.deepClone(this.attributeMap),c={};for(var e in b)c[e]={oldBuffer:this.getAttributeBuffer(e),values:[]};var f=0;this.updatePrimitiveCounts();for(var g=0;g<this.getSectionCount();g++)for(var h=this.indexModes[g],i=this.getPrimitiveCount(g),j=!1,k=0;i>k;k++)switch(h){case"TriangleStrip":j=k%2===1?!0:!1;case"Triangles":case"TriangleFan":var m=a[this.getVertexIndex(k,0,g)],q=a[this.getVertexIndex(k,1,g)],r=a[this.getVertexIndex(k,2,g)];if(j){var s=r;r=q,q=s}for(var e in c)if(e!==d.NORMAL){for(var t=b[e].count,u=0;t>u;u++)c[e].values[f*t+u]=c[e].oldBuffer[m*t+u],c[e].values[(f+1)*t+u]=c[e].oldBuffer[q*t+u],c[e].values[(f+2)*t+u]=c[e].oldBuffer[r*t+u];e===d.POSITION&&(n.setDirect(c[e].values[3*f],c[e].values[3*f+1],c[e].values[3*f+2]),o.setDirect(c[e].values[3*(f+1)],c[e].values[3*(f+1)+1],c[e].values[3*(f+1)+2]),p.setDirect(c[e].values[3*(f+2)],c[e].values[3*(f+2)+1],c[e].values[3*(f+2)+2]),o.sub(n),p.sub(n),o.cross(p).normalize(),c[d.NORMAL]&&(c[d.NORMAL].values[3*f]=o.x,c[d.NORMAL].values[3*f+1]=o.y,c[d.NORMAL].values[3*f+2]=o.z,c[d.NORMAL].values[3*(f+1)]=o.x,c[d.NORMAL].values[3*(f+1)+1]=o.y,c[d.NORMAL].values[3*(f+1)+2]=o.z,c[d.NORMAL].values[3*(f+2)]=o.x,c[d.NORMAL].values[3*(f+2)+1]=o.y,c[d.NORMAL].values[3*(f+2)+2]=o.z))}f+=3}if(0===f)return console.warn("Could not build flat data"),this;var v=new d(b,f);for(var e in c)v.getAttributeBuffer(e).set(c[e].values);return v.paletteMap=this.paletteMap,v.weightsPerVertex=this.weightsPerVertex,v},d.prototype.destroy=function(a){this.vertexData&&this.vertexData.destroy(a),this.indexData&&this.indexData.destroy(a)},d.prototype.clone=function(){var a=l.deepClone(this.attributeMap),b=new d(a,this.vertexCount,this.indexCount);return b.primitiveCounts=this.primitiveCounts.slice(0),b.vertexData.copy(this.vertexData),b.indexData.copy(this.indexData),b.indexLengths=Array.isArray(this.indexLengths)?this.indexLengths.slice(0):this.indexLengths,b.indexModes=this.indexModes.slice(0),b.type=this.type,this.paletteMap&&(b.paletteMap=this.paletteMap.slice(0)),b.weightsPerVertex=this.weightsPerVertex,b},d.POSITION="POSITION",d.NORMAL="NORMAL",d.COLOR="COLOR",d.TANGENT="TANGENT",d.TEXCOORD0="TEXCOORD0",d.TEXCOORD1="TEXCOORD1",d.TEXCOORD2="TEXCOORD2",d.TEXCOORD3="TEXCOORD3",d.WEIGHTS="WEIGHTS",d.JOINTIDS="JOINTIDS",d.createAttribute=function(a,b,c){return{count:a,type:b,stride:0,offset:0,normalized:void 0!==c?c:!1}};var q={POSITION:d.createAttribute(3,"Float"),NORMAL:d.createAttribute(3,"Float"),COLOR:d.createAttribute(4,"Float"),TANGENT:d.createAttribute(4,"Float"),TEXCOORD0:d.createAttribute(2,"Float"),TEXCOORD1:d.createAttribute(2,"Float"),TEXCOORD2:d.createAttribute(2,"Float"),TEXCOORD3:d.createAttribute(2,"Float"),WEIGHTS:d.createAttribute(4,"Float"),JOINTIDS:d.createAttribute(4,"Float")};d.defaultMap=function(a){return e(void 0===a?Object.keys(q):a)},a.exports=d},function(a,b,c){function d(a,b){this.data=a,this.target=b,this.glBuffer=null,this._dataUsage="StaticDraw",this._dataNeedsRefresh=!1}var e=c(16);d.prototype.setDataUsage=function(a){this._dataUsage=a},d.prototype.setDataNeedsRefresh=function(){this._dataNeedsRefresh=!0},d.prototype.destroy=function(a){this.glBuffer&&(a.deleteBuffer(this.glBuffer),this.glBuffer=null)},d.prototype.copy=function(a){if(this.data instanceof ArrayBuffer){var b=new Uint8Array(a.data),c=new Uint8Array(this.data);c.set(b)}else this.data.set(a.data);return this.target=a.target,this.glBuffer=null,this._dataUsage=a._dataUsage,this._dataNeedsRefresh=!1,this},d.prototype.clone=function(){var a;a=this.data instanceof ArrayBuffer?this.data.slice(0):e.cloneTypedArray(this.data);var b=new d(a,this.target);return b._dataUsage=this._dataUsage,b._dataNeedsRefresh=!1,b},a.exports=d},function(a,b,c){function d(){}function e(){var a=["Trident","MSIE","Firefox","Safari","Chrome","Opera"],b="undefined"!=typeof navigator&&navigator.userAgent||"",c=a.length-1;for(c;c>-1&&-1===b.indexOf(a[c]);c--);d.browserType=a[c]}var f=c(17);d.createIndexBuffer=function(a,b){var c;if(256>=b)c="Trident"===d.browserType?new Uint16Array(a):new Uint8Array(a);else if(65536>=b)c=new Uint16Array(a);else{if(!f.ElementIndexUInt)throw new Error("Maximum number of vertices is 65536. Got: "+b);c=new Uint32Array(a)}return c},e(),d.cloneTypedArray=function(a){return new a.constructor(a)},a.exports=d},function(a,b){function c(){}c.init=function(a){c.CompressedTextureS3TC=a.getExtension("WEBGL_compressed_texture_s3tc")||a.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),c.TextureFloat=a.getExtension("OES_texture_float"),c.TextureFloatLinear=a.getExtension("OES_texture_float_linear"),c.TextureHalfFloat=a.getExtension("OES_texture_half_float"),c.TextureHalfFloatLinear=a.getExtension("OES_texture_half_float_linear"),c.StandardDerivatives=a.getExtension("OES_standard_derivatives"),c.TextureFilterAnisotropic=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),c.DepthTexture=a.getExtension("WEBGL_depth_texture")||a.getExtension("WEBKIT_WEBGL_depth_texture")||a.getExtension("MOZ_WEBGL_depth_texture"),c.ElementIndexUInt=a.getExtension("OES_element_index_uint"),c.InstancedArrays=a.getExtension("ANGLE_instanced_arrays"),c.BlendMinmax=a.getExtension("EXT_blend_minmax"),c.FragDepth=a.getExtension("EXT_frag_depth"),c.ShaderTextureLod=a.getExtension("EXT_shader_texture_lod"),c.VertexArrayObject=a.getExtension("OES_vertex_array_object"),c.DrawBuffers=a.getExtension("WEBGL_draw_buffers"),c.maxTexureSize=a.getParameter(a.MAX_TEXTURE_SIZE),c.maxCubemapSize=a.getParameter(a.MAX_CUBE_MAP_TEXTURE_SIZE),c.maxRenderbufferSize=a.getParameter(a.MAX_RENDERBUFFER_SIZE),c.maxViewPortDims=a.getParameter(a.MAX_VIEWPORT_DIMS),c.maxAnisotropy=c.TextureFilterAnisotropic?a.getParameter(c.TextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,c.maxVertexTextureUnits=a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS),c.maxFragmentTextureUnits=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),c.maxCombinedTextureUnits=a.getParameter(a.MAX_COMBINED_TEXTURE_IMAGE_UNITS),c.maxVertexAttributes=a.getParameter(a.MAX_VERTEX_ATTRIBS),c.maxVertexUniformVectors=a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS),c.maxFragmentUniformVectors=a.getParameter(a.MAX_FRAGMENT_UNIFORM_VECTORS),c.maxVaryingVectors=a.getParameter(a.MAX_VARYING_VECTORS),c.aliasedPointSizeRange=a.getParameter(a.ALIASED_POINT_SIZE_RANGE),c.aliasedLineWidthRange=a.getParameter(a.ALIASED_LINE_WIDTH_RANGE),c.samples=a.getParameter(a.SAMPLES),c.sampleBuffers=a.getParameter(a.SAMPLE_BUFFERS),c.depthBits=a.getParameter(a.DEPTH_BITS),c.stencilBits=a.getParameter(a.STENCIL_BITS),c.subpixelBits=a.getParameter(a.SUBPIXEL_BITS),c.supportedExtensionsList=a.getSupportedExtensions(),c.renderer=a.getParameter(a.RENDERER),c.vendor=a.getParameter(a.VENDOR),c.version=a.getParameter(a.VERSION),c.shadingLanguageVersion=a.getParameter(a.SHADING_LANGUAGE_VERSION),c.vertexShaderHighpFloat=a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.HIGH_FLOAT),c.vertexShaderMediumpFloat=a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.MEDIUM_FLOAT),c.vertexShaderLowpFloat=a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.LOW_FLOAT),c.fragmentShaderHighpFloat=a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.HIGH_FLOAT),c.fragmentShaderMediumpFloat=a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.MEDIUM_FLOAT),c.fragmentShaderLowpFloat=a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.LOW_FLOAT),c.vertexShaderHighpInt=a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.HIGH_INT),
c.vertexShaderMediumpInt=a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.MEDIUM_INT),c.vertexShaderLowpInt=a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.LOW_INT),c.fragmentShaderHighpInt=a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.HIGH_INT),c.fragmentShaderMediumpInt=a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.MEDIUM_INT),c.fragmentShaderLowpInt=a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.LOW_INT)},c.getCapabilitiesString=function(){var a=[],b=function(a){return a&&a.buffer instanceof ArrayBuffer&&void 0!==a.byteLength};for(var d in c){var e=c[d];if(!(e instanceof Function||"object"==typeof e&&!(e instanceof Array||b(e)))){var f="";if(b(e)){f+="[";for(var g=0;g<e.length;g++)f+=e[g],g<e.length-1&&(f+=",");f+="]"}else f=e;a.push(d+": "+f)}}return a.join("\n")},a.exports=c},function(a,b,c){function d(){}function e(a,b,c){var d=document.createElement("canvas");d.width=b,d.height=c;var e=d.getContext("2d"),f=e.createImageData(b,c);return f.data.set(a),e.putImageData(f,0,0),d}var f=c(6),g=c(9),h=c(17);d.getByteSize=function(a){var b;switch(a){case"Byte":case"UnsignedByte":b=1;break;case"Short":case"UnsignedShort":case"HalfFloat":b=2;break;case"Int":case"Float":b=4;break;case"Double":b=8;break;default:throw new Error("Unknown type: "+a)}return b},d.checkGLError=function(a){for(var b=a.getError(),c=!1;b!==a.NO_ERROR;){if(c=!0,b===a.INVALID_ENUM)console.error("An unacceptable value is specified for an enumerated argument. The offending command is ignored and has no other side effect than to set the error flag.");else if(b===a.INVALID_VALUE)console.error("A numeric argument is out of range. The offending command is ignored and has no other side effect than to set the error flag.");else if(b===a.INVALID_OPERATION)console.error("The specified operation is not allowed in the current state. The offending command is ignored and has no other side effect than to set the error flag.");else if(b===a.FRAMEBUFFER_COMPLETE)console.error("The command is trying to render to or read from the framebuffer while the currently bound framebuffer is not framebuffer complete (i.e. the return value from glCheckFramebufferStatus is not GL_FRAMEBUFFER_COMPLETE). The offending command is ignored and has no other side effect than to set the error flag.");else if(b===a.OUT_OF_MEMORY)throw new Error("There is not enough memory left to execute the command. The state of the GL is undefined, except for the state of the error flags, after this error is recorded.");b=a.getError()}if(c)throw new Error("Stopping due to error")},d.isPowerOfTwo=g.isPowerOfTwo,d.nearestPowerOfTwo=g.nearestPowerOfTwo,d.clone=f.deepClone,d._blankImages={},d.getBlankImage=function(a,b,c,e,f,h){var i=g.nearestPowerOfTwo(c),j=g.nearestPowerOfTwo(e);i=Math.min(i,f),j=Math.min(j,f);var k=4===b.length?"rgba("+Number(255*b[0]).toFixed(0)+","+Number(255*b[1]).toFixed(0)+","+Number(255*b[2]).toFixed(0)+","+Number(b[3]).toFixed(2)+")":"rgb("+Number(255*b[0]).toFixed(0)+","+Number(255*b[1]).toFixed(0)+","+Number(255*b[2]).toFixed(0)+")",l=k+i+"x"+j,m=d._blankImages[l];if(!m){m=document.createElement("canvas"),m.width=i,m.height=j;var n=m.getContext("2d");n.beginPath(),n.rect(0,0,i,j),n.fillStyle=k,n.fill(),d._blankImages[l]=m}void 0===h?a.image=m:(a.image.isData=!1,a.image.data[h]=m)},d.scaleImage=function(a,b,c,d,f,h){var i=g.nearestPowerOfTwo(c),j=g.nearestPowerOfTwo(d);if(i=Math.min(i,f),j=Math.min(j,f),b.width!==i||b.height!==j){var k=document.createElement("canvas");k.width=i,k.height=j,b.getAttribute&&k.setAttribute("data-ref",b.getAttribute("data-ref"));var l=k.getContext("2d");b.data?l.drawImage(e(b.data,b.width,b.height),0,0,b.width,b.height,0,0,i,j):l.drawImage(b,0,0,b.width,b.height,0,0,i,j),k.dataReady=!0,k.src=b.src,k.originalWidth=c,k.originalHeight=d,void 0===h?a.image=k:a.image.data[h]=k}},d.getGLType=function(a,b){var c;switch(b){case"2D":c=a.TEXTURE_2D;break;case"CUBE":c=a.TEXTURE_CUBE_MAP;break;default:throw new Error("Invalid texture type: "+b)}return c},d.getGLWrap=function(a,b){var c;switch(b){case"Repeat":c=a.REPEAT;break;case"MirroredRepeat":c=a.MIRRORED_REPEAT;break;case"EdgeClamp":c=a.CLAMP_TO_EDGE;break;default:throw new Error("Invalid WrapMode type: "+b)}return c},d.getGLInternalFormat=function(a,b){var c;switch(b){case"RGBA":c=a.RGBA;break;case"RGB":c=a.RGB;break;case"Alpha":c=a.ALPHA;break;case"Luminance":c=a.LUMINANCE;break;case"LuminanceAlpha":c=a.LUMINANCE_ALPHA;break;default:throw new Error("Unsupported format: "+b)}return c},d.getGLPixelDataType=function(a,b){return d.getGLDataType(a,b)},d.getGLDataType=function(a,b){var c;switch(b){case"Float":case"Double":c=a.FLOAT;break;case"Byte":c=a.BYTE;break;case"UnsignedByte":c=a.UNSIGNED_BYTE;break;case"Short":c=a.SHORT;break;case"UnsignedShort":c=a.UNSIGNED_SHORT;break;case"Int":c=a.INT;break;case"UnsignedInt":c=a.UNSIGNED_INT;break;case"UnsignedShort565":c=a.UNSIGNED_SHORT_5_6_5;break;case"UnsignedShort4444":c=a.UNSIGNED_SHORT_4_4_4_4;break;case"UnsignedShort5551":c=a.UNSIGNED_SHORT_5_5_5_1;break;case"HalfFloat":c=h.TextureHalfFloat.HALF_FLOAT_OES;break;default:throw new Error("Unknown datatype: "+b)}return c},d.getFilterFallback=function(a){var b;switch(a){case"NearestNeighborNoMipMaps":case"NearestNeighborNearestMipMap":case"NearestNeighborLinearMipMap":b="NearestNeighborNoMipMaps";break;case"BilinearNoMipMaps":case"Trilinear":case"BilinearNearestMipMap":b="BilinearNoMipMaps";break;default:b="NearestNeighborNoMipMaps"}return b},d.getGLMagFilter=function(a,b){var c;switch(b){case"Bilinear":c=a.LINEAR;break;case"NearestNeighbor":c=a.NEAREST;break;default:throw new Error("Invalid MagnificationFilter type: "+b)}return c},d.getGLMinFilter=function(a,b){var c;switch(b){case"BilinearNoMipMaps":c=a.LINEAR;break;case"Trilinear":c=a.LINEAR_MIPMAP_LINEAR;break;case"BilinearNearestMipMap":c=a.LINEAR_MIPMAP_NEAREST;break;case"NearestNeighborNoMipMaps":c=a.NEAREST;break;case"NearestNeighborNearestMipMap":c=a.NEAREST_MIPMAP_NEAREST;break;case"NearestNeighborLinearMipMap":c=a.NEAREST_MIPMAP_LINEAR;break;default:throw new Error("Invalid MinificationFilter type: "+b)}return c},d.getGLBufferTarget=function(a,b){return"ElementArrayBuffer"===b?a.ELEMENT_ARRAY_BUFFER:a.ARRAY_BUFFER},d.getGLArrayType=function(a,b){var c=null;return b instanceof Uint8Array?c=a.UNSIGNED_BYTE:b instanceof Uint16Array?c=a.UNSIGNED_SHORT:b instanceof Uint32Array?c=a.UNSIGNED_INT:b instanceof Int8Array?c=a.UNSIGNED_BYTE:b instanceof Int16Array?c=a.UNSIGNED_SHORT:b instanceof Int32Array&&(c=a.UNSIGNED_INT),c},d.getGLByteSize=function(a){return a.BYTES_PER_ELEMENT||1},d.getGLCubeMapFace=function(a,b){var c;switch(b){case"PositiveX":c=a.TEXTURE_CUBE_MAP_POSITIVE_X;break;case"NegativeX":c=a.TEXTURE_CUBE_MAP_NEGATIVE_X;break;case"PositiveY":c=a.TEXTURE_CUBE_MAP_POSITIVE_Y;break;case"NegativeY":c=a.TEXTURE_CUBE_MAP_NEGATIVE_Y;break;case"PositiveZ":c=a.TEXTURE_CUBE_MAP_POSITIVE_Z;break;case"NegativeZ":c=a.TEXTURE_CUBE_MAP_NEGATIVE_Z;break;default:throw new Error("Invalid cubemap face: "+b)}return c},d.getGLBufferUsage=function(a,b){var c;switch(b){case"StaticDraw":c=a.STATIC_DRAW;break;case"DynamicDraw":c=a.DYNAMIC_DRAW;break;case"StreamDraw":c=a.STREAM_DRAW;break;default:c=a.STATIC_DRAW}return c},d.getGLIndexMode=function(a,b){var c;switch(b){case"Triangles":c=a.TRIANGLES;break;case"TriangleStrip":c=a.TRIANGLE_STRIP;break;case"TriangleFan":c=a.TRIANGLE_FAN;break;case"Lines":c=a.LINES;break;case"LineStrip":c=a.LINE_STRIP;break;case"LineLoop":c=a.LINE_LOOP;break;case"Points":c=a.POINTS;break;default:c=a.TRIANGLES}return c},d.getGLDepthFunc=function(a,b){var c;switch(b){case"Never":c=a.NEVER;break;case"Always":c=a.ALWAYS;break;case"Less":c=a.LESS;break;case"LessEqual":c=a.LEQUAL;break;case"Equal":c=a.EQUAL;break;case"GreaterEqual":c=a.GEQUAL;break;case"Greater":c=a.GREATER;break;case"NotEqual":c=a.NOTEQUAL;break;default:c=a.LEQUAL}return c},d.getGLBlendParam=function(a,b){var c;switch(b){case"AddEquation":c=a.FUNC_ADD;break;case"SubtractEquation":c=a.FUNC_SUBTRACT;break;case"ReverseSubtractEquation":c=a.FUNC_REVERSE_SUBTRACT;break;case"ZeroFactor":c=a.ZERO;break;case"OneFactor":c=a.ONE;break;case"SrcColorFactor":c=a.SRC_COLOR;break;case"OneMinusSrcColorFactor":c=a.ONE_MINUS_SRC_COLOR;break;case"SrcAlphaFactor":c=a.SRC_ALPHA;break;case"OneMinusSrcAlphaFactor":c=a.ONE_MINUS_SRC_ALPHA;break;case"DstAlphaFactor":c=a.DST_ALPHA;break;case"OneMinusDstAlphaFactor":c=a.ONE_MINUS_DST_ALPHA;break;case"DstColorFactor":c=a.DST_COLOR;break;case"OneMinusDstColorFactor":c=a.ONE_MINUS_DST_COLOR;break;case"SrcAlphaSaturateFactor":c=a.SRC_ALPHA_SATURATE;break;default:throw new Error("Unknown blend param: "+b)}return c},a.exports=d},function(a,b,c){function d(a,b){0===arguments.length?(this.x=0,this.y=0):1===arguments.length&&"object"==typeof arguments[0]?arguments[0]instanceof d?this.copy(arguments[0]):(this.x=arguments[0][0],this.y=arguments[0][1]):(this.x=a,this.y=b)}var e=c(6),f=c(9),g=c(10),h=c(8),i=c(11);d.prototype=Object.create(g.prototype),d.prototype.constructor=d,g.setupAliases(d.prototype,[["u"],["v"]]),d.ZERO=new d(0,0),d.ONE=new d(1,1),d.UNIT_X=new d(1,0),d.UNIT_Y=new d(0,1),d.prototype.getComponent=function(a){switch(a){case 0:return this.x;case 1:return this.y}},d.prototype.setComponent=function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b}return this},d.prototype.add=function(a){return this.x+=a.x,this.y+=a.y,this},d.prototype.addDirect=function(a,b){return this.x+=a,this.y+=b,this},d.prototype.sub=function(a){return this.x-=a.x,this.y-=a.y,this},d.prototype.subDirect=function(a,b){return this.x-=a,this.y-=b,this},d.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},d.prototype.mul=function(a){return this.x*=a.x,this.y*=a.y,this},d.prototype.mulDirect=function(a,b){return this.x*=a,this.y*=b,this},d.prototype.scale=function(a){return this.x*=a,this.y*=a,this},d.prototype.div=function(a){return this.x/=a.x,this.y/=a.y,this},d.prototype.divDirect=function(a,b){return this.x/=a,this.y/=b,this},d.prototype.dot=function(a){return this.x*a.x+this.y*a.y},d.prototype.dotDirect=function(a,b){return this.x*a+this.y*b},d.prototype.equals=function(a){return Math.abs(this.x-a.x)<=f.EPSILON&&Math.abs(this.y-a.y)<=f.EPSILON},d.prototype.equalsDirect=function(a,b){return Math.abs(this.x-a)<=f.EPSILON&&Math.abs(this.y-b)<=f.EPSILON},d.prototype.lerp=function(a,b){return this.x+=(a.x-this.x)*b,this.y+=(a.y-this.y)*b,this},function(){var a=new d;d.prototype.reflect=function(b){return a.copy(b),a.scale(2*this.dot(b)),this.sub(a),this}}(),d.prototype.set=function(a){return a instanceof d||a instanceof h||a instanceof i?(this.x=a.x,this.y=a.y):(this.x=arguments[0],this.y=arguments[1]),this},d.prototype.setDirect=function(a,b){return this.x=a,this.y=b,this},d.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},d.prototype.length=function(){return Math.sqrt(this.lengthSquared())},d.prototype.normalize=function(){var a=this.length();return a<f.EPSILON?(this.x=0,this.y=0):(this.x/=a,this.y/=a),this},d.prototype.unsafeNormalize=function(){var a=this.length();return this.x/=a,this.y/=a,this},d.prototype.distanceSquared=function(a){var b=this.x-a.x,c=this.y-a.y;return b*b+c*c},d.prototype.distance=function(a){return Math.sqrt(this.distanceSquared(a))},d.prototype.applyPre=function(a){var b=a.data,c=this.x,d=this.y;return this.x=b[0]*c+b[1]*d,this.y=b[2]*c+b[3]*d,this},d.prototype.applyPost=function(a){var b=a.data,c=this.x,d=this.y;return this.x=b[0]*c+b[2]*d,this.y=b[1]*c+b[3]*d,this},d.prototype.clone=function(){return new d(this.x,this.y)},d.prototype.copy=d.prototype.set,d.prototype.copyTo=function(a){return a.x=this.x,a.y=this.y,this},d.fromArray=function(a){return new d(a[0],a[1])},d.fromAny=function(){if(2===arguments.length)return d.fromArray(arguments);if(arguments[0]instanceof Array)return d.fromArray(arguments[0]);var a=arguments[0];return new d(a.x,a.y)},d.prototype.setArray=function(a){return this.x=a[0],this.y=a[1],this},d.prototype.toArray=function(){return[this.x,this.y]},Object.defineProperty(d.prototype,"data",{get:e.warnOnce("The .data property of Vector2 was removed. Please use the .x and .y properties instead.",function(){var a=[],b=this;return Object.defineProperties(a,{0:{get:function(){return b.x},set:function(a){b.x=a}},1:{get:function(){return b.y},set:function(a){b.y=a}}}),a})}),d.prototype.setVector=e.warnOnce("The setVector method of Vector2 was removed. Please use the set method instead.",function(a){return this.set(a)}),d.add=e.warnOnce("Vector2.add is deprecated.",function(a,b,c){"number"==typeof a&&(a=[a,a]),"number"==typeof b&&(b=[b,b]),c||(c=new d);var e=a.data||a,f=b.data||b;return c.data[0]=e[0]+f[0],c.data[1]=e[1]+f[1],c}),d.sub=e.warnOnce("Vector2.sub is deprecated.",function(a,b,c){"number"==typeof a&&(a=[a,a]),"number"==typeof b&&(b=[b,b]),c||(c=new d);var e=a.data||a,f=b.data||b;return c.data[0]=e[0]-f[0],c.data[1]=e[1]-f[1],c}),d.mul=e.warnOnce("Vector2.mul is deprecated.",function(a,b,c){"number"==typeof a&&(a=[a,a]),"number"==typeof b&&(b=[b,b]),c||(c=new d);var e=a.data||a,f=b.data||b;return c.data[0]=e[0]*f[0],c.data[1]=e[1]*f[1],c}),d.div=e.warnOnce("Vector2.div is deprecated.",function(a,b,c){"number"==typeof a&&(a=[a,a]),"number"==typeof b&&(b=[b,b]),c||(c=new d);var e=a.data||a,f=b.data||b;return c.data[0]=e[0]/f[0],c.data[1]=e[1]/f[1],c}),d.dot=e.warnOnce("Vector2.dot is deprecated.",function(a,b){"number"==typeof a&&(a=[a,a]),"number"==typeof b&&(b=[b,b]);var c=a.data||a,d=b.data||b;return c[0]*d[0]+c[1]*d[1]}),d.prototype.dotVector=e.warnOnce("Vector2.prototype.dotVector is deprecated.",function(a){var b=this.data,c=a.data;return b[0]*c[0]+b[1]*c[1]}),d.prototype.addVector=e.warnOnce("Vector2.prototype.addVector is deprecated.",function(a){return this.data[0]+=a.data[0],this.data[1]+=a.data[1],this}),d.prototype.mulVector=e.warnOnce("Vector2.prototype.mulVector is deprecated.",function(a){return this.data[0]*=a.data[0],this.data[1]*=a.data[1],this}),d.prototype.subVector=e.warnOnce("Vector2.prototype.subVector is deprecated.",function(a){return this.data[0]-=a.data[0],this.data[1]-=a.data[1],this}),a.exports=d},function(a,b,c){function d(){this.enabled=!0,this.entity=null,this.installedAPI=new Set,this.debugLevel="normal"}var e=c(21);d.applyOnEntity=function(){return!1},d.prototype.attached=function(){},d.prototype.detached=function(){},d.prototype.applyAPI=function(a){var b=this.api;if(b)for(var c=Object.keys(b),d=0;d<c.length;d++){var e=c[d];if("undefined"!=typeof a[e])throw new Error("Could not install method "+e+" of "+this.type+" as it is already taken");a[e]=b[e],this.installedAPI.add(e)}},d.prototype.removeAPI=function(a){this.installedAPI.forEach(function(b){delete a[b]})},d.applyEntitySelectionAPI=function(a,b){if(a)for(var c=Object.keys(a),d=0;d<c.length;d++){var f=c[d];if("undefined"!=typeof e[f])throw new Error("Could not install method "+f+" on EntitySelection as it is already taken");e.installMethod(a[f],f,b)}},a.exports=d},function(a,b,c){function d(){f.apply(this,arguments)}function e(){if(1===arguments.length){var a=arguments[0];return a instanceof d?a.top?a.top:[]:Array.isArray(a)?a:[a]}return arguments.length>1?Array.prototype.slice.call(arguments,0):[]}var f=c(22);d.prototype=Object.create(f.prototype),d.prototype.constructor=d,d.prototype.and=function(){if(null===this.top)return this;var a,b,c,d=e.apply(null,arguments);d.length>this.top.length?(b=this.top,c=d):(b=d,c=this.top);for(var f=[],g=0;g<c.length;g++){var h=c[g].id;f[h]=!0}a=c.concat([]);for(var g=0;g<b.length;g++)f[b[g].id]||a.push(b[g]);return this.stack.push(a),this.top=a,this},d.prototype.intersects=function(){if(null===this.top)return this;var a,b,c,d=e.apply(null,arguments);d.length>this.top.length?(b=this.top,c=d):(b=d,c=this.top);for(var f=[],g=0;g<c.length;g++){var h=c[g].id;f[h]=!0}a=[];for(var g=0;g<b.length;g++)f[b[g].id]&&a.push(b[g]);return this.stack.push(a),this.top=a,this},d.prototype.without=function(){if(null===this.top)return this;for(var a,b=e.apply(null,arguments),c=[],d=0;d<b.length;d++){var f=b[d].id;c[f]=!0}a=[];for(var d=0;d<this.top.length;d++)c[this.top[d].id]||a.push(this.top[d]);return this.stack.push(a),this.top=a,this},d.prototype.andSelf=function(){if(null===this.top)return this;if(this.stack.length<=1)return this;var a=this.stack[this.stack.length-2];return this.and.apply(this,a)},d.prototype.parent=function(){if(null===this.top)return this;var a=[],b=this.top.filter(function(b){return b.transformComponent.parent?a[b.transformComponent.parent.entity.id]?!1:(a[b.transformComponent.parent.entity.id]=!0,!0):!1}).map(function(a){return a.transformComponent.parent.entity});return this.stack.push(b),this.top=b,this},d.prototype.children=function(){if(null===this.top)return this;var a=this.top.map(function(a){return a.transformComponent.children.map(function(a){return a.entity})}),b=a.reduce(function(a,b){return a.concat(b)},[]);return this.stack.push(b),this.top=b,this},d.installMethod=function(a,b,c){d.prototype[b]=function(){if(null===this.top)return this;for(var b=0;b<this.top.length;b++){var d=this.top[b];d.hasComponent(c)&&a.apply(d,arguments)}return this}},a.exports=d},function(a,b){function c(){if(this.stack=[],1===arguments.length){var a=arguments[0];a instanceof c?a.top&&this.stack.push(a.top):Array.isArray(a)?this.stack.push(a):this.stack.push([a])}else arguments.length>1&&this.stack.push(Array.prototype.slice.call(arguments,0));this.stack.length>0&&(this.stack[0]=d(this.stack[0])),this.top=0===this.stack.length?null:this.stack[0]}function d(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];a.lastIndexOf(d)===c&&b.push(d)}return b}function e(){if(1===arguments.length){var a=arguments[0];return a instanceof c?a.top?a.top:[]:Array.isArray(a)?a:[a]}return arguments.length>1?Array.prototype.slice.call(arguments,0):[]}c.EMPTY=new c,c.prototype.contains=function(a){return null===this.top?!1:-1!==this.top.indexOf(a)},c.prototype.size=function(){return null===this.top?0:this.top.length},c.prototype.each=function(a){if(null===this.top)return this;for(var b=0;b<this.top.length&&a(this.top[b],b)!==!1;b++);return this},c.prototype.forEach=c.prototype.each,c.prototype.filter=function(a){if(null===this.top)return this;var b=this.top.filter(a);return this.stack.push(b),this.top=b,this},c.prototype.map=function(a){if(null===this.top)return this;var b=this.top.map(a);return this.stack.push(b),this.top=b,this},c.prototype.flatMap=function(a){if(null===this.top)return this;var b=this.top.map(a),c=b.reduce(function(a,b){return a.concat(b)},[]);return this.stack.push(c),this.top=c,this},c.prototype.reduce=function(a,b){if(null===this.top)return this;var c=[this.top.reduce(a,b)];return this.stack.push(c),this.top=c,this},c.prototype.and=function(){if(null===this.top)return this;var a=e.apply(null,arguments),b=this.top.concat(a);return b=d(b),this.stack.push(b),this.top=b,this},c.prototype.intersects=function(){if(null===this.top)return this;var a,b,c=e.apply(null,arguments),d=[];c.length>this.top.length?(a=this.top,b=c):(a=c,b=this.top);for(var f=0;f<a.length;f++){var g=a[f];-1!==b.indexOf(g)&&d.push(g)}return this.stack.push(d),this.top=d,this},c.prototype.without=function(){if(null===this.top)return this;for(var a=e.apply(null,arguments),b=[],c=0;c<this.top.length;c++){var d=this.top[c];-1===a.indexOf(d)&&b.push(d)}return this.stack.push(b),this.top=b,this},c.prototype.andSelf=function(){if(null===this.top)return this;if(this.stack.length<=1)return this;var a=this.stack[this.stack.length-2],b=a.concat(this.top);return b=d(b),this.stack.push(b),this.top=b,this},c.prototype.end=function(){return null===this.top?this:(this.stack.pop(),0===this.stack.length?this.top=null:this.top=this.stack[this.stack.length-1],this)},c.prototype.first=function(){return null===this.top?null:this.top[0]},c.prototype.clone=function(){var a=new c;return a.top=this.top,a.stack=this.stack.concat([]),a},c.prototype.get=function(a){return"number"!=typeof a?null===this.top?[]:this.top.concat([]):0>a?null===this.top?void 0:this.top[this.top.length+a]:null===this.top?void 0:this.top[a]},c.prototype.toArray=function(){return null===this.top?[]:this.top.concat([])},a.exports=c},function(a,b,c){function d(a,b,c,e){0===arguments.length?(this.x=0,this.y=0,this.z=0,this.w=1):1===arguments.length&&"object"==typeof arguments[0]?arguments[0]instanceof d?this.copy(arguments[0]):(this.x=arguments[0][0],this.y=arguments[0][1],this.z=arguments[0][2],this.w=arguments[0][3]):(this.x=a,this.y=b,this.z=c,this.w=e)}var e=(c(10),c(8)),f=c(11),g=c(24),h=c(9),i=c(6);d.prototype.setDirect=f.prototype.setDirect,d.prototype.dot=f.prototype.dot,d.prototype.length=f.prototype.length,d.prototype.lengthSquared=f.prototype.lengthSquared,d.prototype.normalize=f.prototype.normalize,d.prototype.equals=f.prototype.equals,d.IDENTITY=new d(0,0,0,1),d.prototype.copy=function(a){return this.x=a.x,this.y=a.y,this.z=a.z,this.w=a.w,this},d.prototype.set=function(a){return a instanceof d?(this.x=a.x,this.y=a.y,this.z=a.z,this.w=a.w):(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2],this.w=arguments[3]),this},d.slerp=function(a,b,c,d){if(0===c)return d.set(a);if(1===c)return d.set(b);if(a.equals(b))return d.set(a);var e=a.dot(b);d.set(b),0>e&&(d.negate(),e=-e);var f=1-c,g=c;if(1-e>.1){var h=Math.acos(e),i=1/Math.sin(h);f=Math.sin((1-c)*h)*i,g=Math.sin(c*h)*i}var j=f*a.x+g*d.x,k=f*a.y+g*d.y,l=f*a.z+g*d.z,m=f*a.w+g*d.w;return d.setDirect(j,k,l,m),d},d.prototype.negate=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this},d.prototype.conjugate=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},d.prototype.invert=function(){return this.conjugate().normalize()},d.prototype.mul=function(a){var b=this.x,c=this.y,d=this.z,e=this.w,f=a.x,g=a.y,h=a.z,i=a.w;return this.x=b*i+e*f+c*h-d*g,this.y=c*i+e*g+d*f-b*h,this.z=d*i+e*h+b*g-c*f,this.w=e*i-b*f-c*g-d*h,this},function(){var a=new d;d.prototype.slerp=function(b,c){return a.copy(b),d.slerp(this,b,c,a),this.copy(a),this}}(),d.prototype.fromRotationMatrix=function(a){var b,c,d,e,f=a.e00+a.e11+a.e22;if(f>=0){var g=Math.sqrt(f+1);e=.5*g,g=.5/g,b=(a.e21-a.e12)*g,c=(a.e02-a.e20)*g,d=(a.e10-a.e01)*g}else if(a.e00>a.e11&&a.e00>a.e22){var g=Math.sqrt(1+a.e00-a.e11-a.e22);b=.5*g,g=.5/g,c=(a.e10+a.e01)*g,d=(a.e02+a.e20)*g,e=(a.e21-a.e12)*g}else if(a.e11>a.e22){var g=Math.sqrt(1+a.e11-a.e00-a.e22);c=.5*g,g=.5/g,b=(a.e10+a.e01)*g,d=(a.e21+a.e12)*g,e=(a.e02-a.e20)*g}else{var g=Math.sqrt(1+a.e22-a.e00-a.e11);d=.5*g,g=.5/g,b=(a.e02+a.e20)*g,c=(a.e21+a.e12)*g,e=(a.e10-a.e01)*g}return this.setDirect(b,c,d,e)},d.prototype.toRotationMatrix=function(a){var b=a||new g,c=this.lengthSquared(),d=c>0?2/c:0,e=this.x*d,f=this.y*d,h=this.z*d,i=this.x*e,j=this.x*f,k=this.x*h,l=this.w*e,m=this.y*f,n=this.y*h,o=this.w*f,p=this.z*h,q=this.w*h,r=b.data;return r[0]=1-(m+p),r[1]=j+q,r[2]=k-o,r[3]=j-q,r[4]=1-(i+p),r[5]=n+l,r[6]=k+o,r[7]=n-l,r[8]=1-(i+m),b},function(){var a=new e;d.prototype.fromVectorToVector=function(b,c){var e=b,f=c,g=e.length()*f.length();if(Math.abs(g)>h.EPSILON){var i=e.dot(f)/g,j=Math.acos(Math.max(-1,Math.min(i,1)));if(a.copy(e).cross(f),0>i&&a.length()<h.EPSILON){var k;k=Math.abs(e.x)>Math.abs(e.y)?Math.abs(e.x)>Math.abs(e.z)?0:2:Math.abs(e.y)>Math.abs(e.z)?1:2,a.setValue(k,-e[(k+1)%3]),a.setValue((k+1)%3,e[k]),a.setValue((k+2)%3,0)}return this.fromAngleAxis(j,a)}return this.set(d.IDENTITY)}}(),function(){var a=new e;d.prototype.fromAngleAxis=function(b,c){return a.copy(c).normalize(),this.fromAngleNormalAxis(b,a)}}(),d.prototype.fromAngleNormalAxis=function(a,b){if(b.equals(e.ZERO))return this.set(d.IDENTITY);var c=.5*a,f=Math.sin(c),g=Math.cos(c),h=f*b.x,i=f*b.y,j=f*b.z;return this.setDirect(h,i,j,g)},d.prototype.toAngleAxis=function(a){var b,c=this.x*this.x+this.y*this.y+this.z*this.z;if(Math.abs(c)<=h.EPSILON)b=0,null!==a&&(a.x=1,a.y=0,a.z=0);else if(b=2*Math.acos(this.w),null!==a){var d=1/Math.sqrt(c);a.x=this.x*d,a.y=this.y*d,a.z=this.z*d}return b},d.prototype.clone=function(){return new d(this.x,this.y,this.z,this.w)},d.prototype.dot=function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w},d.prototype.setDirect=function(a,b,c,d){return this.x=a,this.y=b,this.z=c,this.w=d,this},d.prototype.setArray=function(a){return this.x=a[0],this.y=a[1],this.z=a[2],this.w=a[3],this},Object.defineProperty(d.prototype,"data",{get:i.warnOnce("The .data property of Quaternion was removed. Please use the .x, .y, .z and .w properties instead.",function(){var a=[],b=this;return Object.defineProperties(a,{0:{get:function(){return b.x},set:function(a){b.x=a}},1:{get:function(){return b.y},set:function(a){b.y=a}},2:{get:function(){return b.z},set:function(a){b.z=a}},3:{get:function(){return b.w},set:function(a){b.w=a}}}),a})}),d.add=i.warnOnce("Quaternion.add is deprecated.",function(a,b,c){return c||(c=new d),c.x=a.x+b.x,c.y=a.y+b.y,c.z=a.z+b.z,c.w=a.w+b.w,c}),d.div=i.warnOnce("Quaternion.div is deprecated",function(a,b,c){c||(c=new d);var e=!0;return c.x=(e&=b.x<0||b.x>0)?a.x/b.x:0,c.y=(e&=b.y<0||b.y>0)?a.y/b.y:0,c.z=(e&=b.z<0||b.z>0)?a.z/b.z:0,c.w=(e&=b.w<0||b.w>0)?a.w/b.w:0,c}),d.mul=d.mul2=i.warnOnce("Quaternion.mul is deprecated.",function(a,b,c){var d=a.x,e=a.y,f=a.z,g=a.w,h=b.x,i=b.y,j=b.z,k=b.w;return c.x=d*k+g*h+e*j-f*i,c.y=e*k+g*i+f*h-d*j,c.z=f*k+g*j+d*i-e*h,c.w=g*k-d*h-e*i-f*j,c}),d.sub=i.warnOnce("Quaternion.sub is deprecated.",function(a,b,c){return c||(c=new d),c.x=a.x-b.x,c.y=a.y-b.y,c.z=a.z-b.z,c.w=a.w-b.w,c}),d.prototype.add=i.warnOnce("Quaternion.prototype.add is deprecated.",function(a){return d.add(this,a,this)}),d.prototype.div=i.warnOnce("Quaternion.prototype.div is deprecated.",function(a){return d.div(this,a,this)}),d.prototype.magnitude=i.warnOnce("Quaternion.prototype.magnitude is deprecated.",function(){var a=this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w;return 1===a?1:Math.sqrt(a)}),d.prototype.magnitudeSquared=i.warnOnce("Quaternion.prototype.magnitudeSquared is deprecated.",function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}),d.scalarAdd=i.warnOnce("Quaternion.prototype.scalarAdd is deprecated.",function(a,b,c){return c||(c=new d),c.x=a.x+b,c.y=a.y+b,c.z=a.z+b,c.w=a.w+b,c}),d.scalarDiv=i.warnOnce("Quaternion.scalarDiv is deprecated.",function(a,b,c){c||(c=new d);var e=!0;return b=(e&=0>b||b>0)?1/b:0,c.x=a.x*b,c.y=a.y*b,c.z=a.z*b,c.w=a.w*b,c}),d.scalarMul=i.warnOnce("Quaternion.scalarMul is deprecated.",function(a,b,c){return c||(c=new d),c.x=a.x*b,c.y=a.y*b,c.z=a.z*b,c.w=a.w*b,c}),d.scalarSub=i.warnOnce("Quaternion.scalarSub is deprecated.",function(a,b,c){return c||(c=new d),c.x=a.x-b,c.y=a.y-b,c.z=a.z-b,c.w=a.w-b,c}),d.prototype.setVector=i.warnOnce("Quaternion.prototype.setVector is deprecated.",function(a){return this.x=a.x,this.y=a.y,this.z=a.z,this.w=a.w,this}),d.prototype.sub=i.warnOnce("Quaternion.prototype.sub is deprecated.",function(a){return d.sub(this,a,this)}),d.prototype.scalarAdd=i.warnOnce("Quaternion.prototype.scalarAdd is deprecated.",function(a){return d.scalarAdd(this,a,this)}),d.prototype.scalarSub=i.warnOnce("Quaternion.prototype.scalarSub is deprecated.",function(a){return d.scalarSub(this,a,this)}),d.prototype.scalarMul=i.warnOnce("Quaternion.prototype.scalarMul is deprecated.",function(a){return d.scalarMul(this,a,this)}),d.prototype.scalarDiv=i.warnOnce("Quaternion.prototype.scalarDiv is deprecated.",function(a){return d.scalarDiv(this,a,this)}),a.exports=d},function(a,b,c){function d(){if(f.call(this,3,3),0===arguments.length)this.data[0]=1,this.data[4]=1,this.data[8]=1;else if(1===arguments.length&&"object"==typeof arguments[0])arguments[0]instanceof d?this.copy(arguments[0]):this.setArray(arguments[0]);else for(var a=0;a<arguments.length;a++)this.data[a]=arguments[a]}var e=c(9),f=c(25),g=c(8),h=c(6);d._tempX=new g,d._tempY=new g,d._tempZ=new g,d.prototype=Object.create(f.prototype),d.prototype.constructor=d,f.setupAliases(d.prototype,[["e00"],["e10"],["e20"],["e01"],["e11"],["e21"],["e02"],["e12"],["e22"]]),d.IDENTITY=new d(1,0,0,0,1,0,0,0,1),d.prototype.add=function(a){var b=this.data,c=a.data;return b[0]+=c[0],b[1]+=c[1],b[2]+=c[2],b[3]+=c[3],b[4]+=c[4],b[5]+=c[5],b[6]+=c[6],b[7]+=c[7],b[8]+=c[8],this},d.prototype.sub=function(a){var b=this.data,c=a.data;return b[0]-=c[0],b[1]-=c[1],b[2]-=c[2],b[3]-=c[3],b[4]-=c[4],b[5]-=c[5],b[6]-=c[6],b[7]-=c[7],b[8]-=c[8],this},d.prototype.scale=function(a){var b=this.data;return b[0]*=a,b[1]*=a,b[2]*=a,b[3]*=a,b[4]*=a,b[5]*=a,b[6]*=a,b[7]*=a,b[8]*=a,this},d.prototype.mul=function(a){var b=a.data,c=b[0],d=b[3],e=b[6],f=b[1],g=b[4],h=b[7],i=b[2],j=b[5],k=b[8],l=this.data,m=l[0],n=l[3],o=l[6],p=l[1],q=l[4],r=l[7],s=l[2],t=l[5],u=l[8],v=this.data;return v[0]=c*m+d*p+e*s,v[3]=c*n+d*q+e*t,v[6]=c*o+d*r+e*u,v[1]=f*m+g*p+h*s,v[4]=f*n+g*q+h*t,v[7]=f*o+g*r+h*u,v[2]=i*m+j*p+k*s,v[5]=i*n+j*q+k*t,v[8]=i*o+j*r+k*u,this},d.prototype.mul2=function(a,b){var c=a.data,d=c[0],e=c[3],f=c[6],g=c[1],h=c[4],i=c[7],j=c[2],k=c[5],l=c[8],m=b.data,n=m[0],o=m[3],p=m[6],q=m[1],r=m[4],s=m[7],t=m[2],u=m[5],v=m[8],w=this.data;return w[0]=d*n+e*q+f*t,w[3]=d*o+e*r+f*u,w[6]=d*p+e*s+f*v,w[1]=g*n+h*q+i*t,w[4]=g*o+h*r+i*u,w[7]=g*p+h*s+i*v,w[2]=j*n+k*q+l*t,w[5]=j*o+k*r+l*u,w[8]=j*p+k*s+l*v,this},d.prototype.transpose=function(){var a=this.data,b=a[3],c=a[6],d=a[7];return a[3]=a[1],a[6]=a[2],a[7]=a[5],a[1]=b,a[2]=c,a[5]=d,this},d.invert=function(a,b){if(b||(b=new d),b===a)return b.copy(d.invert(a));var c=a.determinant();if(Math.abs(c)<e.EPSILON)return b;c=1/c;var f=b.data,g=a.data;return f[0]=(g[4]*g[8]-g[7]*g[5])*c,f[1]=(g[7]*g[2]-g[1]*g[8])*c,f[2]=(g[1]*g[5]-g[4]*g[2])*c,f[3]=(g[6]*g[5]-g[3]*g[8])*c,f[4]=(g[0]*g[8]-g[6]*g[2])*c,f[5]=(g[3]*g[2]-g[0]*g[5])*c,f[6]=(g[3]*g[7]-g[6]*g[4])*c,f[7]=(g[6]*g[1]-g[0]*g[7])*c,f[8]=(g[0]*g[4]-g[3]*g[1])*c,b},d.prototype.invert=function(){return d.invert(this,this)},d.prototype.isOrthogonal=function(){var a=this.data,b=a[0]*a[3]+a[1]*a[4]+a[2]*a[5];return Math.abs(b)>e.EPSILON?!1:(b=a[0]*a[6]+a[1]*a[7]+a[2]*a[8],Math.abs(b)>e.EPSILON?!1:(b=a[3]*a[6]+a[4]*a[7]+a[5]*a[8],Math.abs(b)>e.EPSILON?!1:!0))},d.prototype.isNormal=function(){var a=this.data,b=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];return Math.abs(b-1)>e.EPSILON?!1:(b=a[3]*a[3]+a[4]*a[4]+a[5]*a[5],Math.abs(b-1)>e.EPSILON?!1:(b=a[6]*a[6]+a[7]*a[7]+a[8]*a[8],Math.abs(b-1)>e.EPSILON?!1:!0))},d.prototype.isOrthonormal=function(){return this.isOrthogonal()&&this.isNormal()},d.prototype.determinant=function(){var a=this.data;return a[0]*(a[4]*a[8]-a[7]*a[5])-a[3]*(a[1]*a[8]-a[7]*a[2])+a[6]*(a[1]*a[5]-a[4]*a[2])},d.prototype.setIdentity=function(){var a=this.data;return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,this},d.prototype.multiplyDiagonalPost=function(a,b){var c=a.x,d=a.y,e=a.z,f=this.data,g=b.data;return g[0]=c*f[0],g[1]=c*f[1],g[2]=c*f[2],g[3]=d*f[3],g[4]=d*f[4],g[5]=d*f[5],g[6]=e*f[6],g[7]=e*f[7],g[8]=e*f[8],b},d.prototype.fromAngles=function(a,b,c){var d=Math.cos(a),e=Math.sin(a),f=Math.cos(b),g=Math.sin(b),h=Math.cos(c),i=Math.sin(c),j=this.data;return j[0]=f*h,j[3]=g*e-f*i*d,j[6]=f*i*e+g*d,j[1]=i,j[4]=h*d,j[7]=-h*e,j[2]=-g*h,j[5]=g*i*d+f*e,j[8]=-g*i*e+f*d,this},d.prototype.rotateX=function(a,b){b=b||this;var c=this.data,d=b.data,e=Math.sin(a),f=Math.cos(a),g=c[3],h=c[4],i=c[5],j=c[6],k=c[7],l=c[8];return c!==d&&(d[0]=c[0],d[1]=c[1],d[2]=c[2]),d[3]=g*f+j*e,d[4]=h*f+k*e,d[5]=i*f+l*e,d[6]=j*f-g*e,d[7]=k*f-h*e,d[8]=l*f-i*e,b},d.prototype.rotateY=function(a,b){b=b||this;var c=this.data,d=b.data,e=Math.sin(a),f=Math.cos(a),g=c[0],h=c[1],i=c[2],j=c[6],k=c[7],l=c[8];return c!==d&&(d[3]=c[3],d[4]=c[4],d[5]=c[5]),d[0]=g*f-j*e,d[1]=h*f-k*e,d[2]=i*f-l*e,d[6]=g*e+j*f,d[7]=h*e+k*f,d[8]=i*e+l*f,b},d.prototype.rotateZ=function(a,b){b=b||this;var c=this.data,d=b.data,e=Math.sin(a),f=Math.cos(a),g=c[0],h=c[1],i=c[2],j=c[3],k=c[4],l=c[5];return c!==d&&(d[6]=c[6],d[7]=c[7],d[8]=c[8]),d[0]=g*f+j*e,d[1]=h*f+k*e,d[2]=i*f+l*e,d[3]=j*f-g*e,d[4]=k*f-h*e,d[5]=l*f-i*e,b},d.prototype.toAngles=function(a){var b=a;b||(b=new g);var c=this.data;return c[3]>1-e.EPSILON?(b.y=Math.atan2(c[2],c[8]),b.z=Math.PI/2,b.x=0):c[3]<-1+e.EPSILON?(b.y=Math.atan2(c[2],c[8]),
b.z=-Math.PI/2,b.x=0):(b.y=Math.atan2(-c[2],c[0]),b.x=Math.atan2(-c[7],c[4]),b.z=Math.asin(c[1])),b},d.prototype.fromAngleNormalAxis=function(a,b,c,d){var e=Math.cos(a),f=Math.sin(a),g=1-e,h=b*b,i=c*c,j=d*d,k=b*c*g,l=b*d*g,m=c*d*g,n=b*f,o=c*f,p=d*f,q=this.data;return q[0]=h*g+e,q[3]=k-p,q[6]=l+o,q[1]=k+p,q[4]=i*g+e,q[7]=m-n,q[2]=l-o,q[5]=m+n,q[8]=j*g+e,this},d.prototype.lookAt=function(a,b){var c=d._tempX,e=d._tempY,f=d._tempZ;f.set(a).normalize().scale(-1),c.set(b).cross(f).normalize(),c.equals(g.ZERO)&&(0!==f.x?c.setDirect(f.y,-f.x,0):c.setDirect(0,f.z,-f.y)),e.set(f).cross(c);var h=this.data;return h[0]=c.x,h[1]=c.y,h[2]=c.z,h[3]=e.x,h[4]=e.y,h[5]=e.z,h[6]=f.x,h[7]=f.y,h[8]=f.z,this},d.prototype.copyQuaternion=function(a){return a.toRotationMatrix(this)},d.prototype.equals=function(a){var b=this.data,c=a.data;return Math.abs(b[0]-c[0])<=e.EPSILON&&Math.abs(b[1]-c[1])<=e.EPSILON&&Math.abs(b[2]-c[2])<=e.EPSILON&&Math.abs(b[3]-c[3])<=e.EPSILON&&Math.abs(b[4]-c[4])<=e.EPSILON&&Math.abs(b[5]-c[5])<=e.EPSILON&&Math.abs(b[6]-c[6])<=e.EPSILON&&Math.abs(b[7]-c[7])<=e.EPSILON&&Math.abs(b[8]-c[8])<=e.EPSILON},d.prototype.copy=function(a){var b=this.data,c=a.data;return b[0]=c[0],b[1]=c[1],b[2]=c[2],b[3]=c[3],b[4]=c[4],b[5]=c[5],b[6]=c[6],b[7]=c[7],b[8]=c[8],this},d.prototype.copyMatrix4=function(a){var b=this.data,c=a.data;return b[0]=c[0],b[1]=c[1],b[2]=c[2],b[3]=c[4],b[4]=c[5],b[5]=c[6],b[6]=c[8],b[7]=c[9],b[8]=c[10],this},d.prototype.setArray=function(a){var b=this.data;return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],this},d.prototype.set=d.prototype.copy,d.prototype.clone=function(){return(new d).copy(this)},d.add=h.warnOnce("Matrix3.add is deprecated - use Matrix3.prototype.add instead.",function(a,b,c){c||(c=new d);var e=c.data,f=a.data;if(b instanceof d){var g=b.data;e[0]=f[0]+g[0],e[1]=f[1]+g[1],e[2]=f[2]+g[2],e[3]=f[3]+g[3],e[4]=f[4]+g[4],e[5]=f[5]+g[5],e[6]=f[6]+g[6],e[7]=f[7]+g[7],e[8]=f[8]+g[8]}else e[0]=f[0]+b,e[1]=f[1]+b,e[2]=f[2]+b,e[3]=f[3]+b,e[4]=f[4]+b,e[5]=f[5]+b,e[6]=f[6]+b,e[7]=f[7]+b,e[8]=f[8]+b;return c}),d.sub=h.warnOnce("Matrix3.sub is deprecated - use Matrix3.prototype.sub instead.",function(a,b,c){c||(c=new d);var e=c.data,f=a.data;if(b instanceof d){var g=b.data;e[0]=f[0]-g[0],e[1]=f[1]-g[1],e[2]=f[2]-g[2],e[3]=f[3]-g[3],e[4]=f[4]-g[4],e[5]=f[5]-g[5],e[6]=f[6]-g[6],e[7]=f[7]-g[7],e[8]=f[8]-g[8]}else e[0]=f[0]-b,e[1]=f[1]-b,e[2]=f[2]-b,e[3]=f[3]-b,e[4]=f[4]-b,e[5]=f[5]-b,e[6]=f[6]-b,e[7]=f[7]-b,e[8]=f[8]-b;return c}),d.mul=h.warnOnce("Matrix3.mul is deprecated - use Matrix3.prototype.mul instead.",function(a,b,c){c||(c=new d);var e=c.data,f=a.data;if(b instanceof d){var g=b.data;e[0]=f[0]*g[0],e[1]=f[1]*g[1],e[2]=f[2]*g[2],e[3]=f[3]*g[3],e[4]=f[4]*g[4],e[5]=f[5]*g[5],e[6]=f[6]*g[6],e[7]=f[7]*g[7],e[8]=f[8]*g[8]}else e[0]=f[0]*b,e[1]=f[1]*b,e[2]=f[2]*b,e[3]=f[3]*b,e[4]=f[4]*b,e[5]=f[5]*b,e[6]=f[6]*b,e[7]=f[7]*b,e[8]=f[8]*b;return c}),d.div=h.warnOnce("Matrix3.div is deprecated - use Matrix3.prototype.div instead.",function(a,b,c){c||(c=new d);var e=c.data,f=a.data;if(b instanceof d){var g=b.data;e[0]=f[0]/g[0],e[1]=f[1]/g[1],e[2]=f[2]/g[2],e[3]=f[3]/g[3],e[4]=f[4]/g[4],e[5]=f[5]/g[5],e[6]=f[6]/g[6],e[7]=f[7]/g[7],e[8]=f[8]/g[8]}else e[0]=f[0]/b,e[1]=f[1]/b,e[2]=f[2]/b,e[3]=f[3]/b,e[4]=f[4]/b,e[5]=f[5]/b,e[6]=f[6]/b,e[7]=f[7]/b,e[8]=f[8]/b;return c}),d.prototype.div=h.warnOnce("Matrix3.prototype.div is deprecated.",function(a){return d.div(this,a,this)}),d.combine=h.warnOnce("Matrix3.combine is deprecated - use Matrix3.prototype.mul or .mul2 instead.",function(a,b,c){c||(c=new d);var e=a.data,f=e[0],g=e[3],h=e[6],i=e[1],j=e[4],k=e[7],l=e[2],m=e[5],n=e[8],o=b.data,p=o[0],q=o[3],r=o[6],s=o[1],t=o[4],u=o[7],v=o[2],w=o[5],x=o[8],y=c.data;return y[0]=f*p+g*s+h*v,y[3]=f*q+g*t+h*w,y[6]=f*r+g*u+h*x,y[1]=i*p+j*s+k*v,y[4]=i*q+j*t+k*w,y[7]=i*r+j*u+k*x,y[2]=l*p+m*s+n*v,y[5]=l*q+m*t+n*w,y[8]=l*r+m*u+n*x,c}),d.prototype.combine=h.warnOnce("Matrix3.prototype.combine is deprecated - use Matrix3.prototype.mul or .mul2 instead.",function(a){return d.combine(this,a,this)}),d.transpose=h.warnOnce("Matrix3.transpose is deprecated - use Matrix3.prototype.transpose instead.",function(a,b){b||(b=new d);var c=a.data,e=b.data;if(b===a){var f=c[3],g=c[6],h=c[7];return e[3]=c[1],e[6]=c[2],e[7]=c[5],e[1]=f,e[2]=g,e[5]=h,b}return e[0]=c[0],e[1]=c[3],e[2]=c[6],e[3]=c[1],e[4]=c[4],e[5]=c[7],e[6]=c[2],e[7]=c[5],e[8]=c[8],b}),d.prototype.applyPost=h.warnOnce("Matrix3.prototype.applyPost is deprecated - use Vector3.prototype.applyPost instead.",function(a){var b=this.data,c=a.x,d=a.y,e=a.z;return a.x=b[0]*c+b[3]*d+b[6]*e,a.y=b[1]*c+b[4]*d+b[7]*e,a.z=b[2]*c+b[5]*d+b[8]*e,a}),d.prototype.applyPre=h.warnOnce("Matrix3.prototype.applyPre is deprecated - use Vector3.prototype.applyPre instead.",function(a){var b=this.data,c=a.x,d=a.y,e=a.z;return a.x=b[0]*c+b[1]*d+b[2]*e,a.y=b[3]*c+b[4]*d+b[5]*e,a.z=b[6]*c+b[7]*d+b[8]*e,a}),a.exports=d},function(a,b,c){function d(a,b){this.rows=a||0,this.cols=b||0,this.data=new Float32Array(this.rows*this.cols)}var e=c(9),f=c(6);d.setupAliases=function(a,b){b.forEach(function(b,c){b.forEach(function(b){Object.defineProperty(a,b,{get:function(){return this.data[c]},set:function(a){this.data[c]=a}})}),Object.defineProperty(a,c,{get:function(){return this.data[c]},set:function(a){this.data[c]=a}})})},d.add=f.warnOnce("Matrix.add is deprecated. Use Matrix3.prototype.add, Matrix2.prototype.add or Matrix4.prototype.add instead.",function(a,b,c){var e=a.rows,f=a.cols;if(c||(c=new d(e,f)),b instanceof d)for(var g=0;g<a.data.length;g++)c.data[g]=a.data[g]+b.data[g];else for(var g=0;g<a.data.length;g++)c.data[g]=a.data[g]+b;return c}),d.prototype.add=f.warnOnce("Matrix.prototype.add is deprecated. Use Matrix3.prototype.add, Matrix2.prototype.add or Matrix4.prototype.add instead.",function(a){return d.add(this,a,this)}),d.sub=f.warnOnce("Matrix.sub is deprecated. Use Matrix3.prototype.sub, Matrix2.prototype.sub or Matrix4.prototype.sub instead.",function(a,b,c){var e=a.rows,f=a.cols;if(c||(c=new d(e,f)),b instanceof d)for(var g=0;g<a.data.length;g++)c.data[g]=a.data[g]-b.data[g];else for(var g=0;g<a.data.length;g++)c.data[g]=a.data[g]-b;return c}),d.prototype.sub=f.warnOnce("Matrix.prototype.sub is deprecated. Use Matrix3.prototype.sub, Matrix2.prototype.sub or Matrix4.prototype.sub instead.",function(a){return d.sub(this,a,this)}),d.mul=f.warnOnce("Matrix.mul is deprecated. Use Matrix3.prototype.mul, Matrix2.prototype.mul or Matrix4.prototype.mul instead.",function(a,b,c){var e=a.rows,f=a.cols;if(c||(c=new d(e,f)),b instanceof d)for(var g=0;g<a.data.length;g++)c.data[g]=a.data[g]*b.data[g];else for(var g=0;g<a.data.length;g++)c.data[g]=a.data[g]*b;return c}),d.prototype.mul=f.warnOnce("Matrix.prototype.mul is deprecated. Use Matrix3.prototype.mul, Matrix2.prototype.mul or Matrix4.prototype.mul instead.",function(a){return d.mul(this,a,this)}),d.div=f.warnOnce("Matrix.div is deprecated. Use Matrix3.prototype.div, Matrix2.prototype.div or Matrix4.prototype.div instead.",function(a,b,c){var e=a.rows,f=a.cols;if(c||(c=new d(e,f)),b instanceof d)for(var g=0;g<a.data.length;g++)c.data[g]=a.data[g]/b.data[g];else{b=1/b;for(var g=0;g<a.data.length;g++)c.data[g]=a.data[g]*b}return c}),d.prototype.div=f.warnOnce("Matrix.prototype.div is deprecated. Use Matrix3.prototype.div, Matrix2.prototype.div or Matrix4.prototype.div instead.",function(a){return d.div(this,a,this)}),d.combine=f.warnOnce("Matrix.combine is deprecated. Use Matrix2/3/4.prototype.mul or Matrix2/3/4.prototype.mul2 instead.",function(a,b,c){var e=a.rows,f=b.cols,g=a.cols=b.rows;if(c||(c=new d(e,f)),c===a||c===b)return d.copy(d.combine(a,b),c);for(var h=0;f>h;h++)for(var i=h*e,j=0;e>j;j++){for(var k=0,l=0;g>l;l++)k+=a.data[l*a.rows+j]*b.data[h*b.rows+l];c.data[i+j]=k}return c}),d.prototype.combine=f.warnOnce("Matrix.prototype.combine is deprecated. Use Matrix2/3/4.prototype.mul or Matrix2/3/4.prototype.mul2 instead.",function(a){return d.combine(this,a,this)}),d.transpose=f.warnOnce("Matrix.transpose is deprecated. Use Matrix2/3/4.prototype.transpose instead.",function(a,b){var c=a.cols,e=a.rows;if(b||(b=new d(c,e)),b===a)return d.copy(d.transpose(a),b);for(var f=0;e>f;f++)for(var g=f*c,h=0;c>h;h++)b.data[g+h]=a.data[h*e+f];return b}),d.prototype.transpose=f.warnOnce("Matrix.prototype.transpose is deprecated. Use Matrix2/3/4.prototype.transpose instead.",function(){return d.transpose(this,this)}),d.copy=f.warnOnce("Matrix.copy is deprecated. Use Matrix2/3/4.prototype.copy instead.",function(a,b){var c=a.rows,e=a.cols;return b||(b=new d(c,e)),b.data.set(a.data),b}),d.prototype.copy=f.warnOnce("Matrix.prototype.copy is deprecated. Use Matrix2/3/4.prototype.copy instead.",function(a){return d.copy(a,this)}),d.equals=f.warnOnce("Matrix.equals is deprecated. Use Matrix2/3/4.prototype.equals instead.",function(a,b){if(a.rows!==b.rows||a.cols!==b.cols)return!1;for(var c=0;c<a.data.length;c++)if(!(Math.abs(a.data[c]-b.data[c])<=e.EPSILON))return!1;return!0}),d.prototype.equals=f.warnOnce("Matrix.prototype.equals is deprecated. Use Matrix2/3/4.prototype.equals instead.",function(a){return d.equals(this,a)}),d.prototype.isOrthogonal=f.warnOnce("Matrix.prototype.isOrthogonal is deprecated. Use Matrix2/3/4.prototype.isOrthogonal instead.",function(){for(var a=0;a<this.cols;a++)for(var b=a+1;b<this.cols;b++){for(var c=a*this.rows,d=b*this.rows,f=0,g=0;g<this.rows;g++)f+=this.data[c+g]*this.data[d+g];if(Math.abs(f)>e.EPSILON)return!1}return!0}),d.prototype.isNormal=f.warnOnce("Matrix.prototype.isNormal is deprecated. Use Matrix2/3/4.prototype.isNormal instead.",function(){for(var a=0;a<this.cols;a++){for(var b=a*this.rows,c=0,d=0;d<this.rows;d++)c+=this.data[b+d]*this.data[b+d];if(Math.abs(c-1)>e.EPSILON)return!1}return!0}),d.prototype.isOrthonormal=f.warnOnce("Matrix.prototype.isOrthonormal is deprecated. Use Matrix2/3/4.prototype.isOrthonormal instead.",function(){return this.isOrthogonal()&&this.isNormal()}),d.prototype.clone=f.warnOnce("Matrix.prorotype.clone is deprecated. Use Matrix2/3/4.prototype.clone instead.",function(){return d.copy(this)}),d.prototype.set=f.warnOnce("Matrix.prototype.set is deprecated. Use Matrix2/3/4.prototype.set instead.",function(){if(1===arguments.length&&"object"==typeof arguments[0])if(arguments[0]instanceof d)this.copy(arguments[0]);else for(var a=0;a<arguments[0].length;a++)this.data[a]=arguments[0][a];else for(var a=0;a<arguments.length;a++)this.data[a]=arguments[a];return this}),d.prototype.toString=f.warnOnce("Matrix.prorotype.toString is deprecated.",function(){for(var a="",b=0;b<this.cols;b++){var c=b*this.rows;a+="[";for(var d=0;d<this.rows;d++)a+=this.data[c+d],a+=d!==this.rows-1?", ":"";a+=b!==this.cols-1?"], ":"]"}return a}),a.exports=d},,function(a,b,c){function d(a,b,c,f,g,h){if(1===arguments.length&&arguments[0]instanceof Object){var i=arguments[0];a=i.width,b=i.height,c=i.length,f=i.tileX,g=i.tileY,h=i.textureMode}this.xExtent=void 0!==a?.5*a:.5,this.yExtent=void 0!==b?.5*b:.5,this.zExtent=void 0!==c?.5*c:.5,this.tileX=f||1,this.tileY=g||1,this.textureMode=void 0!==h?h:d.TextureModes.Uniform;var j=e.defaultMap([e.POSITION,e.NORMAL,e.TEXCOORD0]);e.call(this,j,24,36),this.rebuild()}var e=c(14),f=c(6);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.rebuild=function(){function a(a){for(var b=0;b<a.length;b++){var c=3*a[b];k.push(j[c]),k.push(j[c+1]),k.push(j[c+2])}}function b(){for(var a=0;a<l.length/3;a++)for(var b=0;4>b;b++){var c=3*a;m.push(l[c]),m.push(l[c+1]),m.push(l[c+2])}}var c=this.xExtent,f=this.yExtent,g=this.zExtent,h=this.tileX,i=this.tileY,j=[-c,-f,-g,c,-f,-g,c,f,-g,-c,f,-g,c,-f,g,-c,-f,g,c,f,g,-c,f,g],k=[];a([0,1,2,3,1,4,6,2,4,5,7,6,5,0,3,7,2,6,7,3,0,5,4,1]),this.getAttributeBuffer(e.POSITION).set(k);var l=[0,0,-1,1,0,0,0,0,1,-1,0,0,0,1,0,0,-1,0],m=[];b(),this.getAttributeBuffer(e.NORMAL).set(m);var n=[];if(this.textureMode===d.TextureModes.Uniform)for(var o=0;6>o;o++)n.push(h),n.push(0),n.push(0),n.push(0),n.push(0),n.push(i),n.push(h),n.push(i);else n.push(1,1/3,.75,1/3,.75,2/3,1,2/3),n.push(.75,1/3,.5,1/3,.5,2/3,.75,2/3),n.push(.5,1/3,.25,1/3,.25,2/3,.5,2/3),n.push(.25,1/3,0,1/3,0,2/3,.25,2/3),n.push(.5,1,.5,2/3,.25,2/3,.25,1),n.push(.25,0,.25,1/3,.5,1/3,.5,0);return this.getAttributeBuffer(e.TEXCOORD0).set(n),this.getIndexBuffer().set([2,1,0,3,2,0,6,5,4,7,6,4,10,9,8,11,10,8,14,13,12,15,14,12,18,17,16,19,18,16,22,21,20,23,22,20]),this},d.prototype.clone=function(){var a=f.shallowSelectiveClone(this,["tileX","tileY","textureMode"]);return a.width=2*this.xExtent,a.height=2*this.yExtent,a.length=2*this.zExtent,new d(a)},d.TextureModes={Uniform:"Uniform",Unfolded:"Unfolded"},a.exports=d},function(a,b,c){function d(a,b,c,d){if(1===arguments.length&&arguments[0]instanceof Object){var f=arguments[0];a=f.width,b=f.height,c=f.tileX,d=f.tileY}this.xExtent=void 0!==a?.5*a:.5,this.yExtent=void 0!==b?.5*b:.5,this.tileX=c||1,this.tileY=d||1;var g=e.defaultMap([e.POSITION,e.NORMAL,e.TEXCOORD0]);e.call(this,g,4,6),this.rebuild()}var e=c(14),f=c(6);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.rebuild=function(){var a=this.xExtent,b=this.yExtent,c=this.tileX,d=this.tileY;return this.getAttributeBuffer(e.POSITION).set([-a,-b,0,-a,b,0,a,b,0,a,-b,0]),this.getAttributeBuffer(e.NORMAL).set([0,0,1,0,0,1,0,0,1,0,0,1]),this.getAttributeBuffer(e.TEXCOORD0).set([0,0,0,d,c,d,c,0]),this.getIndexBuffer().set([0,3,1,1,3,2]),this},d.prototype.clone=function(){var a=f.shallowSelectiveClone(this,["xExtent","yExtent","tileX","tileY"]);return new d(a)},a.exports=d},function(a,b,c){function d(a,b,c,e){if(1===arguments.length&&arguments[0]instanceof Object){var g=arguments[0];a=g.zSamples,b=g.radialSamples,c=g.radius,e=g.textureMode}this.zSamples=(void 0!==a?a:8)+1,this.radialSamples=void 0!==b?b:8,this.radius=void 0!==c?c:.5,"string"==typeof e&&(e=d.TextureModes[e]),this.textureMode=void 0!==e?e:d.TextureModes.Polar,this.viewInside=!1;var h=f.defaultMap([f.POSITION,f.NORMAL,f.TEXCOORD0]),i=this.textureMode===d.TextureModes.Chromeball?this.zSamples+1:this.zSamples;this._useSharedPoleVertices=this.textureMode!==d.TextureModes.Projected&&this.textureMode!==d.TextureModes.Linear;var j=this._useSharedPoleVertices?2:0,k=(i-j)*(this.radialSamples+1)+j,l=6*(i-2)*this.radialSamples;f.call(this,h,k,l),this.rebuild()}function e(a,b,c){a[3*c+0]=a[3*b+0],a[3*c+1]=a[3*b+1],a[3*c+2]=a[3*b+2]}var f=c(14),g=c(8),h=c(9),i=c(6);d.prototype=Object.create(f.prototype),d.prototype.constructor=d,d.prototype.rebuild=function(){for(var a=this.getAttributeBuffer(f.POSITION),b=this.getAttributeBuffer(f.NORMAL),c=this.getAttributeBuffer(f.TEXCOORD0),i=this.getIndexBuffer(),j=1/this.radialSamples,k=2/(this.zSamples-1),l=[],m=[],n=0;n<this.radialSamples;n++){var o=h.TWO_PI*j*n;m[n]=Math.cos(o),l[n]=Math.sin(o)}l[this.radialSamples]=l[0],m[this.radialSamples]=m[0];var p=0,q=this.zSamples;this._useSharedPoleVertices&&(p=1,q=this.zSamples-1);for(var r=0,s=new g,t=new g,u=new g,v=p;q>v;v++){var w=h.HALF_PI*(-1+k*v),x=Math.sin(w),y=this.radius*x,z=t.setDirect(0,0,0);z.z+=y;for(var A,B=Math.sqrt(Math.abs(this.radius*this.radius-y*y)),C=r,n=0;n<this.radialSamples;n++){var D=n*j,E=u.setDirect(m[n],l[n],0);s.copy(E).scale(B),a[3*r+0]=z.x+s.x,a[3*r+1]=z.y+s.y,a[3*r+2]=z.z+s.z,A=s.setDirect(a[3*r+0],a[3*r+1],a[3*r+2]),A.normalize(),this.viewInside?(b[3*r+0]=-A.x,b[3*r+1]=-A.y,b[3*r+2]=-A.z):(b[3*r+0]=A.x,b[3*r+1]=A.y,b[3*r+2]=A.z);var F=0;if(this._useSharedPoleVertices||v!==p&&v!==q-1||(F=.5*j),this.textureMode===d.TextureModes.Linear)c[2*r+0]=D+F,c[2*r+1]=.5*(x+1);else if(this.textureMode===d.TextureModes.Projected)c[2*r+0]=D+F,c[2*r+1]=(h.HALF_PI+Math.asin(x))/Math.PI;else if(this.textureMode===d.TextureModes.Polar){var G=(h.HALF_PI-Math.abs(w))/Math.PI,H=G*m[n]+.5,I=G*l[n]+.5;c[2*r+0]=H,c[2*r+1]=I}else if(this.textureMode===d.TextureModes.Chromeball){var G=Math.sin((h.HALF_PI+w)/2);G/=2;var H=G*m[n]+.5,I=G*l[n]+.5;c[2*r+0]=H,c[2*r+1]=I}r++}if(e(a,C,r),e(b,C,r),this.textureMode===d.TextureModes.Linear)c[2*r+0]=1,c[2*r+1]=.5*(x+1);else if(this.textureMode===d.TextureModes.Projected)c[2*r+0]=1,c[2*r+1]=(h.HALF_PI+Math.asin(x))/Math.PI;else if(this.textureMode===d.TextureModes.Polar){var G=(h.HALF_PI-Math.abs(w))/Math.PI;c[2*r+0]=G+.5,c[2*r+1]=.5}else if(this.textureMode===d.TextureModes.Chromeball){var G=Math.sin((h.HALF_PI+w)/2);G/=2,c[2*r+0]=G+.5,c[2*r+1]=.5}r++}if(this.textureMode===d.TextureModes.Chromeball){for(var J=h.HALF_PI-.001,K=this.radius*Math.sin(J),L=Math.sqrt(Math.abs(this.radius*this.radius-K*K)),C=r,n=0;n<this.radialSamples;n++){a[3*r+0]=L*m[n],a[3*r+1]=L*l[n],a[3*r+2]=K;var A=s.setDirect(a[3*r+0],a[3*r+1],a[3*r+2]);A.normalize(),this.viewInside?(b[3*r+0]=-A.x,b[3*r+1]=-A.y,b[3*r+2]=-A.z):(b[3*r+0]=A.x,b[3*r+1]=A.y,b[3*r+2]=A.z);var G=Math.sin((h.HALF_PI+J)/2);G/=2;var H=G*m[n]+.5,I=G*l[n]+.5;c[2*r+0]=H,c[2*r+1]=I,r++}e(a,C,r),e(b,C,r);var G=Math.sin((h.HALF_PI+J)/2);G/=2,c[2*r+0]=G+.5,c[2*r+1]=.5,r++}this._useSharedPoleVertices&&(a[3*r+0]=0,a[3*r+1]=0,a[3*r+2]=-this.radius,this.viewInside?(b[3*r+0]=0,b[3*r+1]=0,b[3*r+2]=1):(b[3*r+0]=0,b[3*r+1]=0,b[3*r+2]=-1),this.textureMode===d.TextureModes.Polar||this.textureMode===d.TextureModes.Chromeball?(c[2*r+0]=.5,c[2*r+1]=.5):(c[2*r+0]=.5,c[2*r+1]=0),r++,a[3*r+0]=0,a[3*r+1]=0,a[3*r+2]=this.radius,this.viewInside?(b[3*r+0]=0,b[3*r+1]=0,b[3*r+2]=-1):(b[3*r+0]=0,b[3*r+1]=0,b[3*r+2]=1),this.textureMode===d.TextureModes.Polar?(c[2*r+0]=.5,c[2*r+1]=.5):this.textureMode===d.TextureModes.Chromeball?(c[2*r+0]=1,c[2*r+1]=-.5):(c[2*r+0]=.5,c[2*r+1]=1));var M=0,N=this.textureMode===d.TextureModes.Chromeball?this.zSamples+1:this.zSamples,O=0;this._useSharedPoleVertices||(O=this.radialSamples+1);for(var v=0;N-3>v;v++){var P=O,Q=P+1;O+=this.radialSamples+1;for(var R=O,S=R+1,r=0;r<this.radialSamples;r++)this.viewInside?(i[M++]=P++,i[M++]=R,i[M++]=Q,i[M++]=Q++,i[M++]=R++,i[M++]=S++):(i[M++]=P++,i[M++]=Q,i[M++]=R,i[M++]=Q++,i[M++]=S++,i[M++]=R++)}for(var r=0;r<this.radialSamples;r++){var P,Q,R;this._useSharedPoleVertices?(P=r,Q=this.vertexCount-2,R=r+1):(P=r,Q=r+this.radialSamples+2,R=r+this.radialSamples+1),this.viewInside?(i[M++]=P,i[M++]=R,i[M++]=Q):(i[M++]=P,i[M++]=Q,i[M++]=R)}for(var T=(q-p-1)*(this.radialSamples+1),r=0;r<this.radialSamples;r++){var P,Q,R;this._useSharedPoleVertices?(P=r+T,Q=r+1+T,R=this.vertexCount-1):(P=r+T-this.radialSamples-1,Q=r+T-this.radialSamples,R=r+T),this.viewInside?(i[M++]=P,i[M++]=R,i[M++]=Q):(i[M++]=P,i[M++]=Q,i[M++]=R)}return this},d.prototype.clone=function(){var a=i.shallowSelectiveClone(this,["zSamples","radialSamples","radius","textureMode"]);return new d(a)},d.TextureModes={Linear:"Linear",Projected:"Projected",Polar:"Polar",Chromeball:"Chromeball"},a.exports=d},function(a,b,c){function d(a,b){this.id=null,this.name="Default Material",this.shader=null,"string"==typeof a?this.name=a:a&&a.vshader&&a.fshader&&(this.shader=d.createShader(a)),b&&b.vshader&&b.fshader?this.shader=d.createShader(b):"string"==typeof b&&(this.name=b),this.uniforms={},this._textureMaps={},this.cullState={enabled:!0,cullFace:"Back",frontFace:"CCW"},this.blendState={blending:"NoBlending",blendEquation:"AddEquation",blendSrc:"SrcAlphaFactor",blendDst:"OneMinusSrcAlphaFactor"},this.depthState={enabled:!0,write:!0,depthFunc:"LessEqual"},this.offsetState={enabled:!1,factor:1,units:1},this.dualTransparency=!1,this.wireframe=!1,this.flat=!1,this.lineWidth=1,this.renderQueue=null,this.fullOverride=!1,this.errorOnce=!1}var e=c(31),f=c(6);d.prototype.setTexture=function(a,b){this._textureMaps[a]=b},d.prototype.getTexture=function(a){return this._textureMaps[a]},d.prototype.removeTexture=function(a){delete this._textureMaps[a]},d.prototype.getTextures=function(){var a=[];for(var b in this._textureMaps)a.push(this._textureMaps[b]);return a},d.prototype.getTextureEntries=function(){return this._textureMaps},d.prototype.getRenderQueue=function(){return null!==this.renderQueue?this.renderQueue:null!==this.shader?this.shader.renderQueue:1e3},d.prototype.setRenderQueue=function(a){this.renderQueue=a},d.prototype.clone=function(a){a=a||{};var b=new d(this.name);if(b.id=this.id,b.name=this.name,b.shader=this.shader.clone(),a.shareUniforms?b.uniforms=this.uniforms:b.uniforms=f.deepClone(this.uniforms),a.shareTextures)for(var c=Object.keys(this._textureMaps),e=0;e<c.length;e++){var g=c[e];b._textureMaps[g]=this._textureMaps[g]}else for(var c=Object.keys(this._textureMaps),e=0;e<c.length;e++){var g=c[e];b._textureMaps[g]=this._textureMaps[g].clone()}return b.cullState.enabled=this.cullState.enabled,b.cullState.cullFace=this.cullState.cullFace,b.cullState.frontFace=this.cullState.frontFace,b.blendState.blending=this.blendState.blending,b.blendState.blendEquation=this.blendState.blendEquation,b.blendState.blendSrc=this.blendState.blendSrc,b.blendState.blendDst=this.blendState.blendDst,b.depthState.enabled=this.depthState.enabled,b.depthState.write=this.depthState.write,b.offsetState.enabled=this.offsetState.enabled,b.offsetState.factor=this.offsetState.factor,b.offsetState.units=this.offsetState.units,b.dualTransparency=this.dualTransparency,b.wireframe=this.wireframe,b.flat=this.flat,b.renderQueue=this.renderQueue,b.fullOverride=this.fullOverride,b.errorOnce=this.errorOnce,b},d.createShader=function(a,b){var c=new e(b||null,a);return null===c.name&&(c.name="DefaultShader"+c._id),c},d.clearShaderCache=function(){},d.createEmptyMaterial=function(a,b){var c=new d(b||"Empty Material");return c.empty(),a?c.shader=d.createShader(a):c.shader=void 0,c},d.prototype.empty=function(){this.cullState={},this.blendState={},this.depthState={},this.offsetState={},this.wireframe=void 0,this.renderQueue=void 0,this.flat=void 0,this._textureMaps={},this.shader=void 0,this.uniforms={}},a.exports=d},function(a,b,c){function d(a,b){if(!b.vshader||!b.fshader)throw new Error("Missing shader sources for shader: "+a);this.originalShaderDefinition=b,this.shaderDefinition=b,this.origVertexSource=b.vshader,this.origFragmentSource=b.fshader,this.name=a,this.shaderProgram=null,this.vertexShader=null,this.fragmentShader=null,this.renderer=null,this.attributeMapping={},this.attributeIndexMapping={},this.uniformMapping={},this.uniformCallMapping={},this.textureSlots=[],this.textureSlotsNaming={},this.textureIndex=0,this.currentCallbacks={},this.overridePrecision=b.precision||null,this.processors=b.processors,this.builder=b.builder,this.defines=b.defines||{},this.attributes=b.attributes||{},this.uniforms=b.uniforms||{},this.defineKey=b.defineKey||"",this.defineKeyDirty=!0,this.frameStart=!0,this.attributeKeys=null,this.matchedUniforms=[],this.renderQueue=j.OPAQUE,d.cache.has(b)?this._id=d.cache.get(b):(this._id=d.cache.size,d.cache.set(b,this._id)),this.errorOnce=!1,this.vertexSource="function"==typeof this.origVertexSource?this.origVertexSource():this.origVertexSource,this.fragmentSource="function"==typeof this.origFragmentSource?this.origFragmentSource():this.origFragmentSource}function e(a){a[d.PROJECTION_MATRIX]=function(a,b){var c=b.camera.getProjectionMatrix();a.uniformMatrix4fv(c)},a[d.VIEW_MATRIX]=function(a,b){var c=b.camera.getViewMatrix();a.uniformMatrix4fv(c)},a[d.WORLD_MATRIX]=function(a,b){var c=void 0!==b.transform?b.transform.matrix:h.IDENTITY;a.uniformMatrix4fv(c)},a[d.NORMAL_MATRIX]=function(a,b){var c=void 0!==b.transform?b.transform.normalMatrix:g.IDENTITY;a.uniformMatrix3fv(c)},a[d.VIEW_INVERSE_MATRIX]=function(a,b){var c=b.camera.getViewInverseMatrix();a.uniformMatrix4fv(c)},a[d.VIEW_PROJECTION_MATRIX]=function(a,b){var c=b.camera.getViewProjectionMatrix();a.uniformMatrix4fv(c)},a[d.VIEW_PROJECTION_INVERSE_MATRIX]=function(a,b){var c=b.camera.getViewProjectionInverseMatrix();a.uniformMatrix4fv(c)};for(var b=0;16>b;b++)a[d["TEXTURE"+b]]=function(a){return function(b){b.uniform1i(a)}}(b);for(var b=0;8>b;b++)a[d["LIGHT"+b]]=function(a){return function(b,c){var d=c.lights[a];void 0!==d?b.uniform3f(d.translation.x,d.translation.y,d.translation.z):b.uniform3f(-20,20,20)}}(b);a[d.LIGHTCOUNT]=function(a,b){a.uniform1i(b.lights.length)},a[d.CAMERA]=function(a,b){var c=b.camera.translation;a.uniform3f(c.x,c.y,c.z)},a[d.NEAR_PLANE]=function(a,b){a.uniform1f(b.camera.near)},a[d.FAR_PLANE]=function(a,b){a.uniform1f(b.camera.far)},a[d.MAIN_NEAR_PLANE]=function(a,b){a.uniform1f(b.mainCamera.near)},a[d.MAIN_FAR_PLANE]=function(a,b){a.uniform1f(b.mainCamera.far)},a[d.MAIN_DEPTH_SCALE]=function(a,b){a.uniform1f(1/(b.mainCamera.far-b.mainCamera.near))},a[d.AMBIENT]=function(a,b){var c=void 0!==b.material.materialState?b.material.materialState.ambient:d.DEFAULT_AMBIENT;a.uniform4fv(c)},a[d.EMISSIVE]=function(a,b){var c=void 0!==b.material.materialState?b.material.materialState.emissive:d.DEFAULT_EMISSIVE;a.uniform4fv(c)},a[d.DIFFUSE]=function(a,b){var c=void 0!==b.material.materialState?b.material.materialState.diffuse:d.DEFAULT_DIFFUSE;a.uniform4fv(c)},a[d.SPECULAR]=function(a,b){var c=d.DEFAULT_SPECULAR;void 0!==b.material.materialState&&(c=b.material.materialState.specular,c[3]=Math.max(b.material.materialState.shininess,1)),a.uniform4fv(c)},a[d.SPECULAR_POWER]=function(a,b){var c=void 0!==b.material.materialState?b.material.materialState.shininess:d.DEFAULT_SHININESS;c=Math.max(c,1),a.uniform1f(c)},a[d.TIME]=function(a){a.uniform1f(i.time)},a[d.TPF]=function(a){a.uniform1f(i.tpf)},a[d.RESOLUTION]=function(a,b){a.uniform2f(b.renderer.viewportWidth,b.renderer.viewportHeight)}}var f=c(32),g=c(24),h=c(33),i=c(34),j=c(43),k=c(6),l=c(44);d.cache=new Map,d.prototype.clone=function(){return new d(this.name,k.deepClone({precision:this.precision,processors:this.processors,builder:this.builder,defines:this.defines,attributes:this.attributes,uniforms:this.uniforms,vshader:this.origVertexSource,fshader:this.origFragmentSource,defineKey:this.defineKey}))},d.prototype.cloneOriginal=function(){return new d(this.name,this.originalShaderDefinition)},d.prototype.precompile=function(a){null===this.shaderProgram&&(this._investigateShaders(),this.addDefines(this.defines),this.addPrecision(this.overridePrecision||a.shaderPrecision),this.compile(a))};var m=/\b(attribute|uniform)\s+(float|int|bool|vec2|vec3|vec4|mat2|mat3|mat4|sampler2D|sampler3D|samplerCube)\s+(\w+)(\s*\[\s*\w+\s*\])*;/g;d.prototype.compileProgram=function(a){null===this.shaderProgram&&(this._investigateShaders(),this.addDefines(this.defines),this.addPrecision(this.overridePrecision||a.shaderPrecision),this.compile(a))},d.prototype.activateProgram=function(a,b){return a.usedProgram!==this.shaderProgram?(b.useProgram(this.shaderProgram),a.usedProgram=this.shaderProgram,!0):void 0},d.prototype.bindAttributeKey=function(a,b,c,d){var e=c[this.attributes[d]];if(e){var f=this.attributeIndexMapping[d];void 0!==f&&(a.newlyEnabledAttributes[f]=!0,b.bindVertexAttribute(f,e))}},d.prototype.bindAttributes=function(a,b,c){if(this.attributes)for(var d=0,e=this.attributeKeys.length;e>d;d++)this.bindAttributeKey(a,b,c,this.attributeKeys[d])},d.prototype.disableAttributes=function(a,b){for(var c=0,d=a.enabledAttributes.length;d>c;c++){var e=a.enabledAttributes[c],f=a.newlyEnabledAttributes[c];!f&&e&&(b.disableVertexAttribArray(c),a.enabledAttributes[c]=!1)}},d.prototype.enableAttributes=function(a,b){for(var c=0,d=a.newlyEnabledAttributes.length;d>c;c++){var e=a.enabledAttributes[c],f=a.newlyEnabledAttributes[c];f&&!e&&(b.enableVertexAttribArray(c),a.enabledAttributes[c]=!0)}},d.prototype.matchUniforms=function(a){var b=this.matchedUniforms;if(b){this.textureIndex=0;for(var c=0,d=b.length;d>c;c++)this._bindUniform(b[c],a)}},d.prototype.apply=function(a,b){var c=b.context,d=b.rendererRecord;this.compileProgram(b),this.activateProgram(d,c),d.newlyEnabledAttributes.length=0,this.bindAttributes(d,b,a.meshData.attributeMap),this.disableAttributes(d,c),this.enableAttributes(d,c),this.matchUniforms(a)},d.prototype.defineValue=function(a,b){var c=a.material.uniforms[b];return void 0===c&&(c=this.uniforms[b]),c},d.prototype.mapSlot=function(a,b,c){var d=a.material.getTexture(c.mapping);d instanceof Array?this.arrayType(b,c,d):(c.index=this.textureIndex,b.call(this.textureIndex++))},d.prototype.arrayType=function(a,b,c){var d=[];b.index=[];for(var e=0;e<c.length;e++)b.index.push(this.textureIndex),d.push(this.textureIndex++);a.call(d)},d.prototype.stringType=function(a,b,c){var d=this.currentCallbacks[b];if(d)d(c,a);else{var e=this.textureSlotsNaming[b];void 0!==e&&this.mapSlot(a,c,e)}},d.prototype.callMapping=function(a,b,c){var d=this.defineValue(a,b),e=typeof d;if("string"===e)this.stringType(a,b,c,d);else{var f="function"===e?d(a):d;void 0!==f&&c.call(f)}},d.prototype._bindUniform=function(a,b){var c=this.uniformCallMapping[a];void 0!==c&&this.callMapping(b,a,c)},d.prototype.setDefine=function(a,b){this.defineKeyDirty=this.defineKeyDirty||this.defines[a]!==b,this.defines[a]=b},d.prototype.removeDefine=function(a){this.defineKeyDirty=this.defineKeyDirty||void 0!==this.defines[a],this.defines[a]=void 0},d.prototype.hasDefine=function(a){return this.defines[a]!==!1&&void 0!==this.defines[a]},d.prototype.startFrame=function(){this.frameStart=!0},d.prototype.endFrame=function(){this.frameStart=!1},d.prototype.updateProcessors=function(a){if(this.processors)for(var b=0;b<this.processors.length;b++)this.processors[b](this,a)},d.prototype.getDefineKey=function(a){if(this.defineKeyDirty){for(var b="Key:"+this.name,c=Object.keys(this.defines),d=0;d<c.length;d++){var e=c[d],f=this.defines[e];void 0!==f&&f!==!1&&-1===a.indexOf(e)&&a.push(e)}for(var d=0,g=a.length;g>d;d++){var e=a[d],f=this.defines[e];void 0!==f&&f!==!1&&(b+="_"+d+":"+f)}this.defineKey=b,this.defineKeyDirty=!1}return this.defineKey},d.prototype.rebuild=function(){this.shaderProgram=null,this.attributeMapping={},this.attributeIndexMapping={},this.uniformMapping={},this.uniformCallMapping={},this.currentCallbacks={},this.attributeKeys=null,this.vertexSource="function"==typeof this.origVertexSource?this.origVertexSource():this.origVertexSource,this.fragmentSource="function"==typeof this.origFragmentSource?this.origFragmentSource():this.origFragmentSource,this.defineKeyDirty=!0},d.prototype._investigateShaders=function(){this.textureSlots=[],this.textureSlotsNaming={},d.investigateShader(this.vertexSource,this),d.investigateShader(this.fragmentSource,this)},d.investigateShader=function(a,b){m.lastIndex=0;for(var c=m.exec(a);null!==c;){var d={format:c[2]},e=c[1],f=c[3],g=c[4];if(g&&("float"===d.format?d.format="floatarray":"int"===d.format?d.format="intarray":0===d.format.indexOf("sampler")&&(d.format="samplerArray")),"attribute"===e)b.attributeMapping[f]=d;else{if(0===d.format.indexOf("sampler")){var h={format:d.format,name:f,mapping:b.uniforms[f],index:b.textureSlots.length};b.textureSlots.push(h),b.textureSlotsNaming[h.name]=h}b.uniformMapping[f]=d}c=m.exec(a)}},d.prototype.compile=function(a){var b=a.context;this.renderer=a,this.vertexShader=this._getShader(b,void 0!==b.VERTEX_SHADER?b.VERTEX_SHADER:WebGLRenderingContext.VERTEX_SHADER,this.vertexSource),this.fragmentShader=this._getShader(b,void 0!==b.FRAGMENT_SHADER?b.FRAGMENT_SHADER:WebGLRenderingContext.FRAGMENT_SHADER,this.fragmentSource),(null===this.vertexShader||null===this.fragmentShader)&&console.error("Shader error - no shaders"),this.shaderProgram=b.createProgram();var c=b.getError();if((null===this.shaderProgram||0!==c)&&(console.error("Shader error: "+c+" [shader: "+this.name+"]"),l.emit("goo.shader.error")),b.attachShader(this.shaderProgram,this.vertexShader),b.attachShader(this.shaderProgram,this.fragmentShader),b.linkProgram(this.shaderProgram),!b.getProgramParameter(this.shaderProgram,void 0!==b.LINK_STATUS?b.LINK_STATUS:WebGLRenderingContext.LINK_STATUS)){var d=b.getProgramInfoLog(this.shaderProgram);console.error("Could not initialise shaders: "+d),l.emit("goo.shader.error",d)}for(var e in this.attributeMapping){var g=b.getAttribLocation(this.shaderProgram,e);-1!==g&&(this.attributeIndexMapping[e]=g)}for(var e in this.uniformMapping){var h=b.getUniformLocation(this.shaderProgram,e);if(h)this.uniformCallMapping[e]=new f(b,h,this.uniformMapping[e].format);else for(var i=this.textureSlots.length,j=0;i>j;j++){
var k=this.textureSlots[j];if(k.name===e){for(this.textureSlots.splice(j,1),delete this.textureSlotsNaming[k.name];i-1>j;j++)this.textureSlots[j].index--;break}}}if(this.attributes&&(this.attributeKeys=Object.keys(this.attributes)),this.uniforms){this.matchedUniforms=[];for(var m in this.uniforms){var n=this.uniformCallMapping[m];void 0!==n&&this.matchedUniforms.push(m);var o=this.uniforms[m];this.defaultCallbacks[o]&&(this.currentCallbacks[m]=this.defaultCallbacks[o])}}};var n=/\b\d+:(\d+):\s(.+)\b/g,o=/\((\d+),\s*\d+\):\s(.+)/g;d.prototype._getShader=function(a,b,c){var d=a.createShader(b);if(a.shaderSource(d,c),a.compileShader(d),!a.getShaderParameter(d,void 0!==a.COMPILE_STATUS?a.COMPILE_STATUS:WebGLRenderingContext.COMPILE_STATUS)){var e=a.getShaderInfoLog(d),f=b===(void 0!==a.VERTEX_SHADER?a.VERTEX_SHADER:WebGLRenderingContext.VERTEX_SHADER)?"VertexShader":"FragmentShader";n.lastIndex=0;var g=n.exec(e);if(null===g&&(g=o.exec(e)),null!==g)for(;null!==g;){var h=c.split("\n"),i=g[1],j=g[2];console.error("Error in "+f+" - ["+this.name+"]["+this._id+"] at line "+i+":"),console.error("	Error: "+j),console.error("	Source: "+h[i-1]),g=n.exec(e)}else console.error("Error in "+f+" - ["+this.name+"]["+this._id+"] "+e);return null}return d};var p=/\bprecision\s+(lowp|mediump|highp)\s+(float|int);/g;d.prototype.addPrecision=function(a){p.lastIndex=0;var b=p.exec(this.vertexSource);null===b&&(this.vertexSource="precision "+a+" float;\n"+this.vertexSource),p.lastIndex=0;var c=p.exec(this.fragmentSource);null===c&&(this.fragmentSource="precision "+a+" float;\n"+this.fragmentSource)},d.prototype.addDefines=function(a){if(a){var b=this.generateDefines(a);this.vertexSource=b+"\n"+this.vertexSource,this.fragmentSource=b+"\n"+this.fragmentSource}},d.prototype.generateDefines=function(a){var b=[];for(var c in a){var d=a[c];if(d!==!1&&void 0!==d){var e="#define "+c+" "+d;b.push(e)}}return b.join("\n")},d.prototype.getShaderDefinition=function(){return{vshader:this.vertexSource,fshader:this.fragmentSource,defines:this.defines,attributes:this.attributes,uniforms:this.uniforms}},d.prototype.destroy=function(){this.shaderProgram&&(this.renderer.context.deleteProgram(this.shaderProgram),this.shaderProgram=null),this.vertexShader&&(this.renderer.context.deleteShader(this.vertexShader),this.vertexShader=null),this.fragmentShader&&(this.renderer.context.deleteShader(this.fragmentShader),this.fragmentShader=null),this.renderer=null},d.prototype.toString=function(){return this.name},d.PROJECTION_MATRIX="PROJECTION_MATRIX",d.VIEW_MATRIX="VIEW_MATRIX",d.VIEW_INVERSE_MATRIX="VIEW_INVERSE_MATRIX",d.VIEW_PROJECTION_MATRIX="VIEW_PROJECTION_MATRIX",d.VIEW_PROJECTION_INVERSE_MATRIX="VIEW_PROJECTION_INVERSE_MATRIX",d.WORLD_MATRIX="WORLD_MATRIX",d.NORMAL_MATRIX="NORMAL_MATRIX";for(var q=0;8>q;q++)d["LIGHT"+q]="LIGHT"+q;d.CAMERA="CAMERA",d.AMBIENT="AMBIENT",d.EMISSIVE="EMISSIVE",d.DIFFUSE="DIFFUSE",d.SPECULAR="SPECULAR",d.SPECULAR_POWER="SPECULAR_POWER",d.NEAR_PLANE="NEAR_PLANE",d.FAR_PLANE="FAR_PLANE",d.MAIN_NEAR_PLANE="MAIN_NEAR_PLANE",d.MAIN_FAR_PLANE="MAIN_FAR_PLANE",d.MAIN_DEPTH_SCALE="DEPTH_SCALE",d.TIME="TIME",d.TPF="TPF",d.RESOLUTION="RESOLUTION",d.DIFFUSE_MAP="DIFFUSE_MAP",d.NORMAL_MAP="NORMAL_MAP",d.SPECULAR_MAP="SPECULAR_MAP",d.LIGHT_MAP="LIGHT_MAP",d.SHADOW_MAP="SHADOW_MAP",d.AO_MAP="AO_MAP",d.EMISSIVE_MAP="EMISSIVE_MAP",d.DEPTH_MAP="DEPTH_MAP",d.DEFAULT_AMBIENT=[.1,.1,.1,1],d.DEFAULT_EMISSIVE=[0,0,0,0],d.DEFAULT_DIFFUSE=[.8,.8,.8,1],d.DEFAULT_SPECULAR=[.6,.6,.6,64],d.DEFAULT_SHININESS=64,d.prototype.defaultCallbacks={},e(d.prototype.defaultCallbacks),a.exports=d},function(a,b){function c(a,b,c){if(this.context=a,this.location=b,this.location.value=void 0,c)switch(c){case"float":this.call=this.uniform1f;break;case"bool":case"int":case"integer":case"sampler2D":case"sampler3D":case"samplerCube":this.call=this.uniform1i;break;case"floatarray":this.call=this.uniform1fv;break;case"intarray":case"samplerArray":this.call=this.uniform1iv;break;case"ivec2":this.call=this.uniform2iv;break;case"ivec3":this.call=this.uniform3iv;break;case"ivec4":this.call=this.uniform4iv;break;case"vec2":this.call=this.uniform2fv;break;case"vec3":this.call=this.uniform3fv;break;case"vec4":this.call=this.uniform4fv;break;case"mat2":this.call=this.uniformMatrix2fv;break;case"mat3":this.call=this.uniformMatrix3fv;break;case"mat4":this.call=this.uniformMatrix4fv;break;default:throw new Error("Uniform type not handled: "+c)}}function d(a,b){for(var c=a.length;c--;)if(a[c]!==b[c])return!1;return!0}c.prototype.uniform1f=function(a){var b=this.location.value;b!==a&&(this.context.uniform1f(this.location,a),this.location.value=a)},c.prototype.uniform1fv=function(a){var b=this.location.value;void 0!==b&&d(a,b)||(this.context.uniform1fv(this.location,a),this.location.value=a.slice())},c.prototype.uniform1i=function(a){var b=this.location.value;b!==a&&(this.context.uniform1i(this.location,a),this.location.value=a)},c.prototype.uniform1iv=function(a){var b=this.location.value;void 0!==b&&d(a,b)||(this.context.uniform1iv(this.location,a),this.location.value=a.slice())},c.prototype.uniform2f=function(a,b){var c=this.location.value;(void 0===c||c[0]!==a||c[1]!==b)&&(this.context.uniform2f(this.location,a,b),this.location.value=[a,b])},c.prototype.uniform2fv=function(a){var b=this.location.value;if(void 0!==b){if(d(a,b))return}else b=this.location.value=new Float64Array(a.length);this.context.uniform2fv(this.location,a);for(var c=a.length;c--;)b[c]=a[c]},c.prototype.uniform2i=function(a,b){var c=this.location.value;(void 0===c||c[0]!==a||c[1]!==b)&&(this.context.uniform2i(this.location,a,b),this.location.value=[a,b])},c.prototype.uniform2iv=function(a){var b=this.location.value;void 0!==b&&d(a,b)||(this.context.uniform2iv(this.location,a),this.location.value=a.slice())},c.prototype.uniform3f=function(a,b,c){var d=this.location.value;if(void 0!==d){if(d[0]===a&&d[1]===b&&d[2]===c)return}else d=this.location.value=[];this.context.uniform3f(this.location,a,b,c),d[0]=a,d[1]=b,d[2]=c},c.prototype.uniform3fv=function(a){var b=this.location.value;if(void 0!==b){if(d(a,b))return}else b=this.location.value=new Float64Array(a.length);this.context.uniform3fv(this.location,a);for(var c=a.length;c--;)b[c]=a[c]},c.prototype.uniform3i=function(a,b,c){var d=this.location.value;(void 0===d||d[0]!==a||d[1]!==b||d[2]!==c)&&(this.context.uniform3i(this.location,a,b,c),this.location.value=[a,b,c])},c.prototype.uniform3iv=function(a){var b=this.location.value;void 0!==b&&d(a,b)||(this.context.uniform3iv(this.location,a),this.location.value=a.slice())},c.prototype.uniform4f=function(a,b,c,d){var e=this.location.value;(void 0===e||e[0]!==a||e[1]!==b||e[2]!==c||e[3]!==d)&&(this.context.uniform4f(this.location,a,b,c,d),this.location.value=[a,b,c,d])},c.prototype.uniform4fv=function(a){var b=this.location.value;if(void 0!==b){if(d(a,b))return}else b=this.location.value=new Float64Array(a.length);this.context.uniform4fv(this.location,a);for(var c=a.length;c--;)b[c]=a[c]},c.prototype.uniform4i=function(a,b,c,d){var e=this.location.value;(void 0===e||e[0]!==a||e[1]!==b||e[2]!==c||e[3]!==d)&&(this.context.uniform4i(this.location,a,b,c,d),this.location.value=[a,b,c,d])},c.prototype.uniform4iv=function(a){var b=this.location.value;void 0!==b&&d(a,b)||(this.context.uniform4iv(this.location,a),this.location.value=a.slice())},c.prototype.uniformMatrix2fv=function(a,b){if(b=b===!0,a.data){var c=this.location.value;if(void 0!==c){var e=d(c.data,a.data);if(e)return;c.copy(a)}else this.location.value=a.clone();this.context.uniformMatrix2fv(this.location,b,a.data)}else{var f=a,c=this.location.value;if(void 0!==c){if(d(f,c))return}else c=this.location.value=new Float64Array(f.length);this.context.uniformMatrix2fv(this.location,b,f);for(var g=f.length;g--;)c[g]=f[g]}},c.prototype.uniformMatrix3fv=function(a,b){if(b=b===!0,a.data){var c=this.location.value;if(void 0!==c){var e=d(c.data,a.data);if(e)return;c.copy(a)}else this.location.value=a.clone();this.context.uniformMatrix3fv(this.location,b,a.data)}else{var f=a,c=this.location.value;if(void 0!==c){if(d(f,c))return}else c=this.location.value=new Float64Array(f.length);this.context.uniformMatrix3fv(this.location,b,f);for(var g=f.length;g--;)c[g]=f[g]}},c.prototype.uniformMatrix4fv=function(a,b){if(b=b===!0,a.data){var c=this.location.value;if(void 0!==c){var e=d(c.data,a.data);if(e)return;c.copy(a)}else this.location.value=a.clone();this.context.uniformMatrix4fv(this.location,b,a.data)}else{var f=a,c=this.location.value;if(void 0!==c){if(d(f,c))return}else c=this.location.value=new Float64Array(f.length);this.context.uniformMatrix4fv(this.location,b,f);for(var g=f.length;g--;)c[g]=f[g]}},a.exports=c},function(a,b,c){function d(){if(f.call(this,4,4),0===arguments.length)this.data[0]=1,this.data[5]=1,this.data[10]=1,this.data[15]=1;else if(1===arguments.length&&"object"==typeof arguments[0])arguments[0]instanceof d?this.copy(arguments[0]):this.setArray(arguments[0]);else for(var a=0;a<arguments.length;a++)this.data[a]=arguments[a]}var e=c(9),f=c(25),g=(c(8),c(6));d.prototype=Object.create(f.prototype),d.prototype.constructor=d,f.setupAliases(d.prototype,[["e00"],["e10"],["e20"],["e30"],["e01"],["e11"],["e21"],["e31"],["e02"],["e12"],["e22"],["e32"],["e03"],["e13"],["e23"],["e33"]]),d.IDENTITY=new d(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),d.prototype.add=function(a){var b=this.data,c=a.data;return b[0]+=c[0],b[1]+=c[1],b[2]+=c[2],b[3]+=c[3],b[4]+=c[4],b[5]+=c[5],b[6]+=c[6],b[7]+=c[7],b[8]+=c[8],b[9]+=c[9],b[10]+=c[10],b[11]+=c[11],b[12]+=c[12],b[13]+=c[13],b[14]+=c[14],b[15]+=c[15],this},d.prototype.sub=function(a){var b=this.data,c=a.data;return b[0]-=c[0],b[1]-=c[1],b[2]-=c[2],b[3]-=c[3],b[4]-=c[4],b[5]-=c[5],b[6]-=c[6],b[7]-=c[7],b[8]-=c[8],b[9]-=c[9],b[10]-=c[10],b[11]-=c[11],b[12]-=c[12],b[13]-=c[13],b[14]-=c[14],b[15]-=c[15],this},d.prototype.scale=function(a){var b=this.data;return b[0]*=a,b[1]*=a,b[2]*=a,b[3]*=a,b[4]*=a,b[5]*=a,b[6]*=a,b[7]*=a,b[8]*=a,b[9]*=a,b[10]*=a,b[11]*=a,b[12]*=a,b[13]*=a,b[14]*=a,b[15]*=a,this},d.prototype.mul=function(a){var b=this.data,c=b[0],d=b[4],e=b[8],f=b[12],g=b[1],h=b[5],i=b[9],j=b[13],k=b[2],l=b[6],m=b[10],n=b[14],o=b[3],p=b[7],q=b[11],r=b[15],s=a.data,t=s[0],u=s[4],v=s[8],w=s[12],x=s[1],y=s[5],z=s[9],A=s[13],B=s[2],C=s[6],D=s[10],E=s[14],F=s[3],G=s[7],H=s[11],I=s[15],J=this.data;return J[0]=c*t+d*x+e*B+f*F,J[4]=c*u+d*y+e*C+f*G,J[8]=c*v+d*z+e*D+f*H,J[12]=c*w+d*A+e*E+f*I,J[1]=g*t+h*x+i*B+j*F,J[5]=g*u+h*y+i*C+j*G,J[9]=g*v+h*z+i*D+j*H,J[13]=g*w+h*A+i*E+j*I,J[2]=k*t+l*x+m*B+n*F,J[6]=k*u+l*y+m*C+n*G,J[10]=k*v+l*z+m*D+n*H,J[14]=k*w+l*A+m*E+n*I,J[3]=o*t+p*x+q*B+r*F,J[7]=o*u+p*y+q*C+r*G,J[11]=o*v+p*z+q*D+r*H,J[15]=o*w+p*A+q*E+r*I,this},d.prototype.mul2=function(a,b){var c=a.data,d=c[0],e=c[4],f=c[8],g=c[12],h=c[1],i=c[5],j=c[9],k=c[13],l=c[2],m=c[6],n=c[10],o=c[14],p=c[3],q=c[7],r=c[11],s=c[15],t=b.data,u=t[0],v=t[4],w=t[8],x=t[12],y=t[1],z=t[5],A=t[9],B=t[13],C=t[2],D=t[6],E=t[10],F=t[14],G=t[3],H=t[7],I=t[11],J=t[15],K=this.data;return K[0]=d*u+e*y+f*C+g*G,K[4]=d*v+e*z+f*D+g*H,K[8]=d*w+e*A+f*E+g*I,K[12]=d*x+e*B+f*F+g*J,K[1]=h*u+i*y+j*C+k*G,K[5]=h*v+i*z+j*D+k*H,K[9]=h*w+i*A+j*E+k*I,K[13]=h*x+i*B+j*F+k*J,K[2]=l*u+m*y+n*C+o*G,K[6]=l*v+m*z+n*D+o*H,K[10]=l*w+m*A+n*E+o*I,K[14]=l*x+m*B+n*F+o*J,K[3]=p*u+q*y+r*C+s*G,K[7]=p*v+q*z+r*D+s*H,K[11]=p*w+q*A+r*E+s*I,K[15]=p*x+q*B+r*F+s*J,this},d.prototype.transpose=function(){var a=this.data,b=a[4],c=a[8],d=a[12],e=a[9],f=a[13],g=a[14];return a[4]=a[1],a[8]=a[2],a[12]=a[3],a[9]=a[6],a[13]=a[7],a[14]=a[11],a[1]=b,a[2]=c,a[3]=d,a[6]=e,a[7]=f,a[11]=g,this},d.invert=function(a,b){if(b||(b=new d),b===a)return b.copy(d.invert(a));var c=a.determinant();if(!c)return b;var e=a.data,f=b.data;return c=1/c,f[0]=(e[5]*(e[10]*e[15]-e[14]*e[11])-e[9]*(e[6]*e[15]-e[14]*e[7])+e[13]*(e[6]*e[11]-e[10]*e[7]))*c,f[1]=(e[1]*(e[14]*e[11]-e[10]*e[15])-e[9]*(e[14]*e[3]-e[2]*e[15])+e[13]*(e[10]*e[3]-e[2]*e[11]))*c,f[2]=(e[1]*(e[6]*e[15]-e[14]*e[7])-e[5]*(e[2]*e[15]-e[14]*e[3])+e[13]*(e[2]*e[7]-e[6]*e[3]))*c,f[3]=(e[1]*(e[10]*e[7]-e[6]*e[11])-e[5]*(e[10]*e[3]-e[2]*e[11])+e[9]*(e[6]*e[3]-e[2]*e[7]))*c,f[4]=(e[4]*(e[14]*e[11]-e[10]*e[15])-e[8]*(e[14]*e[7]-e[6]*e[15])+e[12]*(e[10]*e[7]-e[6]*e[11]))*c,f[5]=(e[0]*(e[10]*e[15]-e[14]*e[11])-e[8]*(e[2]*e[15]-e[14]*e[3])+e[12]*(e[2]*e[11]-e[10]*e[3]))*c,f[6]=(e[0]*(e[14]*e[7]-e[6]*e[15])-e[4]*(e[14]*e[3]-e[2]*e[15])+e[12]*(e[6]*e[3]-e[2]*e[7]))*c,f[7]=(e[0]*(e[6]*e[11]-e[10]*e[7])-e[4]*(e[2]*e[11]-e[10]*e[3])+e[8]*(e[2]*e[7]-e[6]*e[3]))*c,f[8]=(e[4]*(e[9]*e[15]-e[13]*e[11])-e[8]*(e[5]*e[15]-e[13]*e[7])+e[12]*(e[5]*e[11]-e[9]*e[7]))*c,f[9]=(e[0]*(e[13]*e[11]-e[9]*e[15])-e[8]*(e[13]*e[3]-e[1]*e[15])+e[12]*(e[9]*e[3]-e[1]*e[11]))*c,f[10]=(e[0]*(e[5]*e[15]-e[13]*e[7])-e[4]*(e[1]*e[15]-e[13]*e[3])+e[12]*(e[1]*e[7]-e[5]*e[3]))*c,f[11]=(e[0]*(e[9]*e[7]-e[5]*e[11])-e[4]*(e[9]*e[3]-e[1]*e[11])+e[8]*(e[5]*e[3]-e[1]*e[7]))*c,f[12]=(e[4]*(e[13]*e[10]-e[9]*e[14])-e[8]*(e[13]*e[6]-e[5]*e[14])+e[12]*(e[9]*e[6]-e[5]*e[10]))*c,f[13]=(e[0]*(e[9]*e[14]-e[13]*e[10])-e[8]*(e[1]*e[14]-e[13]*e[2])+e[12]*(e[1]*e[10]-e[9]*e[2]))*c,f[14]=(e[0]*(e[13]*e[6]-e[5]*e[14])-e[4]*(e[13]*e[2]-e[1]*e[14])+e[12]*(e[5]*e[2]-e[1]*e[6]))*c,f[15]=(e[0]*(e[5]*e[10]-e[9]*e[6])-e[4]*(e[1]*e[10]-e[9]*e[2])+e[8]*(e[1]*e[6]-e[5]*e[2]))*c,b},d.prototype.invert=function(){return d.invert(this,this)},d.prototype.isOrthogonal=function(){var a;return a=this.e00*this.e01+this.e10*this.e11+this.e20*this.e21+this.e30*this.e31,Math.abs(a)>e.EPSILON?!1:(a=this.e00*this.e02+this.e10*this.e12+this.e20*this.e22+this.e30*this.e32,Math.abs(a)>e.EPSILON?!1:(a=this.e00*this.e03+this.e10*this.e13+this.e20*this.e23+this.e30*this.e33,Math.abs(a)>e.EPSILON?!1:(a=this.e01*this.e02+this.e11*this.e12+this.e21*this.e22+this.e31*this.e32,Math.abs(a)>e.EPSILON?!1:(a=this.e01*this.e03+this.e11*this.e13+this.e21*this.e23+this.e31*this.e33,Math.abs(a)>e.EPSILON?!1:(a=this.e02*this.e03+this.e12*this.e13+this.e22*this.e23+this.e32*this.e33,Math.abs(a)>e.EPSILON?!1:!0)))))},d.prototype.isNormal=function(){var a;return a=this.e00*this.e00+this.e10*this.e10+this.e20*this.e20+this.e30*this.e30,Math.abs(a-1)>e.EPSILON?!1:(a=this.e01*this.e01+this.e11*this.e11+this.e21*this.e21+this.e31*this.e31,Math.abs(a-1)>e.EPSILON?!1:(a=this.e02*this.e02+this.e12*this.e12+this.e22*this.e22+this.e32*this.e32,Math.abs(a-1)>e.EPSILON?!1:(a=this.e03*this.e03+this.e13*this.e13+this.e23*this.e23+this.e33*this.e33,Math.abs(a-1)>e.EPSILON?!1:!0)))},d.prototype.isOrthonormal=function(){return this.isOrthogonal()&&this.isNormal()},d.prototype.determinant=function(){var a=this.data,b=a[5]*a[10]*a[15]+a[9]*a[14]*a[7]+a[13]*a[6]*a[11]-a[13]*a[10]*a[7]-a[9]*a[6]*a[15]-a[5]*a[14]*a[11],c=a[1]*a[10]*a[15]+a[9]*a[14]*a[3]+a[13]*a[2]*a[11]-a[13]*a[10]*a[3]-a[9]*a[2]*a[15]-a[1]*a[14]*a[11],d=a[1]*a[6]*a[15]+a[5]*a[14]*a[3]+a[13]*a[2]*a[7]-a[13]*a[6]*a[3]-a[5]*a[2]*a[15]-a[1]*a[14]*a[7],e=a[1]*a[6]*a[11]+a[5]*a[10]*a[3]+a[9]*a[2]*a[7]-a[9]*a[6]*a[3]-a[5]*a[2]*a[11]-a[1]*a[10]*a[7];return a[0]*b-a[4]*c+a[8]*d-a[12]*e},d.prototype.setIdentity=function(){var a=this.data;return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,this},d.prototype.setRotationFromVector=function(a){var b=Math.sin(a.x),c=Math.cos(a.x),d=Math.sin(a.y),e=Math.cos(a.y),f=Math.sin(a.z),g=Math.cos(a.z),h=this.data;return h[0]=g*e,h[1]=f*e,h[2]=0-d,h[4]=g*d*b-f*c,h[5]=f*d*b+g*c,h[6]=e*b,h[8]=g*d*c+f*b,h[9]=f*d*c-g*b,h[10]=e*c,this},d.prototype.setRotationFromQuaternion=function(a){var b=a.lengthSquared();b=b>0?2/b:0;var c=a.x*b,d=a.y*b,e=a.z*b,f=a.w*c,g=a.w*d,h=a.w*e,i=a.x*c,j=a.x*d,k=a.x*e,l=a.y*d,m=a.y*e,n=a.z*e,o=this.data;return o[0]=1-l-n,o[1]=j+h,o[2]=k-g,o[4]=j-h,o[5]=1-i-n,o[6]=m+f,o[8]=k+g,o[9]=m-f,o[10]=1-i-l,this},d.prototype.setTranslation=function(a){return this.data[12]=a.x,this.data[13]=a.y,this.data[14]=a.z,this},d.prototype.getTranslation=function(a){return a.x=this.data[12],a.y=this.data[13],a.z=this.data[14],this},d.prototype.getRotation=function(a){var b=this.data,c=a.data;return c[0]=b[0],c[1]=b[1],c[2]=b[2],c[3]=b[4],c[4]=b[5],c[5]=b[6],c[6]=b[8],c[7]=b[9],c[8]=b[10],this},d.prototype.getScale=function(a){var b=Math.sqrt(a.setDirect(this.data[0],this.data[4],this.data[8]).lengthSquared()),c=Math.sqrt(a.setDirect(this.data[1],this.data[5],this.data[9]).lengthSquared()),d=Math.sqrt(a.setDirect(this.data[2],this.data[6],this.data[10]).lengthSquared());return a.x=b,a.y=c,a.z=d,this},d.prototype.setScale=function(a){var b=this.data,c=a.x,d=a.y,e=a.z;return b[0]=c,b[5]=d,b[10]=e,this},d.prototype.scale=function(a){var b=this.data,c=a.x,d=a.y,e=a.z;return b[0]*=c,b[1]*=d,b[2]*=e,b[4]*=c,b[5]*=d,b[6]*=e,b[8]*=c,b[9]*=d,b[10]*=e,this},d.prototype.decompose=function(a,b,c){var d=this.data,e=a.set(d[0],d[1],d[2]).length(),f=a.set(d[4],d[5],d[6]).length(),g=a.set(d[8],d[9],d[10]).length(),h=this.determinant();0>h&&(e=-e),a.x=d[12],a.y=d[13],a.z=d[14],b.copyMatrix4(this);var i=1/e,j=1/f,k=1/g,l=b.data;return l[0]*=i,l[1]*=i,l[2]*=i,l[3]*=j,l[4]*=j,l[5]*=j,l[6]*=k,l[7]*=k,l[8]*=k,c.x=e,c.y=f,c.z=g,this},d.prototype.equals=function(a,b){var c=this.data,d=a.data,f=void 0===b?e.EPSILON:b;return 0===f?c[0]===d[0]&&c[1]===d[1]&&c[2]===d[2]&&c[3]===d[3]&&c[4]===d[4]&&c[5]===d[5]&&c[6]===d[6]&&c[7]===d[7]&&c[8]===d[8]&&c[9]===d[9]&&c[10]===d[10]&&c[11]===d[11]&&c[12]===d[12]&&c[13]===d[13]&&c[14]===d[14]&&c[15]===d[15]:Math.abs(c[0]-d[0])<=f&&Math.abs(c[1]-d[1])<=f&&Math.abs(c[2]-d[2])<=f&&Math.abs(c[3]-d[3])<=f&&Math.abs(c[4]-d[4])<=f&&Math.abs(c[5]-d[5])<=f&&Math.abs(c[6]-d[6])<=f&&Math.abs(c[7]-d[7])<=f&&Math.abs(c[8]-d[8])<=f&&Math.abs(c[9]-d[9])<=f&&Math.abs(c[10]-d[10])<=f&&Math.abs(c[11]-d[11])<=f&&Math.abs(c[12]-d[12])<=f&&Math.abs(c[13]-d[13])<=f&&Math.abs(c[14]-d[14])<=f&&Math.abs(c[15]-d[15])<=f},d.prototype.copy=function(a){var b=this.data,c=a.data;return b[0]=c[0],b[1]=c[1],b[2]=c[2],b[3]=c[3],b[4]=c[4],b[5]=c[5],b[6]=c[6],b[7]=c[7],b[8]=c[8],b[9]=c[9],b[10]=c[10],b[11]=c[11],b[12]=c[12],b[13]=c[13],b[14]=c[14],b[15]=c[15],this},d.prototype.setArray=function(a){var b=this.data;return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15],this},d.prototype.set=d.prototype.copy,d.prototype.clone=function(){return(new d).copy(this)},d.add=g.warnOnce("Matrix4.add is deprecated, use Matrix4.prototype.add instead",function(a,b,c){return c||(c=new d),b instanceof d?(c.e00=a.e00+b.e00,c.e10=a.e10+b.e10,c.e20=a.e20+b.e20,c.e30=a.e30+b.e30,c.e01=a.e01+b.e01,c.e11=a.e11+b.e11,c.e21=a.e21+b.e21,c.e31=a.e31+b.e31,c.e02=a.e02+b.e02,c.e12=a.e12+b.e12,c.e22=a.e22+b.e22,c.e32=a.e32+b.e32,c.e03=a.e03+b.e03,c.e13=a.e13+b.e13,c.e23=a.e23+b.e23,c.e33=a.e33+b.e33):(c.e00=a.e00+b,c.e10=a.e10+b,c.e20=a.e20+b,c.e30=a.e30+b,c.e01=a.e01+b,c.e11=a.e11+b,c.e21=a.e21+b,c.e31=a.e31+b,c.e02=a.e02+b,c.e12=a.e12+b,c.e22=a.e22+b,c.e32=a.e32+b,c.e03=a.e03+b,c.e13=a.e13+b,c.e23=a.e23+b,c.e33=a.e33+b),c}),d.sub=g.warnOnce("Matrix4.sub is deprecated",function(a,b,c){return c||(c=new d),b instanceof d?(c.e00=a.e00-b.e00,c.e10=a.e10-b.e10,c.e20=a.e20-b.e20,c.e30=a.e30-b.e30,c.e01=a.e01-b.e01,c.e11=a.e11-b.e11,c.e21=a.e21-b.e21,c.e31=a.e31-b.e31,c.e02=a.e02-b.e02,c.e12=a.e12-b.e12,c.e22=a.e22-b.e22,c.e32=a.e32-b.e32,c.e03=a.e03-b.e03,c.e13=a.e13-b.e13,c.e23=a.e23-b.e23,c.e33=a.e33-b.e33):(c.e00=a.e00-b,c.e10=a.e10-b,c.e20=a.e20-b,c.e30=a.e30-b,c.e01=a.e01-b,c.e11=a.e11-b,c.e21=a.e21-b,c.e31=a.e31-b,c.e02=a.e02-b,c.e12=a.e12-b,c.e22=a.e22-b,c.e32=a.e32-b,c.e03=a.e03-b,c.e13=a.e13-b,c.e23=a.e23-b,c.e33=a.e33-b),c}),d.mul=g.warnOnce("Matrix4.mul is deprecated, use Matrix4.prototype.mul instead",function(a,b,c){return c||(c=new d),b instanceof d?(c.e00=a.e00*b.e00,c.e10=a.e10*b.e10,c.e20=a.e20*b.e20,c.e30=a.e30*b.e30,c.e01=a.e01*b.e01,c.e11=a.e11*b.e11,c.e21=a.e21*b.e21,c.e31=a.e31*b.e31,c.e02=a.e02*b.e02,c.e12=a.e12*b.e12,c.e22=a.e22*b.e22,c.e32=a.e32*b.e32,c.e03=a.e03*b.e03,c.e13=a.e13*b.e13,c.e23=a.e23*b.e23,c.e33=a.e33*b.e33):(c.e00=a.e00*b,c.e10=a.e10*b,c.e20=a.e20*b,c.e30=a.e30*b,c.e01=a.e01*b,c.e11=a.e11*b,c.e21=a.e21*b,c.e31=a.e31*b,c.e02=a.e02*b,c.e12=a.e12*b,c.e22=a.e22*b,c.e32=a.e32*b,c.e03=a.e03*b,c.e13=a.e13*b,c.e23=a.e23*b,c.e33=a.e33*b),c}),d.div=g.warnOnce("Matrix4.div is deprecated",function(a,b,c){return c||(c=new d),b instanceof d?(c.e00=a.e00/b.e00,c.e10=a.e10/b.e10,c.e20=a.e20/b.e20,c.e30=a.e30/b.e30,c.e01=a.e01/b.e01,c.e11=a.e11/b.e11,c.e21=a.e21/b.e21,c.e31=a.e31/b.e31,c.e02=a.e02/b.e02,c.e12=a.e12/b.e12,c.e22=a.e22/b.e22,c.e32=a.e32/b.e32,c.e03=a.e03/b.e03,c.e13=a.e13/b.e13,c.e23=a.e23/b.e23,c.e33=a.e33/b.e33):(b=1/b,c.e00=a.e00*b,c.e10=a.e10*b,c.e20=a.e20*b,c.e30=a.e30*b,c.e01=a.e01*b,c.e11=a.e11*b,c.e21=a.e21*b,c.e31=a.e31*b,c.e02=a.e02*b,c.e12=a.e12*b,c.e22=a.e22*b,c.e32=a.e32*b,c.e03=a.e03*b,c.e13=a.e13*b,c.e23=a.e23*b,c.e33=a.e33*b),c}),d.prototype.div=g.warnOnce("Matrix4.prototype.div is deprecated",function(a){return d.div(this,a,this)}),d.combine=g.warnOnce("Matrix4.combine is deprecated, use Matrix4.prototype.mul instead",function(a,b,c){c||(c=new d);var e=a.data,f=e[0],g=e[4],h=e[8],i=e[12],j=e[1],k=e[5],l=e[9],m=e[13],n=e[2],o=e[6],p=e[10],q=e[14],r=e[3],s=e[7],t=e[11],u=e[15],v=b.data,w=v[0],x=v[4],y=v[8],z=v[12],A=v[1],B=v[5],C=v[9],D=v[13],E=v[2],F=v[6],G=v[10],H=v[14],I=v[3],J=v[7],K=v[11],L=v[15],M=c.data;return M[0]=f*w+g*A+h*E+i*I,M[4]=f*x+g*B+h*F+i*J,M[8]=f*y+g*C+h*G+i*K,M[12]=f*z+g*D+h*H+i*L,M[1]=j*w+k*A+l*E+m*I,M[5]=j*x+k*B+l*F+m*J,M[9]=j*y+k*C+l*G+m*K,M[13]=j*z+k*D+l*H+m*L,M[2]=n*w+o*A+p*E+q*I,M[6]=n*x+o*B+p*F+q*J,M[10]=n*y+o*C+p*G+q*K,M[14]=n*z+o*D+p*H+q*L,M[3]=r*w+s*A+t*E+u*I,M[7]=r*x+s*B+t*F+u*J,M[11]=r*y+s*C+t*G+u*K,M[15]=r*z+s*D+t*H+u*L,c}),d.prototype.combine=g.warnOnce("Matrix4.prototype.combine is deprecated, use Matrix4.prototype.mul instead",function(a){return d.combine(this,a,this)}),d.transpose=g.warnOnce("Matrix4.transpose is deprecated, use Matrix4.prototype.transpose instead",function(a,b){b||(b=new d);var c=a.data,e=b.data;if(b===a){var f=c[4],g=c[8],h=c[12],i=c[9],j=c[13],k=c[14];return e[4]=c[1],e[8]=c[2],e[12]=c[3],e[9]=c[6],e[13]=c[7],e[14]=c[11],e[1]=f,e[2]=g,e[3]=h,e[6]=i,e[7]=j,e[11]=k,b}return e[0]=c[0],e[1]=c[4],e[2]=c[8],e[3]=c[12],e[4]=c[1],e[5]=c[5],e[6]=c[9],e[7]=c[13],e[8]=c[2],e[9]=c[6],e[10]=c[10],e[11]=c[14],e[12]=c[3],e[13]=c[7],e[14]=c[11],e[15]=c[15],b}),d.prototype.applyPre=g.warnOnce("Matrix4.prototype.applyPre is deprecated, use Vector4.prototype.applyPre instead",function(a){var b=a.x,c=a.y,d=a.z,e=a.w,f=this.data;return a.x=f[0]*b+f[1]*c+f[2]*d+f[3]*e,a.y=f[4]*b+f[5]*c+f[6]*d+f[7]*e,a.z=f[8]*b+f[9]*c+f[10]*d+f[11]*e,a.w=f[12]*b+f[13]*c+f[14]*d+f[15]*e,a}),d.prototype.applyPost=g.warnOnce("Matrix4.prototype.applyPost is deprecated, use Vector4.prototype.applyPost instead",function(a){var b=a.x,c=a.y,d=a.z,e=a.w,f=this.data;return a.x=f[0]*b+f[4]*c+f[8]*d+f[12]*e,a.y=f[1]*b+f[5]*c+f[9]*d+f[13]*e,a.z=f[2]*b+f[6]*c+f[10]*d+f[14]*e,a.w=f[3]*b+f[7]*c+f[11]*d+f[15]*e,a}),d.prototype.applyPostPoint=g.warnOnce("Matrix4.prototype.applyPostPoint is deprecated, use Vector4.prototype.applyPostPoint instead",function(a){return a.applyPostPoint(this)}),d.prototype.applyPostVector=g.warnOnce("Matrix4.prototype.applyPostVector is deprecated, use Vector4.prototype.applyPostVector instead",function(a){var b=a.x,c=a.y,d=a.z,e=this.data;return a.x=e[0]*b+e[4]*c+e[8]*d,a.y=e[1]*b+e[5]*c+e[9]*d,a.z=e[2]*b+e[6]*c+e[10]*d,a}),a.exports=d},function(a,b,c){function d(a){if(a&&a._registerBaseComponents){console.warn("World constructor changed! Please use it like this instead: new World({ gooRunner: gooRunner })");var b=a;a={},a.gooRunner=b}a=a||{},this.gooRunner=void 0!==a.gooRunner?a.gooRunner:null,this.time=0,this.fixedTpfTime=0,this.fixedTpf=void 0!==a.fixedTpf?a.fixedTpf:1/60,this.maxSubSteps=void 0!==a.maxSubSteps?a.maxSubSteps:10,this.tpf=0,this.smoothedTpf=this.tpf,this.interpolationTime=0,this.tpfSmoothingCount=void 0!==a.tpfSmoothingCount?a.tpfSmoothingCount:10,this._managers=[],this._systems=[],this._addedEntities=[],this._changedEntities=[],this._removedEntities=[],this.by={},this._installDefaultSelectors(),this.entityManager=new g,this.setManager(this.entityManager),this._components=[],this._tpfIndex=0,this._tpfSmoothingArray=[],this._accumulator=0,e=this}var e,f=c(35),g=c(38),h=c(40),i=c(39),j=c(42),k=c(20),l=c(21),m=c(6);Object.defineProperties(d,{time:{get:m.warnOnce("World.time is deprecated, use world.time instead.",function(){return e&&e.time||0}),set:function(){throw new Error("Don't set World.time!")}},tpf:{get:m.warnOnce("World.tpf is deprecated, use world.tpf instead.",function(){return e&&e.tpf||1}),set:function(){throw new Error("Don't set World.time!")}}}),d.prototype._installDefaultSelectors=function(){this.by.system=function(a){var b=this.getSystem(a);return new l(b._activeEntities)}.bind(this),this.by.component=function(a){var b=this.entityManager.getEntities();return new l(b.filter(function(b){return b.hasComponent(a)}))}.bind(this),this.by.tag=function(a){var b=this.entityManager.getEntities();return new l(b.filter(function(b){return b.hasTag(a)}))}.bind(this),this.by.attribute=function(a){var b=this.entityManager.getEntities();return new l(b.filter(function(b){return b.hasAttribute(a)}))}.bind(this)},d.prototype.add=function(){for(var a=0;a<arguments.length;a++){var b=arguments[a];b instanceof f?this.addEntity(b):b instanceof i?this.setManager(b):b instanceof j?this.setSystem(b):b instanceof k&&this.registerComponent(b)}return this},d.prototype.registerComponent=function(a){return-1===this._components.indexOf(a)&&(this._components.push(a),k.applyEntitySelectionAPI(a.entitySelectionAPI,a.type)),this},d.prototype.setManager=function(a){return this._managers.push(a),a.applyAPI(this.by),this},d.prototype.getManager=function(a){for(var b=0;b<this._managers.length;b++){var c=this._managers[b];if(c.type===a)return c}},d.prototype.setSystem=function(a){if(-1!==this._systems.indexOf(a))return this;for(var b=a.priority,c=0;c<this._systems.length&&!(this._systems[c].priority>b);c++);return this._systems.splice(c,0,a),a.world=this,a.setup(this),this},d.prototype.getSystem=function(a){for(var b=0;b<this._systems.length;b++){var c=this._systems[b];if(c.type===a)return c}},d.prototype.clearSystem=function(a){for(var b=0;b<this._systems.length;b++){var c=this._systems[b];c.type===a&&(c.cleanup(),c.world=null,this._systems.splice(b,1))}return this},d.prototype.createEntity=function(){for(var a=new f(this),b=0;b<arguments.length;b++)"string"==typeof arguments[b]?a.name=arguments[b]:a.set(arguments[b]);return a.transformComponent||a.setComponent(new h),a},d.prototype.getEntities=function(){return this.entityManager.getEntities()},d.prototype.addEntity=function(a,b){if(-1===this._addedEntities.indexOf(a)&&this._addedEntities.push(a),a.transformComponent&&(void 0===b||b===!0))for(var c=a.transformComponent.children,d=0;d<c.length;d++)this.addEntity(c[d].entity,b);for(var d=0;d<this._managers.length;d++){var e=this._managers[d];e.added(a)}return this},d.prototype.removeEntity=function(a,b){-1===this._removedEntities.indexOf(a)&&this._removedEntities.push(a);var c=a.transformComponent;if(c.parent&&(c.parent.detachChild(c),c.parent=null),b===!1){for(var d=c.children,e=0;e<d.length;e++)d[e].parent=null;c.children=[]}else for(var d=c.children,e=0;e<d.length;e++)this._recursiveRemoval(d[e].entity,b);for(var e=0;e<this._managers.length;e++){var f=this._managers[e];f.removed(a)}return this},d.prototype._recursiveRemoval=function(a,b){-1===this._removedEntities.indexOf(a)&&this._removedEntities.push(a);for(var c=0;c<this._managers.length;c++){var d=this._managers[c];d.removed(a)}if(a.transformComponent&&(void 0===b||b===!0))for(var e=a.transformComponent.children,c=0;c<e.length;c++)this._recursiveRemoval(e[c].entity,b)},d.prototype.changedEntity=function(a,b,c){var d={entity:a};void 0!==b&&(d.component=b),void 0!==c&&(d.eventType=c),this._changedEntities.push(d)},d.prototype.processEntityChanges=function(){this._check(this._addedEntities,function(a,b){if(a.added(b),a.addedComponent)for(var c=0;c<b._components.length;c++)a.addedComponent(b,b._components[c])}),this._check(this._changedEntities,function(a,b){a.changed(b.entity),void 0!==b.eventType&&a[b.eventType]&&a[b.eventType](b.entity,b.component)}),this._check(this._removedEntities,function(a,b){if(a.removed(b),a.removedComponent)for(var c=0;c<b._components.length;c++)a.removedComponent(b,b._components[c])})},d.prototype.update=function(a){var b=this.time;b+=a,this.time=b,this.tpf=a;var c=this._tpfSmoothingArray;this._tpfSmoothingArray[this._tpfIndex]=a,this._tpfIndex=(this._tpfIndex+1)%this.tpfSmoothingCount;for(var d=0,e=0;e<c.length;e++)d+=c[e];d/=this.tpfSmoothingCount,this.smoothedTpf=d;var f=0,g=this.fixedTpf,h=this.fixedTpfTime,i=this.maxSubSteps,j=this._accumulator;for(j+=a;j>=g&&i>f;)h+=g,f++,this.fixedUpdate(),j-=g;return this.fixedTpfTime=h,this.interpolationTime=j%g/g,this._accumulator=j,this.process(),this},d.prototype.fixedUpdate=function(){this.processEntityChanges();for(var a=0;a<this._systems.length;a++){var b=this._systems[a];b.passive||b._fixedUpdate(this.fixedTpf)}},d.prototype.process=function(){this.processEntityChanges();for(var a=0;a<this._systems.length;a++){var b=this._systems[a];b.passive||b._process(this.tpf)}},d.prototype.onPreRender=function(){for(var a=0;a<this._systems.length;a++){var b=this._systems[a];b.onPreRender()}},d.prototype.onPostRender=function(){for(var a=0;a<this._systems.length;a++){var b=this._systems[a];b.onPostRender()}},d.prototype._check=function(a,b){for(var c=0;c<a.length;c++)for(var d=a[c],e=0;e<this._systems.length;e++){var f=this._systems[e];b(f,d)}a.length=0},d.prototype.clear=function(){for(var a=0;a<this._systems.length;a++){var b=this._systems[a];b.clear&&b.clear()}this._systems=[];for(var c=this.entityManager.getEntities(),a=0;a<c.length;a++){var d=c[a];d._world=null}this.entityManager.clear(),this._addedEntities=[],this._changedEntities=[],this._removedEntities=[],this.gooRunner=null,e===this&&(e=void 0)},a.exports=d},function(a,b,c){function d(a,b,c){h.apply(this),this._world=a,this._components=[],this.id=void 0!==c?c:g.createUniqueId("entity"),this._index=d.entityCount,this._tags=new Set,this._attributes=new Map,this.name=void 0!==b?b:"Entity_"+this._index,this.skip=!1,this.hidden=!1,this._hidden=!1,this.isVisible=!1,this["static"]=!1,d.entityCount++}function e(a){return a.charAt(0).toLowerCase()+a.substr(1)}var f=c(20),g=c(36),h=c(37);d.prototype=Object.create(h.prototype),d.prototype.constructor=d,d.prototype.set=function(){for(var a=0;a<arguments.length;a++){var b=arguments[a];if(b instanceof f)this.setComponent(b);else{if(!this._world)return this;for(var c=this._world._components,d=0;d<c.length;d++){var e=c[d],g=e.applyOnEntity(b,this);if(g)break}}}return this},d.prototype.addToWorld=function(a){return this._world.addEntity(this,a),this},d.prototype.removeFromWorld=function(a){return this._world.removeEntity(this,a),this},d.prototype.setComponent=function(a){return this.hasComponent(a.type)?this:(this._components.push(a),this[e(a.type)]=a,a.entity=this,a.attached(this),a.applyAPI(this),this._world&&this._world.entityManager.containsEntity(this)&&this._world.changedEntity(this,a,"addedComponent"),this)},d.prototype.hasComponent=function(a){var b=e(a);return!!this[b]},d.prototype.getComponent=function(a){var b=e(a);return this[b]},d.prototype.clearComponent=function(a){var b=e(a),c=this[b];if(c&&this._components.indexOf(c)>-1){c.detached(this),c.entity=null,c.removeAPI(this);var d=this._components.indexOf(c);this._components.splice(d,1),delete this[b],this._world&&this._world.entityManager.containsEntity(this)&&this._world.changedEntity(this,c,"removedComponent")}return this},d.prototype.setTag=function(a){return this._tags.add(a),this},d.prototype.hasTag=function(a){return this._tags.has(a)},d.prototype.clearTag=function(a){return this._tags["delete"](a),this},d.prototype.setAttribute=function(a,b){
return this._attributes.set(a,b),this},d.prototype.hasAttribute=function(a){return this._attributes.has(a)},d.prototype.getAttribute=function(a){return this._attributes.get(a)},d.prototype.clearAttribute=function(a){return this._attributes["delete"](a),this},d.prototype.toString=function(){return this.name},d.entityCount=0,a.exports=d},function(a,b){function c(){}c.endsWith=function(a,b){return-1!==a.indexOf(b,a.length-b.length)},c.startsWith=function(a,b){return 0===a.indexOf(b)},c.capitalize=function(a){return a.charAt(0).toUpperCase()+a.substring(1)},c.uncapitalize=function(a){return a.charAt(0).toLowerCase()+a.substring(1)},c.createUniqueId=function(a){var b=Date.now(),c="xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(a){var c=(b+16*Math.random())%16|0;return"x"===a?c.toString(16):(3&c|8).toString(16)});return void 0===a?c:c+"."+a},c.getUntil=function(a,b){var c=a.indexOf(b);return-1===c?a:a.slice(0,c)},c.getAfterLast=function(a,b){var c=a.lastIndexOf(b);return-1===c?a:a.slice(c+b.length,a.length)},c.getFrom=function(a,b){var c=a.indexOf(b);return-1===c?"":a.slice(c+b.length,a.length)},c.getIndexedName=function(a,b,c){c||(c="_");var d,e=new RegExp(a+"("+c+"\\d+)?"),f=0;for(d in b){var g=b[d],h=e.exec(g);if(h)if(h.length>1&&h[1]){var i=parseInt(h[1].substring(c.length),10);i>=f&&(f=i+1)}else f=1}return a+c+f},c.getUniqueName=function(a,b,d){return-1===b.indexOf(a)?a:c.getIndexedName(a,b,d)},c.toAscii=function(a){return a.replace(/([^\x00-\x7F])/g,"x")},c.hashCode=function(a){var b=0;if(0===a.length)return b;for(var c=0;c<a.length;c++){var d=a.charCodeAt(c);b=(b<<5)-b+d,b&=b}return btoa(b).replace("/","_").replace("+","-")};var d=Date.now();c.getUniqueId=function(){d++;var a=Array.prototype.slice.call(arguments,0).join("");return c.hashCode(d+""+a)},c.escapeHtmlEntities=function(a){var b=document.createElement("div");b.appendChild(document.createTextNode(a));var c={34:"quot"};return b.innerHTML.replace(/[\u00A0-\u2666\"\']/g,function(a){var b=c[a.charCodeAt(0)];return"&"+(b||"#"+a.charCodeAt(0))+";"})};var e=new RegExp("^(?:([^:/?#.]+):)?(?://(?:([^/?#]*)@)?([\\w\\d\\-\\u0100-\\uffff.%]*)(?::([0-9]+))?)?([^?#]+)?(?:\\?([^#]*))?(?:#(.*))?$");c.parseURL=function(a){var b=a.match(e);return{scheme:b[1],user_info:b[2],domain:b[3],port:b[4],path:b[5],query_data:b[6],fragment:b[7]}},a.exports=c},function(a,b){function c(){this._listenerMap=new Map,this._listenersCopy=[]}c.prototype.fire=function(a){var b=this._listenerMap.get(a.type);if(b){a.target=this;for(var c=b.length,d=this._listenersCopy,e=0;c>e;e++)d[e]=b[e];for(var e=0;c>e;e++)d[e](a)}return this},c.prototype.on=function(a,b){var c=this._listenerMap.get(a);return c?-1===c.indexOf(b)&&c.push(b):(c=[b],this._listenerMap.set(a,c)),this},c.prototype.off=function(a,b){if(b){var c,d=this._listenerMap.get(a);d&&-1!==(c=d.indexOf(b))&&(d.splice(c,1),0===d.length&&this._listenerMap["delete"](a))}else this._listenerMap["delete"](a);return this},c.prototype.has=function(a){return this._listenerMap.has(a)},a.exports=c},function(a,b,c){function d(){e.call(this),this.type="EntityManager",this._entitiesById=new Map,this._entitiesByIndex=new Map,this._entityCount=0,this.api={id:function(){var a=d.prototype.getEntityById.apply(this,arguments);return new f(a)}.bind(this),name:function(a){var b=this.getEntities();return new f(b.filter(function(b){return b.name===a}))}.bind(this)}}var e=c(39),f=c(21);d.prototype=Object.create(e.prototype),d.prototype.added=function(a){this.containsEntity(a)||(this._entitiesById.set(a.id,a),this._entitiesByIndex.set(a._index,a),this._entityCount++)},d.prototype.removed=function(a){this.containsEntity(a)&&(this._entitiesById["delete"](a.id),this._entitiesByIndex["delete"](a._index),this._entityCount--)},d.prototype.containsEntity=function(a){return this._entitiesByIndex.has(a._index)},d.prototype.getEntityById=function(a){return this._entitiesById.get(a)},d.prototype.getEntityByIndex=function(a){return this._entitiesByIndex.get(a)},d.prototype.getEntityByName=function(a){if(!(this._entityCount<=0)){var b;return this._entitiesByIndex.forEach(function(c){c.name===a&&(b=c)}),b}},d.prototype.size=function(){return this._entityCount},d.prototype.getEntities=function(){var a=[];return this._entitiesByIndex.forEach(function(b){a.push(b)}),a},d.prototype.getTopEntities=function(){var a=[];return this._entitiesByIndex.forEach(function(b){b.transformComponent&&b.transformComponent.parent||a.push(b)}),a},d.prototype.clear=function(){this._entitiesById.clear(),this._entitiesByIndex.clear(),this._entityCount=0},a.exports=d},function(a,b){function c(){this.installedAPI={}}c.prototype.applyAPI=function(a){var b=this.api;for(var c in b){if("undefined"!=typeof a[c])throw new Error("Could not install method "+c+" of "+this.type+" as it is already taken");a[c]=b[c],this.installedAPI[c]=!0}},a.exports=c},function(a,b,c){function d(){g.apply(this,arguments),this.type="TransformComponent",this.parent=null,this.children=[],this.transform=new e,this.worldTransform=new e,this._localTransformDirty=!0,this._worldTransformDirty=!0}var e=c(41),f=c(8),g=c(20),h=c(21);d.type="TransformComponent",d.prototype=Object.create(g.prototype),d.prototype.constructor=d,d.prototype.api={setTranslation:function(){return d.prototype.setTranslation.apply(this.transformComponent,arguments),this},setRotation:function(){return d.prototype.setRotation.apply(this.transformComponent,arguments),this},setScale:function(){return d.prototype.setScale.apply(this.transformComponent,arguments),this},lookAt:function(){return d.prototype.lookAt.apply(this.transformComponent,arguments),this},move:function(){return d.prototype.move.apply(this.transformComponent,arguments),this},getTranslation:function(){return d.prototype.getTranslation.apply(this.transformComponent,arguments)},getRotation:function(){return d.prototype.getRotation.apply(this.transformComponent,arguments)},getScale:function(){return d.prototype.getScale.apply(this.transformComponent,arguments)},addTranslation:function(){return d.prototype.addTranslation.apply(this.transformComponent,arguments),this},addRotation:function(){return d.prototype.addRotation.apply(this.transformComponent,arguments),this},attachChild:function(a,b){return this.transformComponent.attachChild(a.transformComponent,b),this},detachChild:function(a,b){return this.transformComponent.detachChild(a.transformComponent,b),this},children:function(){return new h(this).children()},parent:function(){return new h(this).parent()},traverse:function(a,b){if(b=void 0!==b?b:0,a(this,b)!==!1)for(var c=0;c<this.transformComponent.children.length;c++){var d=this.transformComponent.children[c].entity;d.traverse(a,b+1)}return this},traverseUp:function(a){for(var b=this.transformComponent;a(b.entity)!==!1&&b.parent;)b=b.parent;return this},hide:function(){return this._hidden=!0,this.traverse(function(a){for(var b=0;b<a._components.length;b++){var c=a._components[b];"boolean"==typeof c.hidden&&(c.hidden=!0)}}),this},show:function(){this._hidden=!1;for(var a=this;a.transformComponent.parent;)if(a=a.transformComponent.parent.entity,a._hidden){for(var b=0;b<this._components.length;b++){var c=this._components[b];"boolean"==typeof c.hidden&&(c.hidden=!0)}return this}return this.traverse(function(a){if(a._hidden)return!1;for(var b=0;b<a._components.length;b++){var c=a._components[b];"boolean"==typeof c.hidden&&(c.hidden=a._hidden)}}),this},isVisiblyHidden:function(){var a=this;if(a._hidden)return!0;for(;a.transformComponent.parent;)if(a=a.transformComponent.parent.entity,a._hidden)return!0;return!1},isHidden:function(){return this._hidden}},d.entitySelectionAPI={setTranslation:d.prototype.api.setTranslation,setRotation:d.prototype.api.setRotation,setScale:d.prototype.api.setScale,lookAt:d.prototype.api.lookAt,move:d.prototype.api.move,addTranslation:d.prototype.api.addTranslation,addRotation:d.prototype.api.addRotation,hide:d.prototype.api.hide,show:d.prototype.api.show};var i=new f;d.prototype.getTranslation=function(){return this.sync().transform.translation},d.prototype.getWorldTranslation=function(){return this.sync().worldTransform.translation},d.prototype.setTranslation=function(){return this.transform.translation.set(f.fromAny.apply(null,arguments)),this.setUpdated(),this},d.prototype.addTranslation=function(){return this.transform.translation.add(f.fromAny.apply(null,arguments)),this.setUpdated(),this},d.prototype.getScale=function(){return this.sync().transform.scale},d.prototype.getWorldScale=function(){return this.sync().worldTransform.scale},d.prototype.setScale=function(){return this.transform.scale.set(f.fromAny.apply(null,arguments)),this.setUpdated(),this},d.prototype.getRotationMatrix=function(){return this.sync().transform.rotation},d.prototype.setRotationMatrix=function(a){return this.transform.rotation.copy(a),this.setUpdated(),this},d.prototype.getWorldRotationMatrix=function(){return this.sync().worldTransform.rotation},d.prototype.getRotation=function(a){return a=a||new f,this.sync().transform.rotation.toAngles(a)},d.prototype.addRotation=function(){if(this.getRotation(i),1===arguments.length&&"object"==typeof arguments[0]){var a=arguments[0];a instanceof f?this.transform.rotation.fromAngles(i.x+a.x,i.y+a.y,i.z+a.z):3===a.length&&this.transform.rotation.fromAngles(i.x+a[0],i.y+a[1],i.z+a[2])}else this.transform.rotation.fromAngles(i.x+arguments[0],i.y+arguments[1],i.z+arguments[2]);return this.setUpdated(),this},d.prototype.setRotation=function(){if(1===arguments.length&&"object"==typeof arguments[0]){var a=arguments[0];a instanceof f?this.transform.rotation.fromAngles(a.x,a.y,a.z):3===a.length&&this.transform.rotation.fromAngles(a[0],a[1],a[2])}else this.transform.rotation.fromAngles(arguments[0],arguments[1],arguments[2]);return this.setUpdated(),this},d.prototype.lookAt=function(a,b){return 3===arguments.length?this.transform.lookAt(new f(arguments[0],arguments[1],arguments[2])):a.transformComponent?this.transform.lookAt(a.transformComponent.sync().worldTransform.translation,b):(Array.isArray(a)&&(a=f.fromArray(a)),Array.isArray(b)&&(b=f.fromArray(b)),this.transform.lookAt(a,b)),this.setUpdated(),this},d.prototype.move=function(){var a=new f;return function(){var b=f.fromAny.apply(null,arguments);return this.transform.applyForwardVector(b,a),this.addTranslation(a),this}}(),d.prototype.setUpdated=function(){this._worldTransformDirty=this._localTransformDirty=!0},d.prototype.attached=function(a){this.entity=a},d.prototype.detached=function(){this.entity=void 0},d.prototype.attachChild=function(a,b){for(var c=this;c;){if(c===a)return void console.warn("attachChild: An object can't be added as a descendant of itself.");c=c.parent}a.parent&&a.parent.detachChild(a),b&&(a.sync(),this.sync(),a.transform.multiply(this.worldTransform.invert(),a.transform),a.setUpdated()),a.parent=this,this.children.push(a)},d.prototype.detachChild=function(a,b){if(a===this)return void console.warn("detachChild: An object can't be removed from itself.");b&&a.transform.copy(a.sync().worldTransform);var c=this.children.indexOf(a);-1!==c&&(a.parent=null,this.children.splice(c,1)),a.setUpdated()},d.prototype.updateTransform=function(){this.transform.update(),this._localTransformDirty=!1,this._worldTransformDirty=!0},d.prototype.updateWorldTransform=function(){var a={type:"transformUpdated"};return function(){this._localTransformDirty&&this.updateTransform();var b=this.worldTransform,c=this.transform;this.parent?b.multiply(this.parent.worldTransform,c):b.copy(c),b.updateNormalMatrix();var d=this.entity;d&&d.fire(a),this._worldTransformDirty=!1}}(),d.prototype.sync=function(){var a=[];return function(){for(var b=this;null!==b;)a.push(b),b=b.parent;for(var c=!1,d=a.length-1;d>=0;d--){var e=a[d];if(e._worldTransformDirty||c){c=!0,e.updateWorldTransform();for(var f=e.children,g=f.length;g--;)f[g]._worldTransformDirty=!0}}return a.length=0,this}}(),d.applyOnEntity=function(a,b){var c=b.transformComponent;c||(c=new d);var g=!1;return Array.isArray(a)&&3===a.length?(c.transform.translation.setDirect(a[0],a[1],a[2]),g=!0):a instanceof f?(c.transform.translation.setDirect(a.x,a.y,a.z),g=!0):"object"==typeof a&&"undefined"!=typeof a.x&&"undefined"!=typeof a.y&&"undefined"!=typeof a.z?(c.transform.translation.setDirect(a.x,a.y,a.z),g=!0):a instanceof e&&(c.transform=a,g=!0),g?(c.setUpdated(),b.setComponent(c),!0):void 0},a.exports=d},function(a,b,c){function d(){this.matrix=new g,this.normalMatrix=new f,this.translation=new e,this.rotation=new f,this.scale=new e(1,1,1)}var e=c(8),f=c(24),g=c(33),h=c(9),i=new e,j=new e,k=new f;d.combine=function(a,b,c){return c=c||new d,i.set(b.translation),i.applyPost(a.rotation),i.mul(a.scale),i.add(a.translation),j.set(b.scale),j.mul(a.scale),k.mul2(a.rotation,b.rotation),c.rotation.copy(k),c.scale.set(j),c.translation.set(i),c.update(),c},d.prototype.combine=function(a){return d.combine(this,a,this)},d.prototype.multiply=function(a,b){return this.matrix.mul2(a.matrix,b.matrix),k.data.set(a.rotation.data),this.rotation.data.set(b.rotation.data),this.rotation.mul2(k,this.rotation),this.translation.set(b.translation),this.translation.mul(a.scale),this.translation.applyPost(k).add(a.translation),i.set(a.scale).mul(b.scale),this.scale.set(i),this},d.prototype.setIdentity=function(){return this.matrix.setIdentity(),this.translation.set(e.ZERO),this.rotation.setIdentity(),this.scale.set(e.ONE),this},d.prototype.applyForward=function(a,b){return b.set(a),b.applyPostPoint(this.matrix),b},d.prototype.applyForwardVector=function(a,b){return b.copy(a),b.setDirect(b.x*this.scale.x,b.y*this.scale.y,b.z*this.scale.z),b.applyPost(this.rotation),b},d.prototype.update=function(){var a=this.matrix.data,b=this.rotation.data,c=this.scale,d=this.translation;return a[0]=c.x*b[0],a[1]=c.x*b[1],a[2]=c.x*b[2],a[3]=0,a[4]=c.y*b[3],a[5]=c.y*b[4],a[6]=c.y*b[5],a[7]=0,a[8]=c.z*b[6],a[9]=c.z*b[7],a[10]=c.z*b[8],a[11]=0,a[12]=d.x,a[13]=d.y,a[14]=d.z,a[15]=1,this},d.prototype.updateNormalMatrix=function(){var a=this.normalMatrix.data,b=this.matrix.data;a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[4],a[4]=b[5],a[5]=b[6],a[6]=b[8],a[7]=b[9],a[8]=b[10];var c=this.scale;return(c.x!==c.y||c.x!==c.z)&&this.normalMatrix.invert().transpose(),this},d.prototype.copy=function(a){return this.matrix.copy(a.matrix),this.translation.set(a.translation),this.rotation.copy(a.rotation),this.scale.set(a.scale),this},d.prototype.setRotationXYZ=function(a,b,c){return this.rotation.fromAngles(a,b,c),this},d.prototype.lookAt=function(a,b){return b||(b=e.UNIT_Y),i.set(a).sub(this.translation),i.lengthSquared()>h.EPSILON&&(i.normalize(),this.rotation.lookAt(i,b)),this},d.prototype.invert=function(a){var b=a;b||(b=new d),b.matrix.copy(this.matrix),b.matrix.invert();var c=b.rotation.copy(this.rotation);return c.transpose(),b.scale.set(e.ONE).div(this.scale),b.translation.copy(this.translation).negate().mul(b.scale),b.translation.applyPost(b.rotation),b},d.prototype.clone=function(){var a=new d;return a.matrix.copy(this.matrix),a.normalMatrix.copy(this.normalMatrix),a.translation.copy(this.translation),a.rotation.copy(this.rotation),a.scale.copy(this.scale),a},a.exports=d},function(a,b){function c(a,b){this.world=null,this.type=a,this.interests=b,this._activeEntities=[],this.passive=!1,this.priority=0}function d(a){return a.charAt(0).toLowerCase()+a.substr(1)}c.prototype.process=function(){},c.prototype.fixedUpdate=function(){},c.prototype.added=function(a){this._check(a)},c.prototype.inserted=function(){},c.prototype.deleted=function(){},c.prototype.changed=function(a){this._check(a)},c.prototype.removed=function(a){var b=this._activeEntities.indexOf(a);-1!==b&&(this._activeEntities.splice(b,1),this.deleted(a))},c.prototype.setup=function(a){a.entityManager.getEntities().forEach(this._check.bind(this))},c.prototype.cleanup=function(){for(var a=0;a<this._activeEntities.length;a++){var b=this._activeEntities[a];this.deleted(b)}},c.prototype._check=function(a){if(!this.interests||0!==this.interests.length){var b=null===this.interests;if(!b&&this.interests.length<=a._components.length){b=!0;for(var c=0;c<this.interests.length;c++){var e=d(this.interests[c]);if(!a[e]){b=!1;break}}}var f=this._activeEntities.indexOf(a);b&&-1===f?(this._activeEntities.push(a),this.inserted(a)):b||-1===f||(this._activeEntities.splice(f,1),this.deleted(a))}},c.prototype._fixedUpdate=function(a){this.fixedUpdate(this._activeEntities,a)},c.prototype._process=function(a){this.process(this._activeEntities,a)},c.prototype._lateProcess=function(a){this.lateProcess(this._activeEntities,a)},c.prototype.clear=function(){this._activeEntities.length=0},c.prototype.onPreRender=function(){},c.prototype.onPostRender=function(){},a.exports=c},function(a,b,c){function d(){this.opaqueSorter=function(a,b){var c=a.meshRendererComponent.materials[0].shader,d=b.meshRendererComponent.materials[0].shader;return null===c||null===d?0:c.defineKey===d.defineKey?a.meshRendererComponent._renderDistance-b.meshRendererComponent._renderDistance:d.defineKey<c.defineKey?-1:d.defineKey>c.defineKey?1:0},this.transparentSorter=function(a,b){return b.meshRendererComponent._renderDistance-a.meshRendererComponent._renderDistance},this.bucketSorter=function(a,b){return a-b}}var e=c(8),f=[],g=new e;d.prototype.sort=function(a,b){var c=0,e={};f.length=0;for(var h=0,i=a.length;i>h;h++){var j=a[h],k=j.meshRendererComponent;if(k&&0!==k.materials.length){var l=k.materials[0].getRenderQueue(),m=0,n=k.worldBound;null!==n?m=g.set(b.translation).sub(n.center).lengthSquared():j.transformComponent&&(m=g.set(b.translation).sub(j.transformComponent.worldTransform.translation).lengthSquared()),k._renderDistance=m;var o=e[l];o||(o=[],e[l]=o,f.push(l)),o.push(j)}else a[c]=j,c++}f.length>1&&f.sort(this.bucketSorter);for(var p=0,i=f.length;i>p;p++){var q=f[p],o=e[q],r=o.length;r>1&&q>=0&&(q<d.TRANSPARENT?o.sort(this.opaqueSorter):o.sort(this.transparentSorter));for(var h=0;r>h;h++)a[c]=o[h],c++}},d.BACKGROUND=0,d.OPAQUE=1e3,d.TRANSPARENT=2e3,d.OVERLAY=3e3,a.exports=d},function(a,b,c){var d=c(45);a.exports=new d},function(a,b){function c(){this.trie={name:"",listeners:[],children:new Map}}function d(a,b,c,d){for(var e=a.listeners.length,f=0;e>f;f++){var g=a.listeners[f];g&&g(b,c,d)}for(var f=0;f<a.listeners.length;f++){var g=a.listeners[f];g||(a.listeners.splice(f,1),f--)}}function e(a,b,c,e){function f(a){d(a,b,c,e),a.children.forEach(f)}f(a)}function f(a,b){var c=a.indexOf(b);-1!==c&&(a[c]=null)}c.prototype.emit=function(a,b,c){if(c=!!c,"string"==typeof a)this._emitToSingle(a,b,c);else for(var d=0;d<a.length;d++)this._emitToSingle(a[d],b,c);return this},c.prototype._getNode=function(a,b){for(var c=this.trie,d=a.split("."),e=0;e<d.length;e++){var f=d[e];if(c.children.has(f))c=c.children.get(f);else{if(!b)return;var g={listeners:[],children:new Map};c.children.set(f,g),c=g}}return c},c.prototype._emitToSingle=function(a,b,c){var d=this._getNode(a,c);d&&(e(d,b,a,this),c&&(d.latestData=b,d.latestChannel=a))},c.prototype.addListener=function(a,b,c){c=!!c;for(var d=this.trie,e=a.split("."),f=0;f<e.length;f++){var g=e[f];if(d.children.has(g))d=d.children.get(g);else{var h={listeners:[],children:new Map};d.children.set(g,h),d=h}}return-1===d.listeners.indexOf(b)&&(d.listeners.push(b),c&&d.latestData&&b(d.latestData,d.latestChannel,this)),this},c.prototype.removeListener=function(a,b){var c=this._getNode(a);return c&&f(c.listeners,b),this},c.prototype.getLastMessageOn=function(a){var b=this._getNode(a);return b?b.latestData:void 0},c.prototype.removeAllOnChannel=function(a){var b=this._getNode(a);return b&&(b.listeners=[]),this},c.prototype.removeChannelAndChildren=function(a){var b=a.split(".");if(b.length>1){var c=b.pop(),d=b.join("."),e=this._getNode(d);e.children["delete"](c)}else this.trie.children["delete"](a);return this},c.prototype._removeListener=function(a,b){f(a.listeners,b),a.children.forEach(function(a){this._removeListener(a,b)},this)},c.prototype.removeListenerFromAllChannels=function(a){return this._removeListener(this.trie,a),this},c.prototype.clear=function(){this.trie={name:"",listeners:[],children:new Map}},a.exports=c},function(a,b,c){function d(){}var e=c(14),f=c(31),g=c(47),h=c(48);d.uber={processors:[h.uber.processor,h.light.processor,h.animation.processor],attributes:{vertexPosition:e.POSITION,vertexNormal:e.NORMAL,vertexTangent:e.TANGENT,vertexColor:e.COLOR,vertexUV0:e.TEXCOORD0,vertexUV1:e.TEXCOORD1,vertexJointIDs:e.JOINTIDS,vertexWeights:e.WEIGHTS},uniforms:{viewProjectionMatrix:f.VIEW_PROJECTION_MATRIX,worldMatrix:f.WORLD_MATRIX,normalMatrix:f.NORMAL_MATRIX,cameraPosition:f.CAMERA,diffuseMap:f.DIFFUSE_MAP,offsetRepeat:[0,0,1,1],normalMap:f.NORMAL_MAP,normalMultiplier:1,specularMap:f.SPECULAR_MAP,emissiveMap:f.EMISSIVE_MAP,aoMap:f.AO_MAP,lightMap:f.LIGHT_MAP,environmentCube:"ENVIRONMENT_CUBE",environmentSphere:"ENVIRONMENT_SPHERE",reflectionMap:"REFLECTION_MAP",transparencyMap:"TRANSPARENCY_MAP",opacity:1,reflectivity:0,refractivity:0,etaRatio:-.5,fresnel:0,discardThreshold:-.01,fogSettings:[0,1e4],fogColor:[1,1,1],vertexColorAmount:1,lodBias:0,wrapSettings:[.5,0]},builder:function(a,b){h.light.builder(a,b)},vshader:function(){return["attribute vec3 vertexPosition;","#ifdef NORMAL","attribute vec3 vertexNormal;","#endif","#ifdef TANGENT","attribute vec4 vertexTangent;","#endif","#ifdef COLOR","attribute vec4 vertexColor;","#endif","#ifdef TEXCOORD0","attribute vec2 vertexUV0;","uniform vec4 offsetRepeat;","varying vec2 texCoord0;","#endif","#ifdef TEXCOORD1","attribute vec2 vertexUV1;","varying vec2 texCoord1;","#endif","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","varying vec3 vWorldPos;","varying vec3 viewPosition;","#ifdef NORMAL","varying vec3 normal;","#endif","#ifdef TANGENT","varying vec3 binormal;","varying vec3 tangent;","#endif","#ifdef COLOR","varying vec4 color;","#endif",h.light.prevertex,h.animation.prevertex,"void main(void) {","mat4 wMatrix = worldMatrix;","#ifdef NORMAL","mat3 nMatrix = normalMatrix;","#endif",h.animation.vertex,"vec4 worldPos = wMatrix * vec4(vertexPosition, 1.0);","vWorldPos = worldPos.xyz;","gl_Position = viewProjectionMatrix * worldPos;","viewPosition = cameraPosition - worldPos.xyz;","#ifdef NORMAL","	normal = normalize(nMatrix * vertexNormal);","#endif","#ifdef TANGENT","	tangent = normalize(nMatrix * vertexTangent.xyz);","	binormal = cross(normal, tangent) * vec3(vertexTangent.w);","#endif","#ifdef COLOR","	color = vertexColor;","#endif","#ifdef TEXCOORD0","	texCoord0 = vertexUV0 * offsetRepeat.zw + offsetRepeat.xy;","#endif","#ifdef TEXCOORD1","	texCoord1 = vertexUV1;","#endif",h.light.vertex,"}"].join("\n")},fshader:function(){return["uniform float lodBias;","#ifdef DIFFUSE_MAP","uniform sampler2D diffuseMap;","#endif","#ifdef NORMAL_MAP","uniform sampler2D normalMap;","uniform float normalMultiplier;","#endif","#ifdef SPECULAR_MAP","uniform sampler2D specularMap;","#endif","#ifdef EMISSIVE_MAP","uniform sampler2D emissiveMap;","#endif","#ifdef AO_MAP","uniform sampler2D aoMap;","#endif","#ifdef LIGHT_MAP","uniform sampler2D lightMap;","#endif","#ifdef TRANSPARENCY_MAP","uniform sampler2D transparencyMap;","#endif","#ifdef REFLECTIVE","#ifdef ENVIRONMENT_CUBE","uniform samplerCube environmentCube;","#elif defined(ENVIRONMENT_SPHERE)","uniform sampler2D environmentSphere;","#endif","uniform vec4 clearColor;","uniform float reflectivity;","uniform float fresnel;","uniform float refractivity;","uniform float etaRatio;","#ifdef REFLECTION_MAP","uniform sampler2D reflectionMap;","#endif","#endif","#ifdef OPACITY","uniform float opacity;","#endif","#ifdef DISCARD","uniform float discardThreshold;","#endif","#ifdef FOG","uniform vec2 fogSettings;","uniform vec3 fogColor;","#endif","varying vec3 vWorldPos;","varying vec3 viewPosition;","#ifdef NORMAL","varying vec3 normal;","#endif","#ifdef TANGENT","varying vec3 binormal;","varying vec3 tangent;","#endif","#ifdef COLOR","varying vec4 color;","uniform float vertexColorAmount;","#endif","#ifdef TEXCOORD0","varying vec2 texCoord0;","#endif","#ifdef TEXCOORD1","varying vec2 texCoord1;","#endif","#define M_PI 3.14159265358979323846264338328",h.light.prefragment,"void main(void)","{","vec4 final_color = vec4(1.0);","#if defined(DIFFUSE_MAP) && defined(TEXCOORD0)","final_color *= texture2D(diffuseMap, texCoord0, lodBias);","#endif","#ifdef COLOR","final_color *= mix(vec4(1.0), color, vertexColorAmount);","#endif","#if defined(TRANSPARENCY_MAP) && defined(TEXCOORD0)","#ifdef TRANSPARENCY_BW","final_color.a = texture2D(transparencyMap, texCoord0).r;","#else","final_color.a = texture2D(transparencyMap, texCoord0).a;","#endif","#endif","#ifdef OPACITY","final_color.a *= opacity;","#endif","#ifdef DISCARD","if (final_color.a < discardThreshold) discard;","#endif","#ifdef AO_MAP","#ifdef TEXCOORD1","final_color.rgb *= texture2D(aoMap, texCoord1).rgb;","#elif defined(TEXCOORD0)","final_color.rgb *= texture2D(aoMap, texCoord0).rgb;","#endif","#endif","#ifdef LIGHT_MAP","#ifdef TEXCOORD1","final_color.rgb *= texture2D(lightMap, texCoord1).rgb * 2.0;","#elif defined(TEXCOORD0)","final_color.rgb *= texture2D(lightMap, texCoord0).rgb * 2.0;","#endif","#else","vec3 N = vec3(0.0, 1.0, 0.0);","#if defined(NORMAL)","N = normalize(normal);","#endif","#if defined(TANGENT) && defined(NORMAL_MAP) && defined(TEXCOORD0)","mat3 tangentToWorld = mat3(tangent, binormal, normal);","vec3 tangentNormal = texture2D(normalMap, texCoord0, lodBias).xyz * vec3(2.0) - vec3(1.0);","tangentNormal = mix(vec3(0.0, 0.0, 1.0), tangentNormal, normalMultiplier);","vec3 worldNormal = (tangentToWorld * tangentNormal);","N = normalize(worldNormal);","#endif","N = N * (-1.0 + 2.0 * float(gl_FrontFacing));",h.light.fragment,"#endif","#ifdef REFLECTIVE","if (refractivity > 0.0) {","vec4 environment = vec4(0.0);","#ifdef ENVIRONMENT_CUBE","vec3 refractionVector = refract(normalize(viewPosition), N, etaRatio);","refractionVector.x = -refractionVector.x;","environment = textureCube(environmentCube, refractionVector);","#elif defined(ENVIRONMENT_SPHERE)","vec3 refractionVector = refract(normalize(viewPosition), N, etaRatio);","refractionVector = -refractionVector;","float xx = (atan(refractionVector.z, refractionVector.x) + M_PI) / (2.0 * M_PI);","float yy = refractionVector.y * 0.5 + 0.5;","environment = texture2D(environmentSphere, vec2(xx, yy));","#endif","environment.rgb = mix(clearColor.rgb, environment.rgb, environment.a);","final_color.rgb = mix(final_color.rgb, environment.rgb, refractivity);","}","if (reflectivity > 0.0) {","vec4 environment = vec4(0.0);","#ifdef ENVIRONMENT_CUBE","vec3 reflectionVector = reflect(normalize(viewPosition), N);","reflectionVector.yz = -reflectionVector.yz;","environment = textureCube(environmentCube, reflectionVector);","#elif defined(ENVIRONMENT_SPHERE)","vec3 reflectionVector = reflect(normalize(viewPosition), N);","float xx = (atan(reflectionVector.z, reflectionVector.x) + M_PI) / (2.0 * M_PI);","float yy = reflectionVector.y * 0.5 + 0.5;","environment = texture2D(environmentSphere, vec2(xx, yy));","#endif","environment.rgb = mix(clearColor.rgb, environment.rgb, environment.a);","float reflectionAmount = reflectivity;","#if defined(REFLECTION_MAP) && defined(TEXCOORD0)","reflectionAmount *= texture2D(reflectionMap, texCoord0).r;","#endif","float fresnelVal = pow(1.0 - abs(dot(normalize(viewPosition), N)), fresnel * 4.0);","reflectionAmount *= fresnelVal;","#if REFLECTION_TYPE == 0","final_color.rgb = mix(final_color.rgb, environment.rgb, reflectionAmount);","#elif REFLECTION_TYPE == 1","final_color.rgb += environment.rgb * reflectionAmount;","#elif REFLECTION_TYPE == 2","final_color.rgb *= environment.rgb * reflectionAmount;","#endif","final_color.a = min(final_color.a + reflectionAmount, 1.0);","}","#endif","#ifndef LIGHT_MAP","final_color.rgb += totalSpecular;","final_color.a = min(final_color.a + length(totalSpecular) / 3.0, 1.0);","#endif","#ifdef FOG","float d = pow(smoothstep(fogSettings.x, fogSettings.y, length(viewPosition)), 1.0);","final_color.rgb = mix(final_color.rgb, fogColor, d);","#endif","gl_FragColor = final_color;","}"].join("\n")}},d.screenCopy={attributes:{vertexPosition:e.POSITION,vertexUV0:e.TEXCOORD0},uniforms:{diffuseMap:f.DIFFUSE_MAP},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","varying vec2 texCoord0;","void main(void) {","texCoord0 = vertexUV0;","gl_Position = vec4(vertexPosition, 1.0);","}"].join("\n"),fshader:["uniform sampler2D diffuseMap;","varying vec2 texCoord0;","void main(void)","{","gl_FragColor = texture2D(diffuseMap, texCoord0);","}"].join("\n")},d.copy={attributes:{vertexPosition:e.POSITION,vertexUV0:e.TEXCOORD0},uniforms:{viewProjectionMatrix:f.VIEW_PROJECTION_MATRIX,worldMatrix:f.WORLD_MATRIX,opacity:1,diffuseMap:f.DIFFUSE_MAP},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","varying vec2 texCoord0;","void main(void) {","texCoord0 = vertexUV0;","gl_Position = viewProjectionMatrix * (worldMatrix * vec4(vertexPosition, 1.0));","}"].join("\n"),fshader:["uniform sampler2D diffuseMap;","uniform float opacity;","varying vec2 texCoord0;","void main(void)","{","gl_FragColor = vec4(texture2D(diffuseMap, texCoord0).rgb, opacity);","}"].join("\n")},d.copyPure={attributes:{vertexPosition:e.POSITION,vertexUV0:e.TEXCOORD0},uniforms:{viewProjectionMatrix:f.VIEW_PROJECTION_MATRIX,worldMatrix:f.WORLD_MATRIX,opacity:1,diffuseMap:f.DIFFUSE_MAP},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","varying vec2 texCoord0;","void main(void) {","texCoord0 = vertexUV0;","gl_Position = viewProjectionMatrix * (worldMatrix * vec4(vertexPosition, 1.0));","}"].join("\n"),fshader:["uniform sampler2D diffuseMap;","uniform float opacity;","varying vec2 texCoord0;","void main(void)","{","vec4 col = texture2D(diffuseMap, texCoord0);","gl_FragColor = vec4(col.rgb, col.a * opacity);","}"].join("\n")},d.simple={attributes:{vertexPosition:e.POSITION},uniforms:{viewProjectionMatrix:f.VIEW_PROJECTION_MATRIX,worldMatrix:f.WORLD_MATRIX},vshader:["attribute vec3 vertexPosition;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","void main(void) {","gl_Position = viewProjectionMatrix * (worldMatrix * vec4(vertexPosition, 1.0));","}"].join("\n"),fshader:["void main(void)","{","gl_FragColor = vec4(1.0);","}"].join("\n")},d.simpleColored={attributes:{vertexPosition:e.POSITION},uniforms:{viewProjectionMatrix:f.VIEW_PROJECTION_MATRIX,worldMatrix:f.WORLD_MATRIX,color:[1,1,1],opacity:1},vshader:["attribute vec3 vertexPosition;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","void main(void) {","gl_Position = viewProjectionMatrix * (worldMatrix * vec4(vertexPosition, 1.0));","}"].join("\n"),fshader:["uniform vec3 color;","uniform float opacity;","void main(void)","{","if (opacity == 0.0) {","discard;","}","gl_FragColor = vec4(color, opacity);","}"].join("\n")},d.simpleLit={processors:[h.light.processor],defines:{NORMAL:!0},attributes:{vertexPosition:e.POSITION,vertexNormal:e.NORMAL},uniforms:{viewProjectionMatrix:f.VIEW_PROJECTION_MATRIX,worldMatrix:f.WORLD_MATRIX,cameraPosition:f.CAMERA,opacity:1},builder:function(a,b){h.light.builder(a,b)},vshader:function(){return["attribute vec3 vertexPosition;","attribute vec3 vertexNormal;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","uniform vec3 cameraPosition;",h.light.prevertex,"varying vec3 normal;","varying vec3 vWorldPos;","varying vec3 viewPosition;","void main(void) {","vec4 worldPos = worldMatrix * vec4(vertexPosition, 1.0);","vWorldPos = worldPos.xyz;","gl_Position = viewProjectionMatrix * worldPos;",h.light.vertex,"normal = (worldMatrix * vec4(vertexNormal, 0.0)).xyz;","viewPosition = cameraPosition - worldPos.xyz;","}"].join("\n")},fshader:function(){return["#ifdef SPECULAR_MAP","uniform sampler2D specularMap;","#ifdef TEXCOORD0","varying vec2 texCoord0;","#endif","#endif","uniform float opacity;",h.light.prefragment,"#ifdef NORMAL","varying vec3 normal;","#endif","varying vec3 vWorldPos;","varying vec3 viewPosition;","void main(void)","{","if (opacity == 0.0) {","discard;","}","#ifdef NORMAL","vec3 N = normalize(normal);","#else","vec3 N = vec3(0,0,1);","#endif","vec4 final_color = vec4(1.0);",h.light.fragment,"final_color.a = opacity;","gl_FragColor = final_color;","}"].join("\n");
}},d.textured={defines:{TEXCOORD0:!0,DIFFUSE_MAP:!0},attributes:{vertexPosition:e.POSITION,vertexUV0:e.TEXCOORD0},uniforms:{viewProjectionMatrix:f.VIEW_PROJECTION_MATRIX,worldMatrix:f.WORLD_MATRIX,diffuseMap:f.DIFFUSE_MAP},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","varying vec2 texCoord0;","void main(void) {","texCoord0 = vertexUV0;","gl_Position = viewProjectionMatrix * (worldMatrix * vec4(vertexPosition, 1.0));","}"].join("\n"),fshader:["#if defined(TEXCOORD0) && defined(DIFFUSE_MAP)","uniform sampler2D diffuseMap;","varying vec2 texCoord0;","#endif","void main(void)","{","#if defined(TEXCOORD0) && defined(DIFFUSE_MAP)","gl_FragColor = texture2D(diffuseMap, texCoord0);","#else","gl_FragColor = vec4(1.0);","#endif","}"].join("\n")},d.texturedLit={processors:[h.light.processor],attributes:{vertexPosition:e.POSITION,vertexNormal:e.NORMAL,vertexUV0:e.TEXCOORD0},uniforms:{viewProjectionMatrix:f.VIEW_PROJECTION_MATRIX,worldMatrix:f.WORLD_MATRIX,cameraPosition:f.CAMERA,diffuseMap:f.DIFFUSE_MAP},builder:function(a,b){h.light.builder(a,b)},vshader:function(){return["attribute vec3 vertexPosition;","attribute vec3 vertexNormal;","attribute vec2 vertexUV0;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","uniform vec3 cameraPosition;",h.light.prevertex,"varying vec3 normal;","varying vec3 vWorldPos;","varying vec3 viewPosition;","varying vec2 texCoord0;","void main(void) {","vec4 worldPos = worldMatrix * vec4(vertexPosition, 1.0);","vWorldPos = worldPos.xyz;","gl_Position = viewProjectionMatrix * worldPos;",h.light.vertex,"normal = (worldMatrix * vec4(vertexNormal, 0.0)).xyz;","texCoord0 = vertexUV0;","viewPosition = cameraPosition - worldPos.xyz;","}"].join("\n")},fshader:function(){return["uniform sampler2D diffuseMap;",h.light.prefragment,"varying vec3 normal;","varying vec3 vWorldPos;","varying vec3 viewPosition;","varying vec2 texCoord0;","void main(void)","{","vec3 N = normalize(normal);","vec4 final_color = texture2D(diffuseMap, texCoord0);",h.light.fragment,"gl_FragColor = final_color;","}"].join("\n")}},d.convolution={defines:{KERNEL_SIZE_FLOAT:"25.0",KERNEL_SIZE_INT:"25"},attributes:{position:e.POSITION,uv:e.TEXCOORD0},uniforms:{viewMatrix:f.VIEW_MATRIX,projectionMatrix:f.PROJECTION_MATRIX,worldMatrix:f.WORLD_MATRIX,tDiffuse:f.DIFFUSE_MAP,uImageIncrement:[.001953125,0],cKernel:[],size:1},vshader:["attribute vec3 position;","attribute vec2 uv;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","uniform float size;","uniform vec2 uImageIncrement;","varying vec2 vUv;","void main() {","vUv = uv - ( ( KERNEL_SIZE_FLOAT - 1.0 ) / 2.0 ) * size * uImageIncrement;","gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( position, 1.0 );","}"].join("\n"),fshader:["uniform float cKernel[ KERNEL_SIZE_INT ];","uniform sampler2D tDiffuse;","uniform vec2 uImageIncrement;","uniform float size;","varying vec2 vUv;","void main() {","vec2 imageCoord = vUv;","vec4 sum = vec4( 0.0 );","for (float i = 0.0; i < KERNEL_SIZE_FLOAT; i++) {","sum += texture2D( tDiffuse, imageCoord ) * cKernel[int(i)];","imageCoord += uImageIncrement * size;","}","gl_FragColor = sum;","}"].join("\n"),buildKernel:function(a){function b(a,b){return Math.exp(-(a*a)/(2*b*b))}a=Math.abs(a);var c,d,e,f,g=25,h=2*Math.ceil(3*a)+1;for(h>g&&(h=g),f=.5*(h-1),d=new Array(h),e=0,c=0;h>c;++c)d[c]=b(c-f,a),e+=d[c];for(c=0;h>c;++c)d[c]/=e;return d}},d.showNormals={defines:{NORMAL:!0},attributes:{vertexPosition:e.POSITION,vertexNormal:e.NORMAL},uniforms:{viewMatrix:f.VIEW_MATRIX,projectionMatrix:f.PROJECTION_MATRIX,viewProjectionMatrix:f.VIEW_PROJECTION_MATRIX,worldMatrix:f.WORLD_MATRIX,opacity:1},vshader:["attribute vec3 vertexPosition;","attribute vec3 vertexNormal;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","varying vec3 normal;","void main() {","normal = vec3(worldMatrix * vec4(vertexNormal, 0.0));","gl_Position = viewProjectionMatrix * (worldMatrix * vec4(vertexPosition, 1.0));","}"].join("\n"),fshader:["uniform float opacity;","#ifdef NORMAL","varying vec3 normal;","#else","vec3 normal = vec3(0,0,1);","#endif","void main() {","gl_FragColor = vec4( 0.5 * normalize( normal ) + 0.5, opacity );","}"].join("\n")},d.particles={attributes:{vertexPosition:e.POSITION,vertexColor:e.COLOR,vertexUV0:e.TEXCOORD0},uniforms:{viewProjectionMatrix:f.VIEW_PROJECTION_MATRIX,worldMatrix:f.WORLD_MATRIX,diffuseMap:f.DIFFUSE_MAP},vshader:["attribute vec3 vertexPosition;","attribute vec4 vertexColor;","attribute vec2 vertexUV0;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","varying vec2 texCoord0;","varying vec4 color;","void main(void) {","texCoord0 = vertexUV0;","color = vertexColor;","gl_Position = viewProjectionMatrix * (worldMatrix * vec4(vertexPosition, 1.0));","}"].join("\n"),fshader:["uniform sampler2D diffuseMap;","varying vec2 texCoord0;","varying vec4 color;","void main(void)","{","vec4 texCol = texture2D(diffuseMap, texCoord0);","if (color.a == 0.0 || texCol.a == 0.0) discard;","else gl_FragColor = texCol * color;","}"].join("\n")},d.normalmap={attributes:{vertexPosition:e.POSITION,vertexUV0:e.TEXCOORD0},uniforms:{viewProjectionMatrix:f.VIEW_PROJECTION_MATRIX,worldMatrix:f.WORLD_MATRIX,heightMap:f.DIFFUSE_MAP,resolution:[512,512],height:.05},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","varying vec2 vUv;","void main() {","vUv = vertexUV0;","gl_Position = viewProjectionMatrix * (worldMatrix * vec4( vertexPosition, 1.0 ));","}"].join("\n"),fshader:["uniform float height;","uniform vec2 resolution;","uniform sampler2D heightMap;","varying vec2 vUv;","void main() {","float val = texture2D( heightMap, vUv ).x;","float valU = texture2D( heightMap, vUv + vec2( 1.0 / resolution.x, 0.0 ) ).x;","float valV = texture2D( heightMap, vUv + vec2( 0.0, 1.0 / resolution.y ) ).x;","gl_FragColor = vec4( ( 0.5 * normalize( vec3( val - valU, val - valV, height  ) ) + 0.5 ), 1.0 );","}"].join("\n")},d.point={attributes:{vertexPosition:e.POSITION,vertexColor:e.COLOR},uniforms:{viewProjectionMatrix:f.VIEW_PROJECTION_MATRIX,worldMatrix:f.WORLD_MATRIX,pointSize:2},vshader:["attribute vec3 vertexPosition;","attribute vec4 vertexColor;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","uniform float pointSize;","varying vec4 color;","void main(void) {","color = vertexColor;","gl_Position = viewProjectionMatrix * (worldMatrix * vec4(vertexPosition, 1.0));","gl_PointSize = pointSize;","}"].join("\n"),fshader:["varying vec4 color;","void main(void)","{","gl_FragColor = color;","}"].join("\n")},d.downsample={attributes:{vertexPosition:e.POSITION,vertexUV0:e.TEXCOORD0},uniforms:{viewMatrix:f.VIEW_MATRIX,projectionMatrix:f.PROJECTION_MATRIX,worldMatrix:f.WORLD_MATRIX,tDiffuse:f.DIFFUSE_MAP},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec2 vUv;","void main() {","vUv = vertexUV0;","gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );","}"].join("\n"),fshader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","gl_FragColor = texture2D( tDiffuse, vUv );","}"].join("\n")},d.lightDepth={processors:[h.animation.processor],defines:{SHADOW_TYPE:0,WEIGHTS:!0,JOINTIDS:!0},attributes:{vertexPosition:e.POSITION,vertexJointIDs:e.JOINTIDS,vertexWeights:e.WEIGHTS},uniforms:{viewMatrix:f.VIEW_MATRIX,projectionMatrix:f.PROJECTION_MATRIX,worldMatrix:f.WORLD_MATRIX,cameraScale:f.MAIN_DEPTH_SCALE},vshader:["attribute vec3 vertexPosition;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec4 worldPosition;",h.animation.prevertex,"void main(void) {","mat4 wMatrix = worldMatrix;",h.animation.vertex,"worldPosition = viewMatrix * (wMatrix * vec4(vertexPosition, 1.0));","gl_Position = projectionMatrix * worldPosition;","}"].join("\n"),fshader:["#if SHADOW_TYPE == 2","uniform float cameraScale;","#endif","varying vec4 worldPosition;",g.methods.packDepth,"void main(void)","{","#if SHADOW_TYPE == 0","gl_FragColor = packDepth(gl_FragCoord.z);","#elif SHADOW_TYPE == 1","gl_FragColor = packDepth(gl_FragCoord.z);","#elif SHADOW_TYPE == 2","float linearDepth = length(worldPosition) * cameraScale;","gl_FragColor = vec4(linearDepth, linearDepth * linearDepth, 0.0, 0.0);","#endif","}"].join("\n")},d.pickingShader={defines:{WEIGHTS:!0,JOINTIDS:!0},attributes:{vertexPosition:e.POSITION,vertexJointIDs:e.JOINTIDS,vertexWeights:e.WEIGHTS,vertexNormal:e.NORMAL},uniforms:{normalMatrix:f.NORMAL_MATRIX,viewMatrix:f.VIEW_MATRIX,projectionMatrix:f.PROJECTION_MATRIX,worldMatrix:f.WORLD_MATRIX,cameraFar:f.FAR_PLANE,thickness:0,id:function(a){return null!=a.renderable._index?a.renderable._index+1:a.renderable.id+1}},processors:[h.animation.processor,function(a){a.setDefine("NORMAL",!0)}],vshader:["attribute vec3 vertexPosition;","#ifdef NORMAL","attribute vec3 vertexNormal;","#endif","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","uniform float cameraFar;","uniform float thickness;","uniform mat3 normalMatrix;",h.animation.prevertex,"varying float depth;","void main() {","#ifdef NORMAL","mat3 nMatrix = normalMatrix;","#endif","mat4 wMatrix = worldMatrix;",h.animation.vertex,"#ifdef NORMAL","vec4 mvPosition = viewMatrix * (wMatrix * vec4( vertexPosition + vertexNormal * thickness, 1.0 ));","#else","vec4 mvPosition = viewMatrix * (wMatrix * vec4( vertexPosition, 1.0 ));","#endif","depth = -mvPosition.z / cameraFar;","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fshader:["uniform float id;","varying float depth;",g.methods.packDepth16,"void main() {","vec2 packedId = vec2(floor(id/255.0), mod(id, 255.0)) * vec2(1.0/255.0);","vec2 packedDepth = packDepth16(depth);","gl_FragColor = vec4(packedId, packedDepth);","}"].join("\n")},a.exports=d},function(a,b){function c(){}c.noisecommon=["vec4 mod289(vec4 x) {","return x - floor(x * (1.0 / 289.0)) * 289.0;","}","vec3 mod289(vec3 x) {","return x - floor(x * (1.0 / 289.0)) * 289.0;","}","vec2 mod289(vec2 x) {","return x - floor(x * (1.0 / 289.0)) * 289.0;","}","vec3 permute(vec3 x) {","return mod289(((x*34.0)+1.0)*x);","}","vec4 permute(vec4 x) {","return mod289(((x*34.0)+1.0)*x);","}"].join("\n"),c.noise2d=[c.noisecommon,"float snoise(vec2 v) {","const vec4 C = vec4(0.211324865405187, // (3.0-sqrt(3.0))/6.0","0.366025403784439, // 0.5*(sqrt(3.0)-1.0)","-0.577350269189626, // -1.0 + 2.0 * C.x","0.024390243902439); // 1.0 / 41.0","vec2 i  = floor(v + dot(v, C.yy) );","vec2 x0 = v - i + dot(i, C.xx);","vec2 i1;","//i1.x = step( x0.y, x0.x ); x0.x > x0.y ? 1.0 : 0.0","//i1.y = 1.0 - i1.x;","i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);","// x0 = x0 - 0.0 + 0.0 * C.xx ;","// x1 = x0 - i1 + 1.0 * C.xx ;","// x2 = x0 - 1.0 + 2.0 * C.xx ;","vec4 x12 = x0.xyxy + C.xxzz;","x12.xy -= i1;","i = mod289(i); // Avoid truncation effects in permutation","vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))","+ i.x + vec3(0.0, i1.x, 1.0 ));","vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);","m = m*m ;","m = m*m ;","vec3 x = 2.0 * fract(p * C.www) - 1.0;","vec3 h = abs(x) - 0.5;","vec3 ox = floor(x + 0.5);","vec3 a0 = x - ox;","m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );","vec3 g;","g.x  = a0.x  * x0.x  + h.x  * x0.y;","g.yz = a0.yz * x12.xz + h.yz * x12.yw;","return 130.0 * dot(m, g);","}"].join("\n"),c.noise3d=[c.noisecommon,"vec4 taylorInvSqrt(vec4 r) {","return 1.79284291400159 - 0.85373472095314 * r;","}","float snoise(vec3 v) {","const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;","const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);","vec3 i  = floor(v + dot(v, C.yyy) );","vec3 x0 = v - i + dot(i, C.xxx);","vec3 g = step(x0.yzx, x0.xyz);","vec3 l = 1.0 - g;","vec3 i1 = min( g.xyz, l.zxy );","vec3 i2 = max( g.xyz, l.zxy );","vec3 x1 = x0 - i1 + C.xxx;","vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y","vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y","i = mod289(i); ","vec4 p = permute( permute( permute( ","i.z + vec4(0.0, i1.z, i2.z, 1.0 ))","+ i.y + vec4(0.0, i1.y, i2.y, 1.0 )) ","+ i.x + vec4(0.0, i1.x, i2.x, 1.0 ));","float n_ = 0.142857142857; // 1.0/7.0","vec3 ns = n_ * D.wyz - D.xzx;","vec4 j = p - 49.0 * floor(p * ns.z * ns.z); // mod(p,7*7)","vec4 x_ = floor(j * ns.z);","vec4 y_ = floor(j - 7.0 * x_ ); // mod(j,N)","vec4 x = x_ *ns.x + ns.yyyy;","vec4 y = y_ *ns.x + ns.yyyy;","vec4 h = 1.0 - abs(x) - abs(y);","vec4 b0 = vec4( x.xy, y.xy );","vec4 b1 = vec4( x.zw, y.zw );","vec4 s0 = floor(b0)*2.0 + 1.0;","vec4 s1 = floor(b1)*2.0 + 1.0;","vec4 sh = -step(h, vec4(0.0));","vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;","vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;","vec3 p0 = vec3(a0.xy,h.x);","vec3 p1 = vec3(a0.zw,h.y);","vec3 p2 = vec3(a1.xy,h.z);","vec3 p3 = vec3(a1.zw,h.w);","vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));","p0 *= norm.x;","p1 *= norm.y;","p2 *= norm.z;","p3 *= norm.w;","vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);","m = m * m;","return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), dot(p2,x2), dot(p3,x3) ) );","}"].join("\n");var d=["float shift_right (float v, float amt) {","v = floor(v) + 0.5;","return floor(v / exp2(amt));","}","float shift_left (float v, float amt) {","return floor(v * exp2(amt) + 0.5);","}","float mask_last (float v, float bits) {","return mod(v, shift_left(1.0, bits));","}","float extract_bits (float num, float from, float to) {","from = floor(from + 0.5); to = floor(to + 0.5);","return mask_last(shift_right(num, from), to - from);","}"].join("\n");c.methods={packDepth:["vec4 packDepth(const in float depth) {","const vec4 bit_shift = vec4(256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0);","const vec4 bit_mask  = vec4(0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0);","vec4 res = fract(depth * bit_shift);","res -= res.xxyz * bit_mask;","return res;","}"].join("\n"),unpackDepth:["float unpackDepth(const in vec4 rgba_depth) {","const vec4 bit_shift = vec4(1.0 / (256.0 * 256.0 * 256.0), 1.0 / (256.0 * 256.0), 1.0 / 256.0, 1.0);","return dot(rgba_depth, bit_shift);","}"].join("\n"),packFloat:[d,"vec4 packFloat(float val) {","if (val == 0.0) return vec4(0, 0, 0, 0);","float sign = val > 0.0 ? 0.0 : 1.0;","val = abs(val);","float exponent = floor(log2(val));","float biased_exponent = exponent + 127.0;","float fraction = ((val / exp2(exponent)) - 1.0) * 8388608.0;","float t = biased_exponent / 2.0;","float last_bit_of_biased_exponent = fract(t) * 2.0;","float remaining_bits_of_biased_exponent = floor(t);","float byte4 = extract_bits(fraction, 0.0, 8.0) / 255.0;","float byte3 = extract_bits(fraction, 8.0, 16.0) / 255.0;","float byte2 = (last_bit_of_biased_exponent * 128.0 + extract_bits(fraction, 16.0, 23.0)) / 255.0;","float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;","return vec4(byte4, byte3, byte2, byte1);","}"].join("\n"),unpackFloat:[d,"float unpackFloat(vec4 val) {","val = val * vec4(255.0);","float sign = - shift_right(val.w, 7.0) * 2.0 + 1.0;","float mantissa = ","val.x +","shift_left(val.y, 8.0) +","shift_left(extract_bits(val.z, 0.0, 7.0), 16.0);"," mantissa = mantissa / 8388608.0 + 1.0;","float exponent = ","shift_left(extract_bits(val.w, 0.0, 7.0), 1.0) +","shift_right(val.z, 7.0) - 127.0;","return sign * mantissa * exp2(exponent);","}"].join("\n"),packDepth16:["vec2 packDepth16(const in float depth) {","const vec2 bias = vec2(1.0 / 255.0, 0.0);","vec2 res = vec2(depth, fract(depth * 255.0));","return res - (res.yy * bias);","}"].join("\n"),unpackDepth16:["float unpackDepth16(const in vec2 rg_depth) {","return rg_depth.x + (rg_depth.y / 255.0);","}"].join("\n"),hsv:["vec3 rgb2hsv(vec3 c) {","vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);","vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));","vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));","float d = q.x - min(q.w, q.y);","float e = 1.0e-10;","return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);","}","vec3 hsv2rgb(vec3 c) {","vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);","vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);","return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);","}"].join("\n")},c.blendmodes=["#define BlendLinearDodgef				BlendAddf","#define BlendLinearBurnf				BlendSubstractf","#define BlendAddf(base, blend)			min(base + blend, 1.0)","#define BlendSubstractf(base, blend)	max(base + blend - 1.0, 0.0)","#define BlendLightenf(base, blend)		max(blend, base)","#define BlendDarkenf(base, blend)		min(blend, base)","#define BlendLinearLightf(base, blend)	(blend < 0.5 ? BlendLinearBurnf(base, (2.0 * blend)) : BlendLinearDodgef(base, (2.0 * (blend - 0.5))))","#define BlendScreenf(base, blend)		(1.0 - ((1.0 - base) * (1.0 - blend)))","#define BlendOverlayf(base, blend)		(base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))","#define BlendSoftLightf(base, blend)	((blend < 0.5) ? (2.0 * base * blend + base * base * (1.0 - 2.0 * blend)) : (sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend)))","#define BlendColorDodgef(base, blend)	((blend == 1.0) ? blend : min(base / (1.0 - blend), 1.0))","#define BlendColorBurnf(base, blend)	((blend == 0.0) ? blend : max((1.0 - ((1.0 - base) / blend)), 0.0))","#define BlendVividLightf(base, blend)	((blend < 0.5) ? BlendColorBurnf(base, (2.0 * blend)) : BlendColorDodgef(base, (2.0 * (blend - 0.5))))","#define BlendPinLightf(base, blend)	((blend < 0.5) ? BlendDarkenf(base, (2.0 * blend)) : BlendLightenf(base, (2.0 *(blend - 0.5))))","#define BlendHardMixf(base, blend)		((BlendVividLightf(base, blend) < 0.5) ? 0.0 : 1.0)","#define BlendReflectf(base, blend)		((blend == 1.0) ? blend : min(base * base / (1.0 - blend), 1.0))","#define Blend(base, blend, funcf)		vec3(funcf(base.r, blend.r), funcf(base.g, blend.g), funcf(base.b, blend.b))","#define BlendNormal(base, blend)		(blend)","#define BlendLighten					BlendLightenf","#define BlendDarken					BlendDarkenf","#define BlendMultiply(base, blend)		(base * blend)","#define BlendAverage(base, blend)		((base + blend) / 2.0)","#define BlendAdd(base, blend)			min(base + blend, vec3(1.0))","#define BlendSubstract(base, blend)	max(base + blend - vec3(1.0), vec3(0.0))","#define BlendDifference(base, blend)	abs(base - blend)","#define BlendNegation(base, blend)		(vec3(1.0) - abs(vec3(1.0) - base - blend))","#define BlendExclusion(base, blend)	(base + blend - 2.0 * base * blend)","#define BlendScreen(base, blend)		Blend(base, blend, BlendScreenf)","#define BlendOverlay(base, blend)		Blend(base, blend, BlendOverlayf)","#define BlendSoftLight(base, blend)	Blend(base, blend, BlendSoftLightf)","#define BlendHardLight(base, blend)	BlendOverlay(blend, base)","#define BlendColorDodge(base, blend)	Blend(base, blend, BlendColorDodgef)","#define BlendColorBurn(base, blend)	Blend(base, blend, BlendColorBurnf)","#define BlendLinearDodge				BlendAdd","#define BlendLinearBurn				BlendSubstract","#define BlendLinearLight(base, blend)	Blend(base, blend, BlendLinearLightf)","#define BlendVividLight(base, blend)	Blend(base, blend, BlendVividLightf)","#define BlendPinLight(base, blend)		Blend(base, blend, BlendPinLightf)","#define BlendHardMix(base, blend)		Blend(base, blend, BlendHardMixf)","#define BlendReflect(base, blend)		Blend(base, blend, BlendReflectf)","#define BlendGlow(base, blend)			BlendReflect(blend, base)","#define BlendPhoenix(base, blend)		(min(base, blend) - max(base, blend) + vec3(1.0))","#define GammaCorrection(color, gamma)											pow(color, vec3(1.0 / gamma))","#define LevelsControlInputRange(color, minInput, maxInput)						min(max(color - vec3(minInput), vec3(0.0)) / (vec3(maxInput) - vec3(minInput)), vec3(1.0))","#define LevelsControlInput(color, minInput, gamma, maxInput)					GammaCorrection(LevelsControlInputRange(color, minInput, maxInput), gamma)","#define LevelsControlOutputRange(color, minOutput, maxOutput)					mix(vec3(minOutput), vec3(maxOutput), color)","#define LevelsControl(color, minInput, gamma, maxInput, minOutput, maxOutput)	LevelsControlOutputRange(LevelsControlInput(color, minInput, gamma, maxInput), minOutput, maxOutput)"].join("\n"),a.exports=c},function(a,b,c){function d(){}var e=c(14),f=c(49),g=c(51),h=c(52),i=c(53),j=c(9),k=c(57),l=c(47),m=new g;m.translation.setDirect(10,10,10),m.direction.setDirect(1,1,1).normalize(),d.defaultLight=m,d.SKYBOX=null,d.SKYSPHERE=null,d.ENVIRONMENT_TYPE=0,d.GLOBAL_AMBIENT=[0,0,0],d.CLEAR_COLOR=[.3,.3,.3,1],d.USE_FOG=!1,d.FOG_SETTINGS=[0,1e4],d.FOG_COLOR=[1,1,1],d.uber={defines:function(a,b){for(var c=Object.keys(b),d=0,e=c.length;e>d;d++)a.setDefine(c[d],!0)},txMaps:function(a,b){for(var c=Object.keys(b),d=0,e=c.length;e>d;d++){var f=c[d];void 0!==b[f]&&null!==b[f]&&"SHADOW_MAP"!==f&&a.setDefine(f,!0)}},reflectivity:function(a,b){b.uniforms.reflectivity||b.uniforms.refractivity?a.setDefine("REFLECTIVE",!0):a.removeDefine("REFLECTIVE"),a.setDefine("REFLECTION_TYPE",void 0!==b.uniforms.reflectionType?b.uniforms.reflectionType:0)},sky:function(a,b){b.getTexture("LOCAL_ENVIRONMENT")?(b.setTexture("ENVIRONMENT_SPHERE",b.getTexture("LOCAL_ENVIRONMENT")),a.setDefine("ENVIRONMENT_TYPE",0),b.getTexture("ENVIRONMENT_CUBE")&&b.removeTexture("ENVIRONMENT_CUBE")):(d.SKYBOX&&(b.uniforms.reflectivity||b.uniforms.refractivity)?b.setTexture("ENVIRONMENT_CUBE",d.SKYBOX):b.getTexture("ENVIRONMENT_CUBE")&&b.removeTexture("ENVIRONMENT_CUBE"),d.SKYSPHERE&&(b.uniforms.reflectivity||b.uniforms.refractivity)?(b.setTexture("ENVIRONMENT_SPHERE",d.SKYSPHERE),a.setDefine("ENVIRONMENT_TYPE",d.ENVIRONMENT_TYPE)):b.getTexture("ENVIRONMENT_SPHERE")&&b.removeTexture("ENVIRONMENT_SPHERE"))},uniforms:function(a,b){if(b.DIFFUSE_MAP){var c=b.DIFFUSE_MAP.offset,d=b.DIFFUSE_MAP.repeat;a.uniforms.offsetRepeat[0]=c.x,a.uniforms.offsetRepeat[1]=c.y,a.uniforms.offsetRepeat[2]=d.x,a.uniforms.offsetRepeat[3]=d.y,a.uniforms.lodBias=b.DIFFUSE_MAP.lodBias}else a.uniforms.offsetRepeat[0]=0,a.uniforms.offsetRepeat[1]=0,a.uniforms.offsetRepeat[2]=1,a.uniforms.offsetRepeat[3]=1,a.uniforms.lodBias=0},attributes:function(a,b,c){for(var d=Object.keys(a.defines),e=0,f=d.length;f>e;e++){var g=d[e];"SHADOW_TYPE"!==g&&"JOINT_COUNT"!==g&&"WEIGHTS"!==g&&"PHYSICALLY_BASED_SHADING"!==g&&"ENVIRONMENT_TYPE"!==g&&"REFLECTIVE"!==g&&"DISCARD"!==g&&"OPACITY"!==g&&"FOG"!==g&&"REFLECTION_TYPE"!==g&&"SKIP_SPECULAR"!==g&&"LIGHT"!==g&&"COOKIE"!==g&&"TRANSPARENCY_BW"!==g&&"WRAP_AROUND"!==g&&(b[g]||c[g]||a.removeDefine(g))}},discard:function(a,b){b.uniforms.discardThreshold>=0?a.setDefine("DISCARD",!0):a.removeDefine("DISCARD")},opacity:function(a,b){var c=b.uniforms.opacity;void 0!==c&&1>c?a.setDefine("OPACITY",!0):a.removeDefine("OPACITY"),b.uniforms.useBWTransparency===!0?a.setDefine("TRANSPARENCY_BW",!0):a.removeDefine("TRANSPARENCY_BW")},fog:function(a){d.USE_FOG?(a.setDefine("FOG",!0),a.uniforms.fogSettings=d.FOG_SETTINGS,a.uniforms.fogColor=d.FOG_COLOR):a.removeDefine("FOG")},normalTangents:function(a,b){a.hasDefine("NORMAL")&&a.hasDefine("NORMAL_MAP")&&!b.meshData.getAttributeBuffer(e.TANGENT)&&k.addTangentBuffer(b.meshData)},processor:function(a,b){var c=b.meshData.attributeMap,e=b.material,f=e._textureMaps;a.uniforms.clearColor=d.CLEAR_COLOR,d.uber.reflectivity(a,e),d.uber.sky(a,e),d.uber.defines(a,c),d.uber.txMaps(a,f),d.uber.uniforms(a,f),d.uber.attributes(a,c,f),d.uber.discard(a,e),d.uber.opacity(a,e),d.uber.fog(a),a.setDefine("SKIP_SPECULAR",!0),d.uber.normalTangents(a,b)}};var n=[];d.light={pointLight:function(a,b,c){var d=b.pointLights=b.pointLights||[],e=8*c,f=a.translation;d[e+0]=f.x,d[e+1]=f.y,d[e+2]=f.z,d[e+3]=a.range;var g=a.color;d[e+4]=g.x*a.intensity,d[e+5]=g.y*a.intensity,d[e+6]=g.z*a.intensity,d[e+7]=a.specularIntensity,n.push("P")},directionalLight:function(a,b,c){var d=b.directionalLights=b.directionalLights||[],e=8*c,f=a.direction;d[e+0]=f.x,d[e+1]=f.y,d[e+2]=f.z,d[e+3]=0;var g=a.color;d[e+4]=g.x*a.intensity,d[e+5]=g.y*a.intensity,d[e+6]=g.z*a.intensity,d[e+7]=a.specularIntensity,n.push("D")},spotLight:function(a,b,c){var d=b.spotLights=b.spotLights||[],e=16*c;d[e+0]=a.translation.x,d[e+1]=a.translation.y,d[e+2]=a.translation.z,d[e+3]=a.range,d[e+4]=a.color.x*a.intensity,d[e+5]=a.color.y*a.intensity,d[e+6]=a.color.z*a.intensity,d[e+7]=a.specularIntensity,d[e+8]=a.direction.x,d[e+9]=a.direction.y,d[e+10]=a.direction.z,d[e+11]=0,d[e+12]=Math.cos(a.angle*j.DEG_TO_RAD/2),d[e+13]=void 0!==a.penumbra?Math.sin(a.penumbra*j.DEG_TO_RAD/4):0,d[e+14]=0,d[e+15]=0,n.push("S")},shadows:function(a,b,c,d,e,f){var g=a.lightCookie instanceof i;if((g||a.shadowCaster)&&a.shadowSettings.shadowData){var h=a.shadowSettings.shadowData;if(a.shadowCaster){b["shadowMaps"+c]="SHADOW_MAP"+c,e.material.setTexture("SHADOW_MAP"+c,h.shadowResult);var j=b.shadowData=b.shadowData||[],k=8*f,l=h.lightCamera.translation;j[k+0]=l.x,j[k+1]=l.y,j[k+2]=l.z,j[k+3]=a.shadowSettings.shadowOffset,j[k+4]=h.cameraScale,j[k+5]=a.shadowSettings.darkness,"PCF"===a.shadowSettings.shadowType?(j[k+6]=a.shadowSettings.resolution[0],j[k+7]=a.shadowSettings.resolution[1]):(j[k+6]=0,j[k+7]=0),f++,n.push("H","PCF"===a.shadowSettings.shadowType?1:"VSM"===a.shadowSettings.shadowType?2:0)}g?(b["lightCookie"+c]="LIGHT_COOKIE"+c,e.material.setTexture("LIGHT_COOKIE"+c,a.lightCookie),n.push("C"),d.setDefine("COOKIE",!0)):d.removeDefine("COOKIE"),b["shadowLightMatrices"+c]=h.vpm}return f},processor:function(a,b){var c=a.uniforms;c.totalAmbient=c.totalAmbient||[.1,.1,.1],b.material.uniforms.totalAmbient=b.material.uniforms.totalAmbient||[.1,.1,.1];var e=b.material.uniforms.materialAmbient||c.materialAmbient||[.1,.1,.1,1],j=b.material.uniforms.totalAmbient;b.material.multiplyAmbient?(j[0]=e[0]*d.GLOBAL_AMBIENT[0],j[1]=e[1]*d.GLOBAL_AMBIENT[1],j[2]=e[2]*d.GLOBAL_AMBIENT[2]):(j[0]=e[0]+d.GLOBAL_AMBIENT[0],j[1]=e[1]+d.GLOBAL_AMBIENT[1],j[2]=e[2]+d.GLOBAL_AMBIENT[2]);var k=b.renderable&&b.renderable.meshRendererComponent&&b.renderable.meshRendererComponent.receiveShadows;if(k?a.setDefine("RECEIVE_SHADOW",!0):a.removeDefine("RECEIVE_SHADOW"),a.frameStart){c.materialEmissive=c.materialEmissive||"EMISSIVE",c.materialDiffuse=c.materialDiffuse||"DIFFUSE",c.materialSpecular=c.materialSpecular||"SPECULAR";var l=0,m=0,o=0,p=0,q=b.lights;if(q.length>0){for(var r=0;r<q.length;r++){var s=q[r];s instanceof f?(d.light.pointLight(s,c,l),l++):s instanceof g?(d.light.directionalLight(s,c,m),m++):s instanceof h&&(d.light.spotLight(s,c,o),o++),p=d.light.shadows(s,c,r,a,b,p)}var t=n.join("");a.setDefine("LIGHT",t),n.length=0}else a.removeDefine("LIGHT")}else for(var q=b.lights,r=0;r<q.length;r++){var s=q[r],u=s.lightCookie instanceof i;if((u||s.shadowCaster)&&s.shadowSettings.shadowData){var v=s.shadowSettings.shadowData;s.shadowCaster&&b.material.setTexture("SHADOW_MAP"+r,v.shadowResult),u&&b.material.setTexture("LIGHT_COOKIE"+r,s.lightCookie)}else b.material.removeTexture("SHADOW_MAP"+r),b.material.removeTexture("LIGHT_COOKIE"+r)}},builder:function(a,b){var c=[],e=[],j=[],k=[];c.push("const mat4 ScaleMatrix = mat4(0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.5, 0.5, 0.5, 1.0);"),j.push("uniform vec3 totalAmbient;","uniform vec4 materialEmissive;","uniform vec4 materialDiffuse;","uniform vec4 materialSpecular;","uniform vec2 wrapSettings;","float ChebychevInequality(in vec2 moments, in float t) {","if ( t <= moments.x ) return 1.0;","float variance = moments.y - (moments.x * moments.x);","variance = max(variance, 0.02);","float d = t - moments.x;","return variance / (variance + d * d);","}"),k.push("#if defined(SPECULAR_MAP) && defined(TEXCOORD0)","float specularStrength = texture2D(specularMap, texCoord0).x;","#else","float specularStrength = 1.0;","#endif","vec3 totalDiffuse = vec3(0.0);","vec3 totalSpecular = vec3(0.0);");var m=b.lights;if(m.length>0){k.push("vec3 normalizedViewPosition = normalize(viewPosition);");for(var n=0,o=0,p=0,q=0,r=0;r<m.length;r++){var s=m[r];s instanceof f?n++:s instanceof g?o++:s instanceof h&&p++,(s.lightCookie instanceof i||s.shadowCaster)&&q++}n>0&&j.push("uniform vec4 pointLights["+2*n+"];"),o>0&&j.push("uniform vec4 directionalLights["+2*o+"];"),p>0&&j.push("uniform vec4 spotLights["+4*p+"];"),q>0&&j.push(l.methods.unpackDepth,"uniform vec4 shadowData["+2*q+"];","float texture2DCompare(sampler2D depths, vec2 uv, float compare) {","return step(unpackDepth(texture2D(depths, uv)), compare);","}"),n=0,o=0,p=0,q=0;for(var r=0;r<m.length;r++){var s=m[r];k.push("{","float shadow = 1.0;");var t=s.lightCookie instanceof i;(s.shadowCaster||t)&&(c.push("uniform mat4 shadowLightMatrices"+r+";","varying vec4 shadowLightDepths"+r+";"),e.push("shadowLightDepths"+r+" = ScaleMatrix * shadowLightMatrices"+r+" * worldPos;"),s.shadowCaster&&(j.push("uniform sampler2D shadowMaps"+r+";"),k.push("float shadowOffset"+r+" = shadowData["+(2*q+0)+"].w;","float shadowDarkness"+r+" = shadowData["+(2*q+1)+"].y;"),"PCF"===s.shadowSettings.shadowType?k.push("vec2 shadowMapSizes"+r+" = shadowData["+(2*q+1)+"].zw;"):"VSM"===s.shadowSettings.shadowType&&k.push("vec3 shadowLightPositions"+r+" = shadowData["+(2*q+0)+"].xyz;","float cameraScales"+r+" = shadowData["+(2*q+1)+"].x;")),t&&j.push("uniform sampler2D lightCookie"+r+";"),j.push("varying vec4 shadowLightDepths"+r+";"),k.push("vec3 depth = shadowLightDepths"+r+".xyz / shadowLightDepths"+r+".w;"),s.shadowCaster&&(q++,k.push("#ifdef RECEIVE_SHADOW","depth.z += shadowOffset"+r+";","if (depth.x >= 0.0 && depth.x <= 1.0 && depth.y >= 0.0 && depth.y <= 1.0 && shadowLightDepths"+r+".z >= 0.0 && depth.z <= 1.0) {"),"PCF"===s.shadowSettings.shadowType?k.push("float xPixelOffset = 1.0 / shadowMapSizes"+r+".x;","float yPixelOffset = 1.0 / shadowMapSizes"+r+".y;","float shadowRadius = 1.25;","float dx0 = -shadowRadius * xPixelOffset;","float dy0 = -shadowRadius * yPixelOffset;","float dx1 = shadowRadius * xPixelOffset;","float dy1 = shadowRadius * yPixelOffset;","shadow = 1.0 - (","texture2DCompare(shadowMaps"+r+", depth.xy + vec2(dx0, dy0), depth.z) +","texture2DCompare(shadowMaps"+r+", depth.xy + vec2(0.0, dy0), depth.z) +","texture2DCompare(shadowMaps"+r+", depth.xy + vec2(dx1, dy0), depth.z) +","texture2DCompare(shadowMaps"+r+", depth.xy + vec2(dx0, 0.0), depth.z) +","texture2DCompare(shadowMaps"+r+", depth.xy, depth.z) +","texture2DCompare(shadowMaps"+r+", depth.xy + vec2(dx1, 0.0), depth.z) +","texture2DCompare(shadowMaps"+r+", depth.xy + vec2(dx0, dy1), depth.z) +","texture2DCompare(shadowMaps"+r+", depth.xy + vec2(0.0, dy1), depth.z) +","texture2DCompare(shadowMaps"+r+", depth.xy + vec2(dx1, dy1), depth.z)",") * (shadowDarkness"+r+" / 9.0);"):"VSM"===s.shadowSettings.shadowType?k.push("depth.z = length(vWorldPos.xyz - shadowLightPositions"+r+") * cameraScales"+r+";","vec4 texel = texture2D(shadowMaps"+r+", depth.xy);","vec2 moments = vec2(texel.x, texel.y);","shadow = ChebychevInequality(moments, depth.z);","shadow = pow(shadow, shadowDarkness"+r+" * 8.0);"):k.push("shadow = 1.0 - texture2DCompare(shadowMaps"+r+", depth.xy, depth.z) * shadowDarkness"+r+";"),k.push("} else {","shadow = 1.0;","}","shadow = clamp(shadow, 0.0, 1.0);","#endif"))),s instanceof f?(k.push("vec4 pointLight"+r+" = pointLights["+(2*n+0)+"];","vec4 pointLightColor"+r+" = pointLights["+(2*n+1)+"];"),k.push("vec3 lVector = normalize(pointLight"+r+".xyz - vWorldPos.xyz);","float lDistance = 1.0 - min((length(pointLight"+r+".xyz - vWorldPos.xyz) / pointLight"+r+".w), 1.0);","float dotProduct = dot(N, lVector);","float pointDiffuseWeightFull = max(dotProduct, 0.0);","float pointDiffuseWeightHalf = max(mix(dotProduct, 1.0, wrapSettings.x), 0.0);","vec3 pointDiffuseWeight = mix(vec3(pointDiffuseWeightFull), vec3(pointDiffuseWeightHalf), wrapSettings.y);","totalDiffuse += materialDiffuse.rgb * pointLightColor"+r+".rgb * pointDiffuseWeight * lDistance * shadow;","vec3 pointHalfVector = normalize(lVector + normalizedViewPosition);","float pointDotNormalHalf = max(dot(N, pointHalfVector), 0.0);","float pointSpecularWeight = pointLightColor"+r+".a * specularStrength * max(pow(pointDotNormalHalf, materialSpecular.a), 0.0);","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = (materialSpecular.a + 2.0001 ) / 8.0;","vec3 schlick = materialSpecular.rgb + vec3(1.0 - materialSpecular.rgb) * pow(1.0 - dot(lVector, pointHalfVector), 5.0);","totalSpecular += schlick * pointLightColor"+r+".rgb * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization * shadow;","#else","totalSpecular += materialSpecular.rgb * pointLightColor"+r+".rgb * pointSpecularWeight * pointDiffuseWeight * lDistance * shadow;","#endif"),
n++):s instanceof g?(k.push("vec3 directionalLightDirection"+r+" = directionalLights["+(2*o+0)+"].xyz;","vec4 directionalLightColor"+r+" = directionalLights["+(2*o+1)+"];"),k.push("vec3 dirVector = normalize(-directionalLightDirection"+r+");","float dotProduct = dot(N, dirVector);","float dirDiffuseWeightFull = max(dotProduct, 0.0);","float dirDiffuseWeightHalf = max(mix(dotProduct, 1.0, wrapSettings.x), 0.0);","vec3 dirDiffuseWeight = mix(vec3(dirDiffuseWeightFull), vec3(dirDiffuseWeightHalf), wrapSettings.y);","vec3 cookie = vec3(1.0);"),t&&k.push("vec4 cookieTex = texture2D(lightCookie"+r+", depth.xy);","cookie = cookieTex.rgb * cookieTex.a;"),k.push("totalDiffuse += materialDiffuse.rgb * directionalLightColor"+r+".rgb * dirDiffuseWeight * shadow * cookie;","vec3 dirHalfVector = normalize(dirVector + normalizedViewPosition);","float dirDotNormalHalf = max(dot(N, dirHalfVector), 0.0);","float dirSpecularWeight = directionalLightColor"+r+".a * specularStrength * max(pow(dirDotNormalHalf, materialSpecular.a), 0.0);","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = (materialSpecular.a + 2.0001) / 8.0;","vec3 schlick = materialSpecular.rgb + vec3(1.0 - materialSpecular.rgb) * pow(1.0 - dot(dirVector, dirHalfVector), 5.0);","totalSpecular += schlick * directionalLightColor"+r+".rgb * dirSpecularWeight * dirDiffuseWeight * specularNormalization * shadow * cookie;","#else","totalSpecular += materialSpecular.rgb * directionalLightColor"+r+".rgb * dirSpecularWeight * dirDiffuseWeight * shadow * cookie;","#endif"),o++):s instanceof h&&(k.push("vec4 spotLight"+r+" = spotLights["+(4*p+0)+"];","vec4 spotLightColor"+r+" = spotLights["+(4*p+1)+"];","vec3 spotLightDirection"+r+" = spotLights["+(4*p+2)+"].xyz;","float spotLightAngle"+r+" = spotLights["+(4*p+3)+"].x;","float spotLightPenumbra"+r+" = spotLights["+(4*p+3)+"].y;"),k.push("vec3 lVector = normalize(spotLight"+r+".xyz - vWorldPos.xyz);","float lDistance = 1.0 - min((length(spotLight"+r+".xyz - vWorldPos.xyz) / spotLight"+r+".w), 1.0);","float spotEffect = dot(normalize(-spotLightDirection"+r+"), lVector);","if (spotEffect > spotLightAngle"+r+") {","if (spotLightPenumbra"+r+" > 0.0) {","spotEffect = (spotEffect - spotLightAngle"+r+") / spotLightPenumbra"+r+";","spotEffect = clamp(spotEffect, 0.0, 1.0);","} else {","spotEffect = 1.0;","}","float dotProduct = dot(N, lVector);","float spotDiffuseWeightFull = max(dotProduct, 0.0);","float spotDiffuseWeightHalf = max(mix(dotProduct, 1.0, wrapSettings.x), 0.0);","vec3 spotDiffuseWeight = mix(vec3(spotDiffuseWeightFull), vec3(spotDiffuseWeightHalf), wrapSettings.y);","vec3 cookie = vec3(1.0);"),t&&k.push("vec4 cookieTex = texture2D(lightCookie"+r+", depth.xy);","cookie = cookieTex.rgb * cookieTex.a;"),k.push("totalDiffuse += materialDiffuse.rgb * spotLightColor"+r+".rgb * spotDiffuseWeight * lDistance * spotEffect * shadow * cookie;","vec3 spotHalfVector = normalize(lVector + normalizedViewPosition);","float spotDotNormalHalf = max(dot(N, spotHalfVector), 0.0);","float spotSpecularWeight = spotLightColor"+r+".a * specularStrength * max(pow(spotDotNormalHalf, materialSpecular.a), 0.0);","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = (materialSpecular.a + 2.0001) / 8.0;","vec3 schlick = materialSpecular.rgb + vec3(1.0 - materialSpecular.rgb) * pow(1.0 - dot(lVector, spotHalfVector), 5.0);","totalSpecular += schlick * spotLightColor"+r+".rgb * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect * shadow * cookie;","#else","totalSpecular += materialSpecular.rgb * spotLightColor"+r+".rgb * spotSpecularWeight * spotDiffuseWeight * lDistance * spotEffect * shadow * cookie;","#endif","}"),p++),k.push("}")}}k.push("#if defined(EMISSIVE_MAP) && defined(TEXCOORD0)","vec3 emissive = vec3(0.0);","#else","vec3 emissive = materialEmissive.rgb;","#endif","#ifdef SKIP_SPECULAR","final_color.xyz = final_color.xyz * (emissive + totalDiffuse + totalAmbient);","#else","final_color.xyz = final_color.xyz * (emissive + totalDiffuse + totalAmbient) + totalSpecular;","#endif","#if defined(EMISSIVE_MAP) && defined(TEXCOORD0)","final_color.rgb += texture2D(emissiveMap, texCoord0).rgb * materialEmissive.rgb;","#endif"),d.light.prevertex=c.join("\n"),d.light.vertex=e.join("\n"),d.light.prefragment=j.join("\n"),d.light.fragment=k.join("\n")}},d.animation={processor:function(a,b){var c=b.currentPose;c?(a.uniforms.jointPalette||(a.uniforms.jointPalette=d.animation.jointPalette),a.setDefine("JOINT_COUNT",3*b.meshData.paletteMap.length)):a.removeDefine("JOINT_COUNT")},jointPalette:function(a){var b=a.meshData,c=a.currentPose;if(c){var e=c._matrixPalette,f=b.store;f||(f=new Float32Array(12*b.paletteMap.length),b.store=f);for(var g,h=0;h<b.paletteMap.length;h++){g=e[b.paletteMap[h]];for(var i=0;12>i;i++)f[12*h+i]=g.data[d.animation.order[i]]}return f}},order:[0,4,8,12,1,5,9,13,2,6,10,14],prevertex:["#if defined(JOINT_COUNT) && defined(WEIGHTS) && defined(JOINTIDS)","attribute vec4 vertexJointIDs;","attribute vec4 vertexWeights;","uniform vec4 jointPalette[JOINT_COUNT];","#endif"].join("\n"),vertex:["#if defined(JOINT_COUNT) && defined(WEIGHTS) && defined(JOINTIDS)","int x = 3*int(vertexJointIDs.x);","int y = 3*int(vertexJointIDs.y);","int z = 3*int(vertexJointIDs.z);","int w = 3*int(vertexJointIDs.w);","mat4 mat = mat4(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0);","mat += mat4(","	jointPalette[x+0].x, jointPalette[x+1].x, jointPalette[x+2].x, 0,","	jointPalette[x+0].y, jointPalette[x+1].y, jointPalette[x+2].y, 0,","	jointPalette[x+0].z, jointPalette[x+1].z, jointPalette[x+2].z, 0,","	jointPalette[x+0].w, jointPalette[x+1].w, jointPalette[x+2].w, 1",") * vertexWeights.x;","mat += mat4(","	jointPalette[y+0].x, jointPalette[y+1].x, jointPalette[y+2].x, 0,","	jointPalette[y+0].y, jointPalette[y+1].y, jointPalette[y+2].y, 0,","	jointPalette[y+0].z, jointPalette[y+1].z, jointPalette[y+2].z, 0,","	jointPalette[y+0].w, jointPalette[y+1].w, jointPalette[y+2].w, 1",") * vertexWeights.y;","mat += mat4(","	jointPalette[z+0].x, jointPalette[z+1].x, jointPalette[z+2].x, 0,","	jointPalette[z+0].y, jointPalette[z+1].y, jointPalette[z+2].y, 0,","	jointPalette[z+0].z, jointPalette[z+1].z, jointPalette[z+2].z, 0,","	jointPalette[z+0].w, jointPalette[z+1].w, jointPalette[z+2].w, 1",") * vertexWeights.z;","mat += mat4(","	jointPalette[w+0].x, jointPalette[w+1].x, jointPalette[w+2].x, 0,","	jointPalette[w+0].y, jointPalette[w+1].y, jointPalette[w+2].y, 0,","	jointPalette[w+0].z, jointPalette[w+1].z, jointPalette[w+2].z, 0,","	jointPalette[w+0].w, jointPalette[w+1].w, jointPalette[w+2].w, 1",") * vertexWeights.w;","wMatrix = wMatrix * mat / mat[3][3];","#ifdef NORMAL","nMatrix = nMatrix * mat3(mat) / mat[3][3];","#endif","#endif"].join("\n")},a.exports=d},function(a,b,c){function d(a){e.call(this,a),this.range=1e3}var e=c(50);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.update=function(a){a.matrix.getTranslation(this.translation)},d.prototype.copy=function(a){return e.prototype.copy.call(this,a),this.range=a.range,this},d.prototype.clone=function(){var a=new d(this.color.clone());return a.copy(this),a},a.exports=d},function(a,b,c){function d(a){this.translation=new e,this.color=a?a.clone():new e(1,1,1),this.intensity=1,this.specularIntensity=1,this.shadowCaster=!1,this.lightCookie=null,this.shadowSettings={size:100,near:1,far:1e3,resolution:[512,512],upVector:e.UNIT_Y.clone(),darkness:1,shadowOffset:-.001,shadowType:"VSM"},this.changedProperties=!1,this.changedColor=!1}var e=c(8);d.prototype.destroy=function(a){var b=this.shadowSettings;b.shadowData&&(b.shadowData.shadowTarget&&b.shadowData.shadowTarget.destroy(a.context),b.shadowData.shadowTargetDown&&b.shadowData.shadowTargetDown.destroy(a.context),b.shadowData.shadowBlurred&&b.shadowData.shadowBlurred.destroy(a.context)),delete b.shadowData},d.prototype.invalidateHandles=function(a){var b=this.shadowSettings;b.shadowData&&(b.shadowData.shadowTarget&&a.invalidateRenderTarget(b.shadowData.shadowTarget),b.shadowData.shadowTargetDown&&a.invalidateRenderTarget(b.shadowData.shadowTargetDown),b.shadowData.shadowBlurred&&a.invalidateRenderTarget(b.shadowData.shadowBlurred))},d.prototype.copy=function(a){return this.translation.copy(a.translation),this.color.copy(a.color),this.intensity=a.intensity,this.specularIntensity=a.specularIntensity,this.shadowCaster=a.shadowCaster,a.lightCookie&&(this.lightCookie=a.lightCookie.clone()),this.shadowSettings.size=a.shadowSettings.size,this.shadowSettings.near=a.shadowSettings.near,this.shadowSettings.far=a.shadowSettings.far,this.shadowSettings.resolution[0]=a.shadowSettings.resolution[0],this.shadowSettings.resolution[1]=a.shadowSettings.resolution[1],this.shadowSettings.upVector.copy(a.shadowSettings.upVector),this.shadowSettings.darkness=a.shadowSettings.darkness,this.shadowSettings.shadowType=a.shadowSettings.shadowType,this.changedProperties=a.changedProperties,this.changedColor=a.changedColor,this},a.exports=d},function(a,b,c){function d(a){f.call(this,a),this.direction=new e}var e=c(8),f=c(50);d.prototype=Object.create(f.prototype),d.prototype.constructor=d,d.prototype.update=function(a){a.matrix.getTranslation(this.translation),this.direction.setDirect(0,0,-1),this.direction.applyPostVector(a.matrix)},d.prototype.copy=function(a){return f.prototype.copy.call(this,a),this.direction.copy(a.direction),this},d.prototype.clone=function(){var a=new d(this.color.clone());return a.copy(this),a},a.exports=d},function(a,b,c){function d(a){f.call(this,a),this.direction=new e,this.range=1e3,this.angle=45,this.penumbra=null,this.exponent=16}var e=c(8),f=c(50);d.prototype=Object.create(f.prototype),d.prototype.constructor=d,d.prototype.update=function(a){a.matrix.getTranslation(this.translation),this.direction.setDirect(0,0,-1),this.direction.applyPostVector(a.matrix)},d.prototype.copy=function(a){return f.prototype.copy.call(this,a),a.direction.copy(this.direction),this.range=a.range,this.angle=a.angle,this.penumbra=a.penumbra,this.exponent=a.exponent,this},d.prototype.clone=function(){var a=new d(this.color.clone());return a.copy(this),a},a.exports=d},function(a,b,c){function d(a,b,c,d){this.glTexture=null,b=b||{},g.copyOptions(this,b,{wrapS:"Repeat",wrapT:"Repeat",magFilter:"Bilinear",minFilter:"Trilinear",format:"RGBA",type:"UnsignedByte",generateMipmaps:!0,premultiplyAlpha:!1,unpackAlignment:1,flipY:!0}),this.anisotropy=void 0!==b.anisotropy?b.anisotropy:1,this.variant="2D",this.offset=b.offset?e.fromAny(b.offset):new e(0,0),this.repeat=b.repeat?e.fromAny(b.repeat):new e(1,1),this.lodBias=0,this.hasBorder=!1,this.needsUpdate=!1,this.updateCallback=null,this.readyCallback=null,this._originalImage=null,this._originalWidth=0,this._originalHeight=0,this.image=null,a&&this.setImage(a,c,d,b),this.loadImage=f.resolve.bind(null,this),this.textureRecord={}}var e=c(19),f=c(54),g=c(6);d.prototype.checkDataReady=function(){return this.image&&(this.image.dataReady||this.image instanceof HTMLImageElement)||null!==this.readyCallback&&this.readyCallback()},d.prototype.checkNeedsUpdate=function(){return this.needsUpdate||null!==this.updateCallback&&this.updateCallback()},d.prototype.setNeedsUpdate=function(){this.needsUpdate=!0},d.prototype.setImage=function(a,b,c,d){this._originalImage=a,this.image=a;var e=a instanceof Array?a[0]:a;if(e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Uint16Array||e instanceof Float32Array){if(b=b||a.width,c=c||a.height,void 0===b||void 0===c)throw new Error("Data textures need width and height");this.image={data:a,width:b,height:c,isData:!0,dataReady:!0},e instanceof Uint8Array||e instanceof Uint8ClampedArray?this.type=d.type||"UnsignedByte":e instanceof Uint16Array?(this.type=d.type||"UnsignedShort565",this.format=d.format||"RGB"):e instanceof Float32Array&&(this.type=d.type||"Float",this.format=d.format||"RGBA")}else a instanceof Array&&(this.image={data:a}),e instanceof HTMLCanvasElement&&(this.image.dataReady=!0);this.setNeedsUpdate(),this._originalWidth=b,this._originalHeight=c},d.prototype.destroy=function(a){a.deleteTexture(this.glTexture),this.glTexture=null},d.prototype.getSizeInMemory=function(){var a;if(!this.image)return 0;var b=this.image.width||this.image.length,c=this.image.height||1;return a=b*c,"Luminance"===this.format||"Alpha"===this.format?a*=1:"Lumin`anceAlpha"===this.format?a*=2:"RGB"===this.format?a*=3:"RGBA"===this.format?a*=4:"PrecompressedDXT1"===this.format?a*=.5:"PrecompressedDXT1A"===this.format?a*=4/6:("PrecompressedDXT3"===this.format||"PrecompressedDXT5"===this.format)&&(a*=1),this.generateMipmaps&&(a=Math.ceil(4*a/3)),a},d.prototype.clone=function(){var a={wrapS:this.wrapS,wrapT:this.wrapT,magFilter:this.magFilter,minFilter:this.minFilter,anisotropy:this.anisotropy,format:this.format,type:this.type,offset:this.offset,repeat:this.repeat,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment,flipY:this.flipY},b=new d(this._originalImage,a,this._originalWidth,this._originalHeight);return b.variant=this.variant,b.lodBias=this.lodBias,b.hasBorder=this.hasBorder,b},d.CUBE_FACES=["PositiveX","NegativeX","PositiveY","NegativeY","PositiveZ","NegativeZ"],a.exports=d},function(a,b,c){function d(){}var e=c(55);d.createPromise=function(a){var b=new e.Promise;return a(function(a){b.resolve(a)},function(a){b.reject(a)}),b},d.resolve=function(a){var b=new e.Promise;return b.resolve(a),b},d.reject=function(a){var b=new e.Promise;return b.reject(a),b};var f=!1;d.createDummyPromise=function(a,b){f||(f=!0,console.warn("PromiseUtils.createDummyPromise is deprecated; please consider using PromiseUtils.resolve/reject instead"));var c=new e.Promise;return b?c.reject(b):c.resolve(a),c},d.optimisticAll=function(a){var b=0,c=a.length,d=[],f=new e.Promise;if(c>0)for(var g=0;c>g;g++)!function(e){a[e].then(function(a){d[e]=a,b++,b===c&&f.resolve(d)},function(a){d[e]=a,b++,b===c&&f.resolve(d)})}(g);else f.resolve(d);return f},d.delay=function(a,b){var c=new e.Promise;return setTimeout(function(){c.resolve(a)},b),c},d.defer=function(a,b){var c,d,f;return f=new e.Promise,b.apply?(c=new e.Promise,d=c.then(function(){return b()}),setTimeout(function(){c.resolve()},a),d):(setTimeout(function(){f.resolve(b)},a),f)},a.exports=d},function(a,b,c){(function(b){function c(a,b){g.async(function(){a.trigger("promise:resolved",{detail:b}),a.isResolved=!0,a.resolvedValue=b})}function d(a,b){g.async(function(){a.trigger("promise:failed",{detail:b}),a.isRejected=!0,a.rejectedValue=b})}function e(a){var b,c=[],d=new q,e=a.length;0===e&&d.resolve([]);var f=function(a,b){c[a]=b,0===--e&&d.resolve(c)},g=function(a){return function(b){f(a,b)}},h=function(a){d.reject(a)};for(b=0;e>b;b++)a[b].then(g(b),h);return d}function f(a,b){g[a]=b}var g={},h="undefined"!=typeof window?window:{},i=h.MutationObserver||h.WebKitMutationObserver;if("undefined"!=typeof b&&"[object process]"==={}.toString.call(b))g.async=function(a,c){b.nextTick(function(){a.call(c)})};else if(i){var j=[],k=new i(function(){var a=j.slice();j=[],a.forEach(function(a){var b=a[0],c=a[1];b.call(c)})}),l=document.createElement("div");k.observe(l,{attributes:!0}),window.addEventListener("unload",function(){k.disconnect(),k=null}),g.async=function(a,b){j.push([a,b]),l.setAttribute("drainQueue","drainQueue")}}else g.async=function(a,b){setTimeout(function(){a.call(b)},1)};var m=function(a,b){this.type=a;for(var c in b)b.hasOwnProperty(c)&&(this[c]=b[c])},n=function(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c][0]===b)return c;return-1},o=function(a){var b=a._promiseCallbacks;return b||(b=a._promiseCallbacks={}),b},p={mixin:function(a){return a.on=this.on,a.off=this.off,a.trigger=this.trigger,a},on:function(a,b,c){var d,e,f=o(this);for(a=a.split(/\s+/),c=c||this;e=a.shift();)d=f[e],d||(d=f[e]=[]),-1===n(d,b)&&d.push([b,c])},off:function(a,b){var c,d,e,f=o(this);for(a=a.split(/\s+/);d=a.shift();)b?(c=f[d],e=n(c,b),-1!==e&&c.splice(e,1)):f[d]=[]},trigger:function(a,b){var c,d,e,f,g,h=o(this);if(c=h[a])for(var i=0,j=c.length;j>i;i++)d=c[i],e=d[0],f=d[1],"object"!=typeof b&&(b={detail:b}),g=new m(a,b),e.call(f,g)}},q=function(){this.on("promise:resolved",function(a){this.trigger("success",{detail:a.detail})},this),this.on("promise:failed",function(a){this.trigger("error",{detail:a.detail})},this)},r=function(){},s=function(a,b,c,d){var e,f,g,h,i="function"==typeof c;if(i)try{e=c(d.detail),g=!0}catch(j){h=!0,f=j}else e=d.detail,g=!0;e&&"function"==typeof e.then?e.then(function(a){b.resolve(a)},function(a){b.reject(a)}):i&&g?b.resolve(e):h?b.reject(f):b[a](e)};q.prototype={then:function(a,b){var c=new q;return this.isResolved&&g.async(function(){s("resolve",c,a,{detail:this.resolvedValue})},this),this.isRejected&&g.async(function(){s("reject",c,b,{detail:this.rejectedValue})},this),this.on("promise:resolved",function(b){s("resolve",c,a,b)}),this.on("promise:failed",function(a){s("reject",c,b,a)}),c},resolve:function(a){c(this,a),this.resolve=r,this.reject=r},reject:function(a){d(this,a),this.resolve=r,this.reject=r}},p.mixin(q.prototype),a.exports={Promise:q,Event:m,EventTarget:p,all:e,configure:f}}).call(b,c(56))},function(a,b){function c(){j=!1,g.length?i=g.concat(i):k=-1,i.length&&d()}function d(){if(!j){var a=setTimeout(c);j=!0;for(var b=i.length;b;){for(g=i,i=[];++k<b;)g&&g[k].run();k=-1,b=i.length}g=null,j=!1,clearTimeout(a)}}function e(a,b){this.fun=a,this.array=b}function f(){}var g,h=a.exports={},i=[],j=!1,k=-1;h.nextTick=function(a){var b=new Array(arguments.length-1);if(arguments.length>1)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];i.push(new e(a,b)),1!==i.length||j||setTimeout(d,0)},e.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=f,h.addListener=f,h.once=f,h.off=f,h.removeListener=f,h.removeAllListeners=f,h.emit=f,h.binding=function(a){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(a){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},function(a,b,c){function d(){}var e=c(19),f=c(8),g=c(14);d.addTangentBuffer=function(a,b){function c(a){for(var b=[],c=0;c<a.length;c+=2)b.push(new e(a[c+0],a[c+1]));return b}function d(a){for(var b=[],c=0;c<a.length;c+=3)b.push(new f(a[c+0],a[c+1],a[c+2]));return b}b=b||0;var h=a.getAttributeBuffer(g.POSITION);if(h){var i=a.getAttributeBuffer(g.NORMAL);if(i){var j=a.getAttributeBuffer("TEXCOORD"+b);if(j||0===b||(j=a.getAttributeBuffer(g.TEXCOORD0)),j){var k=a.getIndexBuffer();if(k){for(var l=a.vertexCount,m=a.indexCount/3,n=[],o=[],p=0;l>p;p++)n[p]=new f,o[p]=new f;for(var q=d(h),r=d(i),s=c(j),t=0;m>t;t++){var u=k[3*t],v=k[3*t+1],w=k[3*t+2],x=q[u],y=q[v],z=q[w],A=s[u],B=s[v],C=s[w],D=y.x-x.x,E=z.x-x.x,F=y.y-x.y,G=z.y-x.y,H=y.z-x.z,I=z.z-x.z,J=B.x-A.x,K=C.x-A.x,L=B.y-A.y,M=C.y-A.y,N=1/(J*M-K*L);if(isFinite(N)!==!1){var O=new f((M*D-L*E)*N,(M*F-L*G)*N,(M*H-L*I)*N),P=new f((J*E-K*D)*N,(J*G-K*F)*N,(J*I-K*H)*N);n[u].add(O),n[v].add(O),n[w].add(O),o[u].add(P),o[v].add(P),o[w].add(P)}}a.attributeMap[g.TANGENT]=g.createAttribute(4,"Float"),a.rebuildData(a.vertexCount,a.indexCount,!0);for(var Q=a.getAttributeBuffer(g.TANGENT),R=new f,S=new f,t=0;l>t;t++){var T=r[t],U=n[t],V=T.dot(U);R.copy(U).sub(S.copy(T).scale(V)).normalize(),Q[4*t+0]=R.x,Q[4*t+1]=R.y,Q[4*t+2]=R.z,V=R.copy(T).cross(U).dot(o[t]);var W=0>V?-1:1;Q[4*t+3]=W}return Q}}}}},a.exports=d},,,,,,,,,,,,,,,,,,,,,,,,,,,,function(a,b,c){function d(a,b,c,d){this.world=a,this.getConfig=b,this.updateObject=c,this.loadObject=d,this._objects=new Map,this._loading=new Map}var e=c(55),f=c(54);d.prototype._create=function(){return{}},d.prototype._remove=function(a){this._objects["delete"](a)},d.prototype._prepare=function(){},d.prototype._load=function(a,b){return this.loadObject(a,b)},d.prototype.load=function(a,b){var c=a.substr(a.lastIndexOf(".")+1);if(c!==this.constructor._type)throw new Error("Trying to load type"+c+" with handler for "+this._type);if(b||(b={}),!this._loading.has(a)||b.instantiate&&"machine"===d.getTypeForRef(a)){if(this._objects.has(a)&&!b.reload)return f.resolve(this._objects.get(a));var e=this.getConfig(a,b).then(function(c){return this.update(a,c,b)}.bind(this)).then(function(b){return this._loading["delete"](a),b}.bind(this)).then(null,function(b){throw this._loading["delete"](a),b}.bind(this));return e}return this._loading.get(a)},d.prototype.clear=function(){var a=[];return this._objects.forEach(function(b,c){a.push(this.update(c,null,{}))}.bind(this)),this._objects.clear(),this._loading.clear(),e.all(a)},d.prototype.update=function(a,b,c){var d=this._update(a,b,c).then(function(b){return this._loading["delete"](a),b}.bind(this));return this._loading.set(a,d),d},d.getTypeForRef=function(a){return a.substr(a.lastIndexOf(".")+1).toLowerCase()},d.prototype._update=function(a,b,c){return b?(c||(c={}),(!this._objects.has(a)||c.instantiate&&"machine"===d.getTypeForRef(a))&&this._objects.set(a,this._create()),this._prepare(b),f.resolve(this._objects.get(a))):(this._remove(a,c),f.resolve())},d.handlerClasses={},d.getHandler=function(a){return d.handlerClasses[a]},d._registerClass=function(a,b){return b._type=a,d.handlerClasses[a]=b},a.exports=d},function(a,b){function c(){}c.getTypedArray=function(a,b){var c=b[0],d=b[1],e=b[2];if("float32"===e)return new Float32Array(a,c,d);if("uint8"===e)return new Uint8Array(a,c,d);if("uint16"===e)return new Uint16Array(a,c,d);if("uint32"===e)return new Uint32Array(a,c,d);throw new Error("Binary format "+e+" is not supported")},c.remove=function(a,b,c){var d=-1;if("function"==typeof c){for(var e=0;e<a.length;e++)if(c(a[e],b)){d=e;break}}else d=a.indexOf(b);d>-1&&a.splice(d,1)},c.find=function(a,b){for(var c=0;c<a.length;c++)if(b(a[c]))return a[c];return null},c.fromKeys=function(a){var b=[];return a.forEach(function(a,c){b.push(c)}),b},c.fromValues=function(a){var b=[];return a.forEach(function(a){b.push(a)}),b},a.exports=c},,function(a,b,c){function d(a,b,c,d){this.world=a,this.getConfig=b,this.updateObject=c,this.loadObject=d}var e=c(54);d.prototype._prepare=function(){},d.prototype._create=function(){throw new Error("ComponentHandler._create is abstract, use ComponentHandler.getHandler(type)")},d.prototype._remove=function(a){a.clearComponent(this._type)},d.prototype._load=function(a,b){return this.loadObject(a,b)},d.prototype.update=function(a,b){if(!a)return e.reject("Entity is missing");if(!b)return this._remove(a),e.resolve();var c=a.getComponent(this._type);return c||(c=this._create(),a.setComponent(c)),this._prepare(b),e.resolve(c)},d.handlerClasses={},d.getHandler=function(a){return d.handlerClasses[a]},d._registerClass=function(a,b){d.handlerClasses[a]=b},a.exports=d},,,,,,,,,,,function(a,b,c){var d=c(6);a.exports=d},,,,,,,,,,,,,function(a,b,c){function d(){this.meshDatas=[],this.vertexData={},this.indexData=[],this.vertexCounter=0,this.indexCounter=0,this.indexLengths=[],this.indexModes=[]}var e=c(14),f=c(17),g=c(8);d.prototype.addEntity=function(a){var b=this;a.traverse(function(a){a.meshDataComponent&&b.addMeshData(a.meshDataComponent.meshData,a.transformComponent.sync().worldTransform)})};var h=new g;d.prototype.addMeshData=function(a,b){if(!f.ElementIndexUInt){if(a.vertexCount>=65536)throw new Error("Maximum number of vertices for a mesh to add is 65535. Got: "+a.vertexCount);this.vertexCounter+a.vertexCount>=65536&&this._generateMesh()}for(var c=b.matrix,d=b.rotation,g=a.attributeMap,i=Object.keys(g),j=0,k=i.length;k>j;j++){var l=i[j],m=g[l],n=this.vertexData[l];n||(this.vertexData[l]={},n=this.vertexData[l],n.array=[],n.map={count:m.count,type:m.type,stride:m.stride,offset:m.offset,normalized:m.normalized});var o=a.getAttributeBuffer(l),p=o.length,q=n.array,r=m.count,s=this.vertexCounter*r;if(l===e.POSITION)for(var t=0;p>t;t+=r)h.setDirect(o[t+0],o[t+1],o[t+2]),h.applyPostPoint(c),q[s+t+0]=h.x,q[s+t+1]=h.y,q[s+t+2]=h.z;else if(l===e.NORMAL)for(var t=0;p>t;t+=r)h.setDirect(o[t+0],o[t+1],o[t+2]),h.applyPost(d),q[s+t+0]=h.x,q[s+t+1]=h.y,q[s+t+2]=h.z;else if(l===e.TANGENT)for(var t=0;p>t;t+=r)h.setDirect(o[t+0],o[t+1],o[t+2]),h.applyPost(d),q[s+t+0]=h.x,q[s+t+1]=h.y,q[s+t+2]=h.z,q[s+t+3]=o[t+3];else for(var t=0;p>t;t++)q[s+t]=o[t]}for(var u=a.getIndexBuffer(),t=0,k=a.indexCount;k>t;t++)this.indexData[this.indexCounter+t]=u[t]+this.vertexCounter;this.vertexCounter+=a.vertexCount,this.indexCounter+=a.indexCount,a.indexLengths?this.indexLengths=this.indexLengths.concat(a.indexLengths):this.indexLengths=this.indexLengths.concat(a.getIndexBuffer().length),this.indexModes=this.indexModes.concat(a.indexModes)},d.prototype._generateMesh=function(){var a={};for(var b in this.vertexData){var c=this.vertexData[b];a[b]=c.map}var d=new e(a,this.vertexCounter,this.indexCounter);for(var b in this.vertexData){var c=this.vertexData[b].array;d.getAttributeBuffer(b).set(c)}d.getIndexBuffer().set(this.indexData),d.indexLengths=this.indexLengths,d.indexModes=this.indexModes;for(var f=d.indexModes[0],g=0,h=[],i=[],j=0;j<d.indexModes.length;j++){var k=d.indexModes[j];f!==k&&(h.push(f),i.push(g),f=k,g=0),g+=d.indexLengths[j],j===d.indexModes.length-1&&(h.push(k),i.push(g),f=k,g=0)}d.indexLengths=i,d.indexModes=h,this.meshDatas.push(d),this.vertexData={},this.indexData=[],this.vertexCounter=0,this.indexCounter=0,this.indexLengths=[],this.indexModes=[]},d.prototype.build=function(){return this.vertexCounter>0&&this._generateMesh(),this.meshDatas},d.prototype.reset=function(){this.meshDatas=[],this.vertexData={},this.indexData=[],this.vertexCounter=0,this.indexCounter=0,this.indexLengths=[],this.indexModes=[]},a.exports=d},,,,,function(a,b,c){function d(a,b,c,d){if(1===arguments.length&&arguments[0]instanceof Object){var f=arguments[0];a=f.radialSamples,b=f.radiusTop,c=f.radiusBottom,d=f.height}this.radialSamples=a||8,this.radiusTop="undefined"==typeof b?.5:b,this.radiusBottom="undefined"==typeof c?this.radiusTop:c,this.height="undefined"==typeof d?1:d;var g=e.defaultMap([e.POSITION,e.NORMAL,e.TEXCOORD0]);e.call(this,g,4*this.radialSamples+2+2,3*this.radialSamples*4),this.indexModes=["Triangles"],this.rebuild()}var e=c(14),f=c(8),g=c(6);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.rebuild=function(){var a=[],b=[],c=[],d=[],g=this.height,h=g/2,i=this.radiusTop,j=this.radiusBottom,k=this.radialSamples,l=2*Math.PI/k,m=1/k,n=4*k+2+2-1,o=new f,p=0;g&&(p=Math.tan((j-i)/g));for(var q=0,r=0,s=0;k>q;q++,r+=l,s+=m){var t=Math.cos(r),u=Math.sin(r),v=t*i,w=u*i,x=t*j,y=u*j;a.push(v,w,h,x,y,-h,v,w,h,x,y,-h),o.setDirect(t,u,p),o.normalize(),b.push(0,0,1,0,0,-1,o.x,o.y,o.z,o.x,o.y,o.z),c.push(t/4+.25,u/4+.75,t/4+.25,u/4+.25,.5,s,1,s)}a.push(i,0,h,j,0,-h),b.push(1,0,0,1,0,0),c.push(.5,1,1,1);for(var q=0;k-1>q;q++)d.push(n,4*q+0,4*q+4,4*q+1,n-1,4*q+5,4*q+4+2,4*q+2,4*q+4+3,4*q+2,4*q+3,4*q+4+3);return d.push(n,4*q+0,0,4*q+1,n-1,1,4*q+4,4*q+2,4*q+5,4*q+2,4*q+3,4*q+5),a.push(0,0,-h,0,0,h),b.push(0,0,-.5,0,0,.5),c.push(.25,.25,.25,.75),this.getAttributeBuffer(e.POSITION).set(a),this.getAttributeBuffer(e.NORMAL).set(b),this.getAttributeBuffer(e.TEXCOORD0).set(c),this.getIndexBuffer().set(d),this},d.prototype.clone=function(){var a=g.shallowSelectiveClone(this,["radialSamples","radiusTop","radiusBottom","height"]);return new d(a)},a.exports=d},,,function(a,b,c){function d(a,b,c,j){a="undefined"!=typeof a?a:45,b="undefined"!=typeof b?b:1,c="undefined"!=typeof c?c:1,j="undefined"!=typeof j?j:1e3,this.translation=new f(0,0,0),this._left=new f(-1,0,0),this._up=new f(0,1,0),this._direction=new f(0,0,-1),this.size=.5,this._frustumNear=this.near=1,this._frustumFar=this.far=2,this._frustumLeft=this.left=-.5,this._frustumRight=this.right=.5,this._frustumTop=this.top=.5,this._frustumBottom=this.bottom=-.5,this._coeffLeft=new e,this._coeffRight=new e,this._coeffBottom=new e,this._coeffTop=new e,this._viewPortLeft=0,this._viewPortRight=1,this._viewPortTop=1,this._viewPortBottom=0,this._worldPlane=[];for(var k=0;k<d.FRUSTUM_PLANES;k++)this._worldPlane[k]=new i;this.projectionMode=d.Perspective,this.lockedRatio=!1,this.aspect=b,this._updateMVMatrix=!0,this._updateInverseMVMatrix=!0,this._updatePMatrix=!0,this._updateMVPMatrix=!0,this._updateInverseMVPMatrix=!0,this.modelView=new h,this.modelViewInverse=new h,this.projection=new h,this.modelViewProjection=new h,this.modelViewProjectionInverse=new h,this._planeState=0,this._clipPlane=new g,this._qCalc=new g,this._corners=[];for(var k=0;8>k;k++)this._corners.push(new f);this._extents=new f,this.vNearPlaneCenter=new f,this.vFarPlaneCenter=new f,this.calcLeft=new f,this.calcUp=new f,this.changedProperties=!0,this.setFrustumPerspective(a,b,c,j),this.onFrameChange()}var e=c(19),f=c(8),g=c(11),h=c(33),i=c(121),j=c(9),k=c(122),l=c(7),m=c(13),n=c(12),o=new f;d.LEFT_PLANE=0,d.RIGHT_PLANE=1,d.BOTTOM_PLANE=2,d.TOP_PLANE=3,d.FAR_PLANE=4,d.NEAR_PLANE=5,d.FRUSTUM_PLANES=6,d.Perspective=0,d.Parallel=1,d.Custom=2,d.Outside=0,d.Inside=1,d.Intersects=2,d.prototype.normalize=function(){this._left.normalize(),this._up.normalize(),this._direction.normalize(),this.onFrameChange()},d.prototype.setProjectionMode=function(a){this.projectionMode=a,this.update()},d.prototype.setFrustumPerspective=function(a,b,c,d){if(void 0!==a&&null!==a&&(this.fov=a),void 0!==b&&null!==b&&(this.aspect=b),void 0!==c&&null!==c&&(this.near=c),void 0!==d&&null!==d&&(this.far=d),void 0!==this.fov){var e=Math.tan(this.fov*j.DEG_TO_RAD*.5)*this.near,f=e*this.aspect;this._frustumLeft=-f,this._frustumRight=f,this._frustumBottom=-e,this._frustumTop=e,this._frustumNear=this.near,this._frustumFar=this.far,this._frustumFar-this._frustumNear<j.EPSILON&&(this._frustumFar=this._frustumNear+j.EPSILON),this.onFrustumChange()}},d.prototype.setFrustum=function(a,b,c,d,e,f,g){void 0!==a&&null!==a&&(this.near=a),void 0!==b&&null!==b&&(this.far=b),void 0!==c&&null!==c&&(this.left=c),void 0!==d&&null!==d&&(this.right=d),void 0!==e&&null!==e&&(this.top=e),void 0!==f&&null!==f&&(this.bottom=f),void 0!==g&&null!==g&&(this.aspect=g),this._frustumNear=this.near,this._frustumFar=this.far,this._frustumLeft=this.left*this.aspect,this._frustumRight=this.right*this.aspect,this._frustumTop=this.top,this._frustumBottom=this.bottom,this._frustumFar-this._frustumNear<j.EPSILON&&(this._frustumFar=this._frustumNear+j.EPSILON),this.onFrustumChange()},d.prototype.copy=function(a){return this.translation.set(a.translation),this._left.set(a._left),this._up.set(a._up),this._direction.set(a._direction),this.fov=a.fov,this.aspect=a.aspect,this.near=a.near,this.far=a.far,this.left=a.left,this.right=a.right,this.top=a.top,this.bottom=a.bottom,this._frustumLeft=a._frustumLeft,this._frustumRight=a._frustumRight,this._frustumBottom=a._frustumBottom,this._frustumTop=a._frustumTop,this._frustumNear=a._frustumNear,this._frustumFar=a._frustumFar,this.projectionMode=a.projectionMode,this.onFrustumChange(),this.onFrameChange(),this},d.prototype.setFrame=function(a,b,c,d){this._left.set(b),this._up.set(c),this._direction.set(d),this.translation.set(a),this.onFrameChange()},d.prototype.lookAt=function(a,b){o.set(a).sub(this.translation).normalize(),o.equals(this._direction)||(this._direction.set(o),this._up.set(b).normalize(),this._up.equals(f.ZERO)&&this._up.set(f.UNIT_Y),this._left.set(this._up).cross(this._direction).normalize(),this._left.equals(f.ZERO)&&(0!==this._direction.x?this._left.setDirect(this._direction.y,-this._direction.x,0):this._left.setDirect(0,this._direction.z,-this._direction.y)),this._up.set(this._direction).cross(this._left).normalize(),this.onFrameChange())},d.prototype.update=function(){this.onFrustumChange(),this.onFrameChange()},d.prototype.contains=function(a){if(!a)return d.Inside;for(var b=d.Inside,c=d.FRUSTUM_PLANES-1;c>=0;c--)switch(a.whichSide(this._worldPlane[c])){case n.Inside:return d.Outside;case n.Outside:break;case n.Intersects:b=d.Intersects}return b},d.prototype.onFrustumChange=function(){this.projectionMode===d.Perspective?(this._coeffLeft.setDirect(-this._frustumNear,-this._frustumLeft).normalize(),
this._coeffRight.setDirect(this._frustumNear,this._frustumRight).normalize(),this._coeffBottom.setDirect(this._frustumNear,-this._frustumBottom).normalize(),this._coeffTop.setDirect(-this._frustumNear,this._frustumTop).normalize()):this.projectionMode===d.Parallel&&(this._frustumRight>this._frustumLeft?(this._coeffLeft.setDirect(-1,0),this._coeffRight.setDirect(1,0)):(this._coeffLeft.setDirect(1,0),this._coeffRight.setDirect(-1,0)),this._frustumTop>this._frustumBottom?(this._coeffBottom.setDirect(-1,0),this._coeffTop.setDirect(1,0)):(this._coeffBottom.setDirect(1,0),this._coeffTop.setDirect(-1,0))),this._updatePMatrix=!0,this._updateMVPMatrix=!0,this._updateInverseMVMatrix=!0,this._updateInverseMVPMatrix=!0,this.changedProperties=!0},d.prototype.onFrameChange=function(){var a;a=this._worldPlane[d.LEFT_PLANE],a.normal.x=this._left.x*this._coeffLeft.x+this._direction.x*this._coeffLeft.y,a.normal.y=this._left.y*this._coeffLeft.x+this._direction.y*this._coeffLeft.y,a.normal.z=this._left.z*this._coeffLeft.x+this._direction.z*this._coeffLeft.y,a.constant=this.translation.dot(a.normal),a=this._worldPlane[d.RIGHT_PLANE],a.normal.x=this._left.x*this._coeffRight.x+this._direction.x*this._coeffRight.y,a.normal.y=this._left.y*this._coeffRight.x+this._direction.y*this._coeffRight.y,a.normal.z=this._left.z*this._coeffRight.x+this._direction.z*this._coeffRight.y,a.constant=this.translation.dot(a.normal),a=this._worldPlane[d.BOTTOM_PLANE],a.normal.x=this._up.x*this._coeffBottom.x+this._direction.x*this._coeffBottom.y,a.normal.y=this._up.y*this._coeffBottom.x+this._direction.y*this._coeffBottom.y,a.normal.z=this._up.z*this._coeffBottom.x+this._direction.z*this._coeffBottom.y,a.constant=this.translation.dot(a.normal),a=this._worldPlane[d.TOP_PLANE],a.normal.x=this._up.x*this._coeffTop.x+this._direction.x*this._coeffTop.y,a.normal.y=this._up.y*this._coeffTop.x+this._direction.y*this._coeffTop.y,a.normal.z=this._up.z*this._coeffTop.x+this._direction.z*this._coeffTop.y,a.constant=this.translation.dot(a.normal),this.projectionMode===d.Parallel&&(this._frustumRight>this._frustumLeft?(this._worldPlane[d.LEFT_PLANE].constant+=this._frustumLeft,this._worldPlane[d.RIGHT_PLANE].constant-=this._frustumRight):(this._worldPlane[d.LEFT_PLANE].constant-=this._frustumLeft,this._worldPlane[d.RIGHT_PLANE].constant+=this._frustumRight),this._frustumBottom>this._frustumTop?(this._worldPlane[d.TOP_PLANE].constant+=this._frustumTop,this._worldPlane[d.BOTTOM_PLANE].constant-=this._frustumBottom):(this._worldPlane[d.TOP_PLANE].constant-=this._frustumTop,this._worldPlane[d.BOTTOM_PLANE].constant+=this._frustumBottom));var b=this._direction.dot(this.translation);a=this._worldPlane[d.FAR_PLANE],a.normal.x=-this._direction.x,a.normal.y=-this._direction.y,a.normal.z=-this._direction.z,a.constant=-(b+this._frustumFar),a=this._worldPlane[d.NEAR_PLANE],a.normal.x=this._direction.x,a.normal.y=this._direction.y,a.normal.z=this._direction.z,a.constant=b+this._frustumNear,this._updateMVMatrix=!0,this._updateMVPMatrix=!0,this._updateInverseMVMatrix=!0,this._updateInverseMVPMatrix=!0},d.prototype.updateProjectionMatrix=function(){var a=this.projection.data,b=this._frustumRight,c=this._frustumLeft,e=this._frustumTop,f=this._frustumBottom,g=this._frustumFar,h=this._frustumNear;this.projectionMode===d.Parallel?(a[0]=2/(b-c),a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2/(e-f),a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=-2/(g-h),a[11]=0,a[12]=-(b+c)/(b-c),a[13]=-(e+f)/(e-f),a[14]=-(g+h)/(g-h),a[15]=1):this.projectionMode===d.Perspective&&(a[0]=2*h/(b-c),a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2*h/(e-f),a[6]=0,a[7]=0,a[8]=(b+c)/(b-c),a[9]=(e+f)/(e-f),a[10]=-(g+h)/(g-h),a[11]=-1,a[12]=0,a[13]=0,a[14]=-(2*g*h)/(g-h),a[15]=0)},d.prototype.updateModelViewMatrix=function(){this.modelView.setIdentity();var a=this.modelView.data;a[0]=-this._left.x,a[4]=-this._left.y,a[8]=-this._left.z,a[1]=this._up.x,a[5]=this._up.y,a[9]=this._up.z,a[2]=-this._direction.x,a[6]=-this._direction.y,a[10]=-this._direction.z,a[12]=this._left.dot(this.translation),a[13]=-this._up.dot(this.translation),a[14]=this._direction.dot(this.translation)},d.prototype.getPickRay=function(a,b,c,d,e){return e||(e=new k),this.getWorldCoordinates(a,b,c,d,0,e.origin),this.getWorldCoordinates(a,b,c,d,.3,e.direction).sub(e.origin).normalize(),e},d.prototype.getWorldPosition=function(a,b,c,e,f,g){return this.projectionMode===d.Parallel?f=(f-this.near)/(this.far-this.near):(f=j.clamp(f,this.near,this.far),f=this.far/(this.far-this.near)+this.far*this.near/(this.near-this.far)/f),this.getWorldCoordinates(a,b,c,e,f,g)},d.prototype.getWorldCoordinates=function(a,b,c,d,e,h){h||(h=new f),this.checkInverseModelViewProjection();var i=new g,j=(a/c-this._viewPortLeft)/(this._viewPortRight-this._viewPortLeft)*2-1,k=((d-b)/d-this._viewPortBottom)/(this._viewPortTop-this._viewPortBottom)*2-1;return i.setDirect(j,k,2*e-1,1),i.applyPost(this.modelViewProjectionInverse),0!==i.w&&i.scale(1/i.w),h.x=i.x,h.y=i.y,h.z=i.z,h},d.prototype.getScreenCoordinates=function(a,b,c,d){return d=this.getNormalizedDeviceCoordinates(a,d),d.x=(d.x+1)*(this._viewPortRight-this._viewPortLeft)/2*b,d.y=(1-d.y)*(this._viewPortTop-this._viewPortBottom)/2*c,d.z=(d.z+1)/2,d},d.prototype.getFrustumCoordinates=function(a,b){return b=this.getNormalizedDeviceCoordinates(a,b),b.x=(b.x+1)*(this._frustumRight-this._frustumLeft)/2+this._frustumLeft,b.y=(b.y+1)*(this._frustumTop-this._frustumBottom)/2+this._frustumBottom,b.z=(b.z+1)*(this._frustumFar-this._frustumNear)/2+this._frustumNear,b},d.prototype.getNormalizedDeviceCoordinates=function(a,b){b||(b=new f),this.checkModelViewProjection();var c=new g;return c.setDirect(a.x,a.y,a.z,1),c.applyPost(this.modelViewProjection),0!==c.w&&c.scale(1/c.w),b.x=c.x,b.y=c.y,b.z=c.z,b},d.prototype.checkModelView=function(){this._updateMVMatrix&&(this.updateModelViewMatrix(),this._updateMVMatrix=!1)},d.prototype.checkProjection=function(){this._updatePMatrix&&(this.updateProjectionMatrix(),this._updatePMatrix=!1)},d.prototype.checkModelViewProjection=function(){this._updateMVPMatrix&&(this.checkModelView(),this.checkProjection(),this.modelViewProjection.mul2(this.getProjectionMatrix(),this.getViewMatrix()),this._updateMVPMatrix=!1)},d.prototype.checkInverseModelView=function(){this._updateInverseMVMatrix&&(this.checkModelView(),this.modelViewInverse.copy(this.modelView).invert(),this._updateInverseMVMatrix=!1)},d.prototype.checkInverseModelViewProjection=function(){this._updateInverseMVPMatrix&&(this.checkModelViewProjection(),this.modelViewProjectionInverse.copy(this.modelViewProjection).invert(),this._updateInverseMVPMatrix=!1)},d.prototype.getViewMatrix=function(){return this.checkModelView(),this.modelView},d.prototype.getProjectionMatrix=function(){return this.checkProjection(),this.projection},d.prototype.getViewProjectionMatrix=function(){return this.checkModelViewProjection(),this.modelViewProjection},d.prototype.getViewInverseMatrix=function(){return this.checkInverseModelView(),this.modelViewInverse},d.prototype.getViewProjectionInverseMatrix=function(){return this.checkInverseModelViewProjection(),this.modelViewProjectionInverse},d.prototype.pack=function(a){for(var b=a.center,c=this._corners,d=this._extents,e=0;e<c.length;e++)c[e].set(b);a instanceof l?d.setDirect(a.xExtent,a.yExtent,a.zExtent):a instanceof m&&d.setDirect(a.radius,a.radius,a.radius),c[0].addDirect(d.x,d.y,d.z),c[1].addDirect(d.x,-d.y,d.z),c[2].addDirect(d.x,d.y,-d.z),c[3].addDirect(d.x,-d.y,-d.z),c[4].addDirect(-d.x,d.y,d.z),c[5].addDirect(-d.x,-d.y,d.z),c[6].addDirect(-d.x,d.y,-d.z),c[7].addDirect(-d.x,-d.y,-d.z);for(var f=this.getViewMatrix(),h=Number.MAX_VALUE,i=-Number.MAX_VALUE,j=new g,e=0;e<c.length;e++)j.setDirect(c[e].x,c[e].y,c[e].z,1),j.applyPre(f),h=Math.min(-j.z,h),i=Math.max(-j.z,i);h=Math.min(Math.max(this._frustumNear,h),this._frustumFar),i=Math.max(h,Math.min(this._frustumFar,i));var k=h/this._frustumNear;this._frustumLeft=this._frustumLeft*k,this._frustumRight=this._frustumRight*k,this._frustumTop=this._frustumTop*k,this._frustumBottom=this._frustumBottom*k,this._frustumNear=h,this._frustumFar=i},d.prototype.calculateFrustumCorners=function(a,b){a=void 0!==a?a:this._frustumNear,b=void 0!==b?b:this._frustumFar;var c=(this._frustumTop-this._frustumBottom)*a*.5/this._frustumNear,e=(this._frustumRight-this._frustumLeft)*a*.5/this._frustumNear,f=(this._frustumTop-this._frustumBottom)*b*.5/this._frustumNear,g=(this._frustumRight-this._frustumLeft)*b*.5/this._frustumNear;this.projectionMode===d.Parallel&&(c=.5*(this._frustumTop-this._frustumBottom),e=.5*(this._frustumRight-this._frustumLeft),f=.5*(this._frustumTop-this._frustumBottom),g=.5*(this._frustumRight-this._frustumLeft));var h=this.vNearPlaneCenter,i=this.vFarPlaneCenter,j=this.calcLeft;j.set(this._direction).scale(a),h.set(this.translation).add(j),j.set(this._direction).scale(b),i.set(this.translation).add(j);var k=this.calcLeft,l=this.calcUp;return k.set(this._left).scale(e),l.set(this._up).scale(c),this._corners[0].set(h).sub(k).sub(l),this._corners[1].set(h).add(k).sub(l),this._corners[2].set(h).add(k).add(l),this._corners[3].set(h).sub(k).add(l),k.set(this._left).scale(g),l.set(this._up).scale(f),this._corners[4].set(i).sub(k).sub(l),this._corners[5].set(i).add(k).sub(l),this._corners[6].set(i).add(k).add(l),this._corners[7].set(i).sub(k).add(l),this._corners},d.prototype.setToObliqueMatrix=function(a){var b=this._clipPlane.set(a);b.w=0,b.applyPost(this.getViewMatrix()),b.w=this.translation.y*a.y-a.w,this._updatePMatrix=!0;var c=this.getProjectionMatrix();this._qCalc.setDirect((j.sign(b.x)+c[8])/c[0],(j.sign(b.y)+c[9])/c[5],-1,(1+c[10])/c[14]),b.scale(2/b.dot(this._qCalc)),c[2]=b.x,c[6]=b.y,c[10]=b.z+1,c[14]=b.w,this._updateMVPMatrix=!0,this._updateInverseMVPMatrix=!0},d.prototype.clone=function(){var a=new d(this.fov,this.aspect,this.near,this.far);return a.copy(this),a},a.exports=d},function(a,b,c){function d(a,b){this.normal=a?a.clone():e.UNIT_Y.clone(),this.constant=isNaN(b)?0:b}var e=c(8);d.XZ=new d(e.UNIT_Y,0),d.XY=new d(e.UNIT_Z,0),d.YZ=new d(e.UNIT_X,0),d.prototype.pseudoDistance=function(a){return this.normal.dot(a)-this.constant},d.prototype.setPlanePoints=function(a,b,c){return this.normal.set(b).sub(a),this.normal.cross(new e(c.x-a.x,c.y-a.y,c.z-a.z)).normalize(),this.constant=this.normal.dot(a),this},d.prototype.reflectVector=function(a,b){var c=b;"undefined"==typeof c&&(c=new e);var d=2*this.normal.dot(a);return c.set(a).sub(new e(this.normal.x*d,this.normal.y*d,this.normal.z*d)),c};var f=new e;d.prototype.rayIntersect=function(a,b,c,d){d="undefined"==typeof d?1e-7:d,b=b||new e;var g=a.direction.dot(this.normal);if(Math.abs(g)<d)return c||console.warn("Ray parallel with plane"),null;var h=f.set(this.normal).scale(this.constant).sub(a.origin).dot(this.normal);return b.set(a.direction).scale(h/g).add(a.origin)},d.prototype.copy=function(a){return this.normal.copy(a.normal),this.constant=a.constant,this},d.prototype.clone=function(){return new d(this.normal.clone(),this.constant)},a.exports=d},function(a,b,c){function d(a,b){this.origin=a?a.clone():new e,this.direction=b?b.clone():e.UNIT_Z.clone()}var e=c(8),f=c(9),g=new e,h=new e,i=new e,j=new e,k=new e;d.prototype.intersects=function(a,b,c,d){return 3===a.length?this.intersectsTriangle(a[0],a[1],a[2],b,c,d):4===a.length?this.intersectsTriangle(a[0],a[1],a[2],b,c,d)||this.intersectsTriangle(a[0],a[2],a[3],b,c,d):!1},d.prototype.intersectsTriangle=function(a,b,c,d,e,l){var m,n=h.set(b).sub(a),o=i.set(c).sub(a),p=j.set(n).cross(o),q=this.direction.dot(p);if(q>f.EPSILON)m=1;else{if(!(q<-f.EPSILON))return!1;if(l)return!1;m=-1,q=-q}var r=g.set(this.origin).sub(a),s=m*this.direction.dot(k.copy(r).cross(o)),t=!1;if(s>=0){var u=m*this.direction.dot(n.cross(r));if(u>=0&&q>=s+u){var v=-m*r.dot(p);if(v>=0){if(!e)return!0;var w=1/q,x=v*w;if(d){var y=s*w,z=u*w;e.setDirect(x,y,z)}else e.set(this.origin).addDirect(this.direction.x*x,this.direction.y*x,this.direction.z*x);t=!0}}}return t},d.prototype.getDistanceToPrimitive=function(a){var b=g;return this.intersects(a,!1,b)?this.origin.distance(b.x,b.y,b.z):1/0},d.prototype.intersectsPlane=function(a,b){var c=a.normal,d=c.dot(this.direction);if(Math.abs(d)<1e-5)return!1;var e=-c.dot(this.origin)+a.constant,f=e/d;return 1e-5>f?!1:(b&&b.set(this.direction).scale(f).add(this.origin),!0)},d.prototype.distanceSquared=function(a,b){var c=g;c.set(a).sub(this.origin);var d=this.direction.dot(c);return d>0?(c.set(this.direction).scale(d),c.add(this.origin)):c.set(this.origin),b&&b.set(c),c.sub(a),c.lengthSquared()},d.prototype.copy=function(a){this.origin.copy(a.origin),this.direction.copy(a.direction)},d.prototype.clone=function(){return new d(this.origin.clone(),this.direction.clone())},a.exports=d},function(a,b,c){function d(a){a=a||{};var b=a.canvas;void 0===b&&(b=document.createElement("canvas"),b.width=500,b.height=500),b.screencanvas=!0,this.domElement=b,this._alpha=void 0!==a.alpha?a.alpha:!1,this._premultipliedAlpha=void 0!==a.premultipliedAlpha?a.premultipliedAlpha:!0,this._antialias=void 0!==a.antialias?a.antialias:!0,this._stencil=void 0!==a.stencil?a.stencil:!1,this._preserveDrawingBuffer=void 0!==a.preserveDrawingBuffer?a.preserveDrawingBuffer:!1,this._useDevicePixelRatio=void 0!==a.useDevicePixelRatio?a.useDevicePixelRatio:!1,this._onError=a.onError,this._contextSettings={alpha:this._alpha,premultipliedAlpha:this._premultipliedAlpha,antialias:this._antialias,stencil:this._stencil,preserveDrawingBuffer:this._preserveDrawingBuffer},this.context=null,this.establishContext(),this._setupContextLost(),a.debug&&this.setupDebugging(a),this.rendererRecord=new g,this.maxTextureSize=isNaN(a.maxTextureSize)?f.maxTexureSize:Math.min(a.maxTextureSize,f.maxTexureSize),this.maxCubemapSize=isNaN(a.maxTextureSize)?f.maxCubemapSize:Math.min(a.maxTextureSize,f.maxCubemapSize),this.shaderPrecision=a.shaderPrecision||"highp","highp"===this.shaderPrecision&&f.vertexShaderHighpFloat.precision>0&&f.fragmentShaderHighpFloat.precision>0?this.shaderPrecision="highp":"lowp"!==this.shaderPrecision&&f.vertexShaderMediumpFloat.precision>0&&f.fragmentShaderMediumpFloat.precision>0?this.shaderPrecision="mediump":this.shaderPrecision="lowp",this.downScale=a.downScale||1,this.clearColor=new k,this._clearColor=new k,this.setClearColor(.3,.3,.3,1),this.viewportX=0,this.viewportY=0,this.viewportWidth=0,this.viewportHeight=0,this.currentWidth=0,this.currentHeight=0,this.devicePixelRatio=1,this._overrideMaterials=[],this._mergedMaterial=new m("Merged Material"),this.renderQueue=new n,this.info=new q,this.shadowHandler=new p,this.hardwarePicking=null,r.addListener("goo.setClearColor",function(a){this.setClearColor.apply(this,a)}.bind(this)),document.createElementNS?(this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svg.setAttribute("xmlns","http://www.w3.org/2000/svg"),this.svg.setAttribute("version","1.1"),this.svg.style.position="absolute",this.svg.style.display="none",document.body.appendChild(this.svg)):this.svg={currentScale:1},r.addListener("goo.setCurrentCamera",function(a){d.mainCamera=a.camera,this.checkResize(d.mainCamera)}.bind(this)),this._definesIndices=[]}function e(a,b){for(var c=0;c<b.length;++c)void 0===b[c]&&console.error("undefined passed to gl."+a+"("+window.WebGLDebugUtils.glFunctionArgsToString(a,b)+")")}var f=c(17),g=c(124),h=c(18),i=c(125),j=c(133),k=c(11),l=c(53);c(127);var m=c(30),n=c(43),o=c(46),p=c(134),q=c(138),r=c(44),s=c(139),t=c(140),u=c(9),v=function(){};d.prototype.setupDebugging=function(a){var b=new XMLHttpRequest;b.open("GET","/js/goo/lib/webgl-debug.js",!1),b.onreadystatechange=function(){4===b.readyState&&b.status>=200&&b.status<=299&&window.eval.call(window,b.responseText)},b.send(null),"undefined"==typeof window.WebGLDebugUtils?console.warn("You need to include webgl-debug.js in your script definition to run in debug mode."):(console.log("Running in webgl debug mode."),a.validate?(console.log('Running with "undefined arguments" validation.'),this.context=window.WebGLDebugUtils.makeDebugContext(this.context,this.onDebugError.bind(this),e)):this.context=window.WebGLDebugUtils.makeDebugContext(this.context,this.onDebugError.bind(this)))},d.prototype.establishContext=function(){if(window.WebGLRenderingContext){for(var a=["experimental-webgl","webgl","moz-webgl","webkit-3d"],b=0;b<a.length;b++)try{if(this.context=this.domElement.getContext(a[b],this._contextSettings),this.context&&"function"==typeof this.context.getParameter)break}catch(c){}if(!this.context)throw new Error("WebGL is supported but disabled")}var d=this.context;d.clearDepth(1),d.clearStencil(0),d.stencilMask(0),d.enable(d.DEPTH_TEST),d.depthFunc(d.LEQUAL),void 0===d.getShaderPrecisionFormat&&(this.context.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}),f.init(this.context)},d.prototype._setupContextLost=function(){this.domElement.addEventListener("webglcontextlost",function(a){a.preventDefault(),r.emit("goo.contextLost")},!1),this.domElement.addEventListener("webglcontextrestored",function(){this._restoreContext(),r.emit("goo.contextRestored")}.bind(this),!1)},d.prototype._restoreContext=v,d.prototype.onDebugError=function(a,b,c){for(var d="WebGL error "+window.WebGLDebugUtils.glEnumToString(a)+" in "+b+"(",e=0;e<c.length;++e)d+=(0===e?"":", ")+window.WebGLDebugUtils.glFunctionArgToString(b,e,c[e]);d+=")",console.error(d),this._onError&&this._onError(d)},d.mainCamera=null,d.prototype.checkResize=function(a,b){var c,d,e=this.devicePixelRatio=this._useDevicePixelRatio&&window.devicePixelRatio?window.devicePixelRatio/this.svg.currentScale:1;navigator.isCocoonJS?(c=window.innerWidth,d=window.innerHeight):(c=this.domElement.offsetWidth,d=this.domElement.offsetHeight),c=Math.max(c*e/this.downScale,1),d=Math.max(d*e/this.downScale,1);var f=c,g=d;a&&a.lockedRatio===!0&&a.aspect&&(c=d*a.aspect);var h=c/d;b||this.setSize(c,d,f,g),a&&a.lockedRatio===!1&&a.aspect!==h&&(a.aspect=h,0===a.projectionMode?a.setFrustumPerspective():a.setFrustum(),a.onFrameChange())},d.prototype.setSize=function(a,b,c,d){if(void 0===c&&(c=a),void 0===d&&(d=b),this.domElement.width=c,this.domElement.height=d,a>c){var e=c/a;a=c,b=d*e}var f=.5*(c-a),g=.5*(d-b);(f!==this.viewportX||g!==this.viewportY||a!==this.viewportWidth||b!==this.viewportHeight)&&(this.setViewport(f,g,a,b),null!==this.hardwarePicking&&(this.hardwarePicking.pickingTarget=null))},d.prototype.setViewport=function(a,b,c,d){this.viewportX=void 0!==a?a:0,this.viewportY=void 0!==b?b:0,this.viewportWidth=void 0!==c?c:this.domElement.width,this.viewportHeight=void 0!==d?d:this.domElement.height,this.context.viewport(this.viewportX,this.viewportY,this.viewportWidth,this.viewportHeight),r.emit("goo.viewportResize",{x:this.viewportX,y:this.viewportY,width:this.viewportWidth,height:this.viewportHeight},!0)},d.prototype.setClearColor=function(a,b,c,d){(this._clearColor.r!==a||this._clearColor.g!==b||this._clearColor.b!==c||this._clearColor.a!==d)&&(this._clearColor.r=a,this._clearColor.g=b,this._clearColor.b=c,this._clearColor.a=d,this.clearColor.copy(this._clearColor),this.context.clearColor(a,b,c,d))},d.prototype.bindData=function(a){var b=a.glBuffer,c=this.context;null!==b?(this.setBoundBuffer(b,a.target),a._dataNeedsRefresh&&(c.bufferSubData(h.getGLBufferTarget(c,a.target),0,a.data),a._dataNeedsRefresh=!1)):(b=c.createBuffer(),a.glBuffer=b,this.rendererRecord.invalidateBuffer(a.target),this.setBoundBuffer(b,a.target),c.bufferData(h.getGLBufferTarget(c,a.target),a.data,h.getGLBufferUsage(c,a._dataUsage)))},d.prototype.updateAttributeData=function(a,b){this.context.bufferSubData(this.context.ARRAY_BUFFER,b,a)},d.prototype.setShadowType=function(a){this.shadowHandler.shadowType=a},d.prototype.updateShadows=function(a,b,c){this.shadowHandler.checkShadowRendering(this,a,b,c)},d.prototype.preloadTexture=function(a,b){a.bindTexture(h.getGLType(a,b.variant),b.glTexture),a.pixelStorei(a.UNPACK_ALIGNMENT,b.unpackAlignment),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,b.premultiplyAlpha),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,b.flipY);var c=b.image;if("2D"===b.variant)c?(!c.isCompressed&&(b.generateMipmaps||c.width>this.maxTextureSize||c.height>this.maxTextureSize)&&(this.checkRescale(b,c,c.width,c.height,this.maxTextureSize),c=b.image),c.isData===!0?c.isCompressed?this.loadCompressedTexture(a,a.TEXTURE_2D,b,c.data):a.texImage2D(a.TEXTURE_2D,0,h.getGLInternalFormat(a,b.format),c.width,c.height,b.hasBorder?1:0,h.getGLInternalFormat(a,b.format),h.getGLDataType(a,b.type),c.data):a.texImage2D(a.TEXTURE_2D,0,h.getGLInternalFormat(a,b.format),h.getGLInternalFormat(a,b.format),h.getGLDataType(a,b.type),c),b.generateMipmaps&&!c.isCompressed&&a.generateMipmap(a.TEXTURE_2D)):a.texImage2D(a.TEXTURE_2D,0,h.getGLInternalFormat(a,b.format),b.width,b.height,0,h.getGLInternalFormat(a,b.format),h.getGLDataType(a,b.type),null);else if("CUBE"===b.variant){if(c&&!c.isData&&(b.generateMipmaps||c.width>this.maxCubemapSize||c.height>this.maxCubemapSize)){for(var d=0;d<l.CUBE_FACES.length;d++)c.data[d]&&!c.data[d].buffer?h.scaleImage(b,c.data[d],c.width,c.height,this.maxCubemapSize,d):h.getBlankImage(b,[.3,.3,.3,0],c.width,c.height,this.maxCubemapSize,d);b.image.width=Math.min(this.maxCubemapSize,u.nearestPowerOfTwo(b.image.width)),b.image.height=Math.min(this.maxCubemapSize,u.nearestPowerOfTwo(b.image.height)),c=b.image}for(var e=0;e<l.CUBE_FACES.length;e++){var f=l.CUBE_FACES[e];c?c.isData===!0?c.isCompressed?this.loadCompressedTexture(a,h.getGLCubeMapFace(a,f),b,c.data[e]):a.texImage2D(h.getGLCubeMapFace(a,f),0,h.getGLInternalFormat(a,b.format),c.width,c.height,b.hasBorder?1:0,h.getGLInternalFormat(a,b.format),h.getGLDataType(a,b.type),c.data[e]):a.texImage2D(h.getGLCubeMapFace(a,f),0,h.getGLInternalFormat(a,b.format),h.getGLInternalFormat(a,b.format),h.getGLDataType(a,b.type),c.data[e]):a.texImage2D(h.getGLCubeMapFace(a,f),0,h.getGLInternalFormat(a,b.format),b.width,b.height,0,h.getGLInternalFormat(a,b.format),h.getGLDataType(a,b.type),null)}c&&b.generateMipmaps&&!c.isCompressed&&a.generateMipmap(a.TEXTURE_CUBE_MAP)}},d.prototype.preloadTextures=function(a,b){var c=this.context,d=Object.keys(a._textureMaps);d.forEach(function(d){var e=a.getTexture(d);if(void 0!==e){var f=e;e instanceof Array==0&&(f=[e]),f.forEach(function(a){a&&b.push(function(){a instanceof j!=0||void 0!==a.image&&a.checkDataReady()!==!1||("2D"===a.variant?a=i.DEFAULT_TEXTURE_2D:"CUBE"===a.variant&&(a=i.DEFAULT_TEXTURE_CUBE)),null===a.glTexture?(a.glTexture=c.createTexture(),this.preloadTexture(c,a),a.needsUpdate=!1):a instanceof l&&a.checkNeedsUpdate()&&(this.preloadTexture(c,a),a.needsUpdate=!1)}.bind(this))},this)}},this)};var w=new t;d.prototype.preloadMaterials=function(a){var b=[],c=w;if(c.reset(),Array.isArray(a))for(var d=0;d<a.length;d++){var e=a[d];if(!(e.isSkybox&&this._overrideMaterials.length>0)){c.fill(e);for(var f=0;f<c.materials.length;f++)this.preloadTextures(c.materials[f],b)}}else{c.fill(a);for(var f=0;f<c.materials.length;f++)this.preloadTextures(c.materials[f],b)}return s.each(b)},d.prototype.precompileShader=function(a,b){var c=a.shader;c.updateProcessors(b),this.findOrCacheMaterialShader(a,b),c=a.shader,c.precompile(this)},d.prototype.clearShaderCache=function(){this.rendererRecord.shaderCache.clear()},d.prototype.precompileShaders=function(a,b){var c=new t;b&&(c.lights=b);var d=[];if(Array.isArray(a))for(var e=0;e<a.length;e++){var f=a[e];if(!(f.isSkybox&&this._overrideMaterials.length>0)){c.fill(f);for(var g=0;g<c.materials.length;g++)c.material=c.materials[g],this.precompileShader(c.materials[g],c,d)}}else{c.fill(a);for(var g=0;g<c.materials.length;g++)c.material=c.materials[g],this.precompileShader(c.materials[g],c,d)}return s.each(d)},d.prototype.preloadBuffers=function(a){var b=new t;if(Array.isArray(a))for(var c=0;c<a.length;c++){var d=a[c];if(!(d.isSkybox&&this._overrideMaterials.length>0)){b.fill(d);for(var e=0;e<b.materials.length;e++)b.material=b.materials[e],this.preloadBuffer(d,b.materials[e],b)}}else{b.fill(a);for(var e=0;e<b.materials.length;e++)b.material=b.materials[e],this.preloadBuffer(a,b.materials[e],b)}},d.prototype.preloadBuffer=function(a,b,c){var d=c.meshData;if(!(null===d.vertexData||null!==d.vertexData&&0===d.vertexData.data.byteLength||null!==d.indexData&&0===d.indexData.data.byteLength)){this.bindData(d.vertexData),null!==d.getIndexBuffer()&&this.bindData(d.getIndexData());var e,f=c.materials,g=null,h=d;e=0===this._overrideMaterials.length?f.length:this._overrideMaterials.length;for(var i=0;e>i;i++){var b=null,j=null;i<f.length&&(b=f[i]),i<this._overrideMaterials.length&&(j=this._overrideMaterials[i]),b&&j?(this._override(j,b,this._mergedMaterial),b=this._mergedMaterial):j&&(b=j),b.shader?(b.errorOnce=!1,b.wireframe&&"wire"!==g?(d.wireframeData||(d.wireframeData=d.buildWireframeData()),d=d.wireframeData,this.bindData(d.vertexData),g="wire"):b.flat&&"flat"!==g?(d.flatMeshData||(d.flatMeshData=d.buildFlatMeshData()),d=d.flatMeshData,this.bindData(d.vertexData),g="flat"):b.wireframe||b.flat||null===g||(d=h,this.bindData(d.vertexData),g=null)):b.errorOnce||(console.warn("No shader set on material: "+b.name),b.errorOnce=!0)}}};var x=new t,y=function(a){a.startFrame()};d.prototype.render=function(a,b,c,e,f,g){if(g?this._overrideMaterials=g instanceof Array?g:[g]:this._overrideMaterials=[],b){null!==d.mainCamera||e||(d.mainCamera=b),this.setRenderTarget(e),void 0===f||null===f||f===!0?this.clear():"object"==typeof f&&this.clear(f.color,f.depth,f.stencil),this.rendererRecord.shaderCache.forEach(y);var h=x;if(h.reset(),h.camera=b,h.mainCamera=d.mainCamera,h.lights=c,h.shadowHandler=this.shadowHandler,h.renderer=this,Array.isArray(a)){this.renderQueue.sort(a,b);for(var i=0;i<a.length;i++){var j=a[i];j.isSkybox&&this._overrideMaterials.length>0||(h.fill(j),this.renderMesh(h))}}else h.fill(a),this.renderMesh(h);e&&e.generateMipmaps&&u.isPowerOfTwo(e.width)&&u.isPowerOfTwo(e.height)&&this.updateRenderTargetMipmap(e)}},d.prototype._override=function(a,b,c){c.empty();for(var d=Object.keys(c),e=0,f=d.length;f>e;e++){var g=d[e],h=c[g],i=a[g],j=b[g];if(h instanceof Object&&"shader"!==g){for(var k=Object.keys(i),l=0,m=k.length;m>l;l++){var n=k[l];h[n]=i[n]}for(var k=Object.keys(j),l=0,m=k.length;m>l;l++){var n=k[l];void 0===h[n]&&(h[n]=j[n])}}else void 0!==i?c[g]=i:c[g]=j}},d.prototype.renderMesh=function(a){var b=a.meshData;if(!(!b||null===b.vertexData||null!==b.vertexData&&0===b.vertexData.data.byteLength||null!==b.indexData&&0===b.indexData.data.byteLength)){this.bindData(b.vertexData),b._attributeDataNeedsRefresh&&(b._dirtyAttributeNames.forEach(function(a){this.updateAttributeData(b.dataViews[a],b.attributeMap[a].offset)},this),b._attributeDataNeedsRefresh=!1,b._dirtyAttributeNames.clear());var c=a.materials,d=null,e=b,f=0;f=0===this._overrideMaterials.length?c.length:this._overrideMaterials.length;for(var g=0;f>g;g++)this.renderMeshMaterial(g,c,d,e,a)}},d.prototype.callShaderProcessors=function(a,b){a.shader.updateProcessors(b),this.findOrCacheMaterialShader(a,b)},d.prototype.renderMeshMaterial=function(a,b,c,d,e){var f=null,g=null;a<b.length&&(f=b[a]),a<this._overrideMaterials.length&&(g=this._overrideMaterials[a]),f=this.configureRenderInfo(e,a,f,g,d,c);var h=e.meshData;this.callShaderProcessors(f,e),f.shader.apply(e,this),this.updateDepthTest(f),this.updateCulling(f),this.updateBlending(f),this.updateOffset(f),this.updateTextures(f),this.updateLineAndPointSettings(f),this._checkDualTransparency(f,h),this.updateCulling(f),this._drawBuffers(h),this.info.calls++,this.info.vertices+=h.vertexCount,this.info.indices+=h.indexCount},d.prototype._drawBuffers=function(a){null!==a.getIndexBuffer()?(this.bindData(a.getIndexData()),null!==a.getIndexLengths()?this.drawElementsVBO(a.getIndexBuffer(),a.getIndexModes(),a.getIndexLengths()):this.drawElementsVBO(a.getIndexBuffer(),a.getIndexModes(),[a.getIndexBuffer().length])):null!==a.getIndexLengths()?this.drawArraysVBO(a.getIndexModes(),a.getIndexLengths()):this.drawArraysVBO(a.getIndexModes(),[a.vertexCount])},d.prototype.configureRenderInfo=function(a,b,c,d,e,f){var g=a.meshData;return b<this._overrideMaterials.length&&(d=this._overrideMaterials[b]),c&&d&&d.fullOverride!==!0?(this._override(d,c,this._mergedMaterial),c=this._mergedMaterial):d&&(c=d),c.shader?(c.errorOnce=!1,c.wireframe&&"wire"!==f?(g.wireframeData||(g.wireframeData=g.buildWireframeData()),g=g.wireframeData,this.bindData(g.vertexData),f="wire"):c.flat&&"flat"!==f?(g.flatMeshData||(g.flatMeshData=g.buildFlatMeshData()),g=g.flatMeshData,this.bindData(g.vertexData),f="flat"):c.wireframe||c.flat||null===f||(g=e,this.bindData(g.vertexData),f=null),a.material=c,a.meshData=g,c):void(c.errorOnce||(console.warn("No shader set on material: "+c.name),c.errorOnce=!0))},d.prototype.findOrCacheMaterialShader=function(a,b){var c=a.shader,d=this.rendererRecord.shaderCache;c.endFrame();var e=c.getDefineKey(this._definesIndices),f=d.get(e);if(f!==a.shader)if(f){if(f.defines={},a.shader.defines){for(var g=Object.keys(a.shader.defines),h=0,i=g.length;i>h;h++){var j=g[h];f.defines[j]=a.shader.defines[j]}f.defineKey=a.shader.defineKey}for(var k=a.shader.uniforms,g=Object.keys(k),h=0,i=g.length;i>h;h++){var j=g[h],l=f.uniforms[j]=k[j];l instanceof Array&&(f.uniforms[j]=l.slice(0))}a.shader=f}else c.builder&&c.builder(c,b),c=c.clone(),d.set(e,c),a.shader=c},d.prototype._checkDualTransparency=function(a,b){if(a.dualTransparency){var c=a.cullState.cullFace,d="Front"===c?"Back":"Front";a.cullState.cullFace=d,this.updateCulling(a),this._drawBuffers(b),a.cullState.cullFace=c}},d.prototype.readPixels=function(a,b,c,d,e){e=e||new Uint8Array(c*d*4);var f=this.context;return f.readPixels(a,b,c,d,f.RGBA,f.UNSIGNED_BYTE,e),e},d.prototype.readTexturePixels=function(a,b,c,d,e,f){f=f||new Uint8Array(d*e*4);var g=this.context,h=g.createFramebuffer();return g.bindFramebuffer(g.FRAMEBUFFER,h),g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,a.glTexture,0),g.checkFramebufferStatus(g.FRAMEBUFFER)===g.FRAMEBUFFER_COMPLETE&&g.readPixels(b,c,d,e,g.RGBA,g.UNSIGNED_BYTE,f),f},d.prototype.drawElementsVBO=function(a,b,c){for(var d=0,e=0,f=a.type=a.type||h.getGLArrayType(this.context,a),g=h.getGLByteSize(a),i=0;i<c.length;i++){var j=c[i],k=h.getGLIndexMode(this.context,b[e]);this.context.drawElements(k,j,f,d*g),d+=j,e<b.length-1&&e++}},d.prototype.drawArraysVBO=function(a,b){for(var c=0,d=0,e=0;e<b.length;e++){var f=b[e],g=h.getGLIndexMode(this.context,a[d]);this.context.drawArrays(g,c,f),c+=f,d<a.length-1&&d++}},d.prototype.renderToPick=function(a,b,c,d,e,f,g,h,i){if(this.viewportWidth*this.viewportHeight!==0){var l=4;if(null===this.hardwarePicking){var n=m.createEmptyMaterial(o.pickingShader,"pickingMaterial");n.blendState={blending:"NoBlending",blendEquation:"AddEquation",blendSrc:"SrcAlphaFactor",blendDst:"OneMinusSrcAlphaFactor"},n.wireframe=!1,this.hardwarePicking={pickingTarget:new j(this.viewportWidth/l,this.viewportHeight/l,{minFilter:"NearestNeighborNoMipMaps",magFilter:"NearestNeighbor"}),pickingMaterial:n,pickingBuffer:new Uint8Array(4),clearColorStore:new k},d=!1}else null===this.hardwarePicking.pickingTarget&&(this.hardwarePicking.pickingTarget=new j(this.viewportWidth/l,this.viewportHeight/l,{minFilter:"NearestNeighborNoMipMaps",magFilter:"NearestNeighbor"}),d=!1);if(d)this.setRenderTarget(this.hardwarePicking.pickingTarget);else{if(this.hardwarePicking.clearColorStore.set(this.clearColor),e&&void 0!==f&&void 0!==g){var p=this._useDevicePixelRatio&&window.devicePixelRatio?window.devicePixelRatio/this.svg.currentScale:1,q=Math.floor((f*p-this.viewportX)/l),r=Math.floor((this.viewportHeight-(g*p-this.viewportY))/l);this.context.enable(this.context.SCISSOR_TEST),this.context.scissor(q,r,1,1)}for(var s=[],t=0,u=a.length;u>t;t++){var v=a[t];(!v.meshRendererComponent||v.meshRendererComponent.isPickable)&&s.push(v)}i?this.render(s,b,[],this.hardwarePicking.pickingTarget,c):this.render(s,b,[],this.hardwarePicking.pickingTarget,c,h||this.hardwarePicking.pickingMaterial),e&&this.context.disable(this.context.SCISSOR_TEST);
}}},d.prototype.pick=function(a,b,c,d){if(this.viewportWidth*this.viewportHeight===0)return c.id=-1,void(c.depth=0);var e=this._useDevicePixelRatio&&window.devicePixelRatio?window.devicePixelRatio/this.svg.currentScale:1,f=4,g=Math.floor((a*e-this.viewportX)/f),h=Math.floor((this.viewportHeight-(b*e-this.viewportY))/f);this.readPixels(g,h,1,1,this.hardwarePicking.pickingBuffer);var i=255*this.hardwarePicking.pickingBuffer[0]+this.hardwarePicking.pickingBuffer[1]-1,j=(this.hardwarePicking.pickingBuffer[2]/255+this.hardwarePicking.pickingBuffer[3]/65025)*d.far;c.id=i,c.depth=j},d.prototype.updateLineAndPointSettings=function(a){var b=this.rendererRecord.lineRecord,c=a.lineWidth||1;b.lineWidth!==c&&(this.context.lineWidth(c),b.lineWidth=c)},d.prototype.updateDepthTest=function(a){var b=this.rendererRecord.depthRecord,c=a.depthState;b.enabled!==c.enabled&&(c.enabled?this.context.enable(this.context.DEPTH_TEST):this.context.disable(this.context.DEPTH_TEST),b.enabled=c.enabled),b.write!==c.write&&(c.write?this.context.depthMask(!0):this.context.depthMask(!1),b.write=c.write),b.depthFunc!==c.depthFunc&&(this.context.depthFunc(h.getGLDepthFunc(this.context,c.depthFunc)),b.depthFunc=c.depthFunc)},d.prototype.updateCulling=function(a){var b=this.rendererRecord.cullRecord,c=a.cullState.cullFace,d=a.cullState.frontFace,e=a.cullState.enabled;if(b.enabled!==e&&(e?this.context.enable(this.context.CULL_FACE):this.context.disable(this.context.CULL_FACE),b.enabled=e),b.cullFace!==c){var f="Front"===c?this.context.FRONT:"Back"===c?this.context.BACK:this.context.FRONT_AND_BACK;this.context.cullFace(f),b.cullFace=c}if(b.frontFace!==d){switch(d){case"CCW":this.context.frontFace(this.context.CCW);break;case"CW":this.context.frontFace(this.context.CW)}b.frontFace=d}},d.prototype.updateTextures=function(a){for(var b=this.context,c=a.shader.textureSlots,d=0;d<c.length;d++){var e=c[d],f=a.getTexture(e.mapping);void 0===f&&("sampler2D"===e.format?f=i.DEFAULT_TEXTURE_2D:"samplerCube"===e.format&&(f=i.DEFAULT_TEXTURE_CUBE));var g=f;f instanceof Array==0&&(g=[f]);for(var h=0;h<g.length;h++){f=g[h];var k=e.index instanceof Array?e.index[h]:e.index;(null===f||f instanceof j&&null===f.glTexture||f instanceof j==0&&(void 0===f.image||f.checkDataReady()===!1))&&("sampler2D"===e.format?f=i.DEFAULT_TEXTURE_2D:"samplerCube"===e.format&&(f=i.DEFAULT_TEXTURE_CUBE));var l=this.rendererRecord.textureRecord[k];void 0===l&&(l=this.rendererRecord.textureRecord[k]={}),null===f.glTexture?(f.glTexture=b.createTexture(),this.updateTexture(b,f,k,l),f.needsUpdate=!1):f instanceof j==0&&f.checkNeedsUpdate()?(this.updateTexture(b,f,k,l),f.needsUpdate=!1):this.bindTexture(b,f,k,l);var m=void 0!==f.image?f.image:f,n=u.isPowerOfTwo(m.width)&&u.isPowerOfTwo(m.height);this.updateTextureParameters(f,n)}}},d.prototype.updateTextureParameters=function(a,b){var c=this.context,d=a.textureRecord,e=h.getGLType(c,a.variant);d.magFilter!==a.magFilter&&(c.texParameteri(e,c.TEXTURE_MAG_FILTER,h.getGLMagFilter(c,a.magFilter)),d.magFilter=a.magFilter);var g=b?a.minFilter:h.getFilterFallback(a.minFilter);d.minFilter!==g&&(c.texParameteri(e,c.TEXTURE_MIN_FILTER,h.getGLMinFilter(c,g)),d.minFilter=g);var i=b?a.wrapS:"EdgeClamp";if(d.wrapS!==i){var j=h.getGLWrap(c,i);c.texParameteri(e,c.TEXTURE_WRAP_S,j),d.wrapS=i}var k=b?a.wrapT:"EdgeClamp";if(d.wrapT!==k){var l=h.getGLWrap(c,k);c.texParameteri(e,c.TEXTURE_WRAP_T,l),d.wrapT=k}if(f.TextureFilterAnisotropic&&"Float"!==a.type){var m=a.anisotropy;d.anisotropy!==m&&(c.texParameterf(e,f.TextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(m,f.maxAnisotropy)),d.anisotropy=m)}},d.prototype.bindTexture=function(a,b,c,d){(void 0===d.boundTexture||void 0!==b.glTexture&&d.boundTexture!==b.glTexture)&&(a.activeTexture(a.TEXTURE0+c),a.bindTexture(h.getGLType(a,b.variant),b.glTexture),d.boundTexture=b.glTexture)},d.prototype.unbindTexture=function(a,b,c,d){a.activeTexture(a.TEXTURE0+c),a.bindTexture(h.getGLType(a,b.variant),null),d.boundTexture=void 0},d.prototype.loadCompressedTexture=function(a,b,c,d){var e=c.image.mipmapSizes,g=0,h=0,i=c.image.width,j=c.image.height,k=f.CompressedTextureS3TC;if(!k)return c.image=void 0,c.needsUpdate=!0,void console.warn("Tried to load unsupported compressed texture.");var l=k.COMPRESSED_RGBA_S3TC_DXT5_EXT;if("PrecompressedDXT1"===c.format)l=k.COMPRESSED_RGB_S3TC_DXT1_EXT;else if("PrecompressedDXT1A"===c.format)l=k.COMPRESSED_RGBA_S3TC_DXT1_EXT;else if("PrecompressedDXT3"===c.format)l=k.COMPRESSED_RGBA_S3TC_DXT3_EXT;else{if("PrecompressedDXT5"!==c.format)throw new Error("Unhandled compression format: "+d.getDataFormat().name());l=k.COMPRESSED_RGBA_S3TC_DXT5_EXT}if("undefined"==typeof e||null===e)d instanceof Uint8Array?a.compressedTexImage2D(b,0,l,i,j,0,d):a.compressedTexImage2D(b,0,l,i,j,0,new Uint8Array(d.buffer,d.byteOffset,d.byteLength));else{if(c.generateMipmaps=!1,d instanceof Array)for(var m=0;m<d.length;m++)a.compressedTexImage2D(b,m,l,i,j,0,d[m]),i=~~(i/2)>1?~~(i/2):1,j=~~(j/2)>1?~~(j/2):1;else for(var m=0;m<e.length;m++)h=e[m],a.compressedTexImage2D(b,m,l,i,j,0,new Uint8Array(d.buffer,d.byteOffset+g,h)),i=~~(i/2)>1?~~(i/2):1,j=~~(j/2)>1?~~(j/2):1,g+=h;var n=1+Math.ceil(Math.log(Math.max(c.image.height,c.image.width))/Math.log(2)),o=e[e.length-1];if(e.length<n)for(var m=e.length;n>m;m++)o=~~((i+3)/4)*~~((j+3)/4)*c.image.bpp*2,a.compressedTexImage2D(b,m,l,i,j,0,new Uint8Array(o)),i=~~(i/2)>1?~~(i/2):1,j=~~(j/2)>1?~~(j/2):1}},d.prototype.updateTexture=function(a,b,c,d){a.activeTexture(a.TEXTURE0+c),a.bindTexture(h.getGLType(a,b.variant),b.glTexture),d.boundTexture=b.glTexture,a.pixelStorei(a.UNPACK_ALIGNMENT,b.unpackAlignment),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,b.premultiplyAlpha),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,b.flipY);var e=b.image;if("2D"===b.variant)e?(e instanceof HTMLVideoElement||e.isCompressed||!(b.generateMipmaps||"EdgeClamp"!==b.wrapS||"EdgeClamp"!==b.wrapT||e.width>this.maxTextureSize||e.height>this.maxTextureSize)||(this.checkRescale(b,e,e.width,e.height,this.maxTextureSize),e=b.image),e.isData===!0?e.isCompressed?this.loadCompressedTexture(a,a.TEXTURE_2D,b,e.data):a.texImage2D(a.TEXTURE_2D,0,h.getGLInternalFormat(a,b.format),e.width,e.height,b.hasBorder?1:0,h.getGLInternalFormat(a,b.format),h.getGLDataType(a,b.type),e.data):a.texImage2D(a.TEXTURE_2D,0,h.getGLInternalFormat(a,b.format),h.getGLInternalFormat(a,b.format),h.getGLDataType(a,b.type),e),b.generateMipmaps&&!e.isCompressed&&a.generateMipmap(a.TEXTURE_2D)):a.texImage2D(a.TEXTURE_2D,0,h.getGLInternalFormat(a,b.format),b.width,b.height,0,h.getGLInternalFormat(a,b.format),h.getGLDataType(a,b.type),null);else if("CUBE"===b.variant){if(e&&!e.isData&&(b.generateMipmaps||e.width>this.maxCubemapSize||e.height>this.maxCubemapSize)){for(var f=0;f<l.CUBE_FACES.length;f++)e.data[f]&&!e.data[f].buffer?h.scaleImage(b,e.data[f],e.width,e.height,this.maxCubemapSize,f):h.getBlankImage(b,[.3,.3,.3,0],e.width,e.height,this.maxCubemapSize,f);b.image.width=Math.min(this.maxCubemapSize,u.nearestPowerOfTwo(b.image.width)),b.image.height=Math.min(this.maxCubemapSize,u.nearestPowerOfTwo(b.image.height)),e=b.image}for(var g=0;g<l.CUBE_FACES.length;g++){var i=l.CUBE_FACES[g];e?e.isData===!0?e.isCompressed?this.loadCompressedTexture(a,h.getGLCubeMapFace(a,i),b,e.data[g]):a.texImage2D(h.getGLCubeMapFace(a,i),0,h.getGLInternalFormat(a,b.format),e.width,e.height,b.hasBorder?1:0,h.getGLInternalFormat(a,b.format),h.getGLDataType(a,b.type),e.data[g]):a.texImage2D(h.getGLCubeMapFace(a,i),0,h.getGLInternalFormat(a,b.format),h.getGLInternalFormat(a,b.format),h.getGLDataType(a,b.type),e.data[g]):a.texImage2D(h.getGLCubeMapFace(a,i),0,h.getGLInternalFormat(a,b.format),b.width,b.height,0,h.getGLInternalFormat(a,b.format),h.getGLDataType(a,b.type),null)}e&&b.generateMipmaps&&!e.isCompressed&&a.generateMipmap(a.TEXTURE_CUBE_MAP)}},d.prototype.checkRescale=function(a,b,c,d,e,f){h.scaleImage(a,b,c,d,e,f)},d.prototype.updateBlending=function(a){var b=this.rendererRecord.blendRecord,c=this.context,d=a.blendState.blending;if(d!==b.blending&&("NoBlending"===d?c.disable(c.BLEND):"AdditiveBlending"===d?(c.enable(c.BLEND),c.blendEquation(c.FUNC_ADD),c.blendFunc(c.SRC_ALPHA,c.ONE)):"SubtractiveBlending"===d?(c.enable(c.BLEND),c.blendEquation(c.FUNC_REVERSE_SUBTRACT),c.blendFunc(c.SRC_ALPHA,c.ONE)):"MultiplyBlending"===d?(c.enable(c.BLEND),c.blendEquation(c.FUNC_ADD),c.blendFunc(c.DST_COLOR,c.ONE_MINUS_SRC_ALPHA)):"AlphaBlending"===d?(c.enable(c.BLEND),c.blendEquation(c.FUNC_ADD),c.blendFunc(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA)):"TransparencyBlending"===d?(c.enable(c.BLEND),c.blendEquationSeparate(c.FUNC_ADD,c.FUNC_ADD),c.blendFuncSeparate(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA)):"CustomBlending"===d?c.enable(c.BLEND):"SeparateBlending"===d?(c.enable(c.BLEND),c.blendEquationSeparate(h.getGLBlendParam(c,a.blendState.blendEquationColor),h.getGLBlendParam(c,a.blendState.blendEquationAlpha)),c.blendFuncSeparate(h.getGLBlendParam(c,a.blendState.blendSrcColor),h.getGLBlendParam(c,a.blendState.blendDstColor),h.getGLBlendParam(c,a.blendState.blendSrcAlpha),h.getGLBlendParam(c,a.blendState.blendDstAlpha))):(c.enable(c.BLEND),c.blendEquationSeparate(c.FUNC_ADD,c.FUNC_ADD),c.blendFuncSeparate(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA)),b.blending=d),"CustomBlending"===d){var e=a.blendState.blendEquation,f=a.blendState.blendSrc,g=a.blendState.blendDst;e!==b.blendEquation&&(c.blendEquation(h.getGLBlendParam(c,e)),b.blendEquation=e),(f!==b.blendSrc||g!==b.blendDst)&&(c.blendFunc(h.getGLBlendParam(c,f),h.getGLBlendParam(c,g)),b.blendSrc=f,b.blendDst=g)}else b.blendEquation=null,b.blendSrc=null,b.blendDst=null},d.prototype.updateOffset=function(a){var b=this.rendererRecord.offsetRecord,c=this.context,d=a.offsetState.enabled,e=a.offsetState.factor,f=a.offsetState.units;b.enabled!==d&&(d?c.enable(c.POLYGON_OFFSET_FILL):c.disable(c.POLYGON_OFFSET_FILL),b.enabled=d),!d||b.factor===e&&b.units===f||(c.polygonOffset(e,f),b.factor=e,b.units=f)},d.prototype.setBoundBuffer=function(a,b){var c=this.rendererRecord.currentBuffer[b];c.valid&&c.buffer===a||(this.context.bindBuffer(h.getGLBufferTarget(this.context,b),a),c.buffer=a,c.valid=!0,"ArrayBuffer"===b&&(this.rendererRecord.attributeCache.length=0))},d.prototype.bindVertexAttribute=function(a,b){var c=this.rendererRecord.attributeCache[a];c!==b.hashKey&&(this.context.vertexAttribPointer(a,b.count,h.getGLDataType(this.context,b.type),b.normalized,b.stride,b.offset),this.rendererRecord.attributeCache[a]=b.hashKey)},d.prototype.clear=function(a,b,c){var d=0;(void 0===a||a)&&(d|=this.context.COLOR_BUFFER_BIT),(void 0===b||b)&&(d|=this.context.DEPTH_BUFFER_BIT),(void 0===c||c)&&(d|=this.context.STENCIL_BUFFER_BIT);var e=this.rendererRecord.depthRecord;e.write!==!0&&(this.context.depthMask(!0),e.write=!0),d&&this.context.clear(d)},d.prototype.flush=function(){this.context.flush()},d.prototype.finish=function(){this.context.finish()},d.prototype.setupFrameBuffer=function(a,b,c){this.context.bindFramebuffer(this.context.FRAMEBUFFER,a),this.context.framebufferTexture2D(this.context.FRAMEBUFFER,this.context.COLOR_ATTACHMENT0,c,b.glTexture,0)},d.prototype.setupRenderBuffer=function(a,b){var c=this.context;c.bindRenderbuffer(c.RENDERBUFFER,a),b.depthBuffer&&!b.stencilBuffer?(c.renderbufferStorage(c.RENDERBUFFER,c.DEPTH_COMPONENT16,b.width,b.height),c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_ATTACHMENT,c.RENDERBUFFER,a)):b.depthBuffer&&b.stencilBuffer?(c.renderbufferStorage(c.RENDERBUFFER,c.DEPTH_STENCIL,b.width,b.height),c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_STENCIL_ATTACHMENT,c.RENDERBUFFER,a)):this.context.renderbufferStorage(c.RENDERBUFFER,c.RGBA4,b.width,b.height)},d.prototype.setRenderTarget=function(a){var b=this.context;if(a&&!a._glFrameBuffer){void 0===a.depthBuffer&&(a.depthBuffer=!0),void 0===a.stencilBuffer&&(a.stencilBuffer=!0),null===a.glTexture&&(a.glTexture=this.context.createTexture());var c=u.isPowerOfTwo(a.width)&&u.isPowerOfTwo(a.height),d=h.getGLInternalFormat(b,a.format),e=h.getGLDataType(b,a.type);a._glFrameBuffer=this.context.createFramebuffer(),a._glRenderBuffer=this.context.createRenderbuffer(),this.context.bindTexture(b.TEXTURE_2D,a.glTexture),this.updateTextureParameters(a,c),this.context.texImage2D(b.TEXTURE_2D,0,d,a.width,a.height,0,d,e,null),this.setupFrameBuffer(a._glFrameBuffer,a,b.TEXTURE_2D),this.setupRenderBuffer(a._glRenderBuffer,a),a.generateMipmaps&&c&&this.context.generateMipmap(b.TEXTURE_2D),this.context.bindTexture(b.TEXTURE_2D,null),this.context.bindRenderbuffer(b.RENDERBUFFER,null),this.context.bindFramebuffer(b.FRAMEBUFFER,null)}var f,g,i,j,k;a?(f=a._glFrameBuffer,j=0,k=0,g=a.width,i=a.height):(f=null,j=this.viewportX,k=this.viewportY,g=this.viewportWidth,i=this.viewportHeight),f!==this.rendererRecord.currentFrameBuffer&&(b.bindFramebuffer(b.FRAMEBUFFER,f),b.viewport(j,k,g,i),this.rendererRecord.currentFrameBuffer=f,this.rendererRecord.textureRecord=[]),this.currentWidth=g,this.currentHeight=i},d.prototype.updateRenderTargetMipmap=function(a){var b=this.context;b.bindTexture(b.TEXTURE_2D,a.glTexture),b.generateMipmap(b.TEXTURE_2D),b.bindTexture(b.TEXTURE_2D,null)},d.prototype._deallocateMeshData=function(a){a.destroy(this.context)},d.prototype._deallocateTexture=function(a){a.destroy(this.context)},d.prototype._deallocateRenderTarget=function(a){a.destroy(this.context)},d.prototype._deallocateShader=function(a){a.destroy()},a.exports=d},function(a,b){function c(){this.currentBuffer={ArrayBuffer:{buffer:null,valid:!1},ElementArrayBuffer:{buffer:null,valid:!1}},this.currentFrameBuffer=null,this.clippingTestValid=!1,this.clippingTestEnabled=!1,this.clips=[],this.enabledTextures=0,this.texturesValid=!1,this.currentTextureArraysUnit=0,this.textureRecord=[],this.usedProgram=null,this.boundAttributes=[],this.enabledAttributes=[],this.newlyEnabledAttributes=[],this.depthRecord={},this.cullRecord={},this.blendRecord={},this.offsetRecord={},this.lineRecord={},this.pointRecord={},this.shaderCache=new Map,this.attributeCache=[]}c.prototype.invalidateBuffer=function(a){this.currentBuffer[a].buffer=null,this.currentBuffer[a].valid=!1},a.exports=c},function(a,b,c){function d(){var a=this.ajax=new h;this.textureHandler=new g({},function(b,c){return a.load(b,c?c.noCache:!1)},function(){},function(b,c){return a.load(b,c?c.noCache:!1)})}var e=c(53),f=c(9),g=c(126),h=c(132),i=c(36),j=c(54),k=c(55);d.UNSUPPORTED_FALLBACK=".png",d.clearCache=function(){},d.prototype.clear=function(){this.ajax.clear(),this.textureHandler.clear()},d.prototype.loadTexture2D=function(a,b){var c=i.createUniqueId("texture");b=b||{},b.imageRef=a;var d=this.textureHandler._create();return this.textureHandler._objects.set(c,d),this.textureHandler.update(c,b)},d.prototype.loadTextureVideo=function(a,b){var c=i.createUniqueId("texture");b=b||{},b.imageRef=a,b.loop=void 0!==b.loop?b.loop:!0,b.wrapS=void 0!==b.wrapS?b.wrapS:"EdgeClamp",b.wrapT=void 0!==b.wrapT?b.wrapT:"EdgeClamp",b.autoPlay=void 0!==b.autoPlay?b.autoPlay:!0,b.texture=void 0!==b.texture?b.texture:{dontwait:!0};var d=this.textureHandler._create();return this.textureHandler._objects.set(c,d),this.textureHandler.update(c,b,b)},d.prototype.loadTextureWebCam=function(){return j.createPromise(function(a,b){var c=document.createElement("video");c.autoplay=!0,c.loop=!0;var d=new e(c,{wrapS:"EdgeClamp",wrapT:"EdgeClamp"});d.readyCallback=function(){return c.readyState>=3?(c.width=c.videoWidth,c.height=c.videoHeight,f.isPowerOfTwo(c.width)&&f.isPowerOfTwo(c.height)||(d.generateMipmaps=!1,d.minFilter="BilinearNoMipMaps"),c.dataReady=!0,!0):!1},d.updateCallback=function(){return!c.paused},window.URL=window.URL||window.webkitURL,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getUserMedia?navigator.getUserMedia({video:!0},function(b){c.src=window.URL.createObjectURL(b),a(d)},b):b(new Error("No support for WebCam getUserMedia found!"))})},d.prototype.loadTextureCube=function(a,b){var c=new e(null,b);c.variant="CUBE";var d=a.map(function(a){return j.createPromise(function(b,c){"string"==typeof a?this.ajax._loadImage(a).then(b,c):b(a)}.bind(this))}.bind(this));return k.all(d).then(function(a){return j.createPromise(function(b,d){for(var e=a[0].width,f=a[0].height,g=0;6>g;g++){var h=a[g];if(e!==h.width||f!==h.height)return c.generateMipmaps=!1,c.minFilter="BilinearNoMipMaps",void d(new Error("The images passed to loadTextureCube() must be of the same size!"))}c.setImage(a),c.image.dataReady=!0,c.image.width=e,c.image.height=f,b(c)})})},d._globalCallback=null,d._finishedLoading=function(a){if(d._globalCallback)try{d._globalCallback(a)}catch(b){console.error("Error in texture callback:",b)}};var l=new Uint8Array([255,255,255,255]);d.DEFAULT_TEXTURE_2D=new e(l,null,1,1),d.DEFAULT_TEXTURE_CUBE=new e([l,l,l,l,l,l],null,1,1),d.DEFAULT_TEXTURE_CUBE.variant="CUBE",a.exports=d},function(a,b,c){function d(){e.apply(this,arguments),n.addListener("playStateChanged",function(a){this._objects.forEach(function(b){if(b.image&&b.image.play&&b.image.pause){var c=b.image;"play"===a?c.play():"stop"===a?(c.pause(),c.currentTime=0):"pause"===a&&c.pause()}})}.bind(this))}var e=c(85),f=c(53),g=c(127),h=c(129),i=c(130),j=c(54),k=c(6),l=c(131),m=c(36),n=c(44),o=c(9);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,e._registerClass("texture",d),d.minFilters=["NearestNeighborNoMipMaps","NearestNeighborNearestMipMap","NearestNeighborLinearMipMap","BilinearNoMipMaps","BilinearNearestMipMap","Trilinear"],d.magFilters=["NearestNeighbor","Bilinear"],d.noMipMapAlternatives={NearestNeighborNoMipMaps:"NearestNeighborNoMipMaps",NearestNeighborNearestMipMap:"NearestNeighborNoMipMaps",NearestNeighborLinearMipMap:"NearestNeighborNoMipMaps",BilinearNoMipMaps:"BilinearNoMipMaps",BilinearNearestMipMap:"BilinearNoMipMaps",Trilinear:"BilinearNoMipMaps"},d.loaders={dds:g,crn:h,tga:i},d.WHITE=new Uint8Array([255,255,255,255]),d.BLACK=new Uint8Array([0,0,0,255]),d.prototype._prepare=function(a){k.defaults(a,{wrapS:"Repeat",wrapT:"Repeat",magFilter:"Bilinear",minFilter:"Trilinear",anisotropy:1,offset:[0,0],repeat:[1,1],flipY:!0,lodBias:0,loop:!0})},d.prototype._remove=function(a){var b=this._objects.get(a);b&&this.world.gooRunner&&b.destroy(this.world.gooRunner.renderer.context),this._objects["delete"](a)},d.prototype._create=function(){return new f},d.prototype._loadWebSupportedImage=function(a,b,c){return this.loadObject(b.imageRef,c).then(function(b){return a.image!==b&&a.setImage(b),a})},d.prototype._loadSpecialImage=function(a,b,c){var e=d.loaders[c],f=b.imageRef;return this.loadObject(f).then(function(c){if(c&&c.preloaded)return k.extend(a.image,c.image),a.format=c.format,a.setNeedsUpdate(),a;var d=new e;return d.load(c,a,b.flipY,0,c.byteLength),a})},d.prototype._loadVideo=function(a,b,c){return this.loadObject(b.imageRef,c).then(function(d){return d.width=d.videoWidth,d.height=d.videoHeight,d.loop=void 0!==b.loop?b.loop:!0,o.isPowerOfTwo(d.width)&&o.isPowerOfTwo(d.height)||(a.generateMipmaps=!1,a.minFilter="BilinearNoMipMaps"),a.setImage(d),a.updateCallback=function(){return!d.paused},b.autoPlay===!1||c.editMode?(d.pause(),d.currentTime=0):d.play(),a})},d.prototype._loadImage=function(a,b,c){var e=b.imageRef,f=m.parseURL(e).path,g=f.substr(f.lastIndexOf(".")+1).toLowerCase();return d.loaders[g]?this._loadSpecialImage(a,b,g,c):-1!==["jpg","jpeg","png","gif"].indexOf(g)?this._loadWebSupportedImage(a,b,c):-1!==["mp4","ogv","webm"].indexOf(g)?this._loadVideo(a,b,c):j.reject(new Error("Unknown image type: "+g))},d.prototype._update=function(a,b,c){var f=this;return e.prototype._update.call(this,a,b,c).then(function(a){if(a){var e;return(a.wrapS!==b.wrapS||a.wrapT!==b.wrapT)&&a.setNeedsUpdate(),a.wrapS=b.wrapS,a.wrapT=b.wrapT,-1!==d.magFilters.indexOf(b.magFilter)&&(a.magFilter=b.magFilter),-1!==d.minFilters.indexOf(b.minFilter)&&(a.minFilter=b.generateMipmaps!==!1?b.minFilter:d.noMipMapAlternatives[b.minFilter]),a.anisotropy=Math.max(b.anisotropy,1),a.offset.setDirect(b.offset[0],b.offset[1]),a.repeat.setDirect(b.repeat[0],b.repeat[1]),a.lodBias=b.lodBias,a.flipY!==b.flipY&&(a.flipY=b.flipY,a.setNeedsUpdate()),a.generateMipmaps!==b.generateMipmaps&&(a.generateMipmaps=b.generateMipmaps!==!1,a.setNeedsUpdate()),a.updateCallback=null,b.imageRef?b.lazy?(a.loadImage=function(){return f._loadImage(a,b,c)},e=a):e=f._loadImage(a,b,c):e=b.svgData?j.createPromise(function(c,d){l.renderSvgToCanvas(b.svgData,{},function(b){b?(a.setImage(b),c(a)):d("could not render svg to canvas")})}):a,c&&c.texture&&c.texture.dontwait?a:e}})},a.exports=d},function(a,b,c){function d(){this.dwSize=0,this.dwFlags=0,this.dwFourCC=0,this.dwRGBBitCount=0,this.dwRBitMask=0,this.dwGBitMask=0,this.dwBBitMask=0,this.dwABitMask=0}function e(){this.dwSize=0,this.dwFlags=0,this.dwHeight=0,this.dwWidth=0,this.dwLinearSize=0,this.dwDepth=0,this.dwMipMapCount=0,this.dwAlphaBitDepth=0,this.dwReserved1=[],this.ddpf=null,this.dwCaps=0,this.dwCaps2=0,this.dwCaps3=0,this.dwCaps4=0,this.dwTextureStage=0}function f(){this.flipVertically=!1,this.bpp=0,this.header=null,this.headerDX10=null,this.mipmapByteSizes=[]}function g(){}var h=c(128),i=c(17);d.HEADER_OFFSET=19,d.DDPF_ALPHAPIXELS=1,d.DDPF_ALPHA=2,d.DDPF_FOURCC=4,d.DDPF_RGB=64,d.DDPF_YUV=512,d.DDPF_LUMINANCE=131072,d.read=function(a){var b=new d;if(b.dwSize=a[d.HEADER_OFFSET+0],32!==b.dwSize)throw new Error("invalid pixel format size: "+b.dwSize);return b.dwFlags=a[d.HEADER_OFFSET+1],b.dwFourCC=a[d.HEADER_OFFSET+2],b.dwRGBBitCount=a[d.HEADER_OFFSET+3],b.dwRBitMask=a[d.HEADER_OFFSET+4],b.dwGBitMask=a[d.HEADER_OFFSET+5],b.dwBBitMask=a[d.HEADER_OFFSET+6],b.dwABitMask=a[d.HEADER_OFFSET+7],b},e.DDSD_CAPS=1,e.DDSD_HEIGHT=2,e.DDSD_WIDTH=4,e.DDSD_PITCH=8,e.DDSD_PIXELFORMAT=4096,e.DDSD_MIPMAPCOUNT=131072,e.DDSD_LINEARSIZE=524288,e.DDSD_DEPTH=8388608,e.DDSCAPS_COMPLEX=8,e.DDSCAPS_MIPMAP=4194304,e.DDSCAPS_TEXTURE=4096,e.DDSCAPS2_CUBEMAP=512,e.DDSCAPS2_CUBEMAP_POSITIVEX=1024,e.DDSCAPS2_CUBEMAP_NEGATIVEX=2048,e.DDSCAPS2_CUBEMAP_POSITIVEY=4096,e.DDSCAPS2_CUBEMAP_NEGATIVEY=8192,e.DDSCAPS2_CUBEMAP_POSITIVEZ=16384,e.DDSCAPS2_CUBEMAP_NEGATIVEZ=32768,e.DDSCAPS2_VOLUME=2097152,e.read=function(a){var b=new e;if(b.dwSize=a[1],124!==b.dwSize)throw new Error("invalid dds header size: "+b.dwSize);b.dwFlags=a[2],b.dwHeight=a[3],b.dwWidth=a[4],b.dwLinearSize=a[5],b.dwDepth=a[6],b.dwMipMapCount=a[7],b.dwAlphaBitDepth=a[8];for(var c=0;c<b.dwReserved1.length;c++)b.dwReserved1[c]=a[9+c];b.ddpf=d.read(a),b.dwCaps=a[27],b.dwCaps2=a[28],b.dwCaps3=a[29],b.dwCaps4=a[30],b.dwTextureStage=a[31];var f=1+Math.ceil(Math.log(Math.max(b.dwHeight,b.dwWidth))/Math.log(2));return h.isSet(b.dwCaps,e.DDSCAPS_MIPMAP)?h.isSet(b.dwFlags,e.DDSD_MIPMAPCOUNT)?b.dwMipMapCount!==f&&console.warn("Got "+b.dwMipMapCount+" mipmaps, expected "+f):b.dwMipMapCount=f:b.dwMipMapCount=1,b},f.prototype.calcMipmapSizes=function(a){for(var b=this.header.dwWidth,c=this.header.dwHeight,d=0,e=0;e<this.header.dwMipMapCount;e++)d=a?~~((b+3)/4)*~~((c+3)/4)*this.bpp*2:~~(b*c*this.bpp/8),this.mipmapByteSizes.push(4*~~((d+3)/4)),b=~~(b/2)>1?~~(b/2):1,c=~~(c/2)>1?~~(c/2):1},g.updateDepth=function(a,b){if(h.isSet(b.header.dwCaps2,e.DDSCAPS2_CUBEMAP)){var c=0;if(h.isSet(b.header.dwCaps2,e.DDSCAPS2_CUBEMAP_POSITIVEX)&&c++,h.isSet(b.header.dwCaps2,e.DDSCAPS2_CUBEMAP_NEGATIVEX)&&c++,h.isSet(b.header.dwCaps2,e.DDSCAPS2_CUBEMAP_POSITIVEY)&&c++,h.isSet(b.header.dwCaps2,e.DDSCAPS2_CUBEMAP_NEGATIVEY)&&c++,h.isSet(b.header.dwCaps2,e.DDSCAPS2_CUBEMAP_POSITIVEZ)&&c++,h.isSet(b.header.dwCaps2,e.DDSCAPS2_CUBEMAP_NEGATIVEZ)&&c++,6!==c)throw new Error("Cubemaps without all faces defined are not currently supported.");a.depth=c}else a.depth=b.header.dwDepth>0?b.header.dwDepth:1},g.readDXT=function(a,b,c,d){if(d.image.isCompressed=!0,!c.flipVertically)return new Uint8Array(a.buffer,a.byteOffset+0,b);for(var e=c.header.dwWidth,f=c.header.dwHeight,g=new Uint8Array(b),i=0,j=0;j<c.header.dwMipMapCount;j++){var k=a.subarray(i,i+c.mipmapByteSizes[j]),l=h.flipDXT(k,e,f,d.format);g.set(l,i),i+=l.length,e=~~(e/2)>1?~~(e/2):1,f=~~(f/2)>1?~~(f/2):1}return g},g.readUncompressed=function(a,b,c,d,e,f,g,i){var j=h.shiftCount(g.header.ddpf.dwRBitMask),k=h.shiftCount(g.header.ddpf.dwGBitMask),l=h.shiftCount(g.header.ddpf.dwBBitMask),m=h.shiftCount(g.header.ddpf.dwABitMask),n=~~(g.header.ddpf.dwRGBBitCount/8),o=1*h.getComponents(i.format),p=new Uint8Array(b),q=g.header.dwWidth,r=g.header.dwHeight,s=0,t=0,u=0,v=[];for(u=0;n>u;u++)v.push(0);for(var w=0;w<g.header.dwMipMapCount;w++){for(var x=0;r>x;x++)for(var y=0;q>y;y++){for(u=0;n>u;u++)v[u]=a[t++];u=h.getIntFromBytes(v);var z=(u&g.header.ddpf.dwRBitMask)>>j,A=(u&g.header.ddpf.dwGBitMask)>>k,B=(u&g.header.ddpf.dwBBitMask)>>l,C=(u&g.header.ddpf.dwABitMask)>>m;e?p[s++]=C:d?(p[s++]=z,f&&(p[s++]=C)):c&&(p[s++]=z,p[s++]=A,p[s++]=B,f&&(p[s++]=C))}s+=q*r*o,q=~~(q/2)>1?~~(q/2):1,r=~~(r/2)>1?~~(r/2):1}return p},g.populate=function(a,b,c){var e=b.header.ddpf.dwFlags,f=h.isSet(e,d.DDPF_FOURCC),i=h.isSet(e,d.DDPF_RGB),j=h.isSet(e,d.DDPF_ALPHAPIXELS),k=h.isSet(e,d.DDPF_LUMINANCE),l=h.isSet(e,d.DDPF_ALPHA);if(a.type="UnsignedByte",f){var m=b.header.ddpf.dwFourCC;if(m===h.getIntFromString("DXT1"))b.bpp=4,a.format="PrecompressedDXT1A";else if(m===h.getIntFromString("DXT3"))b.bpp=8,a.format="PrecompressedDXT3";else{if(m!==h.getIntFromString("DXT5"))throw m===h.getIntFromString("DX10")?new Error("dxt10 LATC formats not supported currently: "+b.headerDX10.dxgiFormat):m===h.getIntFromString("DXT2")?new Error("DXT2 is not supported."):m===h.getIntFromString("DXT4")?new Error("DXT4 is not supported."):new Error("unsupported compressed dds format found ("+m+")");b.bpp=8,a.format="PrecompressedDXT5"}}else if(b.bpp=b.header.ddpf.dwRGBBitCount,i)j?a.format="RGBA":a.format="RGB";else{if(!k&&!j)throw new Error("unsupported uncompressed dds format found.");k&&j?a.format="LuminanceAlpha":k?a.format="Luminance":l&&(a.format="Alpha")}b.calcMipmapSizes(f),a.image.mipmapSizes=b.mipmapByteSizes;for(var n=0,o=0;o<b.mipmapByteSizes.length;o++)n+=b.mipmapByteSizes[o];for(var p=[],o=0;o<a.image.depth;o++)f?p.push(g.readDXT(c,n,b,a)):(i||k||l)&&p.push(g.readUncompressed(c,n,i,k,l,j,b,a));a.image.data=1===a.image.depth?p[0]:p,a.image.useArrays=!0},g.prototype.load=function(a,b,c,d,i){var j=new Int32Array(a,d+0,32),k=j[0];if(k!==h.getIntFromString("DDS "))throw new Error("Not a dds file.");var l=new f;l.flipVertically=c,l.header=e.read(j),l.headerDX10=l.header.ddpf.dwFourCC===h.getIntFromString("DX10")?e.read(Int32Array.create(a,d+128,5)):null;var m=b.image;("undefined"==typeof m||null===m)&&(m={},b.image=m),m.width=l.header.dwWidth,m.height=l.header.dwHeight,g.updateDepth(m,l);var n=128+(l.headerDX10?20:0);g.populate(b,l,new Uint8Array(a,d+n,i-n)),(!l.mipmapByteSizes||l.mipmapByteSizes.length<2)&&(b.minFilter="BilinearNoMipMaps"),m.bpp=l.bpp,m.dataReady=!0,m.isData=!0,b.needsUpdate=!0},g.prototype.isSupported=function(){return!!i.CompressedTextureS3TC},g.prototype.toString=function(){return"DdsLoader"},a.exports=g},function(a,b,c){function d(){}var e=c(17);d.isSupported=function(){return!!e.CompressedTextureS3TC},d.shiftCount=function(a){if(0===a)return 0;for(var b=0;0===(1&a);)if(a>>=1,b++,b>32)throw new Error("invalid mask!");return b},d.isSet=function(a,b){return(a&b)===b},d.getIntFromString=function(a){for(var b=[],c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return d.getIntFromBytes(b)},d.getIntFromBytes=function(a){var b=0;return b|=(255&a[0])<<0,a.length>1&&(b|=(255&a[1])<<8),a.length>2&&(b|=(255&a[2])<<16),a.length>3&&(b|=(255&a[3])<<24),b},d.getComponents=function(a){switch(a){case"Alpha":return 1;case"RGB":return 3;case"RGBA":return 4;case"Luminance":return 1;case"LuminanceAlpha":return 2;case"PrecompressedDXT1":return 1;case"PrecompressedDXT1A":return 1;case"PrecompressedDXT3":return 2;case"PrecompressedDXT5":return 2}return 0},d.flipDXT=function(a,b,c,e){for(var f=new Uint8Array(a.length),g=b+3>>2,h=c+3>>2,i=8*d.getComponents(e),j=0;h>j;j++)for(var k=h-j-1,l=0;g>l;l++){var m=(k*g+l)*i,n=(j*g+l)*i;switch(e){case"PrecompressedDXT1":case"PrecompressedDXT1A":f[m+0]=a[n+0],f[m+1]=a[n+1],f[m+2]=a[n+2],f[m+3]=a[n+3],f[m+4]=a[n+7],f[m+5]=a[n+6],f[m+6]=a[n+5],f[m+7]=a[n+4];break;case"PrecompressedDXT3":f[m+0]=a[n+6],f[m+1]=a[n+7],f[m+2]=a[n+4],f[m+3]=a[n+5],f[m+4]=a[n+2],f[m+5]=a[n+3],f[m+6]=a[n+0],f[m+7]=a[n+1],f[m+8]=a[n+8],f[m+9]=a[n+9],f[m+10]=a[n+10],f[m+11]=a[n+11],f[m+12]=a[n+15],f[m+13]=a[n+14],f[m+14]=a[n+13],f[m+15]=a[n+12];break;case"PrecompressedDXT5":f[m+0]=a[n+0],f[m+1]=a[n+1],d.getBytesFromUInt24(f,m+5,d.flipUInt24(d.getUInt24(a,n+2))),d.getBytesFromUInt24(f,m+2,d.flipUInt24(d.getUInt24(a,n+5))),f[m+8]=a[n+8],f[m+9]=a[n+9],f[m+10]=a[n+10],f[m+11]=a[n+11],f[m+12]=a[n+15],f[m+13]=a[n+14],f[m+14]=a[n+13],f[m+15]=a[n+12]}}return f},d.getUInt24=function(a,b){var c=0;return c|=(255&a[b+0])<<0,c|=(255&a[b+1])<<8,c|=(255&a[b+2])<<16},d.getBytesFromUInt24=function(a,b,c){a[b+0]=255&c,a[b+1]=(65280&c)>>8,a[b+2]=(16711680&c)>>16},d.ThreeBitMask=7,d.flipUInt24=function(a){for(var b=[],c=0;2>c;c++)b.push([0,0,0,0]);b[0][0]=a&d.ThreeBitMask,a>>=3,b[0][1]=a&d.ThreeBitMask,a>>=3,b[0][2]=a&d.ThreeBitMask,a>>=3,b[0][3]=a&d.ThreeBitMask,a>>=3,b[1][0]=a&d.ThreeBitMask,a>>=3,b[1][1]=a&d.ThreeBitMask,a>>=3,b[1][2]=a&d.ThreeBitMask,a>>=3,b[1][3]=a&d.ThreeBitMask;var e=0;return e|=b[1][0]<<0,e|=b[1][1]<<3,e|=b[1][2]<<6,e|=b[1][3]<<9,e|=b[0][0]<<12,e|=b[0][1]<<15,e|=b[0][2]<<18,e|=b[0][3]<<21},a.exports=d},function(a,b,c){function d(){}c(127);var e=c(128),f=c(17);d.cCRNFmtDXT1=0,d.cCRNFmtDXT3=1,d.cCRNFmtDXT5=2,d.prototype.arrayBufferCopy=function(a,b,c,d){var e,f=c/4,g=d%4,h=new Uint32Array(a.buffer,0,(d-g)/4),i=new Uint32Array(b.buffer);for(e=0;e<h.length;e++)i[f+e]=h[e];for(e=d-g;d>e;e++)b[c+e]=a[e]},d.prototype.load=function(a,b,c){if("undefined"==typeof window.CrunchModule)return void console.warn("Crunch library not loaded! Include a script tag pointing to lib/crunch/crunch.js in your html-file.");var f,g,h,i,j,k,l,m,n=window.CrunchModule,o=new Uint8Array(a),p=a.byteLength,q=n._malloc(p);this.arrayBufferCopy(o,n.HEAPU8,q,p),f=n._crn_get_dxt_format(q,p);var r;switch(f){case d.cCRNFmtDXT1:b.format="PrecompressedDXT1A",r=4;break;case d.cCRNFmtDXT3:b.format="PrecompressedDXT3",r=8;break;case d.cCRNFmtDXT5:b.format="PrecompressedDXT5",r=8;break;default:return console.error("Unsupported image format"),0}i=n._crn_get_width(q,p),j=n._crn_get_height(q,p),k=n._crn_get_levels(q,p),h=n._crn_get_uncompressed_size(q,p,0),g=n._malloc(h);var s=b.image;("undefined"==typeof s||null===s)&&(s={},b.image=s),s.width=i,s.height=j,s.depth=1;var t=[];for(b.image.mipmapSizes=[],m=0;k>m;++m)m&&(h=n._crn_get_uncompressed_size(q,p,m)),n._crn_decompress(q,p,g,h,m),l=new Uint8Array(n.HEAPU8.buffer,g,h),c&&(l=e.flipDXT(l,i,j,b.format)),t.push(l),b.image.mipmapSizes.push(h),i*=.5,j*=.5;b.image.data=t,b.image.useArrays=!0,b.type="UnsignedByte",b.image.isCompressed=!0,1>=k&&(b.minFilter="BilinearNoMipMaps"),s.bpp=r,s.dataReady=!0,s.isData=!0,b.needsUpdate=!0,n._free(q),n._free(g)},d.prototype.dxtToRgb565=function(a,b,c,d){for(var e=new Uint16Array(4),f=new Uint16Array(c*d),g=0,h=0,i=0,j=0,k=0,l=0,m=0,n=0,o=0,p=c/4,q=d/4,r=0;q>r;r++)for(var s=0;p>s;s++)i=b+4*(r*p+s),e[0]=a[i],e[1]=a[i+1],j=31&e[0],k=2016&e[0],l=63488&e[0],m=31&e[1],n=2016&e[1],o=63488&e[1],e[2]=5*j+3*m>>3|5*k+3*n>>3&2016|5*l+3*o>>3&63488,e[3]=5*m+3*j>>3|5*n+3*k>>3&2016|5*o+3*l>>3&63488,g=a[i+2],h=4*r*c+4*s,f[h]=e[3&g],f[h+1]=e[g>>2&3],f[h+2]=e[g>>4&3],f[h+3]=e[g>>6&3],h+=c,f[h]=e[g>>8&3],f[h+1]=e[g>>10&3],f[h+2]=e[g>>12&3],f[h+3]=e[g>>14],g=a[i+3],h+=c,f[h]=e[3&g],f[h+1]=e[g>>2&3],f[h+2]=e[g>>4&3],f[h+3]=e[g>>6&3],h+=c,f[h]=e[g>>8&3],f[h+1]=e[g>>10&3],f[h+2]=e[g>>12&3],f[h+3]=e[g>>14];return f},d.prototype.isSupported=function(){return!!f.CompressedTextureS3TC},d.prototype.toString=function(){return"CrunchLoader"},a.exports=d},function(a,b){function c(){this.header=null,this.offset=0,this.use_rle=!1,this.use_pal=!1,this.use_rgb=!1,this.use_grey=!1;
}c.TYPE_NO_DATA=0,c.TYPE_INDEXED=1,c.TYPE_RGB=2,c.TYPE_GREY=3,c.TYPE_RLE_INDEXED=9,c.TYPE_RLE_RGB=10,c.TYPE_RLE_GREY=11,c.ORIGIN_MASK=48,c.ORIGIN_SHIFT=4,c.ORIGIN_BL=0,c.ORIGIN_BR=1,c.ORIGIN_UL=2,c.ORIGIN_UR=3,c.prototype.load=function(a,b){this.loadData(new Uint8Array(a));var c=this.getCanvas();b.setImage(c,c.width,c.height),c.dataReady=!0,b.needsUpdate=!0},c.prototype.loadData=function(a){if(a.length<19)throw new Error("Targa::load() - Not enough data to contain header.");if(this.offset=0,this.header={id_length:a[this.offset++],colormap_type:a[this.offset++],image_type:a[this.offset++],colormap_index:a[this.offset++]|a[this.offset++]<<8,colormap_length:a[this.offset++]|a[this.offset++]<<8,colormap_size:a[this.offset++],origin:[a[this.offset++]|a[this.offset++]<<8,a[this.offset++]|a[this.offset++]<<8],width:a[this.offset++]|a[this.offset++]<<8,height:a[this.offset++]|a[this.offset++]<<8,pixel_size:a[this.offset++],flags:a[this.offset++]},this.checkHeader(),this.header.id_length+this.offset>a.length)throw new Error("Targa::load() - No data ?");switch(this.offset+=this.header.id_length,this.header.image_type){case c.TYPE_RLE_INDEXED:this.use_rle=!0;break;case c.TYPE_INDEXED:this.use_pal=!0;break;case c.TYPE_RLE_RGB:this.use_rle=!0;break;case c.TYPE_RGB:this.use_rgb=!0;break;case c.TYPE_RLE_GREY:this.use_rle=!0;break;case c.TYPE_GREY:this.use_grey=!0}this.parse(a)},c.prototype.checkHeader=function(){switch(this.header.image_type){case c.TYPE_INDEXED:case c.TYPE_RLE_INDEXED:if(this.header.colormap_length>256||24!==this.header.colormap_size||1!==this.header.colormap_type)throw new Error("Targa::checkHeader() - Invalid type colormap data for indexed type");break;case c.TYPE_RGB:case c.TYPE_GREY:case c.TYPE_RLE_RGB:case c.TYPE_RLE_GREY:if(this.header.colormap_type)throw new Error("Targa::checkHeader() - Invalid type colormap data for colormap type");break;case c.TYPE_NO_DATA:throw new Error("Targa::checkHeader() - No data on this TGA file");default:throw new Error("Targa::checkHeader() - Invalid type '"+this.header.image_type+"'")}if(this.header.width<=0||this.header.height<=0)throw new Error("Targa::checkHeader() - Invalid image size");if(8!==this.header.pixel_size&&16!==this.header.pixel_size&&24!==this.header.pixel_size&&32!==this.header.pixel_size)throw new Error("Targa::checkHeader() - Invalid pixel size '"+this.header.pixel_size+"'")},c.prototype.parse=function(a){var b,c,d,e;if(b=this.header,d=b.pixel_size>>3,e=b.width*b.height*d,this.use_pal&&(this.palettes=a.subarray(this.offset,this.offset+=b.colormap_length*d)),this.use_rle){c=new Uint8Array(e);for(var f,g,h,i=0,j=new Uint8Array(d);e>i;)if(f=a[this.offset++],g=(127&f)+1,128&f){for(h=0;d>h;++h)j[h]=a[this.offset++];for(h=0;g>h;++h)c.set(j,i+h*d);i+=d*g}else{for(g*=d,h=0;g>h;++h)c[i+h]=a[this.offset++];i+=g}}else c=a.subarray(this.offset,this.offset+=this.use_pal?b.width*b.height:e);this.image=c},c.prototype.getImageData=function(a){var b,d,e,f,g,h,i,j,k=this.header.width,l=this.header.height;switch(j=a||{width:k,height:l,data:new Uint8Array(k*l*4)},(this.header.flags&c.ORIGIN_MASK)>>c.ORIGIN_SHIFT){default:case c.ORIGIN_UL:b=0,e=1,h=k,d=0,f=1,g=l;break;case c.ORIGIN_BL:b=0,e=1,h=k,d=l-1,f=-1,g=-1;break;case c.ORIGIN_UR:b=k-1,e=-1,h=-1,d=0,f=1,g=l;break;case c.ORIGIN_BR:b=k-1,e=-1,h=-1,d=l-1,f=-1,g=-1}return i="getImageData"+(this.use_grey?"Grey":"")+this.header.pixel_size+"bits",this[i](j.data,d,f,g,b,e,h),j},c.prototype.getCanvas=function(){var a=document.createElement("canvas"),b=a.getContext("2d"),c=b.createImageData(this.header.width,this.header.height);return a.width=this.header.width,a.height=this.header.height,b.putImageData(this.getImageData(c),0,0),a},c.prototype.getDataURL=function(a){return this.getCanvas().toDataURL(a||"image/png")},c.prototype.getImageData8bits=function(a,b,c,d,e,f,g){var h,i,j,k=this.image,l=this.palettes,m=this.header.width,n=0;for(j=b;j!==d;j+=c)for(i=e;i!==g;i+=f,n++)h=k[n],a[4*(i+m*j)+3]=255,a[4*(i+m*j)+2]=l[3*h+0],a[4*(i+m*j)+1]=l[3*h+1],a[4*(i+m*j)+0]=l[3*h+2];return a},c.prototype.getImageData16bits=function(a,b,c,d,e,f,g){var h,i,j,k=this.image,l=this.header.width,m=0;for(j=b;j!==d;j+=c)for(i=e;i!==g;i+=f,m+=2)h=k[m+0]+(k[m+1]<<8),a[4*(i+l*j)+0]=(31744&h)>>7,a[4*(i+l*j)+1]=(992&h)>>2,a[4*(i+l*j)+2]=(31&h)>>3,a[4*(i+l*j)+3]=32768&h?0:255;return a},c.prototype.getImageData24bits=function(a,b,c,d,e,f,g){var h,i,j=this.image,k=this.header.width,l=0;for(i=b;i!==d;i+=c)for(h=e;h!==g;h+=f,l+=3)a[4*(h+k*i)+3]=255,a[4*(h+k*i)+2]=j[l+0],a[4*(h+k*i)+1]=j[l+1],a[4*(h+k*i)+0]=j[l+2];return a},c.prototype.getImageData32bits=function(a,b,c,d,e,f,g){var h,i,j=this.image,k=this.header.width,l=0;for(i=b;i!==d;i+=c)for(h=e;h!==g;h+=f,l+=4)a[4*(h+k*i)+2]=j[l+0],a[4*(h+k*i)+1]=j[l+1],a[4*(h+k*i)+0]=j[l+2],a[4*(h+k*i)+3]=j[l+3];return a},c.prototype.getImageDataGrey8bits=function(a,b,c,d,e,f,g){var h,i,j,k=this.image,l=this.header.width,m=0;for(j=b;j!==d;j+=c)for(i=e;i!==g;i+=f,m++)h=k[m],a[4*(i+l*j)+0]=h,a[4*(i+l*j)+1]=h,a[4*(i+l*j)+2]=h,a[4*(i+l*j)+3]=255;return a},c.prototype.getImageDataGrey16bits=function(a,b,c,d,e,f,g){var h,i,j=this.image,k=this.header.width,l=0;for(i=b;i!==d;i+=c)for(h=e;h!==g;h+=f,l+=2)a[4*(h+k*i)+0]=j[l+0],a[4*(h+k*i)+1]=j[l+0],a[4*(h+k*i)+2]=j[l+0],a[4*(h+k*i)+3]=j[l+1];return a},c.prototype.isSupported=function(){return!0},c.prototype.toString=function(){return"TgaLoader"},a.exports=c},function(a,b,c){function d(){}var e=c(54),f=c(6);d.loadCanvasFromPath=function(a,b){var c={};3===arguments.length&&(c=arguments[1],b=arguments[2]);var d=new Image;d.onerror=function(){console.error("Failed to load svg!"),b()},d.src=a;var e=document.createElement("canvas"),g=e.getContext("2d");d.onload=function(){if(0===d.width&&0===d.height)return b();if(f.defaults(c,{width:d.width,height:d.height,sourceX:0,sourceY:0,sourceWidth:d.width,sourceHeight:d.height,destX:0,destY:0}),f.defaults(c,{destWidth:c.width,destHeight:c.height}),c.resizeToFit){var a=c.sourceWidth/c.sourceHeight;a>1?(c.destHeight=c.destWidth/a,c.destY=.5*(c.height-c.destHeight)):1>a&&(c.destWidth=c.destHeight*a,c.destX=.5*(c.width-c.destWidth))}e.width=c.width,e.height=c.height,g.drawImage(d,c.sourceX,c.sourceY,c.sourceWidth,c.sourceHeight,c.destX,c.destY,c.destWidth,c.destHeight),b(e)}},d.renderSvgToCanvas=function(a,b,c){var e="data:image/svg+xml;base64,"+btoa(a);d.loadCanvasFromPath(e,b,c)},d.getMatrixFromCanvas=function(a){for(var b=a.getContext("2d"),c=function(c,d){return 0>c||c>a.width||0>d||d>a.height?0:b.getImageData(c,d,1,1).data[0]/255},d=[],e=0;e<a.width;e++){d.push([]);for(var f=0;f<a.height;f++)d[e].push(c(e,a.height-(f+1)))}return d},d.svgDataToImage=function(a){var b=window.URL||window.webkitURL||window,c=new Blob([a],{type:"image/svg+xml;charset=utf-8"}),d=new Image;return d.src=b.createObjectURL(c),e.createPromise(function(a,b){d.onload=function(){a(d)},d.onerror=function(){b("Could not load SVG image.")}})},a.exports=d},function(a,b,c){function d(a,b){a&&(this._rootPath=a,"/"!==a.slice(-1)&&(this._rootPath+="/")),this.options=b||{},this._cache={}}function e(a,b){for(var c=0;c<b.length;c++)a[b[c]]=!0;return a}var f=c(126),g=c(54),h=c(6),i=c(36),j=c(55);d.prototype.prefill=function(a,b){b?this._cache=a:h.extend(this._cache,a)},d.prototype.clear=function(){this._cache={}},d.prototype.get=function(a){a=a||{};var b=a.url||"",c="GET",d=new XMLHttpRequest;return d.open(c,b,!0),a.responseType&&(d.responseType=a.responseType),g.createPromise(function(a,b){var c=function(){4===d.readyState&&(d.status>=200&&d.status<=299?(d.removeEventListener("readystatechange",c),a(d)):(d.removeEventListener("readystatechange",c),b(d.statusText)))};d.addEventListener("readystatechange",c),d.send()})},d.ARRAY_BUFFER="arraybuffer",d.crossOrigin=!1;var k={mp4:"video/mp4",ogv:"video/ogg",webm:"video/webm"};d.prototype.load=function(a,b){function c(a,b){return a&&d.types[b]&&d.types[b][a]}var e=this,f=i.parseURL(a).path,h=f.substr(f.lastIndexOf(".")+1).toLowerCase();if(a||g.reject("Path was undefined"),0===a.indexOf(d.ENGINE_SHADER_PREFIX))return g.resolve();if(this._cache[a]&&!b)return c(h,"bundle")&&this.prefill(this._cache[a],b),this._cache[a]instanceof j.Promise?this._cache[a]:g.resolve(this._cache[a]);var l=this._rootPath?this._rootPath+a:a;if(c(h,"image"))return this._cache[a]=this._loadImage(l),this._cache[a];if(c(h,"video"))return this._cache[a]=this._loadVideo(l,k[h]),this._cache[a];if(c(h,"audio"))return this._cache[a]=this._loadAudio(l),this._cache[a];var m={url:l};return c(h,"binary")&&(m.responseType=d.ARRAY_BUFFER),this._cache[a]=this.get(m).then(function(a){if(c(h,"bundle")){var d=JSON.parse(a.response);return e.prefill(d,b),d}return c(h,"json")?JSON.parse(a.response):a.response}).then(null,function(b){throw new Error("Could not load data from "+a+", "+b)})},d.prototype.update=function(a,b){return this._cache[a]=b,g.resolve(b)},d.prototype._loadImage=function(a){window.URL=window.URL||window.webkitURL;var b=new Image;return d.crossOrigin&&(b.crossOrigin="anonymous"),g.createPromise(function(c,d){var e=function(){b.dataReady=!0,window.URL&&void 0!==window.URL.revokeObjectURL&&window.URL.revokeObjectURL(b.src),b.removeEventListener("load",e),b.removeEventListener("error",f),c(b)},f=function(c){b.removeEventListener("load",e),b.removeEventListener("error",f),d("Could not load image from "+a+", "+c)};b.addEventListener("load",e,!1),b.addEventListener("error",f,!1),b.src=a})},d.prototype._loadVideo=function(a,b){var c=1e3,e=document.createElement("video"),f=/(iPad|iPhone|iPod)/g.test(navigator.userAgent);d.crossOrigin&&(e.crossOrigin="anonymous");var h=g.createPromise(function(b,d){var g,h=function(){e.dataReady||console.warn("Video is not ready"),e.removeEventListener("canplay",i),e.removeEventListener("loadstart",j),clearTimeout(g),b(e)},i=function(){e.dataReady=!0,h()},j=function(){f?h():g=setTimeout(h,c)};e.addEventListener("canplay",i,!1),e.addEventListener("loadstart",j,!1),e.addEventListener("error",function(b){d("Could not load video from "+a+", "+b)},!1)}),i={url:a,responseType:d.ARRAY_BUFFER};return this.get(i).then(function(a){var c=new Blob([a.response],{type:b}),d=window.URL.createObjectURL(c);e.src=d}),h},d.prototype._loadAudio=function(a){var b={url:a,responseType:d.ARRAY_BUFFER};return this.get(b).then(function(a){return a.response}).then(null,function(b){throw new Error("Could not load data from "+a+", "+b)})},d.ENGINE_SHADER_PREFIX="GOO_ENGINE_SHADERS/",d.types={text:{vert:!0,frag:!0},json:{shader:!0,script:!0,entity:!0,material:!0,scene:!0,mesh:!0,texture:!0,skeleton:!0,animation:!0,clip:!0,bundle:!0,project:!0,machine:!0,posteffects:!0,animstate:!0,sound:!0,environment:!0,skybox:!0},image:{jpg:!0,jpeg:!0,png:!0,gif:!0},video:{mp4:!0,ogv:!0,webm:!0},binary:e({dat:!0,bin:!0},Object.keys(f.loaders)),audio:{mp3:!0,wav:!0,ogg:!0},bundle:{bundle:!0}},d.types.asset=e({},Object.keys(d.types.image).concat(Object.keys(d.types.binary))),a.exports=d},function(a,b,c){function d(a,b,c){this.glTexture=null,this._glRenderBuffer=null,this._glFrameBuffer=null,this.width=Math.max(Math.floor(a),1),this.height=Math.max(Math.floor(b),1),f.copyOptions(this,c,{wrapS:"EdgeClamp",wrapT:"EdgeClamp",magFilter:"Bilinear",minFilter:"BilinearNoMipMaps",anisotropy:1,format:"RGBA",type:"UnsignedByte",generateMipmaps:!1,premultiplyAlpha:!1,unpackAlignment:1,flipY:!0,depthBuffer:!0,stencilBuffer:!0}),this.variant="2D",this.offset=new e(0,0),this.repeat=new e(1,1),this.textureRecord={}}var e=c(19),f=c(99);d.prototype.clone=function(){var a=new d(this.width,this.height);return a.wrapS=this.wrapS,a.wrapT=this.wrapT,a.magFilter=this.magFilter,a.minFilter=this.minFilter,a.anisotropy=this.anisotropy,a.format=this.format,a.type=this.type,a.variant=this.variant,a.offset.copy(this.offset),a.repeat.copy(this.repeat),a.generateMipmaps=this.generateMipmaps,a.premultiplyAlpha=this.premultiplyAlpha,a.unpackAlignment=this.unpackAlignment,a.flipY=this.flipY,a.depthBuffer=this.depthBuffer,a.stencilBuffer=this.stencilBuffer,a},d.prototype.getSizeInMemory=function(){var a=this.width*this.height*4;return this.generateMipmaps&&(a=Math.ceil(4*a/3)),a},d.prototype.destroy=function(a){this.glTexture&&(a.deleteTexture(this.glTexture),this.glTexture=null),this._glRenderBuffer&&(a.deleteRenderbuffer(this._glRenderBuffer),this._glRenderBuffer=null),this._glFrameBuffer&&(a.deleteFramebuffer(this._glFrameBuffer),this._glFrameBuffer=null)},a.exports=d},function(a,b,c){function d(){this.depthMaterial=new i(j.lightDepth,"depthMaterial"),this.depthMaterial.cullState.cullFace="Back",this.depthMaterial.fullOverride=!0,this.fullscreenPass=new g,this.downsample=i.createShader(j.downsample,"downsample");var a=2;this.blurfilter=i.createShader(j.convolution,"blurfilter");var b=2*Math.ceil(3*a)+1;this.blurfilter.defines={KERNEL_SIZE_FLOAT:b.toFixed(1),KERNEL_SIZE_INT:b.toFixed(0)},this.blurfilter.uniforms.cKernel=j.convolution.buildKernel(a),this.oldClearColor=new l(0,0,0,0),this.shadowClearColor=new l(1,1,1,1),this.renderList=[],this.shadowList=[],this.first=!0}var e=c(17),f=c(8),g=c(135),h=c(120),i=c(30),j=c(46),k=c(133),l=c(11),m=c(49),n=c(52),o=new f;d.prototype._createShadowData=function(a,b){var c=a.resolution[0],d=a.resolution[1],f=!!e.TextureFloatLinear;if(a.shadowData.shadowTarget&&b._deallocateRenderTarget(a.shadowData.shadowTarget),"VSM"===a.shadowType){var g=e.TextureHalfFloat?"HalfFloat":"Float",h={type:g};f||(h.magFilter="NearestNeighbor",h.minFilter="NearestNeighborNoMipMaps"),a.shadowData.shadowTargetDown&&b._deallocateRenderTarget(a.shadowData.shadowTargetDown),a.shadowData.shadowTargetDown=new k(c/2,d/2,h),a.shadowData.shadowBlurred&&b._deallocateRenderTarget(a.shadowData.shadowBlurred),a.shadowData.shadowBlurred=new k(c/2,d/2,h),a.shadowData.shadowTarget=new k(c,d,{type:g,magFilter:"NearestNeighbor",minFilter:"NearestNeighborNoMipMaps"})}else a.shadowData.shadowTarget=new k(c,d,{magFilter:"NearestNeighbor",minFilter:"NearestNeighborNoMipMaps"});a.shadowData.shadowResult=null,a.shadowRecord.resolution=a.shadowRecord.resolution||[],a.shadowRecord.resolution[0]=c,a.shadowRecord.shadowType=a.shadowType},d.prototype.checkShadowRendering=function(a,b,c,d){if(this.first===!0)return void(this.first=!1);for(var e=0;e<d.length;e++){var g=d[e];if(g.shadowCaster||g.lightCookie){var i=g.shadowSettings;i.shadowData||(i.shadowData={},i.shadowRecord={},i.shadowData.lightCamera=new h(55,1,1,1e3));var j=i.shadowRecord,k=i.shadowData.lightCamera;if(k.translation.copy(g.translation),g.direction?(o.set(g.translation).add(g.direction),k.lookAt(o,i.upVector)):k.lookAt(f.ZERO,i.upVector),!i.shadowData.shadowTarget||j.angle!==g.angle||!j.resolution||j.resolution[0]!==i.resolution[0]||j.resolution[1]!==i.resolution[1]||j.near!==i.near||j.far!==i.far||j.size!==i.size){if(j.resolution&&j.resolution[0]===i.resolution[0]&&j.resolution[1]===i.resolution[1]||this._createShadowData(i,a),g instanceof n)k.setFrustumPerspective(g.angle,i.resolution[0]/i.resolution[1],i.near,i.far);else if(g instanceof m)k.setFrustumPerspective(90,i.resolution[0]/i.resolution[1],i.near,i.far);else{var l=i.size;k.setFrustum(i.near,i.far,-l,l,l,-l),k.projectionMode=h.Parallel}k.update(),j.resolution=j.resolution||[],j.resolution[0]=i.resolution[0],j.resolution[1]=i.resolution[1],j.angle=g.angle,j.near=i.near,j.far=i.far,j.size=i.size}"VSM"===i.shadowType&&j.shadowType!==i.shadowType&&(this._createShadowData(i,a),j.shadowType=i.shadowType),k.onFrameChange();for(var p=k.getViewProjectionMatrix().data,q=i.shadowData.vpm=i.shadowData.vpm||[],r=0;16>r;r++)q[r]=p[r];if(g.shadowCaster){this.depthMaterial.shader.setDefine("SHADOW_TYPE","VSM"===i.shadowType?2:0),this.depthMaterial.uniforms.cameraScale=1/(k.far-k.near),i.shadowData.cameraScale=this.depthMaterial.uniforms.cameraScale,this.oldClearColor.copy(a.clearColor),a.setClearColor(this.shadowClearColor.r,this.shadowClearColor.g,this.shadowClearColor.b,this.shadowClearColor.a),this.shadowList.length=0;for(var r=0;r<c.length;r++){var s=c[r];s.meshRendererComponent&&s.meshRendererComponent.castShadows&&!s.isSkybox&&this.shadowList.push(s)}switch(b.process(k,this.shadowList,this.renderList),a.render(this.renderList,k,[],i.shadowData.shadowTarget,!0,this.depthMaterial),i.shadowType){case"VSM":this.fullscreenPass.material.shader=this.downsample,this.fullscreenPass.render(a,i.shadowData.shadowTargetDown,i.shadowData.shadowTarget),this.fullscreenPass.material.shader=this.blurfilter,this.fullscreenPass.material.uniforms.uImageIncrement=[2/i.resolution[0],0],this.fullscreenPass.render(a,i.shadowData.shadowBlurred,i.shadowData.shadowTargetDown),this.fullscreenPass.material.uniforms.uImageIncrement=[0,2/i.resolution[1]],this.fullscreenPass.render(a,i.shadowData.shadowTargetDown,i.shadowData.shadowBlurred),i.shadowData.shadowResult=i.shadowData.shadowTargetDown;break;case"PCF":i.shadowData.shadowResult=i.shadowData.shadowTarget;break;case"Basic":i.shadowData.shadowResult=i.shadowData.shadowTarget;break;default:i.shadowData.shadowResult=i.shadowData.shadowTarget}a.setClearColor(this.oldClearColor.r,this.oldClearColor.g,this.oldClearColor.b,this.oldClearColor.a)}}}},d.prototype.invalidateHandles=function(a){this.fullscreenPass.invalidateHandles(a),a.invalidateMaterial(this.depthMaterial),a.invalidateShader(this.downsample),a.invalidateShader(this.blurfilter)},a.exports=d},function(a,b,c){function d(a){this.material=new e(a||g.simple),this.useReadBuffer=!0,this.renderToScreen=!1,this.renderable={meshData:f.quad,materials:[this.material]},this.enabled=!0,this.clear=!1,this.needsSwap=!0,this.viewportSize=void 0}var e=c(30),f=c(136),g=c(46),h=c(137);d.prototype=Object.create(h.prototype),d.prototype.constructor=d,d.prototype.render=function(a,b,c){this.useReadBuffer&&this.material.setTexture("DIFFUSE_MAP",c),this.renderToScreen?a.render(this.renderable,f.camera,[],null,this.clear):a.render(this.renderable,f.camera,[],b,this.clear)},d.prototype.destroy=function(){this.material.shader.destroy()},d.prototype.invalidateHandles=function(a){a.invalidateMaterial(this.renderable.materials[0]),a.invalidateMeshData(this.renderable.meshData)},a.exports=d},function(a,b,c){function d(){}var e=c(28),f=c(120),g=c(8),h=new f;h.projectionMode=f.Parallel,h.setFrustum(0,1,-1,1,1,-1),h._left.copy(g.UNIT_X).negate(),h._up.copy(g.UNIT_Y),h._direction.copy(g.UNIT_Z),h.onFrameChange(),d.camera=h,d.quad=new e(2,2),a.exports=d},function(a,b){function c(){}c.prototype.destroy=function(){},c.prototype.render=function(){},c.prototype.updateSize=function(){},c.prototype.invalidateHandles=function(){},a.exports=c},function(a,b){function c(){this.reset()}c.prototype.reset=function(){this.calls=0,this.vertices=0,this.indices=0},c.prototype.toString=function(){return"Calls: "+this.calls+"<br/>Vertices: "+this.vertices+"<br/>Indices: "+this.indices},a.exports=c},function(a,b,c){function d(){}var e=c(54),f="undefined"!=typeof window?window.performance:{};f.now=f.now||f.mozNow||f.msNow||f.oNow||f.webkitNow||function(){return Date.now()},d.maxTimePerFrame=50,d.each=function(a){return e.createPromise(function(b){function c(){for(var g=f.now();e<a.length&&f.now()-g<d.maxTimePerFrame;)a[e](),e++;e<a.length?setTimeout(c,4):b()}var e=0;c()})},a.exports=d},function(a,b,c){function d(){this.reset()}var e=c(35),f=c(41);d.prototype.reset=function(){this.renderable=null,this.lights=null,this.materials=null,this.meshData=null,this.camera=null,this.mainCamera=null,this.lights=null,this.shadowHandler=null,this.renderer=null,this.material=null,this.transform=null,this.currentPose=null},d.prototype.fill=function(a){a instanceof e?(this.meshData=a.meshDataComponent.meshData,this.materials=a.meshRendererComponent.materials,this.transform=a.particleComponent?f.IDENTITY:a.transformComponent.sync().worldTransform,a.meshDataComponent.currentPose?this.currentPose=a.meshDataComponent.currentPose:this.currentPose=null):(this.meshData=a.meshData,this.materials=a.materials,this.transform=a.transform,a.currentPose?this.currentPose=a.currentPose:this.currentPose=null),this.renderable=a},a.exports=d},,,,,,,,,,,,,,,,,,,,,,,,,function(a,b,c){function d(){}var e=c(122),f=new e;d.pick=function(a,b,c,e){var f=a.entityManager.getEntities();return d.pickFromList(a,f,b,c,e)},d.pickFromList=function(a,b,c,d,e){var g=a.gooRunner.renderer;c.getPickRay(d,e,g.domElement.offsetWidth,g.domElement.offsetHeight,f);for(var h=[],i=0;i<b.length;i++){var j=b[i],k=j.meshRendererComponent;if(k&&k.isPickable){var l=k.worldBound.intersectsRayWhere(f);l&&l.distances.length&&h.push({entity:j,intersection:l})}}return h.sort(function(a,b){return a.intersection.distances[0]-b.intersection.distances[0]}),h},a.exports=d},,,,,,,,function(a,b){var c={Linear:{None:function(a){return a},In:function(a){return a},Out:function(a){return a},InOut:function(a){return a}},Quadratic:{In:function(a){return a*a},Out:function(a){return a*(2-a)},InOut:function(a){return(a*=2)<1?.5*a*a:-.5*(--a*(a-2)-1)}},Cubic:{In:function(a){return a*a*a},Out:function(a){return--a*a*a+1},InOut:function(a){return(a*=2)<1?.5*a*a*a:.5*((a-=2)*a*a+2)}},Quartic:{In:function(a){return a*a*a*a},Out:function(a){return 1- --a*a*a*a},InOut:function(a){return(a*=2)<1?.5*a*a*a*a:-.5*((a-=2)*a*a*a-2)}},Quintic:{In:function(a){return a*a*a*a*a},Out:function(a){return--a*a*a*a*a+1},InOut:function(a){return(a*=2)<1?.5*a*a*a*a*a:.5*((a-=2)*a*a*a*a+2)}},Sinusoidal:{In:function(a){return 1-Math.cos(a*Math.PI/2)},Out:function(a){return Math.sin(a*Math.PI/2)},InOut:function(a){return.5*(1-Math.cos(Math.PI*a))}},Exponential:{In:function(a){return 0===a?0:Math.pow(1024,a-1)},Out:function(a){return 1===a?1:1-Math.pow(2,-10*a)},InOut:function(a){return 0===a?0:1===a?1:(a*=2)<1?.5*Math.pow(1024,a-1):.5*(-Math.pow(2,-10*(a-1))+2)}},Circular:{In:function(a){return 1-Math.sqrt(1-a*a)},Out:function(a){return Math.sqrt(1- --a*a)},InOut:function(a){return(a*=2)<1?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)}},Elastic:{In:function(a){var b,c=.1,d=.4;return 0===a?0:1===a?1:(!c||1>c?(c=1,b=d/4):b=d*Math.asin(1/c)/(2*Math.PI),-(c*Math.pow(2,10*(a-=1))*Math.sin((a-b)*(2*Math.PI)/d)))},Out:function(a){var b,c=.1,d=.4;return 0===a?0:1===a?1:(!c||1>c?(c=1,b=d/4):b=d*Math.asin(1/c)/(2*Math.PI),c*Math.pow(2,-10*a)*Math.sin((a-b)*(2*Math.PI)/d)+1)},InOut:function(a){var b,c=.1,d=.4;return 0===a?0:1===a?1:(!c||1>c?(c=1,b=d/4):b=d*Math.asin(1/c)/(2*Math.PI),(a*=2)<1?-.5*(c*Math.pow(2,10*(a-=1))*Math.sin((a-b)*(2*Math.PI)/d)):c*Math.pow(2,-10*(a-=1))*Math.sin((a-b)*(2*Math.PI)/d)*.5+1)}},Back:{In:function(a){var b=1.70158;return a*a*((b+1)*a-b)},Out:function(a){var b=1.70158;return--a*a*((b+1)*a+b)+1},InOut:function(a){var b=2.5949095;return(a*=2)<1?.5*(a*a*((b+1)*a-b)):.5*((a-=2)*a*((b+1)*a+b)+2)}},Bounce:{In:function(a){return 1-c.Bounce.Out(1-a)},Out:function(a){return 1/2.75>a?7.5625*a*a:2/2.75>a?7.5625*(a-=1.5/2.75)*a+.75:2.5/2.75>a?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},InOut:function(a){return.5>a?.5*c.Bounce.In(2*a):.5*c.Bounce.Out(2*a-1)+.5}}};a.exports=c},,,,,,,,,,,,,,,,,,,,,function(a,b,c){function d(a){e.apply(this,arguments),this.type="LightComponent",this.light=a,this.hidden=!1,this._transformDirty=!0,this._transformUpdatedListener=null}var e=c(20),f=c(50);d.type="LightComponent",d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.attached=function(){var a=this;this.entity.on("transformUpdated",this._transformUpdatedListener=function(){a._transformDirty=!0})},d.prototype.detached=function(){this.entity.off("transformUpdated",this._transformUpdatedListener),this._transformUpdatedListener=null},d.prototype.updateLight=function(a){this.light.update(a)},d.prototype.copy=function(a){return this.light.copy(a),this.hidden=a.hidden,this},d.prototype.clone=function(){var a=new d(this.light.clone());return a.hidden=this.hidden,a},d.applyOnEntity=function(a,b){if(a instanceof f){var c=new d(a);return b.setComponent(c),!0}},a.exports=d},,,,,,,,,,,,,,,function(a,b){function c(){}c.getSmoke=function(a){return a=a||{},a.scale="undefined"!=typeof a.scale?a.scale:1,a.spread="undefined"!=typeof a.spread?a.spread:2,a.rate="undefined"!=typeof a.spread?a.rate:25,a.velocity="undefined"!=typeof a.velocity?a.velocity:function(b){var c=b.velocity;return c.x=2*(Math.random()-.5)*a.spread*a.scale,c.y=2*(Math.random()+4)*a.scale,c.z=2*(Math.random()-.5)*a.spread*a.scale,c},a.color=a.color||[0,0,0],{totalParticlesToSpawn:-1,releaseRatePerSecond:a.rate,minLifetime:.5,maxLifetime:4,getEmissionVelocity:a.velocity,timeline:[{timeOffset:0,spin:0,mass:1,size:3*a.scale,color:[a.color[0],a.color[1],a.color[2],1]},{timeOffset:1,size:6*a.scale,color:[a.color[0],a.color[1],a.color[2],0]}]}},c.getFire=function(a){return a=a||{},a.scale="undefined"!=typeof a.scale?a.scale:1,a.spread="undefined"!=typeof a.spread?a.spread:2,a.velocity="undefined"!=typeof a.velocity?a.velocity:10,a.startColor=a.startColor||[1,1,0],a.endColor=a.endColor||[1,0,0],{totalParticlesToSpawn:-1,releaseRatePerSecond:30,minLifetime:.5,maxLifetime:2,getEmissionVelocity:function(b){var c=b.velocity;return c.x=2*(Math.random()-.5)*a.spread*a.scale,c.y=(Math.random()+1)*a.velocity*a.scale,c.z=2*(Math.random()-.5)*a.spread*a.scale,c},timeline:[{timeOffset:0,spin:0,mass:1,size:2*a.scale,color:[a.startColor[0],a.startColor[1],a.startColor[2],0]},{timeOffset:.05,color:[a.startColor[0],a.startColor[1],a.startColor[2],1]},{timeOffset:.45,color:[a.endColor[0],a.endColor[1],a.endColor[2],.8]},{timeOffset:.5,size:3*a.scale,color:[0,0,0,0]}]}},c.getSnow=function(a){return a=a||{},a.scale="undefined"!=typeof a.scale?a.scale:2,a.spread="undefined"!=typeof a.spread?a.spread:50,a.velocity="undefined"!=typeof a.velocity?a.velocity:3,a.color=a.color||[1,1,1],{particleCount:1e3,totalParticlesToSpawn:-1,releaseRatePerSecond:50,minLifetime:15,maxLifetime:25,getEmissionPoint:function(b){var c=b.position;return a.getEmissionPoint(c),c},getEmissionVelocity:function(b){var c=b.velocity;return a.getEmissionVelocity(c),c},timeline:[{timeOffset:0,spin:0,mass:1,size:1*a.scale,color:[a.color[0],a.color[1],a.color[2],0]},{timeOffset:.05,color:[a.color[0],a.color[1],a.color[2],1]},{timeOffset:.7,color:[a.color[0],a.color[1],a.color[2],.8]},{timeOffset:.25,spin:5,size:.5*a.scale,color:[a.color[0],a.color[1],a.color[2],0]}]}},a.exports=c},function(a,b,c){function d(){}var e=c(211),f=c(215),g=c(216),h=c(53),i=c(214);d.createParticleSystemEntity=function(a,b,c){var d=a.createEntity(),h=new e({particleCount:b.particleCount||500});h.emitters.push(new i(b)),d.setComponent(h);var j=new g(h.meshData);d.setComponent(j);var k=new f;return k.materials.push(c),k.cullMode="Never",d.setComponent(k),d},d.createFlareTexture=function(a,b){a=a||64,b=b||{},b.startRadius="undefined"!=typeof b.startRadius?b.startRadius:0,b.endRadius="undefined"!=typeof b.endRadius?b.endRadius:a/2,b.steps=b.steps||[{fraction:0,value:1},{fraction:1,value:0}];var c=document.createElement("canvas");c.width=a,c.height=a;for(var d=c.getContext("2d"),e=d.createRadialGradient(a/2,a/2,b.startRadius,a/2,a/2,b.endRadius),f=0;f<b.steps.length;f++){var g=b.steps[f];e.addColorStop(g.fraction,"rgba(255, 255, 255, "+g.value+")")}d.fillStyle=e,d.fillRect(0,0,a,a);var i=d.getImageData(0,0,a,a).data;i=new Uint8Array(i);var j=new h(i,null,a,a);return j},d.createSplashTexture=function(a,b){function c(a,b,c){var d=g.createRadialGradient(a,b,0,a,b,c);d.addColorStop(0,"rgba(255, 255, 255, 0.5)"),d.addColorStop(1,"rgba(255, 255, 255, 0)"),g.fillStyle=d,g.fillRect(a-c,b-c,2*c,2*c)}function d(a,b,d,e,f,g){for(var h=(d-a)/i,j=(e-b)/i,k=(g-f)/i,l=0,m=a,n=b,o=f;i>l;l++,m+=h,n+=j,o+=k)c(m,n,o)}function e(a,b,c,e,f,g,h){for(var i=0;h>i;i++){var j=Math.random()*Math.PI*2,k=4*Math.random()+c,l=4*Math.random()-e;d(a+Math.cos(j)*k,b+Math.sin(j)*k,a+Math.cos(j)*l,b+Math.sin(j)*l,f,g)}}a=a||64,b=b||{},b.nTrails="undefined"!=typeof b.nTrails?b.nTrails:8,b.trailStartRadius="undefined"!=typeof b.trailStartRadius?b.trailStartRadius:1,b.trailEndRadius="undefined"!=typeof b.trailEndRadius?b.trailEndRadius:4;var f=document.createElement("canvas");f.width=a,f.height=a;var g=f.getContext("2d"),i=30;e(a/2,a/2,a/2/10*1,a/2/10*9,b.trailStartRadius,b.trailEndRadius,b.nTrails);var j=g.getImageData(0,0,a,a).data;j=new Uint8Array(j);var k=new h(j,null,a,a);return k},d.createPlanktonTexture=function(a,b){function c(a,b,c){var d=f.createRadialGradient(a,b,0,a,b,c);d.addColorStop(0,"rgba(255, 255, 255, 1)"),d.addColorStop(.3,"rgba(255, 255, 255, 1)"),d.addColorStop(1,"rgba(255, 255, 255, 0)"),f.fillStyle=d,f.fillRect(a-c,b-c,2*c,2*c)}function d(d){for(var e=0;d>e;e++){var f=Math.random()*(a-2*b.maxRadius)+b.maxRadius,g=Math.random()*(a-2*b.maxRadius)+b.maxRadius;c(f,g,Math.random()*(b.maxRadius-b.minRadius)+b.minRadius)}}a=a||64,b=b||{},b.nPoints="undefined"!=typeof b.nPoints?b.nPoints:10,b.minRadius="undefined"!=typeof b.minRadius?b.minRadius:2,b.maxRadius="undefined"!=typeof b.maxRadius?b.maxRadius:5;var e=document.createElement("canvas");e.width=a,e.height=a;var f=e.getContext("2d");d(b.nPoints);var g=f.getImageData(0,0,a,a).data;g=new Uint8Array(g);var i=new h(g,null,a,a);return i},d.createSnowflakeTexture=function(a,b){function c(a,b){for(var c=2*Math.PI/a,d=0;a>d;d++)f.rotate(c),b()}function d(){f.beginPath(),f.moveTo(0,0),f.lineTo(0,90);for(var a=0;6>a;a++)f.moveTo(0,25+10*a),f.lineTo(16-1.5*a,35+10*a),f.moveTo(0,25+10*a),f.lineTo(-(16-1.5*a),35+10*a);f.stroke()}a=a||64,b=b||{};var e=document.createElement("canvas");e.width=a,e.height=a;var f=e.getContext("2d");f.strokeStyle="#FFF",f.lineWidth=4,f.lineCap="round",f.translate(a/2,a/2),f.scale(a/100/2,a/100/2),c(7,d);var g=f.getImageData(0,0,a,a).data;g=new Uint8Array(g);var i=new h(g,null,a,a);return i},a.exports=d},function(a,b,c){function d(a){if(e.apply(this,arguments),this.type="ParticleComponent",e.call(this),a=a||{},this.emitters=[],a.emitters)for(var b=0,c=a.emitters.length;c>b;b++)this.emitters.push(new g(a.emitters[b]));this.timeline=a.timeline?a.timeline:[],this.uRange=isNaN(a.uRange)?1:a.uRange,this.vRange=isNaN(a.vRange)?1:a.vRange;var d=isNaN(a.particleCount)?100:a.particleCount;this.recreateParticles(d),this.enabled=!0}var e=c(20),f=c(212),g=c(214),h=c(14);d.type="ParticleComponent",d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.generateMeshData=function(){var a=h.defaultMap([h.POSITION,h.COLOR,h.TEXCOORD0]);this.meshData=new h(a,4*this.particleCount,6*this.particleCount),this.meshData.vertexData.setDataUsage("DynamicDraw");for(var b=this.meshData.getAttributeBuffer(h.TEXCOORD0),c=this.meshData.getIndexBuffer(),d=0,e=this.particleCount;e>d;d++)b.set([1,0],8*d+0),b.set([1,1],8*d+2),b.set([0,1],8*d+4),b.set([0,0],8*d+6),c.set([4*d+0,4*d+3,4*d+1,4*d+1,4*d+3,4*d+2],6*d)},d.prototype.recreateParticles=function(a){this.particleCount=a,this.particles=[];for(var b=0;b<this.particleCount;b++)this.particles[b]=new f(this,b);this.generateMeshData()},a.exports=d},function(a,b,c){function d(a,b){this.alive=!1,this.position=new f,this.velocity=new f,this.lifeSpan=0,this.parent=a,this.age=0,this.index=b,this.color=new g(1,0,0,1),this.size=0,this.spin=0,this.mass=1,this.emitter=null,this.uvIndex=0,this.lastUVIndex=-1,this.bbX=new f,this.bbY=new f,this.lastColor=new g}var e=c(213),f=c(8),g=c(11),h=c(14),i=new f;d.prototype.respawnParticle=function(a){this.emitter=a,this.lifeSpan=a.nextParticleLifeSpan(),this.alive=!0,this.age=0};var j=[];d.prototype.update=function(a,b){if(this.alive){if(this.age+=a,this.age>this.lifeSpan)return void this.kill();if(this.position.addDirect(this.velocity.x*a,this.velocity.y*a,this.velocity.z*a),e.applyTimeline(this,this.emitter&&this.emitter.timeline?this.emitter.timeline:this.parent.timeline),!this.lastColor.equals(this.color)){var c=this.parent.meshData.getAttributeBuffer(h.COLOR),d=16*this.index;c[d+0+0]=this.color.r,c[d+0+1]=this.color.g,c[d+0+2]=this.color.b,c[d+0+3]=this.color.a,c[d+4+0]=this.color.r,c[d+4+1]=this.color.g,c[d+4+2]=this.color.b,c[d+4+3]=this.color.a,c[d+8+0]=this.color.r,c[d+8+1]=this.color.g,c[d+8+2]=this.color.b,c[d+8+3]=this.color.a,c[d+12+0]=this.color.r,c[d+12+1]=this.color.g,
c[d+12+2]=this.color.b,c[d+12+3]=this.color.a,this.lastColor.set(this.color)}if(this.emitter&&this.emitter.getParticleBillboardVectors(this,b),0===this.spin)this.bbX.scale(this.size),this.bbY.scale(this.size);else{var f=Math.cos(this.spin)*this.size,g=Math.sin(this.spin)*this.size,k=this.bbY.x,l=this.bbY.y,m=this.bbY.z;this.bbY.set(this.bbX),this.bbX.scale(f).addDirect(k*g,l*g,m*g),this.bbY.scale(-g).addDirect(k*f,l*f,m*f)}var n=this.parent.meshData.getAttributeBuffer(h.POSITION),d=12*this.index;if(i.set(this.position).sub(this.bbX).sub(this.bbY),n[d+0+0]=i.x,n[d+0+1]=i.y,n[d+0+2]=i.z,i.set(this.position).sub(this.bbX).add(this.bbY),n[d+3+0]=i.x,n[d+3+1]=i.y,n[d+3+2]=i.z,i.set(this.position).add(this.bbX).add(this.bbY),n[d+6+0]=i.x,n[d+6+1]=i.y,n[d+6+2]=i.z,i.set(this.position).add(this.bbX).sub(this.bbY),n[d+9+0]=i.x,n[d+9+1]=i.y,n[d+9+2]=i.z,this.lastUVIndex!==this.uvIndex){var o=this.parent.meshData.getAttributeBuffer(h.TEXCOORD0),p=this.uvIndex%this.parent.uRange/this.parent.uRange,q=1-Math.floor(this.uvIndex/this.parent.vRange)/this.parent.vRange,r=1/this.parent.uRange,s=1/this.parent.vRange;j[0]=p+r,j[1]=q-s,o.set(j,8*this.index+0),j[0]=p+r,j[1]=q,o.set(j,8*this.index+2),j[0]=p,j[1]=q,o.set(j,8*this.index+4),j[0]=p,j[1]=q-s,o.set(j,8*this.index+6),this.lastUVIndex=this.uvIndex}}},d.prototype.kill=function(){this.alive=!1;var a=this.parent.meshData.getAttributeBuffer(h.POSITION),b=a.subarray(12*this.index,12*this.index+3);a.set(b,12*this.index+3),a.set(b,12*this.index+6),a.set(b,12*this.index+9)},a.exports=d},function(a,b,c){function d(){}var e=c(8);d.getRandomVelocityOffY=function(a,b,c,e,f){var g=b+Math.random()*(c-b),h=2*Math.PI*Math.random();return a.x=Math.cos(h)*Math.sin(g),a.y=Math.cos(g),a.z=Math.sin(h)*Math.sin(g),f&&d.applyEntityTransformVector(a,f),a.scale(e),a},d.randomPointInCube=function(a,b,c,d,e){return a.x=2*Math.random()*b-b+(e?e.x:0),a.y=2*Math.random()*c-c+(e?e.y:0),a.z=2*Math.random()*d-d+(e?e.z:0),a},d.createConstantForce=function(a){var b=new e(a);return{enabled:!0,prepare:function(){},apply:function(a,c){c.velocity.x+=b.x*a,c.velocity.y+=b.y*a,c.velocity.z+=b.z*a}}},d.applyEntityTransformPoint=function(a,b){return b.transformComponent&&b.transformComponent.worldTransform?b.transformComponent.sync().worldTransform.applyForward(a,a):a},d.applyEntityTransformVector=function(a,b){return b.transformComponent&&b.transformComponent.worldTransform?b.transformComponent.sync().worldTransform.applyForwardVector(a,a):a},d.applyTimeline=function(a,b){for(var c,d=a.age,e=a.lifeSpan,f=0,g=0,h=0,i=0,j=e,k=e,l=e,m=e,n=0,o=null,p=null,q=null,r=null,s=null,t=null,u=null,v=null,w=null,x=0,y=b.length;y>x;x++){var z=b[x];n+=(z.timeOffset?z.timeOffset:0)*e,null===t&&void 0!==z.color&&(n>d?(j=n,t=z):(f=n,o=z)),null===u&&void 0!==z.mass&&(n>d?(k=n,u=z):(g=n,p=z)),d>=n&&void 0!==z.uvIndex&&(s=z),null===v&&void 0!==z.size&&(n>d?(l=n,v=z):(h=n,q=z)),null===w&&void 0!==z.spin&&(n>d?(m=n,w=z):(i=n,r=z))}c=(d-f)/(j-f);var A=null!==o?o.color:[1,1,1,1],B=null!==t?t.color:A;a.color.x=(1-c)*A[0]+c*B[0],a.color.y=(1-c)*A[1]+c*B[1],a.color.z=(1-c)*A[2]+c*B[2],a.color.w=(1-c)*A[3]+c*B[3],c=(d-g)/(k-g);var A=null!==p?p.mass:1,B=null!==u?u.mass:A;a.mass=(1-c)*A+c*B,a.uvIndex=null!==s?s.uvIndex:0,c=(d-h)/(l-h);var A=null!==q?q.size:1,B=null!==v?v.size:A;a.size=(1-c)*A+c*B,c=(d-i)/(m-i);var A=null!==r?r.spin:0,B=null!==w?w.spin:A;a.spin=(1-c)*A+c*B},a.exports=d},function(a,b,c){function d(a){g.copyOptions(this,a,{totalParticlesToSpawn:-1,maxLifetime:3,minLifetime:2,timeline:void 0,influences:[],getEmissionPoint:function(a,b){var c=a.position;return c.setDirect(0,0,0),e.applyEntityTransformPoint(c,b)},getEmissionVelocity:function(a,b){var c=a.velocity;return c.setDirect(0,1,0),e.applyEntityTransformVector(c,b)},getParticleBillboardVectors:d.CAMERA_BILLBOARD_FUNC,releaseRatePerSecond:10,enabled:!0}),this.particlesWaitingToRelease=0}var e=c(213),f=c(123),g=c(99);d.CAMERA_BILLBOARD_FUNC=function(a){var b=f.mainCamera;b&&(a.bbX.set(b._left),a.bbY.set(b._up))},d.prototype.nextParticleLifeSpan=function(){return this.minLifetime+(this.maxLifetime-this.minLifetime)*Math.random()},a.exports=d},function(a,b,c){function d(a){e.apply(this,arguments),this.type="MeshRendererComponent",this.materials=Array.isArray(a)?a:a?[a]:[],this.worldBound=null,this._worldBoundDirty=!0,this._transformUpdatedListener=null,this.cullMode="Dynamic",this.castShadows=!0,this.receiveShadows=!0,this.isPickable=!0,this.isReflectable=!0,this.hidden=!1,this._renderDistance=0}var e=c(20),f=c(30);d.type="MeshRendererComponent",d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.api={setDiffuse:function(){var a=this.meshRendererComponent.materials[0];a.uniforms.materialDiffuse||(a.uniforms.materialDiffuse=[0,0,0,1]);var b=a.uniforms.materialDiffuse;if(arguments.length>=3)b[0]=arguments[0],b[1]=arguments[1],b[2]=arguments[2],b[3]=3===arguments.length?1:arguments[3];else{var c=arguments[0];c instanceof Array?(b[0]=c[0],b[1]=c[1],b[2]=c[2],b[3]=3===c.length?1:c[3]):void 0!==c.r&&void 0!==c.g&&void 0!==typeof c.b&&(b[0]=c.r,b[1]=c.g,b[2]=c.b,b[3]=void 0===c.a?1:c.a)}},getDiffuse:function(){return this.meshRendererComponent.materials[0].uniforms.materialDiffuse}},d.entitySelectionAPI={setDiffuse:d.prototype.api.setDiffuse},d.prototype.attached=function(){var a=this;this.entity.on("transformUpdated",this._transformUpdatedListener=function(){a._worldBoundDirty=!0})},d.prototype.detached=function(){this.entity.off("transformUpdated",this._transformUpdatedListener)},d.prototype.updateBounds=function(a,b){this.worldBound=a.transform(b,this.worldBound),this._worldBoundDirty=!1},d.prototype.clone=function(a){a=a||{};var b;b=a.shareMaterials?this.materials:this.materials.map(function(b){return b.clone(a)});var c=new d(b);return c.cullMode=this.cullMode,c.castShadows=this.castShadows,c.receiveShadows=this.receiveShadows,c.isPickable=this.isPickable,c.isReflectable=this.isReflectable,c},d.applyOnEntity=function(a,b){var c=b.meshRendererComponent;c||(c=new d);var e=!1;return a instanceof f&&(c.materials.push(a),e=!0),e?(b.setComponent(c),!0):void 0},a.exports=d},function(a,b,c){function d(a){f.apply(this,arguments),this.type="MeshDataComponent",this.meshData=a,this.modelBound=new e,this.autoCompute=!0,this.currentPose=null}var e=c(7),f=c(20),g=c(14);d.type="MeshDataComponent",d.prototype=Object.create(f.prototype),d.prototype.constructor=d,d.prototype.setModelBound=function(a,b){this.modelBound=a,this.autoCompute=b},d.prototype.computeBoundFromPoints=function(){if(this.autoCompute&&null!==this.modelBound&&this.meshData){var a=this.meshData.getAttributeBuffer("POSITION");void 0!==a&&(this.modelBound.computeFromPoints(a),this.autoCompute=!1)}},d.prototype.clone=function(a){a=a||{};var b=new d;return a.shareMeshData?(b.meshData=this.meshData,b.modelBound=this.modelBound):(b.meshData=this.meshData.clone(),b.modelBound=this.modelBound.clone()),b.autoCompute=this.autoCompute,b},d.applyOnEntity=function(a,b){if(a instanceof g){var c=new d(a);return b.setComponent(c),!0}},a.exports=d},,,,,function(a,b){function c(){}c.supported={fullscreen:!0,pointerLock:!0},c.requestFullScreen=function(){!document.fullscreenElement&&document.documentElement.requestFullScreen&&document.documentElement.requestFullScreen()},c.exitFullScreen=function(){document.fullscreenElement&&document.cancelFullScreen&&document.cancelFullScreen()},c.toggleFullScreen=function(){document.fullscreenElement?document.cancelFullScreen&&document.cancelFullScreen():document.documentElement.requestFullScreen&&document.documentElement.requestFullScreen()},c.requestPointerLock=function(a){var b=a||document.documentElement;b.requestPointerLock&&b.requestPointerLock()},c.exitPointerLock=function(){document.exitPointerLock&&document.exitPointerLock()},c.togglePointerLock=function(a){document.pointerLockElement?c.exitPointerLock():c.requestPointerLock(a)};var d=[];c.addVisibilityChangeListener=function(a){if("function"==typeof a){for(var b,c,e=["","ms","moz","webkit"],f=0;f<e.length;++f){var g=e[f]+(0===e[f].length?"hidden":"Hidden"),h=e[f]+"visibilitychange";if("undefined"!=typeof document[g]){b=g,c=h;break}}if("undefined"!=typeof document.addEventListener&&"undefined"!=typeof b){var i=function(){a(document[b]?!0:!1)};d.push({eventName:c,eventListener:i}),document.addEventListener(c,i)}}},c.clearVisibilityChangeListeners=function(){d.forEach(function(a){document.removeEventListener(a.eventName,a.eventListener)}),d=[]},c.initAllShims=function(a){c.initWebGLShims(),c.initAnimationShims(),c.initFullscreenShims(a),c.initPointerLockShims(a)},c.initWebGLShims=function(){window.Uint8ClampedArray=window.Uint8ClampedArray||window.Uint8Array},c.initAnimationShims=function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];void 0===window.requestAnimationFrame&&(window.requestAnimationFrame=function(b){var c=Date.now(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e}),void 0===window.cancelAnimationFrame&&(window.cancelAnimationFrame=function(a){clearTimeout(a)})},c.initFullscreenShims=function(a){function b(){var a=document.createEvent("CustomEvent");a.initCustomEvent("fullscreenchange",!0,!1,null),document.dispatchEvent(a)}function d(){var a=document.createEvent("CustomEvent");a.initCustomEvent("fullscreenerror",!0,!1,null),document.dispatchEvent(a)}a=a||window;var e=(a.HTMLElement||a.Element).prototype;if(!document.hasOwnProperty("fullscreenEnabled")){var f=function(){return"webkitIsFullScreen"in document?function(){return document.webkitFullscreenEnabled}:"mozFullScreenEnabled"in document?function(){return document.mozFullScreenEnabled}:(c.supported.fullscreen=!1,function(){return!1})}();Object.defineProperty(document,"fullscreenEnabled",{enumerable:!0,configurable:!1,writeable:!1,get:f})}if(!document.hasOwnProperty("fullscreenElement")){var f=function(){for(var a=["webkitCurrentFullScreenElement","webkitFullscreenElement","mozFullScreenElement"],b=function(b){return function(){return document[a[b]]}},c=0;c<a.length;c++)if(a[c]in document)return b(c);return function(){return null}}();Object.defineProperty(document,"fullscreenElement",{enumerable:!0,configurable:!1,writeable:!1,get:f})}document.addEventListener("webkitfullscreenchange",b,!1),document.addEventListener("mozfullscreenchange",b,!1),document.addEventListener("webkitfullscreenerror",d,!1),document.addEventListener("mozfullscreenerror",d,!1),e.requestFullScreen||(e.requestFullScreen=function(){return e.msRequestFullscreen?function(){this.msRequestFullscreen()}:e.webkitRequestFullscreen?function(){this.webkitRequestFullscreen(a.Element.ALLOW_KEYBOARD_INPUT)}:e.webkitRequestFullScreen?function(){this.webkitRequestFullScreen(a.Element.ALLOW_KEYBOARD_INPUT)}:e.mozRequestFullScreen?function(){this.mozRequestFullScreen()}:function(){}}()),document.cancelFullScreen||(document.cancelFullScreen=function(){return document.webkitCancelFullScreen||document.mozCancelFullScreen||function(){}}())},c.initPointerLockShims=function(a){function b(){var a=document.createEvent("CustomEvent");a.initCustomEvent("pointerlockchange",!0,!1,null),document.dispatchEvent(a)}function d(){var a=document.createEvent("CustomEvent");a.initCustomEvent("pointerlockerror",!0,!1,null),document.dispatchEvent(a)}a=a||window;var e=(a.HTMLElement||a.Element).prototype;if(a.MouseEvent){var f=a.MouseEvent.prototype;if("movementX"in f||Object.defineProperty(f,"movementX",{enumerable:!0,configurable:!1,writeable:!1,get:function(){return this.webkitMovementX||this.mozMovementX||0}}),"movementY"in f||Object.defineProperty(f,"movementY",{enumerable:!0,configurable:!1,writeable:!1,get:function(){return this.webkitMovementY||this.mozMovementY||0}}),navigator.pointer||(navigator.pointer=navigator.webkitPointer||navigator.mozPointer),document.addEventListener("webkitpointerlockchange",b,!1),document.addEventListener("webkitpointerlocklost",b,!1),document.addEventListener("mozpointerlockchange",b,!1),document.addEventListener("mozpointerlocklost",b,!1),document.addEventListener("webkitpointerlockerror",d,!1),document.addEventListener("mozpointerlockerror",d,!1),!("pointerLockElement"in document)){var g=function(){return"webkitPointerLockElement"in document?function(){return document.webkitPointerLockElement}:"mozPointerLockElement"in document?function(){return document.mozPointerLockElement}:function(){return null}}();Object.defineProperty(document,"pointerLockElement",{enumerable:!0,configurable:!1,writeable:!1,get:g})}e.requestPointerLock||(e.requestPointerLock=function(){return e.webkitRequestPointerLock?function(){this.webkitRequestPointerLock()}:e.mozRequestPointerLock?function(){this.mozRequestPointerLock()}:navigator.pointer?function(){navigator.pointer.lock(this,b,d)}:(c.supported.pointerLock=!1,function(){})}()),document.exitPointerLock||(document.exitPointerLock=function(){return document.webkitExitPointerLock||document.mozExitPointerLock||function(){navigator.pointer&&navigator.pointer.unlock()}}())}},a.exports=c},,function(a,b,c){var d=c(54);a.exports=d},,,,,,function(a,b,c){function d(a,b,c,d){e.apply(this,arguments),b=b||200,this.options=c||{},this.options.preciseRecursion=!!this.options.preciseRecursion,this.options.autoUpdate=this.options.autoUpdate!==!1,this.overrideMaterial=d,this.doUpdate=!0;var g=a.aspect;this.type="PortalComponent",this.camera=a,this.target=new f(b,b/g),this.options.preciseRecursion&&(this.secondaryTarget=new f(b,b/g))}var e=c(20),f=c(133);d.type="PortalComponent",d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.requestUpdate=function(){this.doUpdate=!0},a.exports=d},function(a,b,c){function d(a,b){e.call(this,"PortalSystem",["MeshRendererComponent","MeshDataComponent","PortalComponent"]),this.renderer=a,this.renderSystem=b,this.renderList=[]}var e=c(42);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.process=function(a){for(var b=0;b<a.length;b++){var c=a[b],d=c.portalComponent;if(d.options.autoUpdate||d.doUpdate){d.doUpdate=!1;var e=d.camera,f=d.target,g=d.secondaryTarget,h=d.overrideMaterial;this.render(this.renderer,e,f,h);var i=c.meshRendererComponent.materials[0];if(i.setTexture("DIFFUSE_MAP",f),d.options.preciseRecursion){var j=f;d.target=g,d.secondaryTarget=j}}}},d.prototype.render=function(a,b,c,d){a.updateShadows(this.renderSystem.partitioner,this.renderSystem.entities,this.renderSystem.lights);for(var e=0;e<this.renderSystem.preRenderers.length;e++){var f=this.renderSystem.preRenderers[e];f.process(a,this.renderSystem.entities,this.renderSystem.partitioner,b,this.renderSystem.lights)}this.renderSystem.partitioner.process(b,this.renderSystem.entities,this.renderList),a.render(this.renderList,b,this.renderSystem.lights,c,!0,d)},a.exports=d},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(a,b,c){function d(a,b,c){if(1===arguments.length&&arguments[0]instanceof Object){var d=arguments[0];a=d.nSegments,b=d.radius,c=d.pointiness}this.nSegments=a||8,this.radius=b||1,this.pointiness=c||0;var f=e.defaultMap([e.POSITION,e.NORMAL,e.TEXCOORD0]);e.call(this,f,this.nSegments+1,3*this.nSegments),this.indexModes=["Triangles"],this.rebuild()}var e=c(14),f=c(6);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.rebuild=function(){for(var a=[],b=[],c=[],d=[],f=Math.atan2(this.radius,this.pointiness),g=2*Math.PI/this.nSegments,h=0,i=0;h<this.nSegments;h++,i+=g)a.push(Math.cos(i)*this.radius,Math.sin(i)*this.radius,0),b.push(Math.cos(i)*Math.cos(f),Math.sin(i)*Math.cos(f),Math.sin(f)),c.push(.5*Math.cos(i)+.5,.5*Math.sin(i)+.5),d.push(this.nSegments,h,(h+1)%this.nSegments);return a.push(0,0,this.pointiness),b.push(0,0,1),c.push(.5,.5),this.getAttributeBuffer(e.POSITION).set(a),this.getAttributeBuffer(e.NORMAL).set(b),this.getAttributeBuffer(e.TEXCOORD0).set(c),this.getIndexBuffer().set(d),this},d.prototype.clone=function(){var a=f.shallowSelectiveClone(this,["nSegments","radius","pointiness"]);return new d(a)},a.exports=d},,,function(a,b,c){function d(a,b,c,d){if(1===arguments.length&&arguments[0]instanceof Object){var e=arguments[0];a=e.circleSamples,b=e.radialSamples,c=e.tubeRadius,d=e.centerRadius}this.circleSamples=void 0!==a?a:8,this.radialSamples=void 0!==b?b:8,this.tubeRadius=void 0!==c?c:1,this.centerRadius=void 0!==d?d:2,this.viewInside=!1;var f=g.defaultMap([g.POSITION,g.NORMAL,g.TEXCOORD0]),h=(this.circleSamples+1)*(this.radialSamples+1),i=6*this.circleSamples*this.radialSamples;g.call(this,f,h,i),this.rebuild()}function e(a,b,c){a[3*c+0]=a[3*b+0],a[3*c+1]=a[3*b+1],a[3*c+2]=a[3*b+2]}function f(a,b,c){a[2*c+0]=a[2*b+0],a[2*c+1]=a[2*b+1]}var g=c(14),h=c(8),i=c(9),j=c(6);d.prototype=Object.create(g.prototype),d.prototype.constructor=d,d.prototype.rebuild=function(){for(var a=this.getAttributeBuffer(g.POSITION),b=this.getAttributeBuffer(g.NORMAL),c=this.getAttributeBuffer(g.TEXCOORD0),d=this.getIndexBuffer(),j=1/this.circleSamples,k=1/this.radialSamples,l=0,m=new h,n=new h,o=new h,p=0;p<this.circleSamples;p++){var q=p*j,r=i.TWO_PI*q,s=Math.cos(r),t=Math.sin(r);m.setDirect(s,t,0),n.copy(m).scale(this.centerRadius);for(var u=l,v=0;v<this.radialSamples;v++){var w=v*k,x=i.TWO_PI*w,y=Math.cos(x),z=Math.sin(x);o.copy(m).scale(y),o.z+=z,o.normalize(),this.viewInside?(b[3*l+0]=-o.x,b[3*l+1]=-o.y,b[3*l+2]=-o.z):(b[3*l+0]=o.x,b[3*l+1]=o.y,b[3*l+2]=o.z),o.scale(this.tubeRadius).add(n),a[3*l+0]=o.x,a[3*l+1]=o.y,a[3*l+2]=o.z,c[2*l+0]=w,c[2*l+1]=q,l++}e(a,u,l),e(b,u,l),c[2*l+0]=1,c[2*l+1]=q,l++}for(var A=0;A<=this.radialSamples;A++,l++)e(a,A,l),e(b,A,l),f(c,A,l),c[2*l+1]=1;for(var B=0,C=0,p=0;p<this.circleSamples;p++){var D=C,E=D+1;C+=this.radialSamples+1;var F=C,G=F+1;for(l=0;l<this.radialSamples;l++)this.viewInside?(d[B++]=D++,d[B++]=E,d[B++]=F,d[B++]=E++,d[B++]=G++,d[B++]=F++):(d[B++]=D++,d[B++]=F,d[B++]=E,d[B++]=E++,d[B++]=F++,d[B++]=G++)}return this},d.prototype.clone=function(){var a=j.shallowSelectiveClone(this,["circleSamples","radialSamples","tubeRadius","centerRadius"]);return new d(a)},a.exports=d},,,function(a,b,c){"undefined"!=typeof window&&c(301),a.exports={Ajax:c(132),ArrayUtil:c(302),ArrayUtils:c(86),AtlasNode:c(303),AudioContext:c(305),BoundingBox:c(7),BoundingPicker:c(165),BoundingSphere:c(13),BoundingTree:c(306),BoundingUpdateSystem:c(307),BoundingVolume:c(12),Box:c(27),BufferData:c(15),BufferUtils:c(16),Bus:c(45),Camera:c(120),CameraComponent:c(308),CameraComponentHandler:c(309),CameraSystem:c(310),CanvasUtils:c(131),Capabilities:c(17),Component:c(20),ComponentHandler:c(88),Composer:c(311),Cone:c(312),ConfigHandler:c(85),ContextLost:c(313),CrunchLoader:c(129),CssTransformComponent:c(314),CssTransformSystem:c(315),Cylinder:c(117),DdsLoader:c(127),DdsUtils:c(128),DirectionalLight:c(51),Disk:c(294),Dom3dComponent:c(316),Dom3dComponentHandler:c(317),Dom3dSystem:c(318),DynamicLoader:c(319),Easing:c(173),Entity:c(35),EntityCombiner:c(342),EntityHandler:c(321),EntityManager:c(38),EntitySelection:c(21),EntityUtils:c(3),EnvironmentHandler:c(336),EventTarget:c(37),FullscreenPass:c(135),FullscreenUtil:c(343),FullscreenUtils:c(136),GameUtils:c(221),GooRunner:c(344),Grid:c(355),GridRenderSystem:c(356),HtmlComponent:c(341),HtmlComponentHandler:c(340),HtmlSystem:c(357),JsonHandler:c(322),Light:c(50),LightComponent:c(194),LightComponentHandler:c(323),LightingSystem:c(349),Logo:c(354),Manager:c(39),Material:c(30),MaterialHandler:c(324),MathUtils:c(9),Matrix2:c(358),Matrix2x2:c(359),Matrix3:c(24),Matrix3x3:c(360),Matrix4:c(33),Matrix4x4:c(361),Matrix:c(25),MeshBuilder:c(112),MeshData:c(14),MeshDataComponent:c(216),MeshDataComponentHandler:c(325),MeshDataHandler:c(326),MeshRendererComponent:c(215),MeshRendererComponentHandler:c(327),MovementComponent:c(362),MovementSystem:c(363),Noise:c(364),ObjectUtil:c(99),ObjectUtils:c(6),OrbitCamControlScript:c(365),OscillatorSound:c(366),Particle:c(212),ParticleComponent:c(211),ParticleEmitter:c(214),ParticleInfluence:c(367),ParticleLib:c(209),ParticlesSystem:c(350),ParticleSystemUtils:c(210),ParticleUtils:c(213),Pass:c(137),PickingSystem:c(368),PipRenderSystem:c(369),Plane:c(121),PointLight:c(49),PortalComponent:c(229),PortalSystem:c(230),PrimitivePickLogic:c(370),ProjectHandler:c(331),PromiseUtil:c(223),PromiseUtils:c(54),Quad:c(28),Quaternion:c(23),Ray:c(122),Rc4Random:c(371),Rectangle:c(304),Renderer:c(123),RendererRecord:c(124),RendererUtils:c(18),RenderInfo:c(140),RenderPass:c(372),RenderQueue:c(43),RenderStats:c(138),RenderSystem:c(346),RenderTarget:c(133),rsvp:c(55),SceneHandler:c(328),ScriptComponent:c(353),Scripts:c(4),ScriptSystem:c(348),ScriptUtils:c(5),Selection:c(22),Shader:c(31),ShaderBuilder:c(48),ShaderCall:c(32),ShaderFragment:c(47),ShaderHandler:c(329),ShaderLib:c(46),ShadowHandler:c(134),ShapeCreatorMemoized:c(320),SimpleBox:c(373),SimplePartitioner:c(347),Skybox:c(339),SkyboxHandler:c(338),Snow:c(337),Sound:c(335),SoundComponent:c(333),SoundComponentHandler:c(332),SoundCreator:c(374),SoundHandler:c(334),SoundSystem:c(352),Sphere:c(29),Spline:c(375),SplineWalker:c(376),SpotLight:c(52),Stats:c(351),StringUtil:c(377),StringUtils:c(36),System:c(42),SystemBus:c(44),TangentGenerator:c(57),TaskScheduler:c(139),TextComponent:c(378),TextSystem:c(379),Texture:c(53),TextureCreator:c(125),TextureGrid:c(380),TextureHandler:c(126),TgaLoader:c(130),Torus:c(297),Transform:c(41),TransformComponent:c(40),TransformComponentHandler:c(330),TransformSystem:c(345),ValueNoise:c(381),Vector2:c(19),Vector3:c(8),Vector4:c(11),Vector:c(10),World:c(34)},"undefined"!=typeof window&&(window.goo=a.exports)},function(a,b){!function(a){"use strict";function b(a,b){function d(a){return this&&this.constructor===d?(this._keys=[],this._values=[],this.objectOnly=b,void(a&&c.call(this,a))):new d(a)}return b||r(a,"size",{get:n}),a.constructor=d,d.prototype=a,d}function c(a){this.add?a.forEach(this.add,this):a.forEach(function(a){this.set(a[0],a[1])},this)}function d(a){return this.has(a)&&(this._keys.splice(q,1),this._values.splice(q,1)),q>-1}function e(a){return this.has(a)?this._values[q]:void 0}function f(a,b){if(this.objectOnly&&b!==Object(b))throw new TypeError("Invalid value used as weak collection key");if(b!=b||0===b)for(q=a.length;q--&&!s(a[q],b););else q=a.indexOf(b);return q>-1}function g(a){return f.call(this,this._values,a)}function h(a){return f.call(this,this._keys,a)}function i(a,b){return this.has(a)?this._values[q]=b:this._values[this._keys.push(a)-1]=b,this}function j(a){return this.has(a)||this._values.push(a),this}function k(){this._values.length=0}function l(){return this._values.slice()}function m(){return this._keys.slice()}function n(){return this._values.length}function o(a,b){var c=this,d=c._values.slice();c._keys.slice().forEach(function(e,f){a.call(b,d[f],e,c)})}function p(a,b){var c=this;c._values.slice().forEach(function(d){a.call(b,d,d,c)})}Object.is||(Object.is=function(a,b){return 0===a&&0===b?1/a===1/b:a!==a?b!==b:a===b});var q,r=Object.defineProperty,s=Object.is;a.Set||(a.Map=b({"delete":d,has:h,get:e,set:i,keys:m,values:l,forEach:o,clear:k}),a.Set=b({has:g,add:j,"delete":d,clear:k,values:l,forEach:p}))}("undefined"!=typeof window&&window||this)},function(a,b,c){var d=c(86);a.exports=d},function(a,b,c){function d(a,b){this.isLeaf=!0,this.isSet=!1,this.children=[],void 0!==a&&void 0!==b?this.localRectangle=new e(0,0,a,b):this.localRectangle=null}var e=c(304);d.prototype.getRectangles=function(){var a=[];return this._getRectangles(a),a},d.prototype._getRectangles=function(a){this.isSet&&a.push(this.localRectangle),this.isLeaf||(this.children[0]._getRectangles(a),this.children[1]._getRectangles(a))},d.prototype.insert=function(a,b){return this._insert(new e(0,0,a,b))},d.prototype._insert=function(a){if(this.isLeaf){if(this.isSet)return null;if(a.w>this.localRectangle.w||a.h>this.localRectangle.h)return null;if(a.w===this.localRectangle.w&&a.h===this.localRectangle.h)return this.isSet=!0,this;this.isLeaf=!1,this.children[0]=new d,this.children[1]=new d;var b=this.localRectangle.w-a.w,c=this.localRectangle.h-a.h;return b>c?(this.children[0].localRectangle=new e(this.localRectangle.x,this.localRectangle.y,a.w,this.localRectangle.h),this.children[1].localRectangle=new e(this.localRectangle.x+a.w,this.localRectangle.y,b,this.localRectangle.h)):(this.children[0].localRectangle=new e(this.localRectangle.x,this.localRectangle.y,this.localRectangle.w,a.h),this.children[1].localRectangle=new e(this.localRectangle.x,this.localRectangle.y+a.h,this.localRectangle.w,c)),this.children[0]._insert(a)}var f=this.children[0]._insert(a);return null!==f?f:this.children[1]._insert(a)},a.exports=d},function(a,b){function c(a,b,c,d){this.x=a,this.y=b,this.w=c,this.h=d}a.exports=c},function(a,b){var c=!0,d="undefined"!=typeof window&&(window.AudioContext||window.webkitAudioContext);d||(console.warn("WebAudio not supported"),c=!1);var e;a.exports={getContext:function(){if(!e&&c)try{e=new d}catch(a){console.warn(a.message),c=!1}return e},isSupported:function(){return c}}},function(a,b,c){function d(a){this.leftTree=null,this.rightTree=null,this.localBound=null,this.worldBound=null,this.section=0,this.start=0,this.end=0,this.boundType=a?a:d.BOUNDTYPE_BOX}var e=c(7),f=c(13),g=c(8),h=new g;d.BOUNDTYPE_SPHERE="sphere",d.BOUNDTYPE_BOX="box",d.MAX_PRIMITIVES_PER_LEAF=16,d.prototype.construct=function(a){if(!a.meshRendererComponent||!a.meshDataComponent||!a.transformComponent)return void console.warn("Entity missing required components for boundingtree construction: ",a);var b=a.meshDataComponent.meshData;if(b.updatePrimitiveCounts(),1===b.getSectionCount()){this.primitiveIndices=[];for(var c=0,d=b.getPrimitiveCount(0);d>c;c++)this.primitiveIndices.push(c);this.createTree(a,0,0,this.primitiveIndices.length)}else this.split(a,0,b.getSectionCount())},d.prototype.createTree=function(a,b,c,e){var f=a.meshDataComponent.meshData;this.section=b,this.start=c,this.end=e,this.primitiveIndices&&(this.createBounds(),this.localBound.computeFromPrimitives(f,b,this.primitiveIndices,c,e),e-c+1<=d.MAX_PRIMITIVES_PER_LEAF||(this.leftTree||(this.leftTree=new d(this.boundType)),this.leftTree.primitiveIndices=this.primitiveIndices,this.leftTree.createTree(a,b,c,Math.floor((c+e)/2)),this.rightTree||(this.rightTree=new d(this.boundType)),this.rightTree.primitiveIndices=this.primitiveIndices,this.rightTree.createTree(a,b,Math.floor((c+e)/2),e)))},d.prototype.split=function(a,b,c){var e=c-b,f=Math.floor(e/2);if(1===f){var g=b;this.leftTree=new d(this.boundType),this.leftTree.primitiveIndices=[];for(var h=0;h<this.leftTree.primitiveIndices.length;h++)this.leftTree.primitiveIndices.push(h);this.leftTree.createTree(a,g,0,this.leftTree.primitiveIndices.length)}else this.leftTree=new d(this.boundType),this.leftTree.split(a,b,b+f);if(e-f===1){var g=b+1;this.rightTree=new d(this.boundType),this.rightTree._primitiveIndices=[];for(var h=0;h<this.rightTree.primitiveIndices.length;h++)this.rightTree.primitiveIndices.push(h);this.rightTree.createTree(a,g,0,this.rightTree.primitiveIndices.length)}else this.rightTree=new d(this.boundType),this.rightTree.split(a,b+f,c);this.localBound=this.leftTree.localBound.clone(),this.localBound.merge(this.rightTree.localBound),this.worldBound=this.localBound.clone()},d.prototype.createBounds=function(){switch(this.boundType){case d.BOUNDTYPE_BOX:this.localBound=new e,this.worldBound=new e;break;case d.BOUNDTYPE_SPHERE:this.localBound=new f,this.worldBound=new f}},d.prototype.findPick=function(a,b,c){if(c||(c=[]),!this.localBound.intersectsRay(a))return c;if(this.leftTree&&this.leftTree.findPick(a,b,c),this.rightTree)this.rightTree.findPick(a,b,c);else if(!this.leftTree)for(var d=b.meshDataComponent.meshData,e=null,f=this.start,i=this.end;i>f;f++)if(e=d.getPrimitiveVertices(this.primitiveIndices[f],this.section,e),a.intersects(e,!1,h)){var j=b.transformComponent.sync().worldTransform,k=new g;k.set(h),k.applyPostPoint(j.matrix),h.sub(a.origin),h.applyPostPoint(j.matrix);for(var l=h.length(),m=[],n=e.length-1;n>=0;n--)m[n]=(new g).set(e[n]),m[n].applyPostPoint(j.matrix);c.push({distance:l,point:k,vertices:m})}return c},a.exports=d},function(a,b,c){function d(){e.call(this,"BoundingUpdateSystem",["TransformComponent","MeshRendererComponent","MeshDataComponent"]),this._worldBound=new f,this._computeWorldBound=null}var e=c(42),f=c(7);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.process=function(a){var b=a.length;if(0===b)return void(this._computeWorldBound=null);for(var c=0;b>c;c++){var d=a[c],e=d.meshDataComponent,f=d.transformComponent,g=d.meshRendererComponent;f.sync(),e.autoCompute?(e.computeBoundFromPoints(),g.updateBounds(e.modelBound,f.worldTransform)):g._worldBoundDirty&&g.updateBounds(e.modelBound,f.worldTransform)}if(this._computeWorldBound&&this._computeWorldBound instanceof Function){for(var c=0;b>c;c++)if(!a[c].particleComponent){this._worldBound=a[c].meshRendererComponent.worldBound.clone();break}for(;b>c;c++)if(!a[c].particleComponent){var h=a[c].meshRendererComponent;this._worldBound=this._worldBound.merge(h.worldBound)}this._computeWorldBound(this._worldBound),this._computeWorldBound=null}},d.prototype.getWorldBound=function(a){this._computeWorldBound=a},d.prototype.deleted=function(a){a.meshRendererComponent&&(a.meshRendererComponent.worldBound=new f)},a.exports=d},function(a,b,c){function d(a){e.apply(this,arguments),this.type="CameraComponent",this.camera=a,this.leftVec=new f(-1,0,0),this.upVec=new f(0,1,0),this.dirVec=new f(0,0,-1),this._transformUpdatedListener=null,this._transformDirty=!0}var e=c(20),f=c(8),g=c(120),h=c(44);d.type="CameraComponent",d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.api={setAsMainCamera:function(){return h.emit("goo.setCurrentCamera",{camera:this.cameraComponent.camera,entity:this}),this}},d.prototype.setUpVector=function(a){0===a?(this.leftVec.setDirect(0,-1,0),this.upVec.setDirect(1,0,0),this.dirVec.setDirect(0,0,-1)):2===a?(this.leftVec.setDirect(-1,0,0),this.upVec.setDirect(0,0,1),this.dirVec.setDirect(0,-1,0)):(this.leftVec.setDirect(-1,0,0),this.upVec.setDirect(0,1,0),this.dirVec.setDirect(0,0,-1))},d.prototype.attached=function(){var a=this;this.entity.on("transformUpdated",this._transformUpdatedListener=function(){a._transformDirty=!0})},d.prototype.detached=function(){this.entity.off("transformUpdated",this._transformUpdatedListener),this._transformUpdatedListener=null},d.prototype.updateCamera=function(a){this.camera._left.set(this.leftVec),this.camera._left.applyPost(a.rotation),this.camera._up.set(this.upVec),this.camera._up.applyPost(a.rotation),this.camera._direction.set(this.dirVec),this.camera._direction.applyPost(a.rotation),a.matrix.getTranslation(this.camera.translation),this.camera.onFrameChange()},d.prototype.copy=function(a){return this.camera.copy(a.camera),this.leftVec.copy(a.leftVec),this.upVec.copy(a.upVec),this.dirVec.copy(a.dirVec),this},d.prototype.clone=function(){var a=new d(this.camera.clone());return a.leftVec.copy(this.leftVec),a.upVec.copy(this.upVec),a.dirVec.copy(this.dirVec),a},d.applyOnEntity=function(a,b){if(a instanceof g){var c=new d(a);return b.setComponent(c),!0}},a.exports=d},function(a,b,c){function d(){e.apply(this,arguments),this._type="CameraComponent"}var e=c(88),f=c(308),g=c(120),h=c(6);d.prototype=Object.create(e.prototype),e._registerClass("camera",d),d.prototype.constructor=d,d.prototype._prepare=function(a){h.defaults(a,{near:1,far:1e4,projectionMode:"Perspective",aspect:1,lockedRatio:!1}),"Perspective"===a.projectionMode&&void 0===a.fov&&(a.fov=45),"Parallel"===a.projectionMode&&void 0===a.size&&(a.size=100),"Perspective"!==a.projectionMode&&"Parallel"!==a.projectionMode&&(a.projectionMode="Perspective")},d.prototype._create=function(){var a=new g(45,1,1,1e3),b=new f(a);return b},d.prototype.update=function(a,b,c){return e.prototype.update.call(this,a,b,c).then(function(a){
if(a){if(a.camera.setProjectionMode(g[b.projectionMode]),a.camera.lockedRatio=!1,"Perspective"===b.projectionMode)a.camera.setFrustumPerspective(b.fov,null,b.near,b.far);else{var c=b.size;a.camera.setFrustum(b.near,b.far,-c,c,c,-c,null),a.camera.size=c}return a}})},a.exports=d},function(a,b,c){function d(){e.call(this,"CameraSystem",["TransformComponent","CameraComponent"]),this.mainCamera=null}var e=c(42),f=c(44),g=c(123);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.findMainCamera=function(){if(this._activeEntities.length){var a=this._activeEntities[0];f.emit("goo.setCurrentCamera",{camera:a.cameraComponent.camera,entity:a})}},d.prototype.inserted=function(a){g.mainCamera||f.emit("goo.setCurrentCamera",{camera:a.cameraComponent.camera,entity:a})},d.prototype.deleted=function(){},d.prototype.onPreRender=function(){for(var a=0;a<this._activeEntities.length;a++){var b=this._activeEntities[a],c=b.transformComponent,d=b.cameraComponent;c.sync(),d._transformDirty&&(d.updateCamera(c.worldTransform),d._transformDirty=!1)}},a.exports=d},function(a,b,c){function d(a){if(this._passedWriteBuffer=!!a,this.writeBuffer=a,void 0===this.writeBuffer){var b=window.innerWidth||1,c=window.innerHeight||1;this.writeBuffer=new e(b,c)}this.readBuffer=this.writeBuffer.clone(),this.passes=[],this._clearColor=[0,0,0,1],this.copyPass=new f(g.copy),this.size=null,this.dirty=!1,this._viewportResizeHandler=function(a){this.dirty=!0,this.size=a}.bind(this),h.addListener("goo.viewportResize",this._viewportResizeHandler,!0)}var e=c(133),f=c(135),g=c(46),h=c(44);d.prototype.destroy=function(a){this.deallocateBuffers(a);for(var b=0;b<this.passes.length;b++){var c=this.passes[b];c.destroy(a)}h.removeListener("goo.viewportResize",this._viewportResizeHandler)},d.prototype.deallocateBuffers=function(a){this.writeBuffer&&!this._passedWriteBuffer&&this.writeBuffer.destroy(a.context),this.readBuffer&&this.readBuffer.destroy(a.context),this.copyPass.destroy(a)},d.prototype.swapBuffers=function(){var a=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=a},d.prototype._checkPassResize=function(a,b){return!a.viewportSize||a.viewportSize.x!==b.x||a.viewportSize.y!==b.y||a.viewportSize.width!==b.width||a.viewportSize.height!==b.height},d.prototype.addPass=function(a,b){this.passes.push(a),a.updateSize&&this.size&&this._checkPassResize(a,this.size)&&(a.updateSize(this.size,b),a.viewportSize=this.size)},d.prototype.setClearColor=function(a){this._clearColor[0]=a[0],this._clearColor[1]=a[1],this._clearColor[2]=a[2],this._clearColor[3]=a[3]},d.prototype.updateSize=function(a){var b=this.size;if(b){var c=b.width,d=b.height;this.deallocateBuffers(a),this.writeBuffer=new e(c,d),this.readBuffer=this.writeBuffer.clone();for(var f=0,g=this.passes.length;g>f;f++){var h=this.passes[f];h.updateSize&&this._checkPassResize(h,b)&&(h.updateSize(b,a),h.viewportSize=b)}}},d.prototype.render=function(a,b,c,d){this.dirty&&(this.updateSize(a),this.dirty=!1);var e,f,g=!1,h=this.passes.length;for(f=0;h>f;f++)if(e=this.passes[f],e.enabled&&(e.render(a,this.writeBuffer,this.readBuffer,b,g,c,d,this._clearColor),e.needsSwap)){if(g){var i=this.renderer.context;i.stencilFunc(i.NOTEQUAL,1,4294967295),this.copyPass.render(a,this.writeBuffer,this.readBuffer,b,c,d),i.stencilFunc(i.EQUAL,1,4294967295)}this.swapBuffers()}},a.exports=d},function(a,b,c){function d(a,b,c){if(1===arguments.length&&arguments[0]instanceof Object){var d=arguments[0];a=d.radialSamples,b=d.radius,c=d.height}this.radialSamples=a||8,this.radius=b||1,this.height="undefined"==typeof c?2:c;var f=e.defaultMap([e.POSITION,e.NORMAL,e.TEXCOORD0]);e.call(this,f,3*this.radialSamples+this.radialSamples+1,3*this.radialSamples*2),this.indexModes=["Triangles"],this.rebuild()}var e=c(14),f=c(6);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.rebuild=function(){for(var a=[],b=[],c=[],d=[],f=Math.atan2(this.radius,this.height),g=2*Math.PI/this.radialSamples,h=1/this.radialSamples,i=0,j=0,k=0;i<this.radialSamples;i++,j+=g,k+=h)a.push(0,0,this.height,Math.cos(j)*this.radius,Math.sin(j)*this.radius,0,Math.cos(j+g)*this.radius,Math.sin(j+g)*this.radius,0),b.push(0,0,1,Math.cos(j)*Math.cos(f),Math.sin(j)*Math.cos(f),Math.sin(f),Math.cos(j+g)*Math.cos(f),Math.sin(j+g)*Math.cos(f),Math.sin(f)),c.push(k+h/2,1,k,.5,k+h,.5),d.push(3*i+0,3*i+1,3*i+2);var l=3*i+0;a.push(0,0,0),b.push(0,0,-1),c.push(.25,.25);for(var i=1,j=0;i<=this.radialSamples-1;i++,j+=g)a.push(Math.cos(j)*this.radius,Math.sin(j)*this.radius,0),b.push(0,0,-1),c.push(.25*Math.cos(j)+.25,.25*Math.sin(j)+.25),d.push(l+i,l,l+i+1);return a.push(Math.cos(j)*this.radius,Math.sin(j)*this.radius,0),b.push(0,0,-1),c.push(.25*Math.cos(j)+.25,.25*Math.sin(j)+.25),d.push(l+this.radialSamples,l,l+1),this.getAttributeBuffer(e.POSITION).set(a),this.getAttributeBuffer(e.NORMAL).set(b),this.getAttributeBuffer(e.TEXCOORD0).set(c),this.getIndexBuffer().set(d),this},d.prototype.clone=function(){var a=f.shallowSelectiveClone(this,["radialSamples","radius","height"]);return new d(a)},a.exports=d},function(a,b,c){var d=c(123),e=c(124);d.prototype.invalidateBuffer=function(a){a.glBuffer=null},d.prototype.invalidateMeshData=function(a){this.invalidateBuffer(a.vertexData),a.indexData&&this.invalidateBuffer(a.indexData),a.wireframeData&&this.invalidateMeshData(a.wireframeData),a.flatMeshData&&this.invalidateMeshData(a.flatMeshData)},d.prototype.invalidateTexture=function(a){a.glTexture=null,a.textureRecord={}},d.prototype.invalidateShader=function(a){a.shaderProgram=null,a.vertexShader=null,a.fragmentShader=null},d.prototype.invalidateMaterial=function(a){for(var b=Object.keys(a._textureMaps),c=0;c<b.length;c++){var d=b[c],e=a._textureMaps[d];this.invalidateTexture(e)}this.invalidateShader(a.shader)},d.prototype.invalidateRenderTarget=function(a){a.glTexture=null,a._glRenderBuffer=null,a._glFrameBuffer=null,delete a.textureRecord},d.prototype.invalidateComposer=function(a){a.writeBuffer&&!a._passedWriteBuffer&&this.invalidateRenderTarget(a.writeBuffer),a.readBuffer&&this.invalidateRenderTarget(a.readBuffer),a.copyPass.invalidateHandles(this);for(var b=0;b<a.passes.length;b++){var c=a.passes[b];c.invalidateHandles(this)}},d.prototype.invalidatePicking=function(){this.hardwarePicking&&(this.hardwarePicking.pickingTarget&&this.invalidateRenderTarget(this.hardwarePicking.pickingTarget),this.invalidateMaterial(this.hardwarePicking.pickingMaterial))},d.prototype._restoreContext=function(){this.establishContext(),this.rendererRecord=new e,this.context.clearColor(this._clearColor.x,this._clearColor.y,this._clearColor.z,this._clearColor.w)}},function(a,b,c){function d(a,b){e.apply(this,arguments),this.type="CssTransformComponent",this.domElement=a,this.scale=1,this.faceCamera="undefined"==typeof b?!1:b}var e=c(20);d.type="CssTransformComponent",d.prototype=Object.create(e.prototype),d.prototype.constructor=d,a.exports=d},function(a,b,c){function d(a){e.call(this,"CssTransformSystem",["TransformComponent","CssTransformComponent"]),this.renderer=a,document.querySelector&&(this.viewDom=document.querySelector("#view"),this.containerDom=document.querySelector("#cam1"),this.containerDom2=document.querySelector("#cam2"))}var e=c(42),f=c(123),g=c(33),h=c(9),i=c(8),j=new g,k=new g,l=new i;d.prototype=Object.create(e.prototype),d.prototype.constructor=d;var m=function(a){return Math.abs(a)<1e-6?0:a},n=["","-webkit-","-moz-","-ms-","-o-"],o=function(a,b,c){for(var d=0;d<n.length;d++)a.style[n[d]+b]=c},p=function(a){var b=a.data;return"matrix3d("+m(b[0])+","+m(-b[1])+","+m(b[2])+","+m(b[3])+","+m(b[4])+","+m(-b[5])+","+m(b[6])+","+m(b[7])+","+m(b[8])+","+m(-b[9])+","+m(b[10])+","+m(b[11])+","+m(b[12])+","+m(-b[13])+","+m(b[14])+","+m(b[15])+")"};d.prototype.process=function(a){if(0!==a.length){var b=f.mainCamera;if(b){var c=.5/Math.tan(h.DEG_TO_RAD*b.fov*.5)*this.renderer.domElement.offsetHeight;o(this.viewDom,"perspective",c+"px"),j.copy(b.getViewInverseMatrix()),k.copy(j),j.invert(),j.setTranslation(new i(0,0,c));var d=p(j);o(this.containerDom,"transform",d),k.e03=-k.e03,k.e23=-k.e23,k.data[0]=1,k.data[1]=0,k.data[2]=0,k.data[4]=0,k.data[5]=1,k.data[6]=0,k.data[8]=0,k.data[9]=0,k.data[10]=1,d=p(k),o(this.containerDom2,"transform",d);for(var e=0;e<a.length;e++){var g=a[e],m=g.getComponent("CssTransformComponent"),n=m.domElement,q=m.scale;q=[q,-q,q].join(","),m.faceCamera?(g.transformComponent.sync().worldTransform.matrix.getTranslation(l),j.copy(b.getViewInverseMatrix()),j.setTranslation(l)):j.copy(g.transformComponent.sync().worldTransform.matrix),d="translate3d(-50%,-50%,0) "+p(j)+"scale3d("+q+")",o(n,"transform",d),n.parentNode!==this.containerDom2&&this.containerDom2.appendChild(n)}}}},a.exports=d},function(a,b,c){function d(a,b){e.apply(this,arguments),this.type="Dom3dComponent",b=b||{},this.hidden=!1,this.width=b.width||500,this.height=b.height||500,this.backfaceVisibility=b.backfaceVisibility||"hidden",this.updated=!0,this.entity=null,this.initDom(a),this.meshData=new f(1,1),this.meshDataComponent=new h(this.meshData),this.meshRendererComponent=new g,this._transformDirty=!0,this._transformUpdatedListener=null}var e=c(20),f=c(28),g=c(215),h=c(216);d.type="Dom3dComponent",d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.attached=function(a){a.setComponent(this.meshDataComponent),a.setComponent(this.meshRendererComponent);var b=this;this.entity.on("transformUpdated",this._transformUpdatedListener=function(){b._transformDirty=!0})},d.prototype.detached=function(a){null!==this.domElement.parentNode&&this.domElement.parentNode.removeChild(this.domElement),a.clearComponent("meshRendererComponent"),a.clearComponent("meshDataComponent"),this.entity.off("transformUpdated",this._transformUpdatedListener),this._transformUpdatedListener=null},d.prototype.initDom=function(a){this.domElement&&null!==this.domElement.parentNode&&this.domElement.parentNode.removeChild(this.domElement),this.domElement=document.createElement("div"),a&&(a.style.width||(a.style.width="100%"),a.style.height||(a.style.height="100%"),this.domElement.appendChild(a)),this.domElement.style.position="absolute",this.domElement.style.margin="0px",this.domElement.style.padding="0px",this.domElement.style.backgroundColor="white",this.domElement.style.backfaceVisibility=this.backfaceVisibility,this.domElement.style.overflow="hidden",this.setSize(this.width,this.height)},d.prototype.setSize=function(a,b){this.width=a||this.width,this.height=b||this.height,this.domElement.style.width=this.width+"px",this.domElement.style.height=this.height+"px"},d.prototype.destroy=function(a){this.meshData.destroy(a)},a.exports=d},function(a,b,c){function d(){f.apply(this,arguments),this._type="Dom3dComponent"}function e(a){return"__"+a.replace(j,"-")}var f=c(88),g=c(316),h=c(55),i=c(54);d.prototype=Object.create(f.prototype),f._registerClass("dom3d",d),d.prototype.constructor=d,d.prototype._prepare=function(){},d.prototype._create=function(){return new g};var j=/\W/g;d.prototype.update=function(a,b,c){var d=this;return f.prototype.update.call(this,a,b,c).then(function(f){function g(a,b){return d.loadObject(b,c).then(function(b){return a.src=b.src,a},function(b){return console.error(b),delete a.src,a})}if(f){var j=e(a.id),k=f.domElement;k||(k=document.createElement("div"),k.id=j,k.className="goo-entity",f.initDom(k)),f.setSize(void 0!==b.width?b.width:500,void 0!==b.height?b.height:500);var l=b.innerHtml!==k.prevInnerHtml,m=b.style!==k.prevStyle;if(k.prevInnerHtml=b.innerHtml,k.prevStyle=b.style,a.meshRendererComponent!==f.meshRendererComponent&&a.setComponent(f.meshRendererComponent),a.meshDataComponent!==f.meshDataComponent&&a.setComponent(f.meshDataComponent),!l&&!m)return i.resolve();var n="";if(b.style){var o=b.style.replace("__entity","#"+j);n="<style>\n"+o+"\n</style>"}k.innerHTML=n+b.innerHtml;var p=k.childNodes;if(1===p.length){var q=p[0];q.style.width||(q.style.width="100%"),q.style.height||(q.style.height="100%")}for(var r=k.getElementsByTagName("IMG"),s=[],t=0;t<r.length;t++){var u=r[t],v=u.getAttribute("data-id");if(v){var w=g(u,v);s.push(w)}}return h.all(s)}})},d.prototype._remove=function(a){var b=a.dom3dComponent;f.prototype._remove.call(this,a),b.domElement&&b.domElement.parentNode&&b.domElement.parentNode.removeChild(b.domElement),(a.meshRendererComponent||a.meshDataComponent)&&(a.clearComponent("meshDataComponent"),a.clearComponent("meshRendererComponent")),b.destroy(this.world.gooRunner.renderer.context)},a.exports=d},function(a,b,c){function d(a){e.call(this,"Dom3dSystem",["TransformComponent","Dom3dComponent"]),this.renderer=a,this.camera=null,f.addListener("goo.setCurrentCamera",function(a){this.camera=a.camera}.bind(this),!0),this.playing=!0;var b=new g(h.simple);b.blendState.blending="CustomBlending",b.blendState.blendSrc="ZeroFactor",b.blendState.blendDst="ZeroFactor";var c=new g(h.uber);c.uniforms.materialDiffuse=[.5,.5,.5,1],c.cullState.cullFace="Front",this.materials=[b,c],this.prefixes=["","-webkit-"],this.styleCache=new Map,this.precisionScale=1e3}var e=c(42),f=c(44),g=c(30),h=c(46),i=c(8),j=c(122),k=c(9);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.init=function(){var a=new j,b=[new i,new i,new i,new i],c=[new i(-.5,-.5,0),new i(-.5,.5,0),new i(.5,.5,0),new i(.5,-.5,0)],d=!1,e=!1,g=this,h=function(e){var f,h,i=g.renderer.domElement;if("touchstart"===e.type||"touchend"===e.type||"touchmove"===e.type)f=e.changedTouches[0].pageX-i.getBoundingClientRect().left,h=e.changedTouches[0].pageY-i.getBoundingClientRect().top;else{var j=i.getBoundingClientRect();f=e.clientX-j.left,h=e.clientY-j.top}g.camera.getPickRay(f,h,g.renderer.domElement.offsetWidth,g.renderer.domElement.offsetHeight,a);for(var k=0;k<g._activeEntities.length;k++){for(var l=g._activeEntities[k],m=0;m<b.length;m++){var n=b[m];n.set(c[m]),n.applyPostPoint(l.transformComponent.sync().worldTransform.matrix)}if(a.intersects(b,d,null,!0))return!0}return!1},k=function(a){if(!g.camera||0===g._activeEntities.length)return!1;var b=h(a);b&&!e?(f.emit("goo.dom3d.enabled",!0),g.renderer.domElement.style.pointerEvents="none",e=!0):!b&&e&&(f.emit("goo.dom3d.enabled",!1),g.renderer.domElement.style.pointerEvents="",e=!1)},l=!1;document.addEventListener("mousedown",function(a){g.camera&&0!==g._activeEntities.length&&(l=!h(a))},!1),document.addEventListener("mouseup",function(a){g.camera&&0!==g._activeEntities.length&&(l=!1,g.playing&&k(a))},!1),document.addEventListener("mousemove",function(a){!l&&g.camera&&0!==g._activeEntities.length&&g.playing&&k(a)},!1);var m=this.rootDom=document.createElement("div");this.renderer.domElement.parentNode.insertBefore(m,this.renderer.domElement),m.style.position="absolute",m.style.overflow="hidden",m.style.webkitUserSelect="none",m.style.mozUserSelect="none",m.style.msUserSelect="none",m.style.transformStyle="preserve-3d",m.style.width="100%",m.style.height="100%",m.style.top="0px",m.style.bottom="0px",m.style.left="0px",m.style.right="0px";var n=this.cameraDom=document.createElement("div");n.style.webkitUserSelect="none",n.style.mozUserSelect="none",n.style.msUserSelect="none",n.style.transformStyle="preserve-3d",n.style.width="100%",n.style.height="100%",m.appendChild(n)},d.prototype.play=function(){this.playing=!0},d.prototype.pause=function(){},d.prototype.resume=d.prototype.play,d.prototype.stop=function(){this.playing=!1,f.emit("goo.dom3d.enabled",!1),this.renderer.domElement&&(this.renderer.domElement.style.pointerEvents="")},d.prototype.getCameraCSSMatrix=function(a){var b=a.data;return"matrix3d("+b[0]+","+-b[1]+","+b[2]+","+b[3]+","+b[4]+","+-b[5]+","+b[6]+","+b[7]+","+b[8]+","+-b[9]+","+b[10]+","+b[11]+","+b[12]*this.precisionScale+","+-b[13]*this.precisionScale+","+b[14]*this.precisionScale+","+b[15]+")"},d.prototype.getEntityCSSMatrix=function(a){var b=a.data;return"translate3d(-50%,-50%,0) matrix3d("+b[0]+","+b[1]+","+b[2]+","+b[3]+","+-b[4]+","+-b[5]+","+-b[6]+","+-b[7]+","+b[8]+","+b[9]+","+b[10]+","+b[11]+","+b[12]*this.precisionScale+","+b[13]*this.precisionScale+","+b[14]*this.precisionScale+","+b[15]+")"},d.prototype.setStyle=function(a,b,c){var d=this.styleCache.get(a);if(c!==d){for(var e=0;e<this.prefixes.length;e++)a.style[this.prefixes[e]+b]=c;this.styleCache.set(a,c)}},d.prototype.inserted=function(a){var b=a.dom3dComponent;b.meshRendererComponent.materials=this.materials},d.prototype.onPreRender=function(){var a=this._activeEntities,b=this.camera;if(b&&0!==a.length){this.renderer.domElement.parentNode&&!this.rootDom&&this.init();var c=this.renderer.viewportWidth/this.renderer.devicePixelRatio,d=this.renderer.viewportHeight/this.renderer.devicePixelRatio,e=.5/Math.tan(k.DEG_TO_RAD*b.fov*.5)*d;this.setStyle(this.rootDom,"perspective",e+"px");var f=b.getViewMatrix(),g="translate3d(0,0,"+e+"px) "+this.getCameraCSSMatrix(f)+" translate3d("+c/2+"px,"+d/2+"px, 0)";this.setStyle(this.cameraDom,"transform",g);for(var h=0,i=a.length;i>h;h++){var j=a[h],l=j.dom3dComponent,m=l.domElement;if(m.parentNode!==this.cameraDom&&this.cameraDom.appendChild(m),l.hidden)l.domElement.style.display="none";else if(l.domElement.style.display="",l.updated||l._transformDirty){l.updated=!1,l._transformDirty=!1;var n=j.transformComponent.sync().worldTransform;g=this.getEntityCSSMatrix(n.matrix)+" scale("+this.precisionScale/l.width+", "+this.precisionScale/l.height+")",this.setStyle(m,"transform",g)}}}},d.prototype.cleanup=function(){e.prototype.cleanup.apply(this,arguments),null!==this.rootDom.parentNode&&this.rootDom.parentNode.removeChild(this.rootDom)},a.exports=d},function(a,b,c){function d(a){if(!a.world)throw new Error("World argument cannot be null");if(this._world=a.world,a.ajax)this._ajax=a.ajax;else{if(!a.rootPath)throw new Error("ajax or rootPath must be defined");this._ajax=new f(a.rootPath)}this._objects=new Map,this._handlers={}}var e=c(85),f=c(132),g=c(55),h=c(36),i=c(54),j=c(86),k=c(320);c(88),c(309),c(321),c(322),c(323),c(324),c(325),c(326),c(327),c(328),c(329),c(126),c(330),c(331),c(332),c(334),c(336),c(338),c(340),d.prototype.preload=function(a,b){this._ajax.prefill(a,b)},d.prototype.clear=function(){var a=[];for(var b in this._handlers)a.push(this._handlers[b].clear());if(this._ajax.clear instanceof Function&&this._ajax.clear(),this._world&&this._world.gooRunner){k.clearCache(this._world.gooRunner.renderer.context);for(var c=0;c<this._world.gooRunner.renderSystems.length;c++){var d=this._world.gooRunner.renderSystems[c].lights;if(d)for(var e=0;e<d.length;e++)d[e].destroy(this._world.gooRunner.renderer)}this._world.gooRunner.renderer.clearShaderCache()}return g.all(a)},d.prototype.load=function(a,b){b=b||{};var c=this._loadObject.bind(this,a,b);return b.preloadBinaries===!0?this._loadBinariesFromRefs(a,b).then(c):c()},d.prototype.update=function(a,b,c){var d=this;return c=c||{},this._ajax.update(a,b).then(function(b){return d._updateObject(a,b,c)}).then(null,function(b){throw console.error("Error updating "+a+" "+b),b})},d.prototype._loadObject=function(a,b){var c=d.getTypeForRef(a),e=this._getHandler(c);return e?e.load(a,b):this._loadRef(a,b)},d.prototype.remove=function(a){return this._objects["delete"](a),this.update(a,null)},d.prototype._updateObject=function(a,b,c){var e=d.getTypeForRef(a),f=this._getHandler(e);return f?f.update(a,b,c):d._isRefTypeInGroup(a,"binary")||"bundle"!==e?i.resolve(b):(console.warn("No handler for type "+e),i.resolve(b))},d.prototype._loadRef=function(a,b){return this._ajax.load(a,null==b?!1:b.noCache)},d.prototype._loadBinariesFromRefs=function(a,b){function c(a){function c(c){return h._loadRef(c,b).then(function(){d++,b.progressCallback instanceof Function&&b.progressCallback(d,a.length)})}var d=0;return g.all(a.map(c))}function e(a){function c(a){return h._loadRef(a,b).then(e)}function e(a){var b=[];if(a.lazy===!0)return i.resolve();for(var e=d._getRefsFromConfig(a),h=0,j=e.length;j>h;h++){var l=e[h];d._isRefTypeInGroup(l,"asset")&&!f.has(l)?f.add(l):d._isRefTypeInGroup(l,"json")&&!k.has(l)&&(k.add(l),b.push(c(l)))}return g.all(b)}var f=new Set,k=new Set;return e({collectionRefs:a}).then(function(){return j.fromValues(f)})}if("string"==typeof a){var f=a;a={},a[f]=f}var h=this;return e(a).then(c)},d.prototype._getHandler=function(a){var b=this._handlers[a];if(b)return b;var c=e.getHandler(a);return c?(this._handlers[a]=new c(this._world,this._loadRef.bind(this),this._updateObject.bind(this),this._loadObject.bind(this)),this._handlers[a]):null};var l=40,m=32,n=function(a){if("string"!=typeof a)return!1;var b=a.split(".");return b[0]&&(b[0].length===l||b[0].length===m)&&b[1]};d._getRefsFromConfig=function(a){function b(a,d){if(h.endsWith(a.toLowerCase(),"refs")&&d instanceof Object){for(var e=0,f=0,g=Object.keys(d),i=g.length;i>f;f++)n(d[g[f]])&&(c.push(d[g[f]]),e++);if(e>0)return}if(h.endsWith(a.toLowerCase(),"ref")&&"thumbnailRef"!==a&&n(d))return void c.push(d);if(d instanceof Object&&"assets"!==a&&!(d instanceof Array))for(var f=0,g=Object.keys(d),i=g.length;i>f;f++)b(g[f],d[g[f]])}var c=[];return b("",a),c},d.getTypeForRef=function(a){return a.substr(a.lastIndexOf(".")+1).toLowerCase()},d._isRefTypeInGroup=function(a,b){var c=d.getTypeForRef(a);return c&&f.types[b]&&f.types[b][c]},a.exports=d},function(a,b,c){function d(){}function e(a,b){var c=Object.keys(b),d=c.map(function(a){return a+""+b[a]}).join("");return a+d}function f(a,b,c){var d=e(a,b),f=p.get(d);if(f)return f;if(f=c(),o.push(d),p.set(d,f),o.length>q){var d=o.shift();p["delete"](d)}return f}var g=c(27),h=c(28),i=c(29),j=c(117),k=c(297),l=c(294),m=c(312),n=c(99),o=[],p=new Map,q=100;d.createQuad=function(a,b){var c=1,d=1,e=1,g=1;return b&&c===b.xExtent&&d===b.yExtent&&e===b.tileX&&g===b.tileY?b:f("quad",{},function(){return new h(c,d,e,g)})},d.createBox=function(a,b){a=a||{},n.defaults(a,{textureMode:"Uniform"});var c=1,d=1,e=1,h=1,i=1;return b&&c===b.xExtent&&d===b.yExtent&&e===b.zExtent&&h===b.tileX&&i===b.tileY&&a.textureMode===b.textureMode.name?b:f("box",a,function(){return new g(c,d,e,h,i,a.textureMode)})},d.createSphere=function(a,b){return a=a||{},n.defaults(a,{zSamples:8,radialSamples:8,textureMode:"Projected",radius:1}),b&&a.zSamples===b.zSamples-1&&a.radialSamples===b.radialSamples&&a.textureMode===b.textureMode.name&&a.radius===b.radius?b:f("sphere",a,function(){return new i(a.zSamples,a.radialSamples,a.radius,a.textureMode)})},d.createCylinder=function(a,b){return a=a||{},n.defaults(a,{radialSamples:8,radius:1}),b&&a.radialSamples===b.radialSamples&&a.radius===b.radius?b:f("cylinder",a,function(){return new j(a.radialSamples,a.radius)})},d.createTorus=function(a,b){return a=a||{},n.defaults(a,{radialSamples:8,circleSamples:12,tubeRadius:.2,centerRadius:1}),b&&a.radialSamples===b._radialSamples&&a.circleSamples===b._circleSamples&&a.tubeRadius===b._tubeRadius&&a.centerRadius===b._centerRadius?b:f("torus",a,function(){return new k(a.circleSamples,a.radialSamples,a.tubeRadius,a.centerRadius)})},d.createDisk=function(a,b){return a=a||{},n.defaults(a,{radialSamples:8,pointiness:0,radius:1}),b&&a.radialSamples===b.nSegments&&a.pointiness===b.pointiness&&a.radius===b.radius?b:a.pointiness===Math.floor(a.pointiness)?f("disk",a,function(){return new l(a.radialSamples,a.radius,a.pointiness)}):new l(a.radialSamples,a.radius,a.pointiness)},d.createCone=function(a,b){return a=a||{},n.defaults(a,{radialSamples:8,height:0,radius:1}),b&&a.radialSamples===b.radialSamples&&a.height===b.height&&a.radius===b.radius?b:a.height===Math.floor(a.height)?f("cone",a,function(){return new m(a.radialSamples,a.radius,a.height)}):new m(a.radialSamples,a.radius,a.height)},d.clearCache=function(a){a&&p.forEach(function(b){b.destroy(a)}),o.length=0,p.clear()},a.exports=d},function(a,b,c){function d(){g.apply(this,arguments),this._componentHandlers={}}function e(a,b){if(a._tags.clear(),b)for(var c in b)a.setTag(c)}function f(a,b){if(a._attributes.clear(),b)for(var c in b)a.setAttribute(c,b[c])}var g=c(85),h=c(88),i=c(55),j=c(36),k=c(54);d.prototype=Object.create(g.prototype),d.prototype.constructor=d,g._registerClass("entity",d),d.prototype._create=function(){return this.world.createEntity()},d.prototype._remove=function(a){var b=this._objects.get(a),c=this;if(b){for(var d=[],e=b._components.slice(0),f=0;f<e.length;f++){var g=this._getComponentType(e[f]),h=this._updateComponent(b,g,null);h instanceof i.Promise&&d.push(h)}return i.all(d).then(function(){b.removeFromWorld(),c._objects["delete"](a)})}},d.prototype._update=function(a,b,c){var d=this;return g.prototype._update.call(this,a,b,c).then(function(g){if(g){g.id=a,g.name=b.name,g["static"]=!!b["static"],e(g,b.tags),f(g,b.customAttributes);var h=[];for(var i in b.components)if(b.components[i]){var j=d._updateComponent(g,i,b.components[i],c);j?h.push(j):console.error("Error handling component "+i)}for(var l=g._components,m=0;m<l.length;m++){var i=d._getComponentType(l[m]);b.components[i]||d._updateComponent(g,i,null,c)}return k.optimisticAll(h).then(function(){return b.hidden?g.hide():g.show(),g})}})},d.prototype._updateComponent=function(a,b,c,d){var e=this._getHandler(b);if(!e)return null;var f=e.update(a,c,d);return f&&f.then?f:null},d.prototype._getComponentType=function(a){var b=a.type;return b=b.slice(0,b.lastIndexOf("Component")),b=j.uncapitalize(b),"howler"===b&&(b="sound"),b},d.prototype._getHandler=function(a){if(!this._componentHandlers[a]){var b=h.getHandler(a);b&&(this._componentHandlers[a]=new b(this.world,this.getConfig,this.updateObject,this.loadObject))}return this._componentHandlers[a]},a.exports=d},function(a,b,c){function d(){e.apply(this,arguments)}var e=c(85),f=c(54);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,e._registerClass("json",d),d.prototype._update=function(a,b){if(!b)return this._remove(a),f.resolve();var c;try{c=JSON.parse(b.body)}catch(d){c={}}return f.resolve(c)},a.exports=d},function(a,b,c){function d(){e.apply(this,arguments),this._type="LightComponent"}var e=c(88),f=c(194),g=c(49),h=c(52),i=c(51),j=c(8),k=c(6);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,e._registerClass("light",d),d.prototype._prepare=function(a){if(k.defaults(a,{direction:[0,0,0],color:[1,1,1],shadowCaster:!1,lightCookie:null}),"DirectionalLight"!==a.type&&(a.range=void 0!==a.range?a.range:1e3),a.shadowCaster){a.shadowSettings=a.shadowSettings||{},k.defaults(a.shadowSettings,{shadowType:"Basic",near:1,far:1e3,resolution:[512,512],darkness:.5,shadowOffset:-.001});var b=a.shadowSettings;"Parallel"===b.projection?b.size=void 0!==b.size?b.size:400:b.fov=void 0!==b.fov?b.fov:55}},d.prototype._create=function(){return new f},d.prototype.update=function(a,b,c){var d=this,f={SpotLight:h,DirectionalLight:i,PointLight:g};return e.prototype.update.call(this,a,b,c).then(function(a){if(a){var e=a.light;e&&f[b.type]===e.constructor||(e=new f[b.type],a.light=e);for(var g in b){var h=b[g];if(e.hasOwnProperty(g))if("shadowSettings"===g)for(var g in h){var i=h[g];e.shadowSettings[g]instanceof j?e.shadowSettings[g].setDirect(i[0],i[1],i[2]):e.shadowSettings[g]=k.clone(i)}else e[g]instanceof j?e[g].setDirect(h[0],h[1],h[2]):e[g]=k.clone(h)}if("PointLight"===b.type&&(e.shadowCaster=!1),b.lightCookie&&"PointLight"!==b.type){var l=b.lightCookie;return l&&l.textureRef&&l.enabled!==!1?d._load(l.textureRef,c).then(function(b){return e.lightCookie=b,a}):(e.lightCookie=null,a)}return e.lightCookie=null,a}})},a.exports=d},function(a,b,c){function d(){e.apply(this,arguments)}var e=c(85),f=c(30),g=c(46),h=c(43),i=c(55),j=c(6);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,e._registerClass("material",d),d.ENGINE_SHADER_PREFIX="GOO_ENGINE_SHADERS/",d.prototype._prepare=function(a){j.defaults(a,{blendState:{},cullState:{},depthState:{},renderQueue:-1,dualTransparency:!1,wireframe:!1,flat:!1}),j.defaults(a.blendState,{blending:"NoBlending",blendEquation:"AddEquation",blendSrc:"SrcAlphaFactor",blendDst:"OneMinusSrcAlphaFactor"}),j.defaults(a.cullState,{enabled:!0,cullFace:"Back",frontFace:"CCW"}),j.defaults(a.depthState,{enabled:!0,write:!0})},d.prototype._create=function(){return new f},d.prototype._remove=function(a){var b=this._objects.get(a);b&&(b.empty(),this._objects["delete"](a))},d.prototype._update=function(a,b,c){var k=this;return e.prototype._update.call(this,a,b,c).then(function(a){function e(b,c,d){return k._load(c,d).then(function(c){a.setTexture(b,c)}).then(null,function(a){throw new Error("Error loading texture: "+c+" - "+a)})}if(a){var l=[];j.extend(a.blendState,b.blendState),j.extend(a.cullState,b.cullState),j.extend(a.depthState,b.depthState),a.id=b.id,a.name=b.name,a.wireframe=b.wireframe,a.flat=b.flat,a.dualTransparency=b.dualTransparency,-1===b.renderQueue?"NoBlending"!==b.blendState.blending?a.renderQueue=h.TRANSPARENT:a.renderQueue=null:a.renderQueue=b.renderQueue,a.uniforms={};for(var m in b.uniforms)void 0===b.uniforms[m].enabled?a.uniforms[m]=j.clone(b.uniforms[m]):b.uniforms[m].enabled&&(a.uniforms[m]=j.clone(b.uniforms[m].value));void 0!==a.uniforms.materialDiffuse&&(a.uniforms.materialDiffuse[3]=1),void 0!==a.uniforms.materialAmbient&&(a.uniforms.materialAmbient[3]=1),void 0!==a.uniforms.materialEmissive&&(a.uniforms.materialEmissive[3]=1),void 0!==a.uniforms.materialSpecular&&void 0!==a.uniforms.materialSpecularPower&&(a.uniforms.materialSpecular[3]=a.uniforms.materialSpecularPower);var n=b.shaderRef;if(n)if(0===n.indexOf(d.ENGINE_SHADER_PREFIX)){var o=n.slice(d.ENGINE_SHADER_PREFIX.length);a.shader=f.createShader(g[o])}else{var p=k._load(n,c).then(function(b){a.shader=b}).then(null,function(a){throw new Error("Error loading shader: "+a)});l.push(p)}else a.shader=f.createShader(g.texturedLit,"DefaultShader");var q;for(var r in b.texturesMapping)q=b.texturesMapping[r],q&&q.textureRef&&q.enabled!==!1?l.push(e(r,q.textureRef,c)):a.removeTexture(r);for(var r in a._textureMaps)b.texturesMapping[r]||a.removeTexture(r);return i.all(l).then(function(){return a})}})},a.exports=d},function(a,b,c){function d(){e.apply(this,arguments),this._type="MeshDataComponent"}var e=c(88),f=c(216),g=c(7),h=c(320),i=c(55),j=c(6),k=c(36);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,e._registerClass("meshData",d),d.prototype._prepare=function(a){return j.defaults(a,{})},d.prototype._create=function(){return new f},d.prototype._remove=function(a){a.meshDataComponent&&a.meshDataComponent.meshData&&this.world.gooRunner&&a.meshDataComponent.meshData.destroy(this.world.gooRunner.renderer.context),a.clearComponent("MeshDataComponent")},d.prototype.update=function(a,b,c){var d=this;return e.prototype.update.call(this,a,b,c).then(function(a){if(a)if(b.shape){var e=h["create"+k.capitalize(b.shape)];if(e)return a.meshData=e(b.shapeOptions,a.meshData),a.autoCompute=!0,a}else{if(b.meshRef){var f=[];return f.push(d._load(b.meshRef,c).then(function(b){if(a.meshData=b,b.boundingBox){var c=b.boundingBox.min,d=b.boundingBox.max,e=[d[0]-c[0],d[1]-c[1],d[2]-c[2]],f=[.5*(d[0]+c[0]),.5*(d[1]+c[1]),.5*(d[2]+c[2])],h=new g;h.xExtent=e[0]/2,h.yExtent=e[1]/2,h.zExtent=e[2]/2,h.center.setDirect(f[0],f[1],f[2]),a.modelBound=h,a.autoCompute=!1}})),b.poseRef?f.push(d._load(b.poseRef,c).then(function(b){a.currentPose=b})):a.currentPose=null,i.all(f).then(function(){return a})}console.warn("MeshDataComponent config does not contain a primitive spec or a reference to a mesh")}})},a.exports=d},function(a,b,c){function d(){e.apply(this,arguments)}var e=c(85),f=c(14),g=c(16),h=c(17),i=c(54),j=c(86),k=4;d.prototype=Object.create(e.prototype),d.prototype.constructor=d,e._registerClass("mesh",d),d.prototype._remove=function(a){var b=this._objects.get(a);b&&this.world.gooRunner&&b.destroy(this.world.gooRunner.renderer.context),this._objects["delete"](a)},d.prototype._update=function(a,b,c){if(!b)return this._remove(a),i.resolve();var d=this._objects.get(a);return d?i.resolve(d):this.loadObject(b.binaryRef,c).then(function(c){if(!c)throw new Error("Binary mesh data was empty");var d=this._createMeshData(b,c);return this._fillMeshData(d,b,c),this._objects.set(a,d),
d}.bind(this))},d.prototype._createMeshData=function(a){var b="SkinnedMesh"===a.type,c=a.vertexCount;if(0===c)return null;var d=0;a.indexLengths?d=a.indexLengths.reduce(function(a,b){return a+b}):a.indices&&(d=a.indices.wordLength);var e={float32:"Float",uint8:"UnsignedByte",uint16:"UnsignedShort",uint32:"UnsignedInt"};"Trident"===g.browserType&&(e.uint8="UnsignedShort");var h={};for(var i in a.attributes){var j=a.attributes[i],k=j.value[2];h[i]=f.createAttribute(j.dimensions,e[k])}var l=new f(h,c,d);return l.type=b?f.SKINMESH:f.MESH,l},d.prototype._fillMeshData=function(a,b,c){var d=a.type===f.SKINMESH;for(var e in b.attributes)if("JOINTIDS"!==e){var g=b.attributes[e].value;a.getAttributeBuffer(e).set(j.getTypedArray(c,g))}if(d&&b.attributes.JOINTIDS){for(var i=a.getAttributeBuffer(f.JOINTIDS),l=j.getTypedArray(c,b.attributes.JOINTIDS.value),m=[],n=0,o=0;o<l.length;o++){var p=l[o];void 0===m[p]&&(m[p]=n++),i.set([m[p]],o)}for(var q=[],p=0;p<m.length;p++){var n=m[p];null!==n&&(q[n]=p)}a.paletteMap=q,a.weightsPerVertex=k}if(a.getIndexBuffer().set(j.getTypedArray(c,b.indices)),a.indexModes=b.indexModes.slice(),a.indexLengths=b.indexLengths.slice(),b.boundingVolume){if("BoundingBox"!==b.boundingVolume.type)throw new Error("Bounding volume was not BoundingBox");a.boundingBox={min:b.boundingVolume.min,max:b.boundingVolume.max}}return!h.ElementIndexUInt&&a.vertexCount>65536&&a.deIndex(),a},a.exports=d},function(a,b,c){function d(){e.apply(this,arguments),this._type="MeshRendererComponent"}var e=c(88),f=c(215),g=c(30),h=c(46),i=c(55),j=c(6);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,e._registerClass("meshRenderer",d),d.DEFAULT_MATERIAL=new g(h.uber,"Default material"),d.prototype._prepare=function(a){return j.defaults(a,{cullMode:"Dynamic",castShadows:!0,receiveShadows:!0,reflectable:!0})},d.prototype._create=function(){return new f},d.prototype.update=function(a,b,c){var f=this;return e.prototype.update.call(this,a,b,c).then(function(a){if(a){a.cullMode=b.cullMode,a.castShadows=b.castShadows,a.receiveShadows=b.receiveShadows,a.isReflectable=b.reflectable;var e=b.materials;if(!e||!Object.keys(e).length){var g=a.materials.filter(function(a){return"gooSelectionIndicator"===a.name});return a.materials=[d.DEFAULT_MATERIAL].concat(g),a}var h=[];return j.forEach(e,function(a){h.push(f._load(a.materialRef,c))},null,"sortValue"),i.all(h).then(function(b){var c=a.materials.filter(function(a){return"gooSelectionIndicator"===a.name});return a.materials=b.concat(c),a})}})},a.exports=d},function(a,b,c){function d(){e.apply(this,arguments)}var e=c(85),f=c(44),g=c(6),h=c(55);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,e._registerClass("scene",d),d.prototype._remove=function(a){var b=this._objects.get(a);if(b)for(var c=0;c<b.entities.length;c++)b.entities[c].removeFromWorld();this._objects["delete"](a)},d.prototype._create=function(){return{id:null,entities:{},posteffects:[],environment:null,initialCameraRef:null}},d.prototype._update=function(a,b,c){var d=this;return e.prototype._update.call(this,a,b,c).then(function(e){if(e){e.id=a;var g=[];return g.push(d._handleEntities(b,e,c)),b.posteffectsRef&&g.push(d._load(b.posteffectsRef,c)),b.environmentRef&&g.push(d._load(b.environmentRef,c)),c.scene&&c.scene.dontSetCamera||b.initialCameraRef&&b.initialCameraRef!==e.initialCameraRef&&g.push(d._load(b.initialCameraRef,c).then(function(a){a&&a.cameraComponent&&f.emit("goo.setCurrentCamera",{camera:a.cameraComponent.camera,entity:a}),e.initialCameraRef=b.initialCameraRef})),h.all(g).then(function(){return e})}})},d.prototype._handleEntities=function(a,b,c){var d=this,e=[],f=g.clone(a.entities),i=[];for(var j in b.entities)f[j]?delete f[j]:i[j]=j;return g.forEach(a.entities,function(a){e.push(d._load(a.entityRef,c))},null,"sortValue"),h.all(e).then(function(a){for(var c=0;c<a.length;c++){var d=a[c];f[d.id]&&d.addToWorld(),f[d.id]||i[d.id]||d._world.entityManager.containsEntity(d)||d.addToWorld(),b.entities[d.id]=d}for(var e in i)delete b.entities[e]})},d.prototype._handlePosteffects=function(a,b,c){return this._load(a.posteffectsRef,c)},d.prototype._handleEnvironment=function(a,b,c){return this._load(a.environmentRef,c)},a.exports=d},function(a,b,c){function d(){e.apply(this,arguments)}var e=c(85),f=c(30),g=c(48),h=c(55),i=c(54);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,e._registerClass("shader",d),d.prototype._remove=function(a){var b=this._objects.get(a);b&&this.world.gooRunner&&(b.destroy(this.world.gooRunner.renderer.context),this._objects["delete"](a))},d.prototype._update=function(a,b,c){if(!b)return this._remove(a),i.resolve();if(!b.vshaderRef)return i.reject("Shader error, missing vertex shader ref");if(!b.fshaderRef)return i.reject("Shader error, missing fragment shader ref");var d=[this.loadObject(b.vshaderRef,c),this.loadObject(b.fshaderRef,c)];return h.all(d).then(function(c){var d=c[0],e=c[1];if(!d)return i.reject("Vertex shader"+b.vshaderRef+"in shader"+a+"not found");if(!e)return i.reject("Fragment shader"+b.fshaderRef+"in shader"+a+"not found");var h={defines:b.defines||{},attributes:b.attributes||{},uniforms:b.uniforms||{},vshader:d,fshader:e};if(b.processors){h.processors=[];for(var j=0;j<b.processors.length;j++){var k=b.processors[j];g[k]?h.processors.push(g[k].processor):console.error("Unknown processor "+k)}}var l=f.createShader(h,a);return this._objects.set(a,l),l}.bind(this))},a.exports=d},function(a,b,c){function d(){e.apply(this,arguments),this._type="TransformComponent"}var e=c(88),f=c(40),g=c(9),h=c(6),i=c(55);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,e._registerClass("transform",d),d.prototype._prepare=function(a){return h.defaults(a,{translation:[0,0,0],rotation:[0,0,0],scale:[1,1,1]})},d.prototype._create=function(){return new f},d.prototype._remove=function(a){var b=a.transformComponent;b.transform.translation.setDirect(0,0,0),b.transform.setRotationXYZ(0,0,0),b.transform.scale.setDirect(1,1,1);for(var c=0;c<b.children.length;c++){var d=b.children[c];b.detachChild(d)}b.setUpdated()},d.prototype.update=function(a,b,c){function d(a,b){return f.loadObject(b,c).then(function(b){if(b&&b.transformComponent){a.attachChild(b.transformComponent);var c=f.world.entityManager.containsEntity(b)||-1!==f.world._addedEntities.indexOf(b),d=f.world.entityManager.containsEntity(a.entity)||f.world._addedEntities.indexOf(a.entity)>-1;!c&&d&&b.addToWorld()}else console.error("Failed to add child to transform component");return a})}var f=this;return e.prototype.update.call(this,a,b,c).then(function(a){if(a){a.transform.translation.setDirect(b.translation[0],b.translation[1],b.translation[2]),a.transform.setRotationXYZ(g.DEG_TO_RAD*b.rotation[0],g.DEG_TO_RAD*b.rotation[1],g.DEG_TO_RAD*b.rotation[2]),a.transform.scale.setDirect(b.scale[0],b.scale[1],b.scale[2]);var c=[];if(b.children){for(var e=Object.keys(b.children),f=0;f<e.length;f++){var h=b.children[e[f]].entityRef;c.push(d(a,h))}for(var f=0;f<a.children.length;f++){var j=a.children[f],k=j.entity.id;b.children[k]||a.detachChild(j)}}else for(var f=0;f<a.children.length;f++){var j=a.children[f];a.detachChild(j)}return i.all(c).then(function(){return a.setUpdated(),a})}})},a.exports=d},function(a,b,c){function d(){e.apply(this,arguments)}var e=c(85);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,e._registerClass("project",d),d.prototype._remove=function(a,b){var c=this._objects.get(a);c&&this.updateObject(c.mainScene.id,null,b)},d.prototype._create=function(){return{mainScene:null}},d.prototype._update=function(a,b,c){var d=this;return e.prototype._update.call(this,a,b,c).then(function(a){function e(){return d._load(b.mainSceneRef,c).then(function(b){return a.mainScene=b,a})}return a?a.mainScene&&b.mainSceneRef!==a.mainScene.id?d.updateObject(a.mainScene.id,null,c).then(e):e():void 0})},a.exports=d},function(a,b,c){function d(){e.apply(this,arguments),this._type="SoundComponent"}var e=c(88),f=c(333),g=c(305),h=c(55),i=c(54),j=c(6);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,e._registerClass("sound",d),d.prototype._remove=function(a){var b=a.soundComponent;if(b&&b.sounds)for(var c=b.sounds,d=0;d<c.length;d++)c[d].stop()},d.prototype._prepare=function(a){j.defaults(a,{volume:1,reverb:0})},d.prototype._create=function(){return new f},d.prototype.update=function(a,b,c){if(!g.isSupported())return i.resolve();var d=this;return e.prototype.update.call(this,a,b,c).then(function(a){if(a){a.updateConfig(b);for(var e=0;e<a.sounds.length;e++){var f=a.sounds[e];b.sounds[f.id]||a.removeSound(f)}var g=[];return j.forEach(b.sounds,function(a){g.push(d._load(a.soundRef,c))},null,"sortValue"),h.all(g).then(function(b){for(var c=0;c<b.length;c++)-1===a.sounds.indexOf(b[c])&&a.addSound(b[c]);return a})}})},a.exports=d},function(a,b,c){function d(){e.apply(this,arguments),this.type="SoundComponent",this._system=null,this.sounds=[],this._isPanned=!0,this._outDryNode=f.getContext().createGain(),this._outWetNode=f.getContext().createGain(),this.connectTo(),this._pannerNode=f.getContext().createPanner(),this._pannerNode.connect(this._outDryNode),this._inNode=f.getContext().createGain(),this._inNode.connect(this._pannerNode),this._inNode2d=f.getContext().createGain(),this._inNode2d.connect(this._outDryNode),this._oldPosition=new g,this._position=new g,this._orientation=new g,this._attachedToCamera=!1,this._autoPlayDirty=!1}var e=c(20),f=c(305),g=c(8),h=c(9);d.type="SoundComponent",d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.addSound=function(a){-1===this.sounds.indexOf(a)&&(a.spatialize?a.connectTo([this._inNode,this._outWetNode]):a.connectTo([this._inNode2d]),this.sounds.push(a),this._autoPlayDirty=!0)},d.prototype.removeSound=function(a){var b=this.sounds.indexOf(a);b>-1&&(a.stop(),this.sounds.splice(b,1),a.spatialize?a.disconnectFrom([this._inNode,this._outWetNode]):a.disconnectFrom([this._inNode2d]))},d.prototype.getSoundById=function(a){for(var b=0;b<this.sounds.length;b++)if(this.sounds[b].id===a)return this.sounds[b]},d.prototype.connectTo=function(a){this._outDryNode.disconnect(),this._outWetNode.disconnect(),a&&a.dry&&this._outDryNode.connect(a.dry),a&&a.wet&&this._outWetNode.connect(a.wet)},d.prototype.updateConfig=function(a){void 0!==a.volume&&(this._outDryNode.gain.value=h.clamp(a.volume,0,1)),void 0!==a.reverb&&(this._outWetNode.gain.value=h.clamp(a.reverb,0,1))},d.prototype._autoPlaySounds=function(){for(var a=this.sounds,b=0;b<a.length;b++){var c=a[b];c.autoPlay&&c.play()}},d.prototype.process=function(a,b){return this._pannerNode.rolloffFactor=a.rolloffFactor,this._pannerNode.maxDistance=a.maxDistance,this._autoPlayDirty&&this._system&&!this._system.passive&&(this._autoPlaySounds(),this._autoPlayDirty=!1),this._attachedToCamera||!b?(this._isPanned&&(this._inNode.disconnect(),this._inNode.connect(this._outDryNode),this._isPanned=!1),this._pannerNode.setPosition(0,0,0),void this._pannerNode.setOrientation(0,0,0)):(this._isPanned||(this._inNode.disconnect(),this._inNode.connect(this._pannerNode),this._isPanned=!0),b.getTranslation(this._position),this._oldPosition.set(this._position),this._orientation.setDirect(0,0,-1),this._orientation.applyPostVector(b),this._pannerNode.setPosition(this._position.x,this._position.y,this._position.z),void this._pannerNode.setOrientation(this._orientation.x,this._orientation.y,this._orientation.z))},a.exports=d},function(a,b,c){function d(){if(e.apply(this,arguments),this._audioCache={},void 0!==window.Audio){var a=new Audio;this._codecs=[{type:"mp3",enabled:!!a.canPlayType("audio/mpeg;")},{type:"ogg",enabled:!!a.canPlayType('audio/ogg; codecs="vorbis"')},{type:"wav",enabled:!!a.canPlayType('audio/wav; codecs="1"')}]}else this._codecs=[]}var e=c(85),f=c(305),g=c(335),h=c(54),i=c(6);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,e._registerClass("sound",d),d.prototype._remove=function(a){var b=this._objects.get(a);b&&(b.stop(),this._objects["delete"](a))},d.prototype._prepare=function(a){i.defaults(a,{loop:!1,audioRefs:{},volume:1,spatialize:!1,autoPlay:!1,name:"A Sound"})},d.prototype._create=function(){return new g},d.prototype._update=function(a,b,c){if(!f.isSupported())return h.resolve();var d=this;return e.prototype._update.call(this,a,b,c).then(function(a){if(a){a.update(b);for(var c=0;c<d._codecs.length;c++){var e=d._codecs[c],g=b.audioRefs[e.type];if(g&&e.enabled)return d._audioCache[g]?(a.setAudioBuffer(d._audioCache[g]),a):d.loadObject(g).then(function(a){return h.createPromise(function(b){f.getContext().decodeAudioData(a,function(a){b(a)},function(){console.error("Could not decode audio "+g),b(null)})})}).then(function(b){return b&&(d._audioCache[g]=b,a.setAudioBuffer(b)),a})}return console.warn("No supported audioformat was found"),a}})},a.exports=d},function(a,b,c){function d(){this.id=null,this.name=null,this._loop=!1,this._rate=1,this._offset=0,this._duration=null,this._volume=1,this._buffer=null,this._stream=null,this._streamSource=null,this._currentSource=null,this._outNode=e.getContext().createGain(),this.connectTo(),this._playStart=0,this._pausePos=0,this._endPromise=null,this._paused=!1,this.spatialize=!0,this.autoPlay=!1}var e=c(305),f=c(9),g=c(223),h=c(55);d.prototype.play=function(a){if(a=a||0,this._currentSource)return this._endPromise;if(this._endPromise=new h.Promise,!this._buffer||this._stream)return this._endPromise;var b=this._currentSource=e.getContext().createBufferSource();this._paused=!1,this._currentSource.onended=function(){this._currentSource!==b||this._paused||this.stop()}.bind(this),this._currentSource.playbackRate.value=this._rate,this._currentSource.connect(this._outNode),this._currentSource.buffer=this._buffer,this._currentSource.loop=this._loop,this._loop&&(this._currentSource.loopStart=this._offset,this._currentSource.loopEnd=this._duration+this._offset),this._playStart=e.getContext().currentTime-this._pausePos;var c=this._duration-this._pausePos;return this._loop?this._currentSource.start(a,this._pausePos+this._offset):this._currentSource.start(a,this._pausePos+this._offset,c),this._endPromise},d.prototype.pause=function(){this._currentSource&&(this._paused=!0,this._pausePos=(e.getContext().currentTime-this._playStart)%this._duration,this._pausePos/=this._rate,this._stop())},d.prototype.stop=function(a){this._paused=!1,this._pausePos=0,this._endPromise&&this._endPromise.resolve(),this._currentSource&&this._stop(a)},d.prototype.fadeIn=function(a){this.stop();var b=this._volume;this._outNode.gain.value=0;var c=this.fade(b,a);return this.play(),c},d.prototype.fadeOut=function(a){return this._outNode.gain.value=this._volume,this.fade(0,a)},d.prototype.fade=function(a,b){return this._outNode.gain.cancelScheduledValues(e.getContext().currentTime),this._outNode.gain.setValueAtTime(this._outNode.gain.value,e.getContext().currentTime),this._outNode.gain.linearRampToValueAtTime(a,e.getContext().currentTime+b),g.delay(a,1e3*b)},d.prototype.isPlaying=function(){return!!this._currentSource},d.prototype._stop=function(a){a=a||0,this._currentSource.stop(a),this._currentSource=null},d.prototype.update=function(a){a=a||{},void 0!==a.id&&(this.id=a.id),void 0!==a.name&&(this.name=a.name),void 0!==a.loop&&(this._loop=!!a.loop,this._currentSource&&(this._currentSource.loop=this._loop)),void 0!==a.volume&&(this._volume=f.clamp(a.volume,0,1),this._outNode.gain.value=this._volume),void 0!==a.offset&&(this._offset=a.offset),void 0!==a.duration&&(this._duration=a.duration),void 0!==a.timeScale&&(this._rate=a.timeScale,this._currentSource&&(this._currentSource.playbackRate.value=a.timeScale)),void 0!==a.spatialize&&(this.spatialize=a.spatialize),void 0!==a.autoPlay&&(this.autoPlay=a.autoPlay),this._buffer&&this._clampInterval()},d.prototype._clampInterval=function(){this._offset=Math.min(this._offset,this._buffer.duration),null!==this._duration?this._duration=Math.min(this._buffer.duration-this._offset,this._duration):this._duration=this._buffer.duration-this._offset,this._pausePos=f.clamp(this._pausePos,0,this._duration)},d.prototype.connectTo=function(a){if(a){a instanceof Array||(a=[a]);for(var b=0;b<a.length;b++)this._outNode.connect(a[b])}},d.prototype.disconnectFrom=function(a){if(a){a instanceof Array||(a=[a]);for(var b=0;b<a.length;b++)this._outNode.disconnect(a[b])}},d.prototype.setAudioBuffer=function(a){this.setAudioStream(null),this._buffer=a,this._clampInterval()},d.prototype.setAudioStream=function(a){return a?(this.stop(),this._stream=a,this._streamSource=e.getContext().createMediaStreamSource(a),void this._streamSource.connect(this._outNode)):void(this._streamSource&&(this._streamSource.disconnect(),this._streamSource=null))},a.exports=d},function(a,b,c){function d(){e.apply(this,arguments)}var e=c(85),f=c(6),g=c(44),h=c(48),i=c(337),j=c(55),k={backgroundColor:[.3,.3,.3,1],globalAmbient:[0,0,0],fog:{enabled:!1,color:[1,1,1],near:10,far:1e3}},l={volume:1,reverb:0,rolloffFactor:.4,maxDistance:100};d.prototype=Object.create(e.prototype),d.prototype.constructor=d,e._registerClass("environment",d),d.prototype._prepare=function(a){f.defaults(a,k)},d.prototype._create=function(){return{weatherState:{}}},d.prototype._remove=function(a){var b=this._objects.get(a);if(this._objects["delete"](a),b){for(var c in b.weatherState)d.weatherHandlers[c].remove(b.weatherState);g.emit("goo.setClearColor",k.backgroundColor),h.CLEAR_COLOR=k.backgroundColor,h.GLOBAL_AMBIENT=k.globalAmbient.slice(0,3),h.USE_FOG=k.fog.enabled,h.FOG_COLOR=k.fog.color.slice(0,3),h.FOG_SETTINGS=[k.fog.near,k.fog.far];var e=this.world.getSystem("SoundSystem");e&&(e.updateConfig(l),e.setReverb(null))}},d.prototype._update=function(a,b,c){var i=this;return e.prototype._update.call(this,a,b,c).then(function(a){if(a){var e=b.backgroundColor,k=e[3];a.backgroundColor=[e[0]*k,e[1]*k,e[2]*k,e[3]],a.globalAmbient=b.globalAmbient.slice(0,3),a.fog=f.deepClone(b.fog),g.emit("goo.setClearColor",a.backgroundColor),h.CLEAR_COLOR=a.backgroundColor,h.GLOBAL_AMBIENT=a.globalAmbient,h.USE_FOG=a.fog.enabled,h.FOG_COLOR=a.fog.color.slice(0,3),h.FOG_SETTINGS=[a.fog.near,b.fog.far];for(var l in b.weather){var m=d.weatherHandlers[l];m&&m.update.call(i,b.weather[l],a.weatherState)}var n=[];if(b.skyboxRef)d.currentSkyboxRef=b.skyboxRef,n.push(i._load(b.skyboxRef,{reload:!0}));else if(d.currentSkyboxRef){var o=i.updateObject(d.currentSkyboxRef,null).then(function(){delete d.currentSkyboxRef});n.push(o)}var p=i.world.getSystem("SoundSystem");if(b.sound&&p)if(p.updateConfig(b.sound),b.sound.reverbRef){var o=i._load(b.sound.reverbRef,c).then(function(a){p.setReverb(a._buffer)});n.push(o)}else p.setReverb(null);return j.all(n).then(function(){return a})}})},d.weatherHandlers={snow:{update:function(a,b){a.enabled?(b.snow&&b.snow.enabled||(b.snow=b.snow||{},b.snow.enabled=!0,b.snow.snow=new i(this.world.gooRunner)),b.snow.snow.setEmissionVelocity(a.velocity),b.snow.snow.setReleaseRatePerSecond(a.rate),b.snow.snow.setEmissionHeight(a.height)):b.snow&&b.snow.enabled&&(b.snow.snow.remove(),b.snow.enabled=!1,delete b.snow.snow)},remove:function(a){a.snow&&a.snow.snow&&(a.snow.snow.remove(),a.snow.enabled=!1,delete a.snow.snow)}}},a.exports=d},function(a,b,c){function d(a){this.velocity=10,this.height=25,this.material=new e(f.particles);var b=h.createFlareTexture(64);b.generateMipmaps=!0,this.material.setTexture("DIFFUSE_MAP",b),this.material.blendState.blending="AdditiveBlending",this.material.cullState.enabled=!1,this.material.depthState.write=!1,this.material.renderQueue=2002;var c=this;this.particleCloudEntity=h.createParticleSystemEntity(a.world,g.getSnow({getEmissionPoint:function(a){a.copy(i.mainCamera?i.mainCamera.translation:new j),a.x+=1e3*Math.random()-500,a.y+=c.height,a.z+=1e3*Math.random()-500},getEmissionVelocity:function(a){a.x=2*(Math.random()-.5),a.y=-(Math.random()+1)*c.velocity,a.z=2*(Math.random()-.5)}}),this.material),this.particleCloudEntity.name="_ParticleSystemSnow",this.onCameraChange=function(a){a.entity.attachChild(this.particleCloudEntity)}.bind(this),this.particleCloudEntity.transformComponent.transform.translation.copy(i.mainCamera?i.mainCamera.translation:new j),this.particleCloudEntity.addToWorld()}var e=c(30),f=c(46),g=c(209),h=c(210),i=c(123),j=c(8);d.prototype.setEmissionVelocity=function(a){if(a){this.velocity=a;for(var b=this.particleCloudEntity.particleComponent,c=b.particles,d=0;d<c.length;d++)c[d].velocity.y=-(Math.random()+1)*this.velocity}},d.prototype.setEmissionHeight=function(a){a&&(this.height=a)},d.prototype.setReleaseRatePerSecond=function(a){if(a){var b=this.particleCloudEntity.particleComponent,c=b.emitters[0];c.releaseRatePerSecond=a}},d.prototype.remove=function(){this.particleCloudEntity.removeFromWorld()},a.exports=d},function(a,b,c){function d(){f.apply(this,arguments),this._activeSkyboxRef=null;var a=new j("box",[],null,0);this._skybox=this.world.createEntity(a.meshData,a.materials[0],a.transform),this._skybox.transformComponent.sync(),this._skybox.isSkybox=!0,this._skybox.name="Skybox_box",this._skyboxTexture=new h(null,{flipY:!1}),this._skyboxTexture.variant="CUBE",this._skyboxTexture.wrapS="EdgeClamp",this._skyboxTexture.wrapT="EdgeClamp",this._skybox.meshRendererComponent.materials[0].setTexture("DIFFUSE_MAP",this._skyboxTexture);var b=new j("sphere",[],null,0);this._skysphere=this.world.createEntity(b.meshData,b.materials[0],b.transform),this._skysphere.transformComponent.sync(),this._skysphere.isSkybox=!0,this._skysphere.name="Skybox_sphere",this._skysphereTexture=new h(null,{flipY:!1,wrapS:"EdgeClamp",wrapT:"EdgeClamp"}),this._skysphere.meshRendererComponent.materials[0].setTexture("DIFFUSE_MAP",this._skysphereTexture),this._activeSkyshape=null}function e(a,b){var c=a.length;if(c!==b.length)return!1;for(;c--;)if(a[c]!==b[c])return!1;return!0}var f=c(85),g=c(336),h=c(53),i=c(48),j=c(339),k=c(55),l=c(54),m=c(44);d.prototype=Object.create(f.prototype),d.prototype.constructor=d,f._registerClass("skybox",d),d.prototype._remove=function(a){this._objects["delete"](a),this._activeSkyboxRef===a&&(this._hide(this._skybox),this._hide(this._skysphere),this._skyboxTexture.setImage(null),this._activeSkyshape=null,i.SKYBOX=null,i.SKYSPHERE=null,this._activeSkyboxRef=null)},d.prototype._create=function(){return{textures:[],enabled:!1}},d.prototype._update=function(a,b,c){var d=this;return f.prototype._update.call(this,a,b,c).then(function(e){if(!e)return l.resolve([]);var f=[];return b.box&&f.push(d._updateBox(a,b.box,c,e)),b.sphere&&f.push(d._updateSphere(a,b.sphere,c,e)),k.all(f).then(function(c){return(b.box||b.sphere)&&(d._activeSkyboxRef=a),c})})},d.prototype._updateSphere=function(a,b,c,d){var e=this;return b.sphereRef?this._load(b.sphereRef,c).then(function(c){if(!c||!c.image)return m.emit("goo.error.skybox",{type:"Sphere",message:"The skysphere needs an image to display."}),void e._hide(e._skysphere);if(c===d.textures[0]&&e._activeSkyshape===e._skysphere)return e._skysphere;if(a===g.currentSkyboxRef&&b.enabled){var f=e._skysphereTexture;d.textures=[c],f.setImage(c.image),e._show(e._skysphere)}else b.enabled||e._hide(e._skysphere);return e._skysphere}):(e._skysphereTexture.setImage(null),e._hide(e._skysphere),l.resolve(e._skysphere))};var n=["rightRef","leftRef","topRef","bottomRef","frontRef","backRef"];d.prototype._updateBox=function(a,b,c,d){var f=this,h=n.map(function(a){return b[a]?f._load(b[a],c):l.resolve()});return k.all(h).then(function(c){if(e(c,d.textures)&&f._activeSkyshape===f._skybox)return f._skybox;var h=c.map(function(a){return a?a.image:null});if(0===h.filter(Boolean).length)return f._skyboxTexture.setImage(null),f._hide(f._skybox),f._skybox;for(var i=1,j=1,k=0;k<h.length;k++)h[k]&&(i=Math.max(i,h[k].width),j=Math.max(j,h[k].width));if(a===g.currentSkyboxRef&&b.enabled){d.textures=c;var l=f._skyboxTexture;l.setImage(h),l.image.width=i,l.image.height=j,l.image.dataReady=!0,l.setNeedsUpdate(),f._show(f._skybox)}else b.enabled||f._hide(f._skybox);return f._skybox})},d.prototype._hide=function(a){var b=this.world.getSystem("RenderSystem");b.removed(a),a===this._skybox?i.SKYBOX=null:a===this._skysphere&&(i.SKYSPHERE=null)},d.prototype._show=function(a){var b=this.world.getSystem("RenderSystem");this._activeSkyshape&&b.removed(this._activeSkyshape),b.added(a),this._activeSkyshape=a,i.SKYBOX=a===this._skybox?this._skyboxTexture:null,i.SKYSPHERE=a===this._skysphere?this._skysphereTexture:null},a.exports=d},function(a,b,c){function d(a,b,c,g){var m;if(a===d.SPHERE)this.meshData=new f(16,32,1,c||f.TextureModes.Projected),b instanceof Array&&(b=b[0]),b&&(m=(new j).loadTexture2D(b));else{if(a!==d.BOX)throw new Error("Unknown geometry type");this.meshData=new e(1,1,1),b.length&&(m=(new j).loadTextureCube(b,{flipY:!1,wrapS:"EdgeClamp",wrapT:"EdgeClamp"}))}var n=new h(l[a],"Skybox material");n.cullState.cullFace="Front",n.depthState.enabled=!1,n.renderQueue=1,m&&m.then(function(a){n.setTexture(i.DIFFUSE_MAP,a)}),this.materials=[n],this.transform=new k;var o=a===d.SPHERE?Math.PI/2:0;this.transform.rotation.fromAngles(o,g,0),this.transform.update(),this.active=!0}var e=c(27),f=c(29),g=c(14),h=c(30),i=c(31),j=c(125),k=c(41);d.SPHERE="sphere",d.BOX="box";var l={};l.box={attributes:{vertexPosition:g.POSITION},uniforms:{normalMatrix:i.NORMAL_MATRIX,viewMatrix:i.VIEW_MATRIX,projectionMatrix:i.PROJECTION_MATRIX,near:i.NEAR_PLANE,diffuseMap:i.DIFFUSE_MAP},vshader:["attribute vec3 vertexPosition;","uniform mat3 normalMatrix;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform float near;","varying vec3 eyeVec;","void main(void) {","	eyeVec = vertexPosition * normalMatrix * near * 10.0;","	vec3 worldPos = mat3(viewMatrix) * eyeVec;","	gl_Position = projectionMatrix * vec4(worldPos, 1.0);","}"].join("\n"),fshader:["uniform samplerCube diffuseMap;","varying vec3 eyeVec;","void main(void) {","	vec4 cube = textureCube(diffuseMap, eyeVec);","	if (cube.a < 0.05) discard;","	gl_FragColor = cube;","}"].join("\n")},l.sphere={attributes:{vertexPosition:g.POSITION,vertexUV0:g.TEXCOORD0},uniforms:{normalMatrix:i.NORMAL_MATRIX,viewMatrix:i.VIEW_MATRIX,projectionMatrix:i.PROJECTION_MATRIX,near:i.NEAR_PLANE,diffuseMap:i.DIFFUSE_MAP},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat3 normalMatrix;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform float near;","varying vec2 texCoord0;","void main(void) {","	texCoord0 = vertexUV0;","	vec3 worldPos = mat3(viewMatrix) * normalMatrix * vertexPosition * near * 10.0;","	gl_Position = projectionMatrix * vec4(worldPos, 1.0);","}"].join("\n"),fshader:["precision mediump float;","uniform sampler2D diffuseMap;","varying vec2 texCoord0;","void main(void)","{","	vec4 sphere = texture2D(diffuseMap, texCoord0);","	if (sphere.a < 0.05) discard;","	gl_FragColor = sphere;","}"].join("\n")},a.exports=d},function(a,b,c){function d(){f.apply(this,arguments),this._type="HtmlComponent"}function e(a){return"__"+a.replace(j,"-")}var f=c(88),g=c(341),h=c(55),i=c(54);d.prototype=Object.create(f.prototype),f._registerClass("html",d),d.prototype.constructor=d,d.prototype._prepare=function(){},d.prototype._create=function(){return new g};var j=/\W/g;d.prototype.update=function(a,b,c){var d=this;return f.prototype.update.call(this,a,b,c).then(function(e){if(e){var f=e.domElement;return f||(f=e.domElement=d._createDomElement(a,e),d._attachDomElement(f,a)),e.useTransformComponent=b.useTransformComponent!==!1,e.pixelPerfect=void 0!==b.pixelPerfect?b.pixelPerfect:!0,d._updateHtml(f,a,b,c).then(function(){return d._updateAttributes(f,a,b),e})}})},d.prototype._createDomElement=function(a){var b=document.createElement("div");return b.id=e(a.id),b.className="goo-entity",this._addMouseListeners(b,a),this._addTouchListeners(b,a),b},d.prototype._addMouseListeners=function(a,b){var c=function(a){var c=b._world.gooRunner,d={entity:b,depth:0,x:a.pageX,y:a.pageY,domEvent:a,id:b.id,type:a.type};c.triggerEvent(a.type,d)};a.addEventListener("mousedown",c),a.addEventListener("mouseup",c),a.addEventListener("click",c)},d.prototype._addTouchListeners=function(a,b){var c=function(a){var c=b._world.gooRunner,d=c.renderer.domElement,e=a.changedTouches[0].pageX-d.getBoundingClientRect().left,f=a.changedTouches[0].pageY-d.getBoundingClientRect().top,g={entity:b,depth:0,x:e,y:f,domEvent:a,id:b.id,type:a.type};c.triggerEvent(a.type,g)};a.addEventListener("touchstart",c),a.addEventListener("touchmove",c),a.addEventListener("touchend",c)},d.prototype._attachDomElement=function(a,b){var c=b._world.gooRunner.renderer.domElement.parentElement||document.body;c.appendChild(a)},d.prototype._updateHtml=function(a,b,c,d){return c.innerHtml===a.prevInnerHtml?i.resolve():(a.prevInnerHtml=c.innerHtml,a.innerHTML=c.innerHtml,this._loadImages(a,d))},d.prototype._loadImages=function(a,b){function c(a){var c=a.getAttribute("data-id");return c?d.loadObject(c,b).then(function(b){return a.src=b.src,a},function(b){return console.error(b),delete a.src,a}):i.resolve()}var d=this,e=[].slice.apply(a.getElementsByTagName("IMG"));return h.all(e.map(c))},d.prototype._updateAttributes=function(a,b,c){var d,e,f,g=a.prevAttributes||{},h=Object.keys(g),i=c.attributes||{},j=Object.keys(i);for(d=0;d<h.length;++d)e=h[d],void 0===i[e]&&a.removeAttribute(h[d]);for(d=0;d<j.length;++d)e=j[d],f=i[e],f!==g[e]&&a.setAttribute(e,f);a.prevAttributes=c.attributes,i.style||a.setAttribute("style","position: absolute; top: 0; left: 0; z-index: 1; display: none"),b._world.getSystem("HtmlSystem").clearStyleCache(a)},d.prototype._remove=function(a){var b=a.htmlComponent;f.prototype._remove.call(this,a),b.domElement&&b.domElement.parentNode.removeChild(b.domElement)},a.exports=d},function(a,b,c){function d(a,b){b=b||{},e.apply(this,arguments),this.type="HtmlComponent",this.domElement=a,this.hidden=void 0!==b.hidden?b.hidden:!1,this.useTransformComponent=void 0!==b.useTransformComponent?b.useTransformComponent:!0,this.pixelPerfect=void 0!==b.pixelPerfect?b.pixelPerfect:!0}var e=c(20);d.type="HtmlComponent",d.prototype=Object.create(e.prototype),d.prototype.constructor=d,a.exports=d},function(a,b,c){function d(a,b,c,d){this.world=a,this.gridCount=b||1,this.gridSize=1,this.removeOldData=void 0!==c?c:!0,this.keepEntities=void 0!==d?d:!1,this.createdEntities=[]}var e=c(35),f=c(112),g=c(41),h=c(8),i=c(7),j=c(13);d.prototype.combine=function(){this.world.processEntityChanges(),this.world.getSystem("TransformSystem")._process(),this.world.getSystem("BoundingUpdateSystem")._process();var a=this.world.entityManager.getTopEntities();this.gridSize>1&&(this.gridSize=this._calculateBounds(a)/this.gridCount),this._combineList(a)},d.prototype._combineList=function(a){var b=a;this.createdEntities=[],a instanceof e==1&&(b=[a]);for(var c=new Map,d=[],f=0;f<b.length;f++)this._buildSubs(b[f],c,d);d.length>1&&(b=this.world.createEntity("RootCombined").addToWorld(),c.set(b,d));var g=this;c.forEach(function(a,b){a.length>0&&g._combine(b,a)})},d.prototype._buildSubs=function(a,b,c){if(!(a._hidden||a.skip||a.animationComponent||a.particleComponent)){c&&a["static"]!==!1||(c=[],b.set(a,c)),a["static"]&&a.meshDataComponent&&a.meshRendererComponent&&a.meshRendererComponent.worldBound&&c.push(a);for(var d=0;d<a.transformComponent.children.length;d++){var e=a.transformComponent.children[d];this._buildSubs(e.entity,b,c)}}},d.prototype._combine=function(a,b){var c=a.transformComponent.sync().worldTransform,d=new g,e=new g;c.invert(d);for(var h=new Map,i=0;i<b.length;i++){var j=b[i],k=j.meshRendererComponent.materials[0],l=j.meshDataComponent.meshData.attributeMap,m=Object.keys(l);if(m.sort(),m=m.join("_"),this.gridSize>1){var n=j.meshRendererComponent.worldBound.center.x/this.gridSize,o=j.meshRendererComponent.worldBound.center.z/this.gridSize;m=m+"_"+Math.round(n)+"_"+Math.round(o)}var p=h.get(k);p||(p=new Map,h.set(k,p));var q=p.get(m);q||(q=[],p.set(m,q)),q.push(j)}var r=this;h.forEach(function(b,c){b.forEach(function(b){if(1!==b.length){for(var g=new f,h=0;h<b.length;h++){var i=b[h];a!==i?e.multiply(d,i.transformComponent.sync().worldTransform):e.setIdentity(),
g.addMeshData(i.meshDataComponent.meshData,e),r.removeOldData?(i.clearComponent("meshDataComponent"),i.clearComponent("meshRendererComponent"),r.keepEntities||1!==i._components.length||0!==i.transformComponent.children.length||i.removeFromWorld()):(i.skip=!0,i._hidden=!0)}var j=g.build();for(var k in j){var i=r.world.createEntity(j[k],c);i.addToWorld(),a.attachChild(i),r.createdEntities.push(i)}}})})},d.prototype._calculateBounds=function(a){for(var b=!0,c=new i,d=0;d<a.length;d++){var e=a[d];e.traverse(function(a){if(a.meshRendererComponent&&!a.particleComponent)if(b){var d=a.meshRendererComponent.worldBound;d instanceof i?c.copy(d):d instanceof j?(c.center.set(d.center),c.xExtent=c.yExtent=c.zExtent=d.radius):(c.center.set(h.ZERO),c.xExtent=c.yExtent=c.zExtent=10),b=!1}else c.merge(a.meshRendererComponent.worldBound)})}return 2*Math.max(c.xExtent,c.zExtent)},d.prototype.cleanup=function(){for(var a=0;a<this.createdEntities.length;a++){var b=this.createdEntities[a];b.removeFromWorld(),b.parent().each(function(a){a.detachChild(b)})}},a.exports=d},function(a,b,c){var d=c(136);a.exports=d},function(a,b,c){function d(a){if(a=a||{},w.initAllShims(),this.world=new e({gooRunner:this,tpfSmoothingCount:a.tpfSmoothingCount}),this.renderer=new f(a),this.useTryCatch=void 0!==a.useTryCatch?a.useTryCatch:!0,this._setBaseSystems(),this._registerBaseComponents(),this.doProcess=!0,this.doRender=!0,a.showStats&&this.addStats(),void 0===a.logo||a.logo){var b=this._buildLogo(a.logo);b&&document.body.appendChild(b)}this.callbacksPreProcess=[],this.callbacksPreRender=[],this.callbacks=[],this.callbacksNextFrame=[],this._takeSnapshots=[],this.start=-1,this.animationId=0,a.manuallyStartGameLoop||this.startGameLoop(),a.debugKeys&&this._addDebugKeys(),this._events={click:null,mousedown:null,mouseup:null,mousemove:null,touchstart:null,touchend:null,touchmove:null},this._eventListeners={click:[],mousedown:[],mouseup:[],mousemove:[],touchstart:[],touchend:[],touchmove:[]},this._eventTriggered={click:null,mousedown:null,mouseup:null,mousemove:null,touchstart:null,touchend:null,touchmove:null},w.addVisibilityChangeListener(function(a){a?this._stopGameLoop():this.manuallyPaused||this._startGameLoop()}.bind(this)),this._picking={x:0,y:0,skipUpdateBuffer:!1,doPick:!1,pickingCallback:null,pickingStore:{},clearColorStore:[]},this.manuallyPaused=!!a.manuallyStartGameLoop,this._setupContextLost()}var e=c(34),f=c(123),g=c(345),h=c(346),i=c(307),j=c(348),k=c(349),l=c(310),m=c(350),n=c(351),o=c(305),p=c(352),q=c(40),r=c(216),s=c(215),t=c(308),u=c(194),v=c(353),w=c(221),x=c(354),y=c(44),z=c(30);d.prototype._setupContextLost=function(){y.addListener("goo.contextLost",function(){for(var a=0;a<this.renderSystems.length;a++){var b=this.renderSystems[a];b.invalidateHandles&&b.invalidateHandles(this.renderer)}var c=this.world.getSystem("LightingSystem");c&&c.invalidateHandles(this.renderer),this.renderer.shadowHandler&&this.renderer.shadowHandler.invalidateHandles(this.renderer),this.renderer.invalidatePicking(),this.stopGameLoop()}.bind(this)),y.addListener("goo.contextRestored",function(){this.startGameLoop()}.bind(this))},d.prototype._setBaseSystems=function(){this.world.setSystem(new j(this.world)),this.world.setSystem(new g),this.world.setSystem(new l),this.world.setSystem(new m),this.world.setSystem(new i),this.world.setSystem(new k),o.isSupported()&&this.world.setSystem(new p),this.renderSystem=new h,this.renderSystems=[this.renderSystem],this.world.setSystem(this.renderSystem)},d.prototype._registerBaseComponents=function(){this.world.registerComponent(q),this.world.registerComponent(r),this.world.registerComponent(s),this.world.registerComponent(t),this.world.registerComponent(u),this.world.registerComponent(v)},d.prototype.run=function(a){this.useTryCatch?this._callSafe(this._updateFrame,a):this._updateFrame(a)},d.prototype._callSafe=function(a){try{a.apply(this,Array.prototype.slice.call(arguments,1))}catch(b){b instanceof Error?console.error(b.stack):console.log(b)}},d.prototype.setRenderSystem=function(a,b){this.world.setSystem(a),void 0!==b?this.renderSystems.splice(b,0,a):this.renderSystems.push(a)},d.prototype._updateFrame=function(a){this.start<0&&(this.start=a);var b=(a-this.start)/1e3;if(0>b)return this.start=a,void(this.animationId=window.requestAnimationFrame(this.run.bind(this)));if(this.start=a,this.callbacksNextFrame.length>0){var c=this.callbacksNextFrame;if(this.callbacksNextFrame=[],this.useTryCatch)for(var d=0;d<c.length;d++){var e=c[d];this._callSafe(e,b)}else for(var d=0;d<c.length;d++){var e=c[d];e(b)}}if(this.useTryCatch)for(var d=0;d<this.callbacksPreProcess.length;d++){var e=this.callbacksPreProcess[d];this._callSafe(e,b)}else for(var d=0;d<this.callbacksPreProcess.length;d++){var e=this.callbacksPreProcess[d];e(b)}if(this.doProcess&&this.world.update(b),this.renderer.info.reset(),this.doRender){this.renderer.checkResize(f.mainCamera),this.renderer.setRenderTarget(),this.world.onPreRender();for(var d=0;d<this.callbacksPreRender.length;d++)this.callbacksPreRender[d](b);for(var d=0;d<this.renderSystems.length;d++)this.renderSystems[d].passive||this.renderSystems[d].render(this.renderer);if(this._picking.doPick&&f.mainCamera){var g=this.renderer.clearColor;this._picking.clearColorStore[0]=g.r,this._picking.clearColorStore[1]=g.g,this._picking.clearColorStore[2]=g.b,this._picking.clearColorStore[3]=g.a,this.renderer.setClearColor(0,0,0,1);for(var d=0;d<this.renderSystems.length;d++)this.renderSystems[d].renderToPick&&!this.renderSystems[d].passive&&this.renderSystems[d].renderToPick(this.renderer,this._picking.skipUpdateBuffer);this.renderer.pick(this._picking.x,this._picking.y,this._picking.pickingStore,f.mainCamera),this.useTryCatch?this._callSafe(this._picking.pickingCallback,this._picking.pickingStore.id,this._picking.pickingStore.depth):this._picking.pickingCallback(this._picking.pickingStore.id,this._picking.pickingStore.depth),this._picking.doPick=!1,this.renderer.setClearColor.apply(this.renderer,this._picking.clearColorStore)}this.world.onPostRender()}if(this.useTryCatch)for(var d=0;d<this.callbacks.length;d++){var e=this.callbacks[d];this._callSafe(e,b)}else for(var d=0;d<this.callbacks.length;d++){var e=this.callbacks[d];e(b)}if(this.stats&&this.stats.update(this.renderer.info.toString()+"<br>Transforms: "+this.world.getSystem("TransformSystem").numUpdates+"<br>Cached shaders: "+this.renderer.rendererRecord.shaderCache.size),this._takeSnapshots.length){var h=this.renderer.domElement.toDataURL();if(this.useTryCatch)for(var d=this._takeSnapshots.length-1;d>=0;d--){var e=this._takeSnapshots[d];this._callSafe(e,h)}else for(var d=this._takeSnapshots.length-1;d>=0;d--){var e=this._takeSnapshots[d];e(h)}this._takeSnapshots=[]}this.animationId&&(this.animationId=window.requestAnimationFrame(this.run.bind(this)))},d.prototype._buildLogo=function(a){var b=document.createElement("div"),c=a&&a.color?a.color:x.white,d=x.getLogo({width:"70px",height:"50px",color:c});return""!==d?(b.innerHTML='<a style="text-decoration: none;" href="http://www.goocreate.com" target="_blank">'+d+"</a>",b.style.position="absolute",b.style.zIndex="2000",a?"topright"===a||"topright"===a.position?(b.style.top="10px",b.style.right="10px"):"topleft"===a||"topleft"===a.position?(b.style.top="10px",b.style.left="10px"):"bottomright"===a||"bottomright"===a.position?(b.style.bottom="10px",b.style.right="10px"):(b.style.bottom="10px",b.style.left="10px"):(b.style.top="10px",b.style.right="10px"),b.id="goologo",b.style.webkitTouchCallout="none",b.style.webkitUserSelect="none",b.style.khtmlUserSelect="none",b.style.mozUserSelect="none",b.style.msUserSelect="none",b.style.userSelect="none",b.ondragstart=function(){return!1},b):void 0},d.prototype._addDebugKeys=function(){var a="shiftKey",b={50:"normals",222:"normals",51:"lit",52:"color",53:"wireframe",54:"flat",55:"texture",191:"texture",56:"+wireframe"};document.addEventListener("keydown",function(c){if(c[a])switch(c.which){case 32:w.toggleFullScreen();break;case 13:w.togglePointerLock();break;case 49:this.renderSystem.setDebugMaterial();break;default:b[c.which]&&this.renderSystem.setDebugMaterial(b[c.which])}}.bind(this),!1),document.addEventListener("mousedown",function(b){if(b[a]){var c=b.clientX,d=b.clientY;this.pick(c,d,function(a,b){var c=this.world.entityManager.getEntityById(a);console.log("Picked entity:",c,"At depth:",b)}.bind(this))}}.bind(this),!1)},d.prototype.addEventListener=function(a,b){!this._eventListeners[a]||this._eventListeners[a].indexOf(b)>-1||"function"==typeof b&&(this._eventListeners[a].push(b),1===this._eventListeners[a].length&&this._enableEvent(a))},d.prototype.removeEventListener=function(a,b){if(this._eventListeners[a]){var c=this._eventListeners[a].indexOf(b);c>-1&&this._eventListeners[a].splice(c,1),0===this._eventListeners[a].length&&this._disableEvent(a)}},d.prototype.triggerEvent=function(a,b){b.type=a,this._eventTriggered[a]=b.domEvent,this._dispatchEvent(b),y.emit("goo.trigger."+a,b)},d.prototype._dispatchEvent=function(a){for(var b=Object.keys(this._eventTriggered),c=0;c<b.length;c++){var d=b[c];if(this._eventTriggered[d]&&this._eventListeners[d]){var e={entity:a.entity,depth:a.depth,x:a.x,y:a.y,type:d,domEvent:this._eventTriggered[d],id:a.id,intersection:a.intersection};try{for(var f=0;f<this._eventListeners[d].length&&this._eventListeners[d][f](e)!==!1;f++);}catch(g){console.error(g)}this._eventTriggered[d]=null}}},d.prototype._enableEvent=function(a){if(!this._events[a]){var b=function(b){var c,d;if("touchstart"===b.type||"touchend"===b.type||"touchmove"===b.type)c=b.changedTouches[0].pageX-b.changedTouches[0].target.getBoundingClientRect().left,d=b.changedTouches[0].pageY-b.changedTouches[0].target.getBoundingClientRect().top;else{var e=b.target||b.srcElement,g=e.getBoundingClientRect();c=b.clientX-g.left,d=b.clientY-g.top}this._eventTriggered[a]=b,this.pick(c,d,function(a,b){var e=this.renderer.devicePixelRatio,g=this.world.entityManager.getEntityByIndex(a),h=f.mainCamera.getWorldPosition(c*e,d*e,this.renderer.viewportWidth,this.renderer.viewportHeight,b);this._dispatchEvent({entity:g,depth:b,x:c,y:d,id:a,intersection:h})}.bind(this))}.bind(this);this.renderer.domElement.addEventListener(a,b),this._events[a]=b}},d.prototype._disableEvent=function(a){this._events[a]&&this.renderer.domElement.removeEventListener(a,this._events[a]),this._events[a]=null},d.prototype._startGameLoop=function(){this.animationId||(this.start=-1,this.animationId=window.requestAnimationFrame(this.run.bind(this)))},d.prototype.startGameLoop=function(){this.manuallyPaused=!1,this._startGameLoop()},d.prototype._stopGameLoop=function(){window.cancelAnimationFrame(this.animationId),this.animationId=0},d.prototype.stopGameLoop=function(){this.manuallyPaused=!0,this._stopGameLoop()},d.prototype.takeSnapshot=function(a){this._takeSnapshots.push(a)},d.prototype.pick=function(a,b,c,d){this._picking.x=a,this._picking.y=b,this._picking.skipUpdateBuffer=void 0===d?!1:d,c&&(this._picking.pickingCallback=c),this._picking.doPick=!0},d.prototype.pickSync=function(a,b,c){var d=this.renderer.clearColor;this._picking.skipUpdateBuffer=void 0===c?!1:c;var e=d.clone();this.renderer.setClearColor(0,0,0,1),this.renderSystem.renderToPick(this.renderer,!1),this.renderer.setClearColor(e.r,e.g,e.b,e.a);var g={};return this.renderer.pick(a,b,g,f.mainCamera),g},d.prototype.clear=function(){this.stopGameLoop(),this.world.clear();var a=this.renderer.domElement;a.parentNode&&a.parentNode.removeChild(a),y.clear(),z.store=[],z.hash=[],f.mainCamera=null,w.clearVisibilityChangeListeners(),this.world=null,this.renderer=null,this.renderSystem=null,this.renderSystems=null,this.callbacks=null,this.callbacksPreProcess=null,this.callbacksPreRender=null,this.callbacksNextFrame=null,this._takeSnapshots=null,this._events=null},d.prototype.addStats=function(){this.stats=new n,this.stats.domElement.style.position="absolute",this.stats.domElement.style.left="10px",this.stats.domElement.style.top="10px",document.body.appendChild(this.stats.domElement)},d.prototype.removeStats=function(){this.stats&&(this.stats.domElement.parentNode.removeChild(this.stats.domElement),this.stats=null)},a.exports=d},function(a,b,c){function d(){g.call(this,"TransformSystem",["TransformComponent"]),this.numUpdates=0}function e(a){if(a.transformComponent._worldTransformDirty){a.transformComponent.updateWorldTransform(),f++;for(var b=a.transformComponent.children,c=0;c<b.length;c++)b[c]._worldTransformDirty=!0}}var f,g=c(42);d.prototype=Object.create(g.prototype),d.prototype.constructor=d,d.prototype.process=function(){var a=this._activeEntities;f=0;var b,c,d=a.length;for(b=0;d>b;b++)c=a[b].transformComponent,c._localTransformDirty&&c.updateTransform();for(b=0;d>b;b++){var g=a[b];c=g.transformComponent,null===c.parent&&g.traverse(e)}this.numUpdates=f},a.exports=d},function(a,b,c){function d(){e.call(this,"RenderSystem",["MeshRendererComponent","MeshDataComponent"]),this.entities=[],this.renderList=[],this.postRenderables=[],this.partitioner=new g,this.preRenderers=[],this.composers=[],this._composersActive=!0,this.doRender=!0,this._debugMaterials={},this.overrideMaterials=[],this.partitioningCamera=null,this.camera=null,this.lights=[],this.currentTpf=0,f.addListener("goo.setCurrentCamera",function(a){this.camera=a.camera}.bind(this)),f.addListener("goo.setLights",function(a){this.lights=a}.bind(this)),this.picking={doPick:!1,x:0,y:0,pickingStore:{},pickingCallback:function(a,b){console.log(a,b)},skipUpdateBuffer:!1}}var e=c(42),f=c(44),g=c(347),h=c(30),i=c(46),j=c(6);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.pick=function(a,b,c,d){this.picking.x=a,this.picking.y=b,this.picking.skipUpdateBuffer=void 0===d?!1:d,c&&(this.picking.pickingCallback=c),this.picking.doPick=!0},d.prototype.inserted=function(a){this.partitioner&&this.partitioner.added(a)},d.prototype.deleted=function(a){this.partitioner&&this.partitioner.removed(a)},d.prototype.process=function(a,b){this.entities=a,this.currentTpf=b},d.prototype.render=function(a){if(this.doRender&&this.camera){a.updateShadows(this.partitioner,this.entities,this.lights);for(var b=0;b<this.preRenderers.length;b++){var c=this.preRenderers[b];c.process(a,this.entities,this.partitioner,this.camera,this.lights)}if(this.partitioningCamera?this.partitioner.process(this.partitioningCamera,this.entities,this.renderList):this.partitioner.process(this.camera,this.entities,this.renderList),this.composers.length>0&&this._composersActive)for(var b=0;b<this.composers.length;b++){var d=this.composers[b];d.render(a,this.currentTpf,this.camera,this.lights,null,!0,this.overrideMaterials)}else a.render(this.renderList,this.camera,this.lights,null,!0,this.overrideMaterials)}},d.prototype.renderToPick=function(a,b){a.renderToPick(this.renderList,this.camera,!0,b)},d.prototype.enableComposers=function(a){this._composersActive=!!a},d.prototype._createDebugMaterial=function(a){if(""!==a){var b;switch(a){case"wireframe":case"color":b=j.deepClone(i.simpleColored.fshader);break;case"lit":b=j.deepClone(i.simpleLit.fshader);break;case"texture":b=j.deepClone(i.textured.fshader);break;case"normals":b=j.deepClone(i.showNormals.fshader);break;case"simple":b=j.deepClone(i.simple.fshader)}var c=j.deepClone(i.uber);c.fshader=b,"flat"!==a?(this._debugMaterials[a]=new h(c,a),"wireframe"===a&&(this._debugMaterials[a].wireframe=!0),"lit"===a&&(this._debugMaterials[a]._textureMaps={EMISSIVE_MAP:null,DIFFUSE_MAP:null,SPECULAR_MAP:null,NORMAL_MAP:null,AO_MAP:null,LIGHT_MAP:null,TRANSPARENCY_MAP:null})):(this._debugMaterials[a]=h.createEmptyMaterial(null,a),this._debugMaterials[a].flat=!0)}},d.prototype.setDebugMaterial=function(a){if(!a||""===a)return void(this.overrideMaterials=[]);var b=a.split("+");this.overrideMaterials=[];for(var c=0;c<b.length;c++){var a=b[c];this._debugMaterials[a]||this._createDebugMaterial(a),""===a?this.overrideMaterials.push(null):this.overrideMaterials.push(this._debugMaterials[a])}},d.prototype.invalidateHandles=function(a){for(var b=0;b<this.entities.length;b++){for(var c=this.entities[b],d=c.meshRendererComponent.materials,e=0;e<d.length;e++)a.invalidateMaterial(d[e]);a.invalidateMeshData(c.meshDataComponent.meshData)}for(var b=0;b<this.composers.length;b++){var f=this.composers[b];a.invalidateComposer(f)}a.rendererRecord=null},a.exports=d},function(a,b,c){function d(){}var e=c(120);d.prototype.added=function(){},d.prototype.removed=function(){},d.prototype.process=function(a,b,c){for(var d=0,f=0;f<b.length;f++){var g=b[f];if(g.skip||g.meshRendererComponent.hidden)g.isVisible=!1;else if("Never"===g.meshRendererComponent.cullMode)c[d++]=g,g.isVisible=!0;else{var h=g.meshRendererComponent.worldBound,i=a.contains(h);i!==e.Outside?(c[d++]=g,g.isVisible=!0):g.isVisible=!1}}c.length=d},a.exports=d},function(a,b,c){function d(a){e.call(this,"ScriptSystem",["ScriptComponent"]),this._world=a;var b=this._world.gooRunner.renderer;this.context={domElement:b.domElement,viewportWidth:b.viewportWidth,viewportHeight:b.viewportHeight,world:a,activeCameraEntity:null,worldData:{},playTime:0},this._playing=!0,f.addListener("goo.setCurrentCamera",function(a){this.context.activeCameraEntity=a.entity}.bind(this)),f.addListener("goo.viewportResize",function(a){this.context.viewportWidth=a.width,this.context.viewportHeight=a.height}.bind(this)),this.manualSetup=!1,this.priority=500}var e=c(42),f=c(44);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.play=function(){this.context.playTime=0,this._playing=!0},d.prototype.resume=function(){this._playing=!0},d.prototype.pause=function(){this._playing=!1},d.prototype.stop=d.prototype.pause,d.prototype.fixedUpdate=function(a,b){for(var c=0;c<a.length;c++){var d=a[c].scriptComponent;d.fixedUpdate(a[c],b)}},d.prototype.process=function(a,b){this._playing&&(this.context.playTime+=b);for(var c=0;c<a.length;c++){var d=a[c].scriptComponent;d.run(a[c],b)}for(var c=0;c<a.length;c++){var d=a[c].scriptComponent;d.lateRun(a[c],b)}},d.prototype.addedComponent=function(a,b){"ScriptComponent"!==b.type||this.manualSetup||b.setup(a)},d.prototype.removedComponent=function(a,b){"ScriptComponent"!==b.type||this.manualSetup||b.cleanup()},d.prototype.clear=function(){for(var a=0;a<this._activeEntities.length;a++){var b=this._activeEntities[a];b.scriptComponent.cleanup()}this._world=null,this.context=null,e.prototype.clear.call(this)},a.exports=d},function(a,b,c){function d(){f.call(this,"LightingSystem",["LightComponent","TransformComponent"]),this.overrideLights=null,this.lights=[],this._needsUpdate=!0}var e=c(17),f=c(42),g=c(44);d.prototype=Object.create(f.prototype),d.prototype.constructor=d,d.prototype.setOverrideLights=function(a){this.overrideLights=a,g.emit("goo.setLights",this.overrideLights),this._needsUpdate=!0},d.prototype.clearOverrideLights=function(){this.overrideLights=void 0,this._needsUpdate=!0},d.prototype.inserted=function(a){a.lightComponent.updateLight(a.transformComponent.sync().worldTransform)},d.prototype.process=function(a){if(!this.overrideLights){this.lights.length=0;for(var b=0;b<a.length;b++){var c=a[b],d=c.transformComponent,f=c.lightComponent;if(d.sync(),(f._transformDirty||this._needsUpdate)&&(f.updateLight(d.worldTransform),f._transformDirty=!1),!f.hidden){var h=f.light;h.shadowCaster=h.shadowCaster&&e.TextureFloat,this.lights.push(h)}}this._needsUpdate=!1,g.emit("goo.setLights",this.lights)}},d.prototype.invalidateHandles=function(a){this._activeEntities.forEach(function(b){b.lightComponent.light.invalidateHandles(a)})},a.exports=d},function(a,b,c){function d(){e.call(this,"ParticlesSystem",["TransformComponent","MeshRendererComponent","MeshDataComponent","ParticleComponent"]),this.passive=!1}var e=c(42);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.process=function(a,b){if(!(b>1))for(var c=0,d=a.length;d>c;c++){var e=a[c],f=e.particleComponent;f.enabled&&this.updateParticles(e,f,b)}},d.prototype.updateParticles=function(a,b,c){for(var d,e=0,f=-1,g=!1;e<b.particleCount;){for(;void 0===d;)if(f++,b.emitters.length>f){if(d=b.emitters[f],d.influences.length)for(var h=0,i=d.influences.length;i>h;h++)d.influences[h].prepare(a,d);if(!d.enabled){d=void 0;continue}if(0!==d.totalParticlesToSpawn&&(d.particlesWaitingToRelease+=d.releaseRatePerSecond*c,d.particlesWaitingToRelease=Math.max(d.particlesWaitingToRelease,0)),d.particlesWaitingToRelease<1){d=void 0;continue}}else d=null;var j=b.particles[e];if(j.alive&&j.emitter&&j.emitter.influences.length)for(var h=0,i=j.emitter.influences.length;i>h;h++)j.emitter.influences[h].enabled&&j.emitter.influences[h].apply(c,j,e);j.alive&&(j.update(c,a),g=!0),!j.alive&&d&&(d.particlesWaitingToRelease--,d.totalParticlesToSpawn>=1&&d.totalParticlesToSpawn--,j.respawnParticle(d),d.getEmissionPoint(j,a),d.getEmissionVelocity(j,a),(d.particlesWaitingToRelease<1||0===d.totalParticlesToSpawn)&&(d=void 0)),e++}g&&(b.meshData.vertexData._dataNeedsRefresh=!0,a.meshDataComponent.autoCompute=!0)},d.prototype.play=function(){this.passive=!1},d.prototype.pause=function(){this.passive=!0},d.prototype.resume=d.prototype.play,d.prototype.stop=d.prototype.pause,a.exports=d},function(a,b){function c(){var a=Date.now(),b=a,c=a,d=0,e=1/0,f=0,g=0,h=1/0,i=0,j=0,k=0,l=document.createElement("div");l.id="stats",l.addEventListener("mousedown",function(a){a.preventDefault(),v(++k%2)},!1),l.style.cssText="width:80px;cursor:pointer;z-index:1000;-webkit-touch-callout: none;-webkit-user-select: none;-khtml-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;";var m=document.createElement("div");m.id="fps",m.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002",l.appendChild(m);var n=document.createElement("div");n.id="fpsText",n.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:8px;font-weight:bold;line-height:13px",n.innerHTML="FPS",m.appendChild(n);var o=document.createElement("div");for(o.id="fpsGraph",o.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff",m.appendChild(o);o.children.length<74;){var p=document.createElement("span");p.style.cssText="width:1px;height:30px;float:left;background-color:#113",o.appendChild(p)}var q=document.createElement("div");q.id="ms",q.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none",l.appendChild(q);var r=document.createElement("div");r.id="msText",r.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:8px;font-weight:bold;line-height:13px",r.innerHTML="MS",q.appendChild(r);var s=document.createElement("div");for(s.id="msGraph",s.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0",q.appendChild(s);s.children.length<74;){var p=document.createElement("span");p.style.cssText="width:1px;height:30px;float:left;background-color:#131",s.appendChild(p)}var t=document.createElement("div");t.id="info",t.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#200",l.appendChild(t);var u=document.createElement("div");u.id="infoText",u.style.cssText="color:#f66;font-family:Helvetica,Arial,sans-serif;font-size:8px;font-weight:bold;line-height:13px",u.innerHTML="INFO",t.appendChild(u);var v=function(a){switch(k=a){case 0:m.style.display="block",q.style.display="none";break;case 1:m.style.display="none",q.style.display="block"}},w=function(a,b){var c=a.appendChild(a.firstChild);c.style.height=b+"px"};this.domElement=l,this.setMode=v,this.begin=function(){a=Date.now()},this.end=function(k){var l=Date.now();return l>c+100&&(d=l-a,e=Math.min(e,d),f=Math.max(f,d),r.textContent=d+" MS ("+e+"-"+f+")",w(s,Math.min(30,30-d/200*30)),c=l,k&&(u.innerHTML=k)),j++,l>b+1e3&&(g=Math.round(1e3*j/(l-b)),h=Math.min(h,g),i=Math.max(i,g),n.textContent=g+" FPS ("+h+"-"+i+")",w(o,Math.min(30,30-g/(Math.min(500,i)+10)*30)),b=l,j=0),l},this.update=function(b){a=this.end(b)}}a.exports=c},function(a,b,c){function d(){if(this._isSupported=f.isSupported(),!this._isSupported)return void console.warn("Cannot create SoundSystem, WebAudio not supported");e.call(this,"SoundSystem",["SoundComponent","TransformComponent"]),this.entities=[],this._relativeTransform=new i,this._pausedSounds={},this.initialized=!1,this.rolloffFactor=.4,this.maxDistance=100,this.volume=1,this.reverb=0,this.muted=!1,this.reverbAudioBuffer=null,this._reverbDirty=!0,this._dirty=!0,this._camera=null;var a=this;h.addListener("goo.setCurrentCamera",function(b){a._camera=b.camera}),this._scheduledUpdates=[]}var e=c(42),f=c(305),g=c(9),h=c(44),i=c(33);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype._initializeAudioNodes=function(){this._outNode=f.getContext().createGain(),this._outNode.connect(f.getContext().destination),this._wetNode=f.getContext().createGain(),this._wetNode.connect(this._outNode),this._wetNode.gain.value=.2,this._convolver=f.getContext().createConvolver(),this._convolver.connect(this._wetNode),this._listener=f.getContext().listener,this._listener.setPosition(0,0,0),this._listener.setOrientation(0,0,-1,0,1,0),this.initialized=!0},d.prototype.inserted=function(a){this.initialized||this._initializeAudioNodes(),a.soundComponent.connectTo({dry:this._outNode,wet:this._convolver}),a.soundComponent._system=this},d.prototype.deleted=function(a){if(a.soundComponent){for(var b=a.soundComponent.sounds,c=0;c<b.length;c++)b[c].stop();a.soundComponent.connectTo(),a.soundComponent._system=null}},d.prototype.updateConfig=function(a){a=a||{},void 0!==a.maxDistance&&(this.maxDistance=a.maxDistance),void 0!==a.rolloffFactor&&(this.rolloffFactor=a.rolloffFactor),void 0!==a.volume&&(this.volume=g.clamp(a.volume,0,1)),void 0!==a.reverb&&(this.reverb=g.clamp(a.reverb,0,1)),void 0!==a.muted&&(this.muted=a.muted),this._dirty=!0},d.prototype.setReverb=function(a){this.reverbAudioBuffer=a,this._reverbDirty=!0},d.prototype.pause=function(){if(!this._pausedSounds){this._pausedSounds={};for(var a=0;a<this.entities.length;a++)for(var b=this.entities[a].soundComponent.sounds,c=0;c<b.length;c++){var d=b[c];d.isPlaying()&&(d.pause(),this._pausedSounds[d.id]=!0)}}},d.prototype.mute=function(){this.muted=!0,this._dirty=!0},d.prototype.unmute=function(){this.muted=!1,this._dirty=!0},d.prototype.resume=function(){if(this._pausedSounds){for(var a=0;a<this.entities.length;a++)for(var b=this.entities[a].soundComponent.sounds,c=0;c<b.length;c++){var d=b[c];this._pausedSounds[d.id]&&d.play()}this._pausedSounds=null}},d.prototype.play=function(){this.resume(),this.passive=!1},d.prototype.stop=function(){for(var a=0;a<this.entities.length;a++)for(var b=this.entities[a].soundComponent.sounds,c=0;c<b.length;c++){var d=b[c];d.stop()}this._pausedSounds=null,this.passive=!0},d.prototype.process=function(a,b){if(this._isSupported&&0!==a.length){this.initialized||this._initializeAudioNodes(),this._reverbDirty&&(this._wetNode.disconnect(),!this.reverbAudioBuffer&&this._wetNode?this._convolver.buffer=null:(this._convolver.buffer=this.reverbAudioBuffer,this._wetNode.connect(this._outNode)),this._reverbDirty=!1),this._dirty&&(this._outNode.gain.value=this.muted?0:this.volume,this._wetNode.gain.value=this.reverb,this._dirty=!1),this.entities=a;var c,d=this._relativeTransform;this._camera&&(c=this._camera.getViewMatrix());for(var e=0;e<a.length;e++){var f=a[e],g=f.soundComponent;g._attachedToCamera=!(!f.cameraComponent||f.cameraComponent.camera!==this._camera),this._camera&&!g._attachedToCamera?(d.mul2(c,f.transformComponent.sync().worldTransform.matrix),g.process(this,d,b)):g.process(this,null,b)}}},a.exports=d},function(a,b,c){function d(){return"undefined"!=typeof window&&window.goo||{}}function e(a){f.apply(this,arguments),this.type="ScriptComponent",a instanceof Array?this.scripts=a:a?this.scripts=[a]:this.scripts=[]}var f=c(20),g=c(44),h=c(6);e.type="ScriptComponent",e.prototype=Object.create(f.prototype),e.prototype.constructor=e,e.prototype.setup=function(a){var b=a._world.getSystem("ScriptSystem").context,c=Object.create(b);h.extend(c,{entity:a,entityData:{}});for(var e=0;e<this.scripts.length;e++){var f=this.scripts[e];if(!f.context&&(f.context=Object.create(c),f.parameters&&void 0!==f.parameters.enabled?f.enabled=f.parameters.enabled:f.enabled=!0,f.setup&&f.enabled))try{f.setup(f.parameters,f.context,d())}catch(g){this._handleError(f,g,"setup")}}},e.prototype.run=function(a){for(var b=0;b<this.scripts.length;b++){var c=this.scripts[b];if(c&&c.run&&(void 0===c.enabled||c.enabled))try{c.run(a,a._world.tpf,c.context,c.parameters)}catch(e){this._handleError(c,e,"run")}else if(c.update&&(void 0===c.enabled||c.enabled))try{c.update(c.parameters,c.context,d())}catch(e){this._handleError(c,e,"update")}}},e.prototype.lateRun=function(){for(var a=0;a<this.scripts.length;a++){var b=this.scripts[a];if(b.lateUpdate&&(void 0===b.enabled||b.enabled))try{b.lateUpdate(b.parameters,b.context,d())}catch(c){this._handleError(b,c,"lateUpdate")}}},e.prototype.fixedUpdate=function(){for(var a=0;a<this.scripts.length;a++){var b=this.scripts[a];if(b.fixedUpdate&&(void 0===b.enabled||b.enabled))try{b.fixedUpdate(b.parameters,b.context,d())}catch(c){this._handleError(b,c,"lateUpdate")}}},e.prototype.cleanup=function(){for(var a=0;a<this.scripts.length;a++){var b=this.scripts[a];if(b.context){if(b.cleanup&&(b.parameters&&void 0!==b.parameters.enabled?b.parameters.enabled:b.enabled))try{b.cleanup(b.parameters,b.context,d())}catch(c){this._handleError(b,c,"cleanup")}b.enabled=!1,b.context=null}}},e.prototype.startScripts=function(){this.scripts.forEach(function(a){a.parameters&&a.parameters.enabled===!1?a.enabled=!1:a.enabled=!0})},e.prototype.stopScripts=function(){this.scripts.forEach(function(a){a.enabled=!1})},e.prototype._handleError=function(a,b,c){a.enabled=!1;var d={id:a.id,errors:[{message:b.message||b,phase:c}]};if(b instanceof Error){var e=b.stack.split("\n")[1].match(/(\d+):\d+\)$/);e&&(d.line=parseInt(e[1],10)-1)}console.error(d.errors[0].message,d),g.emit("goo.scriptError",d)},e.applyOnEntity=function(a,b){if(a instanceof Function||a&&a.run instanceof Function||a&&a.update instanceof Function){var c;return b.scriptComponent?c=b.scriptComponent:(c=new e,b.setComponent(c)),c.scripts.push(a.run instanceof Function||a.update instanceof Function?a:{run:a}),!0}},a.exports=e},function(a,b){function c(){}c.blue="#2A3276",c.white="#FFFFFF";var d={color:c.white,shadow:!1};c.getLogo=function(a){a=a||{};for(var b in d)void 0===a[b]&&(a[b]=d[b]);if(!document.createElementNS)return"";var c="http://www.w3.org/2000/svg",e=document.createElementNS(c,"svg");e.setAttribute("version","1.1"),e.setAttribute("xmlns",c),e.setAttribute("x","0px"),e.setAttribute("y","0px"),e.setAttribute("viewBox","0 0 396.603 277.343"),e.setAttribute("enable-background","new 0 0 396.603 277.343"),e.setAttribute("xml:space","preserve"),a.width&&e.setAttribute("width",a.width),a.height&&e.setAttribute("height",a.height);var f=document.createElementNS(c,"g");e.appendChild(f);var g=document.createElementNS(c,"filter");g.setAttribute("id","insetShadow");var h=document.createElementNS(c,"feGaussianBlur");h.setAttribute("in","SourceAlpha"),h.setAttribute("stdDeviation","0");var i=document.createElementNS(c,"feOffset");i.setAttribute("dx","0"),i.setAttribute("dy","-5"),i.setAttribute("result","offsetblur");var j=document.createElementNS(c,"feComponentTransfer"),k=document.createElementNS(c,"feFuncA");k.setAttribute("type","linear"),k.setAttribute("slope","0.5"),j.appendChild(k);var l=document.createElementNS(c,"feMerge"),m=document.createElementNS(c,"feMergeNode"),n=document.createElementNS(c,"feMergeNode");n.setAttribute("in","SourceGraphic"),l.appendChild(m),l.appendChild(n),g.appendChild(h),g.appendChild(i),g.appendChild(j),g.appendChild(l),f.appendChild(g);var o=document.createElementNS(c,"path");o.setAttribute("d","M303.337,46.286c-13.578,0-25.784,5.744-34.396,14.998c-9.86,10.59-26.319,10.59-36.172,0c-8.605-9.254-20.818-14.998-34.402-14.998c-25.936,0-46.971,21.034-46.971,46.978c0,25.936,21.035,46.972,46.971,46.972c13.584,0,25.797-5.744,34.402-14.998c9.853-10.598,26.325-10.598,36.172,0c8.612,9.254,20.818,14.998,34.396,14.998c25.941,0,46.977-21.036,46.977-46.972C350.313,67.32,329.278,46.286,303.337,46.286z M198.296,116.39c-12.785,0-23.146-10.359-23.146-23.144s10.361-23.151,23.146-23.151c12.795,0,23.156,10.367,23.156,23.151S211.091,116.39,198.296,116.39z M303.337,116.407c-12.785,0-23.146-10.36-23.146-23.144c0-12.784,10.36-23.151,23.146-23.151c12.795,0,23.156,10.367,23.156,23.151C326.493,106.047,316.132,116.407,303.337,116.407z M156.18,138.347c-14.087-3.23-22.316-17.482-18.068-31.305c3.704-12.072,2.568-25.511-4.22-37.256C120.927,47.323,92.22,39.63,69.766,52.587C47.317,65.552,39.624,94.26,52.581,116.713c6.795,11.761,17.853,19.462,30.17,22.282c14.084,3.235,22.314,17.497,18.074,31.317c-3.711,12.08-2.582,25.504,4.213,37.264c12.965,22.455,41.666,30.148,64.127,17.178c22.447-12.945,30.148-41.658,17.185-64.111C179.554,148.881,168.497,141.181,156.18,138.347z M104.802,113.287c-11.064,6.387-25.219,2.599-31.604-8.474c-6.397-11.07-2.604-25.225,8.474-31.609c11.057-6.398,25.22-2.598,31.611,8.46C119.673,92.741,115.872,106.897,104.802,113.287z M145.687,207.256c-12.785,0-23.145-10.361-23.145-23.145s10.359-23.15,23.145-23.15c12.797,0,23.156,10.367,23.156,23.15S158.483,207.256,145.687,207.256z"),
o.setAttribute("fill",a.color),a.shadow&&(f.appendChild(g),o.setAttribute("style","filter:url(#insetShadow)")),f.appendChild(o);var p=new XMLSerializer,q=p.serializeToString(e);return q},a.exports=c},function(a,b,c){function d(a,b,c,d){if(1===arguments.length&&arguments[0]instanceof Object){var f=arguments[0];a=f.xSegments,b=f.ySegments,c=f.width,d=f.height}this.xSegments=a||10,this.ySegments=b||10,this.width=c||1,this.height=d||1;var g=e.defaultMap([e.POSITION]),h=4+2*(this.xSegments-1)+2*(this.ySegments-1),i=8+2*(this.xSegments-1)+2*(this.ySegments-1);e.call(this,g,h,i),this.indexModes[0]="Lines",this.rebuild()}var e=c(14),f=c(6);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.rebuild=function(){var a=this.width/2,b=this.height/2,c=[],d=[];c.push(-a,-b,0,-a,b,0,a,b,0,a,-b,0),d.push(0,1,1,2,2,3,3,0);for(var f,g=this.width/this.xSegments,h=1;h<this.xSegments;h++)f=h*g-a,c.push(f,-b,0,f,b,0);var i;g=this.height/this.ySegments;for(var h=1;h<this.ySegments;h++)i=h*g-b,c.push(-a,i,0,a,i,0);for(var h=d.length/2;h<c.length/3;h+=2)d.push(h,h+1);this.getAttributeBuffer(e.POSITION).set(c),this.getIndexBuffer().set(d)},d.prototype.clone=function(){var a=f.shallowSelectiveClone(this,["xSegments","ySegments","width","height"]);return new d(a)},a.exports=d},function(a,b,c){function d(){f.call(this,"GridRenderSystem",[]),this.renderList=[],this.doRender={grid:!0},this.scale=62.5,this.count=100,this.camera=null,this.lights=[],this.transform1=new k,this.transform1.rotation.rotateX(-Math.PI/2),this.transform1.scale.setDirect(this.scale,this.scale,this.scale),this.transform1.update(),this.transform2=new k,this.transform2.rotation.rotateX(-Math.PI/2),this.transform2.scale.setDirect(this.scale,this.scale,this.scale),this.transform2.update();var a=.2,b=new i(m,"Grid Material");b.blendState.blending="TransparencyBlending",b.uniforms.color=[a,a,a,1],b.depthState.write=!1,b.depthState.enabled=!0;var c=new i(m,"Grid Material");c.blendState.blending="TransparencyBlending",c.uniforms.color=[a,a,a,1],c.depthState.write=!1,c.depthState.enabled=!0;var d=new l(this.count,this.count);this.grid1={meshData:d,materials:[b],transform:this.transform1},this.grid2={meshData:d,materials:[c],transform:this.transform2},this.oldHeightScale1=0,this.oldX1=0,this.oldZ1=0,this.oldHeightScale1=0,this.oldX1=0,this.oldZ1=0;var e=this;g.addListener("goo.setCurrentCamera",function(a){e.camera=a.camera}),g.addListener("goo.setLights",function(a){e.lights=a})}function e(a,b){for(var c=0;b>c;++c)a=Math.pow(a,2)*(3-2*a);return a}var f=c(42),g=c(44),h=c(14),i=c(30),j=c(31),k=c(41),l=c(355);d.prototype=Object.create(f.prototype),d.prototype.constructor=d,d.prototype.inserted=function(){},d.prototype.deleted=function(){},d.prototype.process=function(){if(this.doRender.grid){var a=Math.max(Math.abs(this.camera.translation.y)/10,0),b=Math.pow(a,.15),c=1-2*Math.abs(b-Math.floor(b)-.5);c=Math.min(2*c,1);var d=Math.pow(2,4*Math.floor(b)+2)*this.scale,f=Math.pow(a,.15)+.5,g=1-2*Math.abs(f-Math.floor(f)-.5);g=Math.min(2*g,1);var h=Math.pow(2,4*Math.floor(f))*this.scale;c=e(c,1),g=e(g,1),this.grid1.materials[0].uniforms.scale=d,this.grid1.materials[0].uniforms.opacity=c,this.grid2.materials[0].uniforms.scale=h,this.grid2.materials[0].uniforms.opacity=g;var i=Math.floor(this.camera.translation.x*this.count/d),j=Math.floor(this.camera.translation.z*this.count/d);(d!==this.oldHeightScale1||i!==this.oldX1||j!==this.oldZ1)&&(this.transform1.scale.setDirect(d,d,d),this.transform1.translation.x=i*d/this.count,this.transform1.translation.z=j*d/this.count,this.transform1.update(),this.oldX1=i,this.oldZ1=j,this.oldHeightScale1=d),i=Math.floor(this.camera.translation.x*this.count/h),j=Math.floor(this.camera.translation.z*this.count/h),(h!==this.oldHeightScale2||i!==this.oldX2||j!==this.oldZ2)&&(this.transform2.scale.setDirect(h,h,h),this.transform2.translation.x=i*h/this.count,this.transform2.translation.z=j*h/this.count,this.transform2.update(),this.oldX2=i,this.oldZ2=j,this.oldHeightScale2=h),c>g?(this.renderList[0]=this.grid1,this.renderList[1]=this.grid2):(this.renderList[0]=this.grid2,this.renderList[1]=this.grid1)}},d.prototype.render=function(a){a.checkResize(this.camera),this.camera&&this.doRender.grid&&a.render(this.renderList,this.camera,this.lights,null,!1)},d.prototype.invalidateHandles=function(a){this.renderList.forEach(function(b){b.materials.forEach(function(b){a.invalidateMaterial(b)}),a.invalidateMeshData(b.meshData)})};var m={attributes:{vertexPosition:h.POSITION},uniforms:{viewMatrix:j.VIEW_MATRIX,projectionMatrix:j.PROJECTION_MATRIX,worldMatrix:j.WORLD_MATRIX,color:[.55,.55,.55,1],fogNear:j.NEAR_PLANE,fogFar:j.FAR_PLANE,opacity:1,scale:1},vshader:["attribute vec3 vertexPosition;","uniform mat4 worldMatrix;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","varying float depth;","void main(void) {","vec4 viewPosition = viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);","depth = -viewPosition.z;","gl_Position = projectionMatrix * viewPosition;","}"].join("\n"),fshader:["precision mediump float;","uniform vec4 color;","uniform float fogNear;","uniform float fogFar;","uniform float opacity;","uniform float scale;","varying float depth;","void main(void) {","gl_FragColor = color;","float lerpVal = 1.0 - clamp(depth * 3.0 / min(scale, fogFar * 3.0), 0.0, 1.0);","gl_FragColor.a = opacity * lerpVal;","}"].join("\n")};a.exports=d},function(a,b,c){function d(a){e.call(this,"HtmlSystem",["TransformComponent","HtmlComponent"]),this.renderer=a,this.styleCache=new Map}var e=c(42),f=c(123),g=c(8);d.prototype=Object.create(e.prototype),d.prototype.constructor=d;var h=2147483647,i=new g;d.prototype.setStyle=function(a,b,c,d){var e=this.styleCache.get(a);e||(e=new Map,this.styleCache.set(a,e)),c!==e.get(b)&&(a.style[b]=c,d&&(a.style["-webkit-"+b]=c),e.set(b,c))},d.prototype.clearStyleCache=function(a){this.styleCache["delete"](a)},d.prototype.process=function(a){if(0!==a.length)for(var b=f.mainCamera,c=this.renderer,d=c.viewportWidth,e=c.viewportHeight,g=c.domElement.offsetLeft,j=c.domElement.offsetTop,k=0;k<a.length;k++){var l=a[k],m=l.htmlComponent;if(m.useTransformComponent)if(m.hidden)this.setStyle(m.domElement,"display","none");else if(i.set(b.translation).sub(l.transformComponent.sync().worldTransform.translation),b._direction.dot(i)>0)this.setStyle(m.domElement,"display","none");else if(b.getScreenCoordinates(l.transformComponent.sync().worldTransform.translation,d,e,i),i.z<0)this.setStyle(m.domElement,"display","none");else{this.setStyle(m.domElement,"display","");var n=i.x/c.devicePixelRatio,o=i.y/c.devicePixelRatio;m.pixelPerfect&&(n=Math.floor(n),o=Math.floor(o)),this.setStyle(m.domElement,"transform","translate(-50%, -50%) translate("+(n+g)+"px, "+(o+j)+"px)",!0),this.setStyle(m.domElement,"zIndex",h-Math.round(i.z*h))}else this.setStyle(m.domElement,"display",m.hidden?"none":""),this.setStyle(m.domElement,"transform","")}},d.prototype.deleted=function(a){if(a&&a.htmlComponent){var b=a.htmlComponent;b.domElement.parentNode&&b.domElement.parentNode.removeChild(b.domElement),b.domElement=null}},a.exports=d},function(a,b,c){function d(){if(f.call(this,2,2),0===arguments.length)this.data[0]=1,this.data[3]=1;else if(1===arguments.length&&"object"==typeof arguments[0])arguments[0]instanceof d?this.copy(arguments[0]):this.setArray(arguments[0]);else for(var a=0;a<arguments.length;a++)this.data[a]=arguments[a]}var e=c(9),f=c(25),g=c(6);d.prototype=Object.create(f.prototype),d.prototype.constructor=d,f.setupAliases(d.prototype,[["e00"],["e10"],["e01"],["e11"]]),d.IDENTITY=new d(1,0,0,1),d.prototype.add=function(a){var b=this.data,c=a.data;return b[0]+=c[0],b[1]+=c[1],b[2]+=c[2],b[3]+=c[3],this},d.prototype.sub=function(a){var b=this.data,c=a.data;return b[0]-=c[0],b[1]-=c[1],b[2]-=c[2],b[3]-=c[3],this},d.prototype.scale=function(a){var b=this.data;return b[0]*=a,b[1]*=a,b[2]*=a,b[3]*=a,this},d.prototype.mul=function(a){var b=a.data,c=b[0],d=b[2],e=b[1],f=b[3],g=this.data,h=g[0],i=g[2],j=g[1],k=g[3],l=this.data;return l[0]=c*h+d*j,l[2]=c*j+d*k,l[1]=e*h+f*j,l[3]=e*i+f*k,this},d.prototype.mul2=function(a,b){var c=a.data,d=c[0],e=c[2],f=c[1],g=c[3],h=b.data,i=h[0],j=h[2],k=h[1],l=h[3],m=this.data;return m[0]=d*i+e*k,m[2]=d*k+e*l,m[1]=f*i+g*k,m[3]=f*j+g*l,this},d.prototype.transpose=function(){var a=this.data,b=a[1];return a[1]=a[2],a[2]=b,this},d.invert=function(a,b){if(b||(b=new d),b===a)return b.copy(d.invert(a));var c=a.determinant();return Math.abs(c)<e.EPSILON?b:(c=1/c,b.e00=a.e11*c,b.e10=0-a.e10*c,b.e01=0-a.e01*c,b.e11=a.e00*c,b)},d.prototype.invert=function(){return d.invert(this,this)},d.prototype.isOrthogonal=function(){var a;return a=this.e00*this.e01+this.e10*this.e11,Math.abs(a)>e.EPSILON?!1:!0},d.prototype.isNormal=function(){var a;return a=this.e00*this.e00+this.e10*this.e10,Math.abs(a-1)>e.EPSILON?!1:(a=this.e01*this.e01+this.e11*this.e11,Math.abs(a-1)>e.EPSILON?!1:!0)},d.prototype.isOrthonormal=function(){return this.isOrthogonal()&&this.isNormal()},d.prototype.determinant=function(){return this.e00*this.e11-this.e01*this.e10},d.prototype.setIdentity=function(){return this.set(d.IDENTITY),this},d.prototype.equals=function(a){var b=this.data,c=a.data;return Math.abs(b[0]-c[0])<=e.EPSILON&&Math.abs(b[1]-c[1])<=e.EPSILON&&Math.abs(b[2]-c[2])<=e.EPSILON&&Math.abs(b[3]-c[3])<=e.EPSILON},d.prototype.copy=function(a){var b=this.data,c=a.data;return b[0]=c[0],b[1]=c[1],b[2]=c[2],b[3]=c[3],this},d.prototype.setArray=function(a){var b=this.data;return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],this},d.prototype.set=d.prototype.copy,d.prototype.clone=function(){return(new d).copy(this)},d.add=g.warnOnce("Matrix2.add is deprecated. Use Matrix2.prototype.add instead.",function(a,b,c){return c||(c=new d),b instanceof d?(c.e00=a.e00+b.e00,c.e10=a.e10+b.e10,c.e01=a.e01+b.e01,c.e11=a.e11+b.e11):(c.e00=a.e00+b,c.e10=a.e10+b,c.e01=a.e01+b,c.e11=a.e11+b),c}),d.combine=g.warnOnce("Matrix2.combine is deprecated. Use Matrix2.prototype.multiply instead.",function(a,b,c){return c||(c=new d),c===a||c===b?f.copy(d.combine(a,b),c):(c.e00=a.e00*b.e00+a.e01*b.e10,c.e10=a.e10*b.e00+a.e11*b.e10,c.e01=a.e00*b.e01+a.e01*b.e11,c.e11=a.e10*b.e01+a.e11*b.e11,c)}),d.div=g.warnOnce("Matrix2.div is deprecated. Use Matrix2.prototype.div instead.",function(a,b,c){return c||(c=new d),b instanceof d?(c.e00=a.e00/b.e00,c.e10=a.e10/b.e10,c.e01=a.e01/b.e01,c.e11=a.e11/b.e11):(b=1/b,c.e00=a.e00*b,c.e10=a.e10*b,c.e01=a.e01*b,c.e11=a.e11*b),c}),d.mul=g.warnOnce("Matrix2.mul is deprecated. Use Matrix2.prototype.mul instead.",function(a,b,c){return c||(c=new d),b instanceof d?(c.e00=a.e00*b.e00,c.e10=a.e10*b.e10,c.e01=a.e01*b.e01,c.e11=a.e11*b.e11):(c.e00=a.e00*b,c.e10=a.e10*b,c.e01=a.e01*b,c.e11=a.e11*b),c}),d.transpose=g.warnOnce("Matrix2.transpose is deprecated. Use Matrix2.prototype.transpose instead.",function(a,b){return b||(b=new d),b===a?f.copy(d.transpose(a),b):(b.e00=a.e00,b.e10=a.e01,b.e01=a.e10,b.e11=a.e11,b)}),d.sub=g.warnOnce("Matrix2.sub is deprecated. Use Matrix2.prototype.sub instead.",function(a,b,c){return c||(c=new d),b instanceof d?(c.e00=a.e00-b.e00,c.e10=a.e10-b.e10,c.e01=a.e01-b.e01,c.e11=a.e11-b.e11):(c.e00=a.e00-b,c.e10=a.e10-b,c.e01=a.e01-b,c.e11=a.e11-b),c}),d.prototype.combine=g.warnOnce("Matrix2.prototype.combine is deprecated. Use Matrix2.prototype.mul or Matrix2.prototype.mul2 instead.",function(a){return d.combine(this,a,this)}),d.prototype.div=g.warnOnce("Matrix2.prototype.div is deprecated.",function(a){return d.div(this,a,this)}),a.exports=d},function(a,b,c){var d=c(358),e=c(6),f=e.warnOnce("Matrix2x2 has been renamed to Matrix2.",function(){d.apply(this,arguments)});f.prototype=Object.create(d.prototype),f.prototype.constructor=f;for(var g in d)f[g]=d[g];a.exports=f},function(a,b,c){var d=c(24),e=c(6),f=e.warnOnce("Matrix3x3 has been renamed to Matrix3.",function(){d.apply(this,arguments)});f.prototype=Object.create(d.prototype),f.prototype.constructor=f;for(var g in d)f[g]=d[g];a.exports=f},function(a,b,c){var d=c(33),e=c(6),f=e.warnOnce("Matrix4x4 has been renamed to Matrix4.",function(){d.apply(this,arguments)});f.prototype=Object.create(d.prototype),f.prototype.constructor=f;for(var g in d)f[g]=d[g];a.exports=f},function(a,b,c){function d(){f.apply(this,arguments),this.type="MovementComponent",this.velocity=new e,this.rotationVelocity=new e}var e=c(8),f=c(20);d.type="MovementComponent",d.prototype=Object.create(f.prototype),d.prototype.constructor=d,d.prototype.addVelocity=function(a){this.velocity.add(a)},d.prototype.setVelocity=function(a){this.velocity.set(a)},d.prototype.getVelocity=function(){return this.velocity},d.prototype.addRotationVelocity=function(a){this.rotationVelocity.add(a)},d.prototype.setRotationVelocity=function(a){this.rotationVelocity.set(a)},d.prototype.getRotationVelocity=function(){return this.rotationVelocity},a.exports=d},function(a,b,c){function d(){e.call(this,"MovementSystem",["MovementComponent"])}var e=c(42);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.addVelocityToTransform=function(a,b,c){b.translation.addDirect(a.x*c,a.y*c,a.z*c)},d.prototype.addRotToTransform=function(a,b,c){b.rotation.rotateX(a.x*c),b.rotation.rotateY(a.y*c),b.rotation.rotateZ(a.z*c)},d.prototype.applyMovementToEntity=function(a){var b=a._world.tpf,c=a.movementComponent.getRotationVelocity(),d=a.movementComponent.getVelocity(),e=a.transformComponent.transform;this.addVelocityToTransform(d,e,b),this.addRotToTransform(c,e,b),a.transformComponent.setUpdated()},d.prototype.process=function(a){for(var b=0;b<a.length;b++)this.applyMovementToEntity(a[b])},a.exports=d},function(a,b,c){function d(){}var e=c(9);d.shifter=[37,91,12,128,216,96,51,153,39,231,223,180,160,157,135,179,74,50,205,151,4,213,196,58,212,120,53,45,10,195,137,159,103,144,109,170,202,48,121,13,245,68,232,28,210,174,197,80,107,206,156,116,155,240,162,79,41,59,147,117,0,242,118,164,129,101,98,126,214,105,89,26,130,254,85,199,8,165,76,75,187,166,64,143,217,149,78,7,172,230,87,119,42,247,84,139,16,141,134,86,154,71,253,60,99,235,168,30,34,55,113,140,191,69,31,106,40,82,73,33,81,14,234,131,255,88,169,136,248,148,220,138,219,102,44,127,36,200,95,208,54,152,47,20,23,15,52,123,177,224,122,171,215,173,211,188,190,133,244,167,236,35,63,145,221,104,65,24,70,100,56,150,49,77,110,228,112,209,198,1,237,185,250,225,93,201,124,108,218,72,243,21,22,6,114,38,125,29,66,249,222,111,241,11,186,61,176,183,17,163,229,161,57,238,227,132,67,83,207,226,46,189,115,193,194,233,182,192,18,27,25,2,3,252,97,62,184,239,175,92,246,142,251,204,203,32,146,90,19,9,178,158,181,94,43,5],d.split=function(a){var b=Math.floor(a),c=e.scurve5(a-b);return{i0:b+0,i1:b+1,f0:1-c,f1:0+c}},d.fractal1d=function(a,b,c,d,e,f){for(var g=0,h=1,i=0,j=0;c>j;j++)g+=h*f.evaluate1d(a,b),i+=h,h*=d,a*=e;return g/i},d.fractal2d=function(a,b,c,d,e,f,g){for(var h=0,i=1,j=0,k=0;d>k;k++)h+=i*g.evaluate2d(a,b,c),j+=i,i*=e,a*=f,b*=f;return h/j},d.fractal3d=function(a,b,c,d,e,f,g,h){for(var i=0,j=1,k=0,l=0;e>l;l++)i+=j*h.evaluate3d(a,b,c,d),k+=j,j*=f,a*=g,b*=g,c*=g;return i/k},d.fractal4d=function(a,b,c,d,e,f,g,h,i){for(var j=0,k=1,l=0,m=0;f>m;m++)j+=k*i.evaluate4d(a,b,c,d,e),l+=k,k*=g,a*=h,b*=h,c*=h,d*=h;return j/l},a.exports=d},function(a,b,c){function d(a,b){b.dirty=!0,b.timeSamples=[0,0,0,0,0],b.xSamples=[0,0,0,0,0],b.ySamples=[0,0,0,0,0],b.sample=0,b.velocity=new r,b.cartesian=new q,b.worldUpVector=q.UNIT_Y.clone(),b.maxSampleTimeMS=200,b.mouseState={buttonDown:!1,lastX:NaN,lastY:NaN},o(a,b);var c;if(a.lookAtDistance){var d=b.entity.getRotation();c=b.spherical=new q(a.lookAtDistance,-d.y+Math.PI/2,-d.x)}else if(a.spherical instanceof Array)var c=b.spherical=new q(a.spherical[0],a.spherical[1]*s.DEG_TO_RAD,a.spherical[2]*s.DEG_TO_RAD);else if(a.spherical)var c=b.spherical=new q(a.spherical.x,a.spherical.y*s.DEG_TO_RAD,a.spherical.z*s.DEG_TO_RAD);else var c=b.spherical=new q(15,0,0);if(b.targetSpherical=c.clone(),a.lookAtDistance){var e=b.entity.transformComponent.transform.rotation;b.lookAtPoint=new q(0,0,-a.lookAtDistance),b.lookAtPoint.applyPost(e),b.lookAtPoint.add(b.entity.getTranslation())}else a.lookAtPoint?b.lookAtPoint=a.lookAtPoint instanceof Array?q.fromArray(a.lookAtPoint):a.lookAtPoint.clone():b.lookAtPoint=new q;b.goingToLookAt=b.lookAtPoint.clone(),h(1,b),k(a,b)}function e(a,b,c,d){var e=d.dragButton,f=d.mouseState;(-1===e||e===a||b===!1)&&(f.buttonDown=b,b?(f.lastX=NaN,f.lastY=NaN,d.velocity.setDirect(0,0),d.spherical.y=s.moduloPositive(d.spherical.y,s.TWO_PI),d.targetSpherical.set(d.spherical)):j(c,d))}function f(a,b,c,d){var e=0,f=0,h=d.mouseState;isNaN(h.lastX)||isNaN(h.lastY)?(h.lastX=a,h.lastY=b):(e=-(a-h.lastX),f=b-h.lastY,h.lastX=a,h.lastY=b),!h.buttonDown||0===e&&0===f||(d.timeSamples[d.sample]=Date.now(),d.xSamples[d.sample]=e,d.ySamples[d.sample]=f,d.sample++,d.sample>d.timeSamples.length-1&&(d.sample=0),d.velocity.setDirect(0,0),g(c.orbitSpeed*e,c.orbitSpeed*f,c,d))}function g(a,b,c,d){var e=d.targetSpherical;if(c.clampAzimuth){var f=c.minAzimuth*s.DEG_TO_RAD,g=c.maxAzimuth*s.DEG_TO_RAD;e.y=s.radialClamp(e.y-a,f,g)}else e.y-=a;var h=c.minAscent*s.DEG_TO_RAD,i=c.maxAscent*s.DEG_TO_RAD;e.z=s.clamp(e.z+b,h,i),d.dirty=!0}function h(a,b){if(b.entity.cameraComponent){var c=b.entity.cameraComponent.camera;if(c.projectionMode===t.Parallel){b.size=c.top,b.size/=a;var d=b.size;c.setFrustum(null,null,-d,d,d,-d)}}}function i(a,b,c){var d=Math.max(-1,Math.min(1,-a.wheelDelta||a.detail));d*=v*c.targetSpherical.x;var e=c.targetSpherical;e.x=s.clamp(e.x+b.zoomSpeed*d,b.minZoomDistance,b.maxZoomDistance),c.dirty=!0}function j(a,b){for(var c=b.timeSamples,d=Date.now(),e=0,f=0,g=!1,h=0,i=c.length;i>h;h++)d-c[h]<b.maxSampleTimeMS&&(e+=b.xSamples[h],f+=b.ySamples[h],g=!0);g?b.velocity.setDirect(e*a.orbitSpeed/c.length,f*a.orbitSpeed/c.length):b.velocity.setDirect(0,0)}function k(a,b){var c=0,d=!!navigator.userAgent.match(/Android/i),g={wheelDelta:0};b.listeners={mousedown:function(c){if(!a.whenUsed||b.entity===b.activeCameraEntity){var d=c.button;0===d&&(c.altKey?d=2:c.shiftKey&&(d=1)),e(d,!0,a,b)}},mouseup:function(c){var d=c.button;0===d&&(c.altKey?d=2:c.shiftKey&&(d=1)),e(d,!1,a,b)},mousemove:function(c){a.whenUsed&&b.entity!==b.activeCameraEntity||f(c.clientX,c.clientY,a,b)},mouseleave:function(a){b.orbitListeners.mouseup(a)},mousewheel:function(c){a.whenUsed&&b.entity!==b.activeCameraEntity||i(c,a,b)},touchstart:function(c){a.whenUsed&&b.entity!==b.activeCameraEntity||e(b.dragButton,1===c.targetTouches.length,a,b),d&&c.preventDefault()},touchend:function(){e(b.dragButton,!1,a,b),c=0},touchmove:function(d){if(!a.whenUsed||b.entity===b.activeCameraEntity){var e,h,j,k=d.targetTouches,l=k[0].clientX,m=k[0].clientY;if(2===k.length){var n=k[1].clientX,o=k[1].clientY;j=(l-n)*(l-n)+(m-o)*(m-o)}else e=l,h=m,f(e,h,a,b);var p=(j-c)/Math.max(b.domElement.offsetHeight,b.domElement.offsetWidth);p/=3,0===c?c=j:2===k.length&&Math.abs(p)>.3&&(g.wheelDelta=p,i(g,a,b),c=j)}}},b.listeners.DOMMouseScroll=b.listeners.mousewheel,b.listeners.mouseleave=b.listeners.mouseup;for(var h in b.listeners)b.domElement.addEventListener(h,b.listeners[h]);b.domElement.oncontextmenu=function(){return!1}}function l(a,b,c){if(c.velocity.lengthSquared()>w){g(c.velocity.x,c.velocity.y,b,c);var d=s.lerp(c.inertia,0,1-a/c.inertia);c.velocity.scale(d)}else c.velocity.setDirect(0,0,0)}function m(a,b){if(b.dirty){var c=b.spherical,d=b.targetSpherical,e=b.lookAtPoint,f=b.goingToLookAt,g=b.cartesian,i=b.entity,j=i.transformComponent,k=j.transform,m=s.lerp(b.smoothness,1,b.world.tpf);f.distanceSquared(e)<w?e.set(f):e.lerp(f,m),b.inertia>0&&l(i._world.tpf,a,b);var n=c,o=d;n.y=s.lerp(m,n.y,o.y),n.z=s.lerp(m,n.z,o.z);var p=n.x;n.x=s.lerp(m,n.x,o.x),p/=n.x,h(p,b),s.sphericalToCartesian(n.x,n.y,n.z,g),k.translation.set(g.add(e)),k.translation.equals(e)||k.lookAt(e,b.worldUpVector),c.distanceSquared(d)<w&&b.lookAtPoint.equals(b.goingToLookAt)&&(n.y=s.moduloPositive(n.y,s.TWO_PI),d.set(c),b.dirty=!1),j.setUpdated(),b.entity.cameraComponent&&u.emit("goo.cameraPositionChanged",{spherical:b.spherical.toArray(),translation:k.translation.toArray(),lookAtPoint:b.lookAtPoint.toArray(),id:i.id})}}function n(a,b){for(var c in b.listeners)b.domElement.removeEventListener(c,b.listeners[c])}function o(a,b){b.smoothness=Math.pow(s.clamp(a.smoothness,0,1),.3),b.inertia=Math.pow(s.clamp(a.drag,0,1),.3),b.dragButton=["Any","Left","Middle","Right","None"].indexOf(a.dragButton)-1,b.dragButton<-1?b.dragButton=-1:4===b.dragButton&&(b.dragButton=null),b.dirty=!0}function p(){return{setup:d,update:m,cleanup:n,argsUpdated:o}}var q=c(8),r=c(19),s=c(9),t=c(120),u=c(44),v=.035,w=1e-6;p.externals={key:"OrbitCamControlScript",name:"OrbitCamera Control",description:"Enables camera to orbit around a point in 3D space using the mouse",parameters:[{key:"whenUsed","default":!0,name:"When Camera Used",description:"Script only runs when the camera to which it is added is being used.",type:"boolean"},{key:"dragButton",description:"Button to enable dragging","default":"Any",options:["Any","Left","Middle","Right","None"],type:"string",control:"select"},{key:"orbitSpeed","default":.005,type:"float",scale:.001,decimals:3},{key:"zoomSpeed","default":1,type:"float",scale:.1},{key:"drag",name:"Inertia","default":.9,type:"float",control:"slider",min:0,max:1},{key:"smoothness","default":.4,type:"float",min:0,max:1,control:"slider"},{key:"minZoomDistance","default":1,type:"float",min:.01},{key:"maxZoomDistance","default":1e3,type:"float",min:1},{key:"minAscent",description:"Maximum arc the camera can reach below the target point","default":-89.99,type:"float",control:"slider",min:-89.99,max:89.99},{key:"maxAscent",description:"Maximum arc the camera can reach above the target point","default":89.99,type:"float",control:"slider",min:-89.99,max:89.99},{key:"clampAzimuth","default":!1,type:"boolean"},{key:"minAzimuth",description:"Maximum arc the camera can reach clockwise of the target point","default":90,type:"int",control:"slider",min:0,max:360},{key:"maxAzimuth",description:"Maximum arc the camera can reach counter-clockwise of the target point","default":270,type:"int",control:"slider",min:0,max:360},{key:"lookAtDistance",description:"The point to orbit around","default":15,type:"float",min:.001}]},a.exports=p},function(a,b,c){function d(){this.id=null,this._volume=1,this._frequency=440,this._type="sine",this._outNode=e.getContext().createGain(),this.connectTo()}var e=c(305),f=c(9);d.prototype.stop=function(){this._oscNode.stop(),this._oscNode=null},d.prototype.play=function(){this._oscNode=e.getContext().createOscillator(),this._oscNode.connect(this._outNode),this._oscNode.frequency.value=this._frequency,this._oscNode.type=this._type,this._oscNode.start()},d.prototype.update=function(a){void 0!==a.volume&&(this._volume=f.clamp(a.volume,0,1),this._outNode.gain.value=this._volume),void 0!==a.frequency&&(this._frequency=a.frequency,this._oscNode&&(this._oscNode.frequency.value=this._frequency)),void 0!==a.type&&-1!==d.TYPES.indexOf(a.type)&&(this._type=a.type,this._oscNode&&(this._oscNode.type=this._type))},d.prototype.connectTo=function(a){if(!e.isSupported())return void console.warn("WebAudio not supported");if(this._outNode.disconnect(),a){a instanceof Array||(a=[a]);for(var b=0;b<a.length;b++)this._outNode.connect(a[b])}},d.TYPES=["sine","square","sawtooth","triangle","custom"],a.exports=d},function(a,b){function c(a){a=a||{},this.prepare=a.prepare?a.prepare:function(){},this.apply=a.apply?a.apply:function(){},this.enabled=void 0!==a.enabled?a.enabled===!0:!0}a.exports=c},function(a,b,c){function d(a){e.call(this,"PickingSystem",["MeshRendererComponent","TransformComponent"]),this.passive=!0,this.pickRay=null,this.onPick=null,a=a||{},this.setPickLogic(a.pickLogic||null)}var e=c(42);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.setPickLogic=function(a){this.pickLogic=a,a&&-1===this.interests.indexOf("MeshDataComponent")&&this.interests.push("MeshDataComponent")},d.prototype.inserted=function(a){a.meshRendererComponent.isPickable&&this.pickLogic&&this.pickLogic.added(a)},d.prototype.deleted=function(a){this.pickLogic&&this.pickLogic.removed(a)},d.prototype.process=function(a){if(this.pickRay&&this.onPick){for(var b=[],c=0;c<a.length;c++){var d=a[c],e=d.meshRendererComponent;if(e.isPickable)if(this.pickLogic){this.pickLogic.isConstructed(d)||this.pickLogic.added(d);var f=this.pickLogic.getPickResult(this.pickRay,d);f&&f.distances&&f.distances.length&&b.push({entity:d,intersection:f})}else if(e.worldBound){var f=e.worldBound.intersectsRayWhere(this.pickRay);f&&f.distances.length&&b.push({entity:d,intersection:f})}}b.sort(function(a,b){return a.intersection.distances[0]-b.intersection.distances[0]}),this.onPick(b)}},a.exports=d},function(a,b,c){function d(a){e.call(this,"PipRenderSystem",null),this.renderSystem=a,this.target=new j(512,512),this.outPass=new m(l.copy);var b=this;this.outPass.render=function(a,c,d){this.material.setTexture("DIFFUSE_MAP",d),a.render(this.renderable,n.camera,[],b.target,!0)};var c=new k(o);c.setTexture("DIFFUSE_MAP",this.target),this.quad=new i(1,1),this.aspect=null,this.width=null,this.height=null,this.renderableQuad={meshData:this.quad,materials:[c]},this.renderList=[],this.usePostEffects=!1,this.camera=null,this.size=null,this.dirty=!1,f.addListener("goo.setPipCamera",function(a){this.camera=a.camera,this.usePostEffects=void 0!==a.usePostEffects?a.usePostEffects:!1,this.dirty=!0}.bind(this)),this._viewportResizeHandler=function(a){this.size=a,this.dirty=!0}.bind(this),f.addListener("goo.viewportResize",this._viewportResizeHandler,!0)}var e=c(42),f=c(44),g=c(14),h=c(31),i=c(28),j=c(133),k=c(30),l=c(46),m=c(135),n=c(136);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.updateQuad=function(a,b,c,d,e){a.getAttributeBuffer(g.POSITION).set([b,c,0,b,c+e,0,b+d,c+e,0,b+d,c,0]),a.setVertexDataUpdated()},d.prototype.render=function(a){if(this.camera&&this.size){this.renderer=a,this.dirty&&(this.dirty=!1,a.checkResize(this.camera,!0));var b=this.camera.aspect,c=.2*this.size.height,d=c*b;(b!==this.aspect||d!==this.width||c!==this.height)&&(this.aspect=b,this.width=d,this.height=c,this.updateQuad(this.quad,10,10,d,c)),a.updateShadows(this.renderSystem.partitioner,this.renderSystem.entities,this.renderSystem.lights);for(var e=0;e<this.renderSystem.preRenderers.length;e++){var f=this.renderSystem.preRenderers[e];f.process(a,this.renderSystem.entities,this.renderSystem.partitioner,this.camera,this.renderSystem.lights)}if(this.renderSystem.partitioner.process(this.camera,this.renderSystem.entities,this.renderList),this.usePostEffects&&this.renderSystem.composers.length>0){var g=this.renderSystem.composers[0],h=g.passes.length-1,i=g.passes[h];g.passes[h]=this.outPass,g.render(a,this.renderSystem.currentTpf,this.camera,this.renderSystem.lights,null,!0),g.passes[h]=i}else{var j=null;a.render(this.renderList,this.camera,this.renderSystem.lights,this.target,!0,j)}a.render(this.renderableQuad,n.camera,[],null,!1)}};var o={defines:{EDGE:!0},attributes:{vertexPosition:g.POSITION,vertexUV0:g.TEXCOORD0},uniforms:{viewProjectionMatrix:h.VIEW_PROJECTION_MATRIX,worldMatrix:h.WORLD_MATRIX,diffuseMap:h.DIFFUSE_MAP,resolution:h.RESOLUTION},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","uniform vec2 resolution;","varying vec2 texCoord0;","void main(void) {","  texCoord0 = vertexUV0;","  gl_Position = vec4(","    2.0 * vertexPosition.x / resolution.x - 1.0,","    2.0 * vertexPosition.y / resolution.y - 1.0,","    -1.0,","    1.0","  );","}"].join("\n"),fshader:["uniform sampler2D diffuseMap;","uniform vec2 resolution;","varying vec2 texCoord0;","const vec4 edgeCol = vec4(0.2, 0.2, 0.2, 1.0);","void main(void) {","  vec4 color = texture2D(diffuseMap, texCoord0);","  #ifdef EDGE","  float edge = step(10.0 / resolution.x, min(texCoord0.x, 1.0 - texCoord0.x)) * step(10.0 / resolution.y, min(texCoord0.y, 1.0 - texCoord0.y));","  gl_FragColor = mix(edgeCol, color, edge);","  #else","  gl_FragColor = color;","  #endif","}"].join("\n")};a.exports=d},function(a,b,c){function d(){this.invRay=new f,this.invMatrix=new g}var e=c(306),f=c(122),g=c(33);d.prototype.getPickResult=function(a,b){var c=b.meshDataComponent.meshData.__boundingTree;if(!c)return null;var d=b.transformComponent.sync().worldTransform;this.invMatrix.copy(d.matrix).invert(),this.invRay.origin.set(a.origin).applyPostPoint(this.invMatrix),this.invRay.direction.set(a.direction).applyPostVector(this.invMatrix);var e=c.findPick(this.invRay,b),f={};return e.length>0&&(e.sort(function(a,b){return a.distance-b.distance}),f.distances=[],f.points=[],f.vertices=[],e.forEach(function(a){f.distances.push(a.distance),f.points.push(a.point),f.vertices.push(a.vertices)})),f},d.prototype.added=function(a){this.isConstructed(a)||this.rebuild(a)},d.prototype.removed=function(a){a.meshDataComponent&&a.meshDataComponent.meshData&&(a.meshDataComponent.meshData.__boundingTree=null)},d.prototype.isConstructed=function(a){return!!a.meshDataComponent.meshData.__boundingTree},d.prototype.rebuild=function(a){a.meshDataComponent.meshData.__boundingTree=new e,a.meshDataComponent.meshData.__boundingTree.construct(a)},a.exports=d},function(a,b){function c(a){function b(){d=(d+1)%256,e=(e+c[d])%256;var a=c[d];return c[d]=c[e],c[e]=a,c[(c[d]+c[e])%256]}var c=[],d=0,e=0;this.init=function(a){for(var b=0;256>b;b++)c[b]=b;for(var d=0,b=0;256>b;b++){d=(d+c[b]+a.charCodeAt(b%a.length))%256;var e=c[b];c[b]=c[d],c[d]=e}},this.init(a),this.getRandomNumber=function(){for(var a=0,c=1,d=0;8>d;d++)a+=b()*c,c*=256;return a/0x10000000000000000}}a.exports=c},function(a,b,c){function d(a,b){this.renderList=a,this.filter=b,this.clearColor=new g(0,0,0,0),this.oldClearColor=new g,this.renderToScreen=!1,this.overrideMaterial=null,this.enabled=!0,this.clear=!0,this.needsSwap=!1,this.viewportSize=void 0}var e=c(123),f=c(137),g=c(11);d.prototype=Object.create(f.prototype),d.prototype.constructor=d,d.prototype.render=function(a,b,c,d,f,g,h,i){if(g=g||e.mainCamera){h=h||[];var j;j=this.filter?this.renderList.filter(this.filter):this.renderList,this.renderToScreen?a.render(j,g,h,null,this.clear,this.overrideMaterial):a.render(j,g,h,c,this.clear,this.overrideMaterial),this.clearColor,1}},a.exports=d},function(a,b,c){function d(a,b,c){if(1===arguments.length&&arguments[0]instanceof Object){var d=arguments[0];a=d.width,b=d.height,c=d.length}this.xExtent=void 0!==a?.5*a:.5,this.yExtent=void 0!==b?.5*b:.5,this.zExtent=void 0!==c?.5*c:.5;var f=e.defaultMap([e.POSITION]);e.call(this,f,8,36),this.rebuild()}var e=c(14);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.rebuild=function(){var a=this.xExtent,b=this.yExtent,c=this.zExtent;return this.getAttributeBuffer(e.POSITION).set([-a,-b,-c,a,-b,-c,a,b,-c,-a,b,-c,-a,-b,c,a,-b,c,a,b,c,-a,b,c]),this.getIndexBuffer().set([2,1,0,0,3,2,5,6,7,7,4,5,7,3,0,0,4,7,1,2,6,6,5,1,6,2,3,3,7,6,0,1,5,5,4,0]),this},d.prototype.clone=function(){var a={width:2*this.xExtent,height:2*this.yExtent,length:2*this.zExtent};return new d(a)},a.exports=d},function(a,b,c){function d(){var a=this.ajax=new g;this.soundHandler=new e({},function(b,c){return a.load(b,c?c.noCache:!1)},function(){},function(b,c){return a.load(b,c?c.noCache:!1)})}var e=c(334),f=c(305),g=c(132),h=c(36),i=c(54);d.prototype.clear=function(){this.ajax.clear(),this.soundHandler.clear()},d.prototype.loadSound=function(a,b){if(!f.isSupported())return i.reject(new Error("AudioContext is not supported!"));var c=h.createUniqueId("sound");b=b||{},b.audioRefs={};var d=h.getAfterLast(a,".");b.audioRefs[d]=a;var e=this.soundHandler._create();return this.soundHandler._objects.set(c,e),this.soundHandler.update(c,b,{})},a.exports=d},function(a,b,c){function d(a){this.controlPoints=a,this.segments=(this.controlPoints.length-1)/3}var e=c(19),f=c(8),g=c(11);!function(){var a=new g,b=new g,c=new g,h=new f,i=new f,j=new f,k=new e,l=new e,m=new e;
d.quadraticInterpolation=function(d,n,o,p,q){var r=p*p,s=1-p,t=s*s;q instanceof g?(d.copyTo(a),a.scale(t),n.copyTo(b),b.scale(s*p*2),o.copyTo(c),c.scale(r),q.set(a).add(b).add(c)):q instanceof f?(d.copyTo(h),h.scale(t),n.copyTo(i),i.scale(s*p*2),o.copyTo(j),j.scale(r),q.set(h).add(i).add(j)):q instanceof e&&(d.copyTo(k),k.scale(t),n.copyTo(l),l.scale(s*p*2),o.copyTo(m),m.scale(r),q.set(k).add(l).add(m))}}(),function(){var a=new g,b=new g,c=new g,h=new g,i=new f,j=new f,k=new f,l=new f,m=new e,n=new e,o=new e,p=new e;d.cubicInterpolation=function(d,q,r,s,t,u){var v=t*t,w=v*t,x=1-t,y=x*x,z=y*x;u instanceof g?(d.copyTo(a),a.scale(z),q.copyTo(b),b.scale(y*t*3),r.copyTo(c),c.scale(x*v*3),s.copyTo(h),h.scale(w),u.set(a).add(b).add(c).add(h)):u instanceof f?(d.copyTo(i),i.scale(z),q.copyTo(j),j.scale(y*t*3),r.copyTo(k),k.scale(x*v*3),s.copyTo(l),l.scale(w),u.set(i).add(j).add(k).add(l)):u instanceof e&&(d.copyTo(m),m.scale(z),q.copyTo(n),n.scale(y*t*3),r.copyTo(o),o.scale(x*v*3),s.copyTo(p),p.scale(w),u.set(m).add(n).add(o).add(p))}}(),d.prototype.getPoint=function(a,b){if(0>=a)return void b.set(this.controlPoints[0]);if(a>=1)return void b.set(this.controlPoints[this.controlPoints.length-1]);var c=this.segments*a,e=Math.floor(c),f=c-e,g=this.controlPoints[3*e+0],h=this.controlPoints[3*e+1],i=this.controlPoints[3*e+2],j=this.controlPoints[3*e+3];d.cubicInterpolation(g,h,i,j,f,b)},a.exports=d},function(a,b,c){function d(a,b){this.substepSize=b||.01,this._spline=a,this._segment=0,this._localT=0,this._pointer=a.controlPoints[0].clone()}var e=c(375);d.prototype._localInterpolation=function(a){var b=this._spline.controlPoints[3*this._segment+0],c=this._spline.controlPoints[3*this._segment+1],d=this._spline.controlPoints[3*this._segment+2],f=this._spline.controlPoints[3*this._segment+3];e.cubicInterpolation(b,c,d,f,this._localT,a)},d.prototype._step=function(a,b){return this._localT+=a,this._localT>1&&(this._localT-=1,this._segment++,this._segment>=this._spline.segments)?void b.copy(this._spline.controlPoints[this._spline.controlPoints.length-1]):void this._localInterpolation(b)},d.prototype.advance=function(a,b){for(var c=0;a>c&&this._segment<this._spline.segments;)this._step(this.substepSize,b),c+=this._pointer.distance(b),this._pointer.copy(b)},d.prototype.canWalk=function(){return this._segment<this._spline.segments},a.exports=d},function(a,b,c){var d=c(36);a.exports=d},function(a,b,c){function d(a){e.apply(this,arguments),this.type="TextComponent",this.text=a||"",this.dirty=!0}var e=c(20);d.type="TextComponent",d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.setText=function(a){return this.text!==a&&(this.text=a,this.dirty=!0),this},a.exports=d},function(a,b,c){function d(){e.call(this,"TextSystem",["TextComponent"])}var e=c(42),f=c(380),g=c(216);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.process=function(a){for(var b=0;b<a.length;b++){var c=a[b],d=c.textComponent;if(d.dirty){if(c.hasComponent("MeshDataComponent"))c.getComponent("MeshDataComponent").meshData=f.fromString(d.text);else{var e=f.fromString(d.text),h=new g(e);c.setComponent(h)}this.dirty=!1}}},a.exports=d},function(a,b,c){function d(a,b){this.matrix=a,this.textureUnitsPerLine=b||8;var c=g.defaultMap([g.POSITION,g.NORMAL,g.TEXCOORD0]),d=e(a);g.call(this,c,4*d,6*d),this.rebuild()}function e(a){for(var b=0,c=0;c<a.length;c++)b+=a[c].length;return b}function f(a){var b=[],c=a.split("\n");return c.forEach(function(a){var c=a.split(""),d=c.map(function(a){return a.charCodeAt(0)});b.push(d)}),b}var g=c(14),h=c(6);d.prototype=Object.create(g.prototype),d.prototype.constructor=d,d.prototype.rebuild=function(){for(var a=[],b=[],c=[],d=[],e=0,f=this.matrix.length/2,h=0;h<this.matrix.length;h++)for(var i=this.matrix[h].length/2,j=0;j<this.matrix[h].length;j++){a.push(j-i,-h-1+f,0,j-i,-h+f,0,j+1-i,-h+f,0,j+1-i,-h-1+f,0),b.push(0,0,1,0,0,1,0,0,1,0,0,1);var k=this.matrix[h][j]%this.textureUnitsPerLine/this.textureUnitsPerLine,l=Math.floor(this.matrix[h][j]/this.textureUnitsPerLine)/this.textureUnitsPerLine;l=1-l,d.push(k,l-1/this.textureUnitsPerLine,k,l,k+1/this.textureUnitsPerLine,l,k+1/this.textureUnitsPerLine,l-1/this.textureUnitsPerLine),c.push(e+3,e+1,e+0,e+2,e+1,e+3),e+=4}return this.getAttributeBuffer(g.POSITION).set(a),this.getAttributeBuffer(g.NORMAL).set(b),this.getAttributeBuffer(g.TEXCOORD0).set(d),this.getIndexBuffer().set(c),this},d.prototype.clone=function(){var a=h.shallowSelectiveClone(this,["matrix","textureUnitsPerLine"]);return new d(a)},d.fromString=function(a){return new d(f(a),16)},a.exports=d},function(a,b,c){function d(){e.call(this)}var e=c(364);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.sources=[0,1/15,2/15,.2,4/15,5/15,.4,7/15,8/15,.6,10/15,11/15,.8,13/15,14/15,1],d.evaluate1d=function(a,b){var c=e.split(a/b),f=15&e.shifter[255&c.i0],g=15&e.shifter[255&c.i1],h=0;return h+=c.f0*d.sources[f],h+=c.f1*d.sources[g]},d.evaluate2d=function(a,b,c){var f=e.split(a/c),g=e.split(b/c),h=15&e.shifter[e.shifter[255&g.i0]+f.i0&255],i=15&e.shifter[e.shifter[255&g.i0]+f.i1&255],j=15&e.shifter[e.shifter[255&g.i1]+f.i0&255],k=15&e.shifter[e.shifter[255&g.i1]+f.i1&255],l=0;return l+=g.f0*f.f0*d.sources[h],l+=g.f0*f.f1*d.sources[i],l+=g.f1*f.f0*d.sources[j],l+=g.f1*f.f1*d.sources[k]},d.evaluate3d=function(a,b,c,f){var g=e.split(a/f),h=e.split(b/f),i=e.split(c/f),j=15&e.shifter[e.shifter[e.shifter[255&i.i0]+h.i0&255]+g.i0&255],k=15&e.shifter[e.shifter[e.shifter[255&i.i0]+h.i0&255]+g.i1&255],l=15&e.shifter[e.shifter[e.shifter[255&i.i0]+h.i1&255]+g.i0&255],m=15&e.shifter[e.shifter[e.shifter[255&i.i0]+h.i1&255]+g.i1&255],n=15&e.shifter[e.shifter[e.shifter[255&i.i1]+h.i0&255]+g.i0&255],o=15&e.shifter[e.shifter[e.shifter[255&i.i1]+h.i0&255]+g.i1&255],p=15&e.shifter[e.shifter[e.shifter[255&i.i1]+h.i1&255]+g.i0&255],q=15&e.shifter[e.shifter[e.shifter[255&i.i1]+h.i1&255]+g.i1&255],r=0;return r+=i.f0*h.f0*g.f0*d.sources[j],r+=i.f0*h.f0*g.f1*d.sources[k],r+=i.f0*h.f1*g.f0*d.sources[l],r+=i.f0*h.f1*g.f1*d.sources[m],r+=i.f1*h.f0*g.f0*d.sources[n],r+=i.f1*h.f0*g.f1*d.sources[o],r+=i.f1*h.f1*g.f0*d.sources[p],r+=i.f1*h.f1*g.f1*d.sources[q]},d.evaluate4d=function(a,b,c,f,g){var h=e.split(a/g),i=e.split(b/g),j=e.split(c/g),k=e.split(f/g),l=15&e.shifter[e.shifter[e.shifter[e.shifter[255&k.i0]+j.i0&255]+i.i0&255]+h.i0&255],m=15&e.shifter[e.shifter[e.shifter[e.shifter[255&k.i0]+j.i0&255]+i.i0&255]+h.i1&255],n=15&e.shifter[e.shifter[e.shifter[e.shifter[255&k.i0]+j.i0&255]+i.i1&255]+h.i0&255],o=15&e.shifter[e.shifter[e.shifter[e.shifter[255&k.i0]+j.i0&255]+i.i1&255]+h.i1&255],p=15&e.shifter[e.shifter[e.shifter[e.shifter[255&k.i0]+j.i1&255]+i.i0&255]+h.i0&255],q=15&e.shifter[e.shifter[e.shifter[e.shifter[255&k.i0]+j.i1&255]+i.i0&255]+h.i1&255],r=15&e.shifter[e.shifter[e.shifter[e.shifter[255&k.i0]+j.i1&255]+i.i1&255]+h.i0&255],s=15&e.shifter[e.shifter[e.shifter[e.shifter[255&k.i0]+j.i1&255]+i.i1&255]+h.i1&255],t=15&e.shifter[e.shifter[e.shifter[e.shifter[255&k.i1]+j.i0&255]+i.i0&255]+h.i0&255],u=15&e.shifter[e.shifter[e.shifter[e.shifter[255&k.i1]+j.i0&255]+i.i0&255]+h.i1&255],v=15&e.shifter[e.shifter[e.shifter[e.shifter[255&k.i1]+j.i0&255]+i.i1&255]+h.i0&255],w=15&e.shifter[e.shifter[e.shifter[e.shifter[255&k.i1]+j.i0&255]+i.i1&255]+h.i1&255],x=15&e.shifter[e.shifter[e.shifter[e.shifter[255&k.i1]+j.i1&255]+i.i0&255]+h.i0&255],y=15&e.shifter[e.shifter[e.shifter[e.shifter[255&k.i1]+j.i1&255]+i.i0&255]+h.i1&255],z=15&e.shifter[e.shifter[e.shifter[e.shifter[255&k.i1]+j.i1&255]+i.i1&255]+h.i0&255],A=15&e.shifter[e.shifter[e.shifter[e.shifter[255&k.i1]+j.i1&255]+i.i1&255]+h.i1&255],B=0;return B+=k.f0*j.f0*i.f0*h.f0*d.sources[l],B+=k.f0*j.f0*i.f0*h.f1*d.sources[m],B+=k.f0*j.f0*i.f1*h.f0*d.sources[n],B+=k.f0*j.f0*i.f1*h.f1*d.sources[o],B+=k.f0*j.f1*i.f0*h.f0*d.sources[p],B+=k.f0*j.f1*i.f0*h.f1*d.sources[q],B+=k.f0*j.f1*i.f1*h.f0*d.sources[r],B+=k.f0*j.f1*i.f1*h.f1*d.sources[s],B+=k.f1*j.f0*i.f0*h.f0*d.sources[t],B+=k.f1*j.f0*i.f0*h.f1*d.sources[u],B+=k.f1*j.f0*i.f1*h.f0*d.sources[v],B+=k.f1*j.f0*i.f1*h.f1*d.sources[w],B+=k.f1*j.f1*i.f0*h.f0*d.sources[x],B+=k.f1*j.f1*i.f0*h.f1*d.sources[y],B+=k.f1*j.f1*i.f1*h.f0*d.sources[z],B+=k.f1*j.f1*i.f1*h.f1*d.sources[A]},a.exports=d}]);