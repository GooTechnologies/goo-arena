webpackJsonp([17],{0:function(a,b,c){a.exports=c(476)},476:function(a,b,c){if(a.exports={AxisAlignedCamControlScript:c(477),BasicControlScript:c(478),ButtonScript:c(479),CannonPickScript:c(480),FlyControlScript:c(481),GroundBoundMovementScript:c(484),HeightMapBoundingScript:c(485),LensFlareScript:c(486),MouseLookControlScript:c(483),OrbitNPanControlScript:c(487),PanCamScript:c(488),PickAndRotateScript:c(489),PolyBoundingScript:c(490),RotationScript:c(491),ScriptComponentHandler:c(492),ScriptHandler:c(493),ScriptHandlers:c(494),ScriptRegister:c(495),SparseHeightMapBoundingScript:c(496),WasdControlScript:c(482),WorldFittedTerrainScript:c(497)},"undefined"!=typeof window)for(var d in a.exports)window.goo[d]=a.exports[d]},477:function(a,b,c){function d(){function a(a,c){c.axis=e.UNIT_Z.clone(),c.upAxis=e.UNIT_Y.clone(),b(a,c,a.view),c.currentView=a.view,c.lookAtPoint=new e,c.distance=a.distance,c.smoothness=Math.pow(f.clamp(a.smoothness,0,1),.3),c.axisAlignedDirty=!0}function b(a,b,c){if(b.currentView!==c){switch(b.currentView=c,c){case"XY":b.axis.set(e.UNIT_Z),b.upAxis.set(e.UNIT_Y);break;case"ZY":b.axis.set(e.UNIT_X),b.upAxis.set(e.UNIT_Y)}b.axisAlignedDirty=!0}}function c(a,b){if(a.view!==b.currentView&&(b.axisAlignedDirty=!0),b.axisAlignedDirty){var c=b.entity,d=c.transformComponent.transform;d.translation.set(b.axis).scale(b.distance).add(b.lookAtPoint),d.lookAt(b.lookAtPoint,b.upAxis),c.transformComponent.setUpdated(),b.axisAlignedDirty=!1}}function d(){}return{setup:a,update:c,cleanup:d}}var e=c(8),f=c(9);d.externals={key:"AxisAlignedCamControlScript",name:"Axis-aligned Camera Control",description:"Aligns a camera along an axis, and enables switching between them.",parameters:[{key:"whenUsed",name:"When Camera Used",description:"Script only runs when the camera to which it is added is being used.","default":!0,type:"boolean"},{key:"distance",name:"Distance",type:"float",description:"Camera distance from lookat point",control:"slider","default":1,min:1,max:1e3},{key:"view",type:"string","default":"XY",control:"select",options:["XY","ZY"]}]},a.exports=d},478:function(a,b,c){function d(a){a=a||{},this.domElement=void 0===a.domElement?null:a.domElement.domElement||a.domElement,this.name="BasicControlScript",this.movementSpeed=10,this.rollSpeed=2,this.movementSpeedMultiplier=1,this.mouseStatus=0,this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this.moveVector=new e(0,0,0),this.rotationVector=new e(0,0,0),this.multiplier=new e(1,1,1),this.rotationMatrix=new f,this.tmpVec=new e,this.handleEvent=function(a){"function"==typeof this[a.type]&&this[a.type](a)},this.keydown=function(a){if(!a.altKey){switch(a.keyCode){case 16:this.movementSpeedMultiplier=.1;break;case 87:this.moveState.forward=1;break;case 83:this.moveState.back=1;break;case 65:this.moveState.left=1;break;case 68:this.moveState.right=1;break;case 82:this.moveState.up=1;break;case 70:this.moveState.down=1;break;case 38:this.moveState.pitchUp=1;break;case 40:this.moveState.pitchDown=1;break;case 37:this.moveState.yawLeft=1;break;case 39:this.moveState.yawRight=1;break;case 81:this.moveState.rollLeft=1;break;case 69:this.moveState.rollRight=1}this.updateMovementVector(),this.updateRotationVector()}},this.keyup=function(a){switch(a.keyCode){case 16:this.movementSpeedMultiplier=1;break;case 87:this.moveState.forward=0;break;case 83:this.moveState.back=0;break;case 65:this.moveState.left=0;break;case 68:this.moveState.right=0;break;case 82:this.moveState.up=0;break;case 70:this.moveState.down=0;break;case 38:this.moveState.pitchUp=0;break;case 40:this.moveState.pitchDown=0;break;case 37:this.moveState.yawLeft=0;break;case 39:this.moveState.yawRight=0;break;case 81:this.moveState.rollLeft=0;break;case 69:this.moveState.rollRight=0}this.updateMovementVector(),this.updateRotationVector()},this.mousedown=function(a){this.domElement!==document&&this.domElement.focus(),a.preventDefault(),a=a.touches&&1===a.touches.length?a.touches[0]:a,this.mouseDownX=a.pageX,this.mouseDownY=a.pageY,this.mouseStatus=1,document.addEventListener("mousemove",this.mousemove,!1),document.addEventListener("mouseup",this.mouseup,!1),document.addEventListener("touchmove",this.mousemove,!1),document.addEventListener("touchend",this.mouseup,!1)}.bind(this),this.mousemove=function(a){this.mouseStatus>0&&(a=a.touches&&1===a.touches.length?a.touches[0]:a,this.moveState.yawLeft=a.pageX-this.mouseDownX,this.moveState.pitchDown=a.pageY-this.mouseDownY,this.updateRotationVector(),this.mouseDownX=a.pageX,this.mouseDownY=a.pageY)}.bind(this),this.mouseup=function(a){this.mouseStatus&&(a.preventDefault(),this.mouseStatus=0,this.moveState.yawLeft=this.moveState.pitchDown=0,this.updateRotationVector(),document.removeEventListener("mousemove",this.mousemove),document.removeEventListener("mouseup",this.mouseup),document.removeEventListener("touchmove",this.mousemove),document.removeEventListener("touchend",this.mouseup))}.bind(this),this.updateMovementVector=function(){var a=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right,this.moveVector.y=-this.moveState.down+this.moveState.up,this.moveVector.z=-a+this.moveState.back},this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp,this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft,this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft},this.getContainerDimensions=function(){return this.domElement!==document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}},this.domElement&&this.setupMouseControls(),this.updateMovementVector(),this.updateRotationVector()}var e=c(8),f=c(24);d.prototype.setupMouseControls=function(){this.domElement.setAttribute("tabindex",-1),this.domElement.addEventListener("mousedown",this.mousedown,!1),this.domElement.addEventListener("touchstart",this.mousedown,!1),this.domElement.addEventListener("keydown",this.keydown.bind(this),!1),this.domElement.addEventListener("keyup",this.keyup.bind(this),!1)},d.prototype.externals=function(){return[{variable:"movementSpeed",type:"number"},{variable:"rollSpeed",type:"number"}]},d.prototype.run=function(a,b,c){c&&!this.domElement&&c.domElement&&(this.domElement=c.domElement,this.setupMouseControls());var d=a.transformComponent,f=d.transform,g=a._world.tpf,h=g*this.movementSpeed*this.movementSpeedMultiplier,i=g*this.rollSpeed*this.movementSpeedMultiplier;(!this.moveVector.equals(e.ZERO)||!this.rotationVector.equals(e.ZERO)||this.mouseStatus>0)&&(f.translation.x+=this.moveVector.x*h,f.translation.y+=this.moveVector.y*h,f.translation.z+=this.moveVector.z*h,this.tmpVec.x+=-this.rotationVector.x*i*this.multiplier.x,this.tmpVec.y+=this.rotationVector.y*i*this.multiplier.y,this.tmpVec.z+=this.rotationVector.z*i*this.multiplier.z,f.rotation.fromAngles(this.tmpVec.x,this.tmpVec.y,this.tmpVec.z),this.mouseStatus>0&&(this.moveState.yawLeft=0,this.moveState.pitchDown=0,this.updateRotationVector()),d.setUpdated())},a.exports=d},479:function(a,b,c){function d(){function a(a,c){c.button=["Any","Left","Middle","Right"].indexOf(a.button)-1,c.button<-1&&(c.button=-1),c.renderToPickHandler=function(){c.skipUpdateBuffer=!0},e.addListener("ButtonScript.renderToPick",c.renderToPickHandler,!1),c.mouseState={x:0,y:0,down:!1,downOnEntity:!1,overEntity:!1},c.listeners={mousedown:function(d){if(a.whenUsed){var e=f(d);(e===c.button||-1===c.button)&&(c.mouseState.down=!0,b(a,c,d),g(a,c,"mousedown"))}},mouseup:function(d){if(a.whenUsed){var e=f(d);(e===c.button||-1===c.button)&&(c.mouseState.down=!1,b(a,c,d),c.mouseState.downOnEntity&&g(a,c,"click"),g(a,c,"mouseup"))}},dblclick:function(d){if(a.whenUsed){var e=f(d);(e===c.button||-1===c.button)&&(c.mouseState.down=!1,b(a,c,d),g(a,c,"dblclick"))}},mousemove:function(d){a.whenUsed&&a.enableOnMouseMove&&(c.mouseState.down=!1,b(a,c,d),g(a,c,"mousemove"))},touchstart:function(b){if(a.whenUsed){c.mouseState.down=!0;var d=b.targetTouches,e=c.domElement.getBoundingClientRect();c.mouseState.x=d[0].pageX-e.left,c.mouseState.y=d[0].pageY-e.top,g(a,c,"touchstart")}},touchend:function(b){a.whenUsed&&(b.preventDefault(),b.stopPropagation(),c.mouseState.down=!1,g(a,c,"touchend"))}};for(var d in c.listeners)c.domElement.addEventListener(d,c.listeners[d])}function b(a,b,c){var d=b.domElement.getBoundingClientRect();b.mouseState.x=c.pageX-d.left,b.mouseState.y=c.pageY-d.top}function c(a,b){b.skipUpdateBuffer=!1}function d(a,b){for(var c in b.listeners)b.domElement.removeEventListener(c,b.listeners[c]);e.removeListener("ButtonScript.renderToPick",b.renderToPickHandler)}function f(a){var b=a.button;return 0===b&&(a.altKey?b=2:a.shiftKey&&(b=1)),b}function g(a,b,c){var d=b.entity._world.gooRunner,f=d.pickSync(b.mouseState.x,b.mouseState.y,b.skipUpdateBuffer);b.skipUpdateBuffer||e.emit("ButtonScript.renderToPick");var g=d.world.entityManager.getEntityByIndex(f.id);b.mouseState.downOnEntity=!1,g===b.entity&&(e.emit(a.channel+"."+c,{type:c,entity:g}),("mousedown"===c||"touchstart"===c)&&(b.mouseState.downOnEntity=!0),!a.linkUrl||"click"!==c&&"touchend"!==c||window.open(a.linkUrl,a.linkTarget)),"mousemove"!==c||b.mouseState.overEntity||g!==b.entity||e.emit(a.channel+".mouseover",{type:"mouseover",entity:g}),"mousemove"===c&&b.mouseState.overEntity&&g!==b.entity&&e.emit(a.channel+".mouseout",{type:"mouseout",entity:g}),b.mouseState.overEntity=g===b.entity}return{setup:a,update:c,cleanup:d}}var e=c(44);d.externals={key:"ButtonScript",name:"Button",description:"Enables an entity to be interacted with using click or touch.",parameters:[{key:"whenUsed",type:"boolean","default":!0},{key:"button",name:"button",description:"Only interact with this mouse button.",type:"string",control:"select","default":"Any",options:["Any","Left","Middle","Right"]},{key:"linkUrl",name:"linkUrl",description:"URL to open when clicking the entity. Leave this field empty to disable.",type:"string","default":""},{key:"linkTarget",name:"linkTarget",description:"The window to open the link in.",type:"string","default":"_blank"},{key:"channel",name:"channel",description:"Event channel to emit to. Will emit channel.click, .mousedown, .mouseup, .mouseover, .mouseout, .dblclick, .touchstart, .touchend",type:"string","default":"button"},{key:"enableOnMouseMove",name:"enableOnMouseMove",description:"Enables .mousemove, .mouseover, and .mouseout events. For larger scenes, this might be worth turning off, for better performance.",type:"boolean","default":!0}]},a.exports=d},480:function(a,b,c){function d(){function a(a){var b=a[0].clientX,c=a[0].clientY,d=a[1].clientX,e=a[1].clientY,f=(b+d)/2,g=(c+e)/2;return[f,g]}function b(b,c){k=["Any","Left","Middle","Right"].indexOf(b.pickButton)-1,-1>k&&(k=-1),m=c.world.getSystem("CannonSystem");var d=new CANNON.Sphere(.1),e=c.jointBody=new CANNON.RigidBody(0,d);e.collisionFilterGroup=2,e.collisionFilterMask=2,m.world.add(e),l={x:0,y:0,ox:0,oy:0,dx:0,dy:0,down:!1};var f=c.listeners={mousedown:function(a){if(!b.whenUsed||c.entity===c.activeCameraEntity){var d=a.button;0===d&&(a.altKey?d=2:a.shiftKey&&(d=1)),(d===k||-1===k)&&(l.down=!0,l.ox=l.x=a.clientX,l.oy=l.y=a.clientY)}},mouseup:function(a){var b=a.button;0===b&&(a.altKey?b=2:a.shiftKey&&(b=1)),(b===k||-1===k)&&(l.down=!1,l.dx=l.dy=0)},mousemove:function(a){b.whenUsed&&c.entity!==c.activeCameraEntity||l.down&&(l.x=a.clientX,l.y=a.clientY,c.dirty=!0)},mouseleave:function(){l.down=!1,l.ox=l.x,l.oy=l.y},touchstart:function(d){if(!b.whenUsed||c.entity===c.activeCameraEntity){if(l.down=2===d.targetTouches.length,!l.down)return;var e=a(d.targetTouches);l.ox=l.x=e[0],l.oy=l.y=e[1]}},touchmove:function(d){if(!b.whenUsed||c.entity===c.activeCameraEntity){if(!l.down)return;var e=a(d.targetTouches);l.x=e[0],l.y=e[1]}},touchend:function(){l.down=!1,l.ox=l.x,l.oy=l.y}};for(var g in f)c.domElement.addEventListener(g,f[g]);c.dirty=!0}function c(a,b){l.dx=l.x-l.ox,l.dy=l.y-l.oy,l.ox=l.x,l.oy=l.y;var c=f.mainCamera;if(c&&l.down&&!b.mouseConstraint){for(var d=[],g=b.world.by.system("CannonSystem").toArray(),k=0;k<g.length;k++){var m=g[k].cannonRigidbodyComponent.body;m&&m.shape instanceof CANNON.Box&&m.motionstate===CANNON.Body.DYNAMIC&&d.push(m)}var o=c.getPickRay(l.x,l.y,window.innerWidth,window.innerHeight),p=new CANNON.Vec3(o.origin.x,o.origin.y,o.origin.z),q=new CANNON.Vec3(o.direction.x,o.direction.y,o.direction.z),r=new CANNON.Ray(p,q),s=r.intersectBodies(d);if(s.length){var m=s[0].body,t=s[0].point;h(a,b,t.x,t.y,t.z,m,o.direction.scale(-1))}}else if(c&&l.down&&b.mouseConstraint&&(0!==l.dx||0!==l.dy)){var c=f.mainCamera,o=c.getPickRay(l.x,l.y,window.innerWidth,window.innerHeight),u=new e;n.rayIntersect(o,u,!0),i(a,b,u)}else l.down||j(a,b)}function d(a,b){for(var c in b.listeners)b.domElement.removeEventListener(c,b.listeners[c])}function h(a,b,c,d,f,g,h){b.constrainedBody=g;var i=new CANNON.Vec3(c,d,f).vsub(b.constrainedBody.position),j=b.constrainedBody.quaternion.inverse(),k=j.vmult(i);b.jointBody.position.set(c,d,f),b.mouseConstraint=new CANNON.PointToPointConstraint(b.constrainedBody,k,b.jointBody,new CANNON.Vec3(0,0,0)),m.world.addConstraint(b.mouseConstraint);var l=new e(c,d,f);n.constant=l.dot(h),n.normal.set(h)}function i(a,b,c){b.jointBody.position.set(c.x,c.y,c.z),b.mouseConstraint.update()}function j(a,b){m.world.removeConstraint(b.mouseConstraint),b.mouseConstraint=!1}var k,l,m,n=new g;return{setup:b,update:c,cleanup:d}}var e=c(8),f=c(123),g=c(121);d.externals={key:"CannonPickScript",name:"Cannon.js Body Pick",description:"Enables the user to physically pick a Cannon.js physics body and drag it around.",parameters:[{key:"whenUsed",type:"boolean","default":!0},{key:"pickButton",name:"Pan button",description:"Pick with this button",type:"string",control:"select","default":"Any",options:["Any","Left","Middle","Right"]},{key:"useForceNormal",name:"Use force normal",type:"boolean","default":!1},{key:"forceNormal",name:"Force normal","default":[0,0,1],type:"vec3"}]},a.exports=d},481:function(a,b,c){function d(){function a(a,b){h.setup(a,b),d.setup(a,b)}function b(a,b){h.update(a,b),d.update(a,b)}function c(a,b){h.cleanup(a,b),d.cleanup(a,b)}var d=e.create(f),h=e.create(g);return{setup:a,cleanup:c,update:b}}var e=c(4),f=c(482),g=c(483),h=f.externals.parameters,i=g.externals.parameters,j=h.concat(i.slice(1));d.externals={key:"FlyControlScript",name:"Fly Control",description:"This is a combo of the Wasd script and the MouseLook script",parameters:j},a.exports=d},482:function(a,b,c){function d(){function a(){s.x=o.strafeLeft-o.strafeRight,s.z=o.forward-o.back}function b(b){if(!b.altKey)switch(f.keyForCode(b.keyCode)){case n.crawlKey:o.crawling=!0;break;case n.forwardKey:o.forward=1,a();break;case n.backKey:o.back=1,a();break;case n.strafeLeftKey:o.strafeLeft=1,a();break;case n.strafeRightKey:o.strafeRight=1,a()}}function c(b){if(!b.altKey)switch(f.keyForCode(b.keyCode)){case n.crawlKey:o.crawling=!1;break;case n.forwardKey:o.forward=0,a();break;case n.backKey:o.back=0,a();break;case n.strafeLeftKey:o.strafeLeft=0,a();break;case n.strafeRightKey:o.strafeRight=0,a()}}function d(a){a.setAttribute("tabindex",-1),a.addEventListener("keydown",b,!1),a.addEventListener("keyup",c,!1)}function g(a,b){n=a,b.moveState=o={strafeLeft:0,strafeRight:0,forward:0,back:0,crawling:!1},k=b.entity,l=k.transformComponent,m=l.transform,u.copy(m.translation),d(b.domElement)}function h(a,b){if((p||!s.equals(e.ZERO))&&(p||!a.whenUsed||b.entity===b.activeCameraEntity)){p=!1,t.setDirect(q.x*s.z+r.x*s.x,q.y*s.z+r.y*s.x,q.z*s.z+r.z*s.x),t.normalize();var c=b.world.tpf*(o.crawling?a.crawlSpeed:a.walkSpeed);t.scale(c);var d=m.rotation;t.applyPost(d),u.add(t),m.translation.copy(u),l.setUpdated()}}function i(a,d){d.domElement.removeEventListener("keydown",b,!1),d.domElement.removeEventListener("keyup",c,!1)}function j(){p=!0}var k,l,m,n,o,p=!1,q=new e(0,0,-1),r=new e(-1,0,0),s=new e,t=new e,u=new e;return{setup:g,update:h,cleanup:i,argsUpdated:j}}var e=c(8),f=c(5);d.externals={key:"WASD",name:"WASD Control",description:"Enables moving via the WASD keys",parameters:[{key:"whenUsed",type:"boolean",name:"When Camera Used",description:"Script only runs when the camera to which it is added is being used.","default":!0},{key:"crawlKey",type:"string",control:"key","default":"Shift"},{key:"forwardKey",type:"string",control:"key","default":"W"},{key:"backKey",type:"string",control:"key","default":"S"},{key:"strafeLeftKey",type:"string",control:"key","default":"A"},{key:"strafeRightKey",type:"string",control:"key","default":"D"},{key:"walkSpeed",type:"int",control:"slider","default":10,min:1,max:100,exponential:!0},{key:"crawlSpeed",control:"slider",type:"int","default":1,min:.1,max:10,exponential:!0}]},a.exports=d},483:function(a,b,c){function d(){function a(a){r.whenUsed&&q.entity!==q.activeCameraEntity||(-1===p||a.button===p||3===p&&!v)&&(t=!0,w=y=a.clientX,x=z=a.clientY)}function b(){u||g.requestPointerLock()}function c(a){u||r.whenUsed&&q.entity!==q.activeCameraEntity||(u&&void 0!==a.movementX?(y+=a.movementX,z+=a.movementY):t&&(y=a.clientX,z=a.clientY))}function d(a){r.whenUsed&&q.entity!==q.activeCameraEntity||u&&void 0!==a.movementX&&(y+=a.movementX,z+=a.movementY)}function i(){t=!1}function j(){u&&(t=!1)}function k(){u=!!document.pointerLockElement,document.pointerLockElement?(q.domElement.removeEventListener("mousedown",b),v=!0):q.domElement.addEventListener("mousedown",b)}function l(f,l){q=l,r=f,p=h.indexOf(f.button)-1,-1>p&&(p=-1);var m=l.domElement;3===p&&(document.addEventListener("pointerlockchange",k),g.requestPointerLock(),document.addEventListener("mousemove",d),document.addEventListener("mousemove",j),m.addEventListener("mousedown",b)),m.addEventListener("mousemove",c),m.addEventListener("mousedown",a),m.addEventListener("mouseup",i),o=new e;var n=l.entity.transformComponent.transform.rotation;n.toAngles(o),s=o.y}function m(a,b){if(y!==w||z!==x){var c=y-w,d=z-x,e=b.entity,g=e.transformComponent.transform.rotation;g.toAngles(o);var h=o.x,i=o.y,j=a.maxAscent*f.DEG_TO_RAD,k=a.minAscent*f.DEG_TO_RAD;h=f.clamp(h-d*a.speed/200,k,j);var l=a.maxAzimuth*f.DEG_TO_RAD-s,m=a.minAzimuth*f.DEG_TO_RAD-s;i-=c*a.speed/200,a.clampAzimuth&&(i=f.radialClamp(i,m,l)),g.fromAngles(h,i,0),e.transformComponent.setUpdated(),w=y,x=z}}function n(e,f){var h=f.domElement;3===p&&(g.exitPointerLock(),document.removeEventListener("mousemove",d),document.removeEventListener("pointerlockchange",k),h.removeEventListener("mousedown",b)),h.removeEventListener("mousemove",c),h.removeEventListener("mousedown",a),h.removeEventListener("mouseup",i)}var o,p,q,r,s,t=!1,u=!1,v=!1,w=0,x=0,y=0,z=0;return{setup:l,update:m,cleanup:n}}var e=c(8),f=c(9),g=c(221),h=["Any","Left","Middle","Right","None"];d.externals={key:"MouseLookScript",name:"Mouse Look Control",description:"Click and drag to change rotation of entity, usually a camera",parameters:[{key:"whenUsed",type:"boolean",name:"When Camera Used",description:"Script only runs when the camera to which it is added is being used.","default":!0},{key:"button",name:"Mouse button",type:"string",control:"select","default":"Left",options:h},{key:"speed",name:"Turn Speed",type:"float",control:"slider","default":1,min:-10,max:10,scale:.1},{key:"maxAscent",name:"Max Ascent",type:"float",control:"slider","default":89.95,min:-89.95,max:89.95},{key:"minAscent",name:"Min Ascent",type:"float",control:"slider","default":-89.95,min:-89.95,max:89.95},{key:"clampAzimuth","default":!1,type:"boolean"},{key:"minAzimuth",description:"Maximum arc the camera can reach clockwise of the target point","default":-90,type:"int",control:"slider",min:-180,max:0},{key:"maxAzimuth",description:"Maximum arc the camera can reach counter-clockwise of the target point","default":90,type:"int",control:"slider",min:0,max:180}]},a.exports=d},484:function(a,b,c){function d(a){a=a||{};for(var b in g)"boolean"==typeof g[b]?this[b]=void 0!==a[b]?a[b]===!0:g[b]:isNaN(g[b])?g[b]instanceof e?this[b]=a[b]?new e(a[b]):(new e).set(g[b]):this[b]=a[b]||g[b]:this[b]=isNaN(a[b])?g[b]:a[b];this.groundContact=1,this.targetVelocity=new e,this.targetHeading=new e,this.acceleration=new e,this.torque=new e,this.groundHeight=0,this.groundNormal=new e,this.controlState={run:0,strafe:0,jump:0,yaw:0,roll:0,pitch:0}}var e=c(8),f=new e,g={gravity:-9.81,worldFloor:-(1/0),jumpImpulse:95,accLerp:.1,rotLerp:.1,modForward:1,modStrafe:.7,modBack:.4,modTurn:.3};d.prototype.setTerrainSystem=function(a){this.terrainScript=a},d.prototype.getTerrainSystem=function(){return this.terrainScript},d.prototype.getTerrainHeight=function(a){var b=this.getTerrainSystem().getTerrainHeightAt(a);return null===b&&(b=this.worldFloor),b},d.prototype.getTerrainNormal=function(a){return this.getTerrainSystem().getTerrainNormalAt(a)},d.prototype.applyForward=function(a){this.controlState.run=a},d.prototype.applyStrafe=function(a){this.controlState.strafe=a},d.prototype.applyJump=function(a){this.controlState.jump=a},d.prototype.applyTurn=function(a){this.controlState.yaw=a},d.prototype.applyJumpImpulse=function(a){return this.groundContact&&(this.controlState.jump?(a=this.jumpImpulse,this.controlState.jump=0):a=0),a},d.prototype.applyDirectionalModulation=function(a,b,c){a*=this.modStrafe,c*=c>0?this.modForward:this.modBack,this.targetVelocity.setDirect(a,this.applyJumpImpulse(b),c)},d.prototype.applyTorqueModulation=function(a,b,c){this.targetHeading.setDirect(a,b*this.modTurn,c)},d.prototype.applyGroundNormalInfluence=function(){var a=Math.abs(Math.cos(this.groundNormal.x)),b=Math.abs(Math.cos(this.groundNormal.z));this.targetVelocity.x*=a,this.targetVelocity.z*=b},d.prototype.updateTargetVectors=function(a){this.applyDirectionalModulation(this.controlState.strafe,this.gravity,this.controlState.run),this.targetVelocity.applyPost(a.rotation),this.applyGroundNormalInfluence(),this.applyTorqueModulation(this.controlState.pitch,this.controlState.yaw,this.controlState.roll)},d.prototype.computeAcceleration=function(a,b,c){return f.set(c),f.applyPost(a.transformComponent.transform.rotation),f.sub(b),f.lerp(c,this.accLerp),f.y=c.y,f},d.prototype.computeTorque=function(a,b){return f.set(b),f.sub(a),f.lerp(b,this.rotLerp),f},d.prototype.updateVelocities=function(a){var b=a.movementComponent.getVelocity(),c=a.movementComponent.getRotationVelocity();this.acceleration.set(this.computeAcceleration(a,b,this.targetVelocity)),this.torque.set(this.computeTorque(c,this.targetHeading))},d.prototype.applyAccelerations=function(a){a.movementComponent.addVelocity(this.acceleration),a.movementComponent.addRotationVelocity(this.torque)},d.prototype.updateGroundNormal=function(a){this.groundNormal.set(this.getTerrainNormal(a.translation))},d.prototype.checkGroundContact=function(a,b){this.groundHeight=this.getTerrainHeight(b.translation),b.translation.y<=this.groundHeight?(this.groundContact=1,this.updateGroundNormal(b)):this.groundContact=0},d.prototype.applyGroundContact=function(a,b){this.groundHeight>=b.translation.y&&(b.translation.y=this.groundHeight,a.movementComponent.velocity.y<0&&(a.movementComponent.velocity.y=0))},d.prototype.run=function(a){var b=a.transformComponent.transform;this.checkGroundContact(a,b),this.updateTargetVectors(b),this.updateVelocities(a),this.applyAccelerations(a),this.applyGroundContact(a,b)},a.exports=d},485:function(a,b,c){function d(a){this.matrixData=a,this.width=a.length-1}var e=c(9);d.prototype.getMatrixData=function(){return this.matrixData},d.prototype.getPointInMatrix=function(a,b){return this.matrixData[a][b]},d.prototype.getAt=function(a,b){return 0>a||a>this.width||0>b||b>this.width?0:this.getPointInMatrix(a,b)},d.prototype.getInterpolated=function(a,b){var c=this.getAt(Math.ceil(a),Math.ceil(b)),d=this.getAt(Math.ceil(a),Math.floor(b)),e=this.getAt(Math.floor(a),Math.ceil(b)),f=this.getAt(Math.floor(a),Math.floor(b)),g=a-Math.floor(a),h=b-Math.floor(b),i=c*g+e*(1-g),j=d*g+f*(1-g),k=i*h+j*(1-h);return k},d.prototype.getTriangleAt=function(a,b){var c,d=Math.ceil(a),e=Math.floor(a),f=Math.ceil(b),g=Math.floor(b),h=a-e,i=b-g,j={x:e,y:f,z:this.getAt(e,f)},k={x:d,y:g,z:this.getAt(d,g)};return c=1-i>h?{x:e,y:g,z:this.getAt(e,g)}:{x:d,y:f,z:this.getAt(d,f)},[j,k,c]},d.prototype.getPreciseHeight=function(a,b){var c=this.getTriangleAt(a,b),d=e.barycentricInterpolation(c[0],c[1],c[2],{x:a,y:b,z:0});return d.z},d.prototype.run=function(a){var b=a.transformComponent.transform.translation;b.y=this.getInterpolated(b.z,b.x)},a.exports=d},486:function(a,b,c){function d(){function a(a){t.size=a,t.splash=h.createSplashTexture(512,{trailStartRadius:25,trailEndRadius:0}),t.ring=h.createFlareTexture(a,{steps:u.ring,startRadius:a/4,endRadius:a/2}),t.dot=h.createFlareTexture(a,{steps:u.dot,startRadius:0,endRadius:a/2}),t.bell=h.createFlareTexture(a,{steps:u.bell,startRadius:0,endRadius:a/2}),t["default"]=h.createFlareTexture(a,{steps:u.none,startRadius:0,endRadius:a/2})}function b(a,b,c,d,e){for(var g=0;g<a.length;g++){var h=a[g];r.push(new f(b,h.tx,h.displace,h.size,h.intensity*p,c,d,e,t,k))}return r}function c(a){for(var b=0;b<a.length;b++)a[b].quad.removeFromWorld()}function d(b,c){p=b.intensity,q=new e(100*b.edgeRelevance);var d=s;b.highRes&&(d*=4),t.size!==d&&a(d),r=[],j=c.entity,k=c.world,m=!1,o=[b.color[0],b.color[1],b.color[2],1],n=[{size:2.53,tx:"bell",intensity:.7,displace:1},{size:.53,tx:"dot",intensity:.7,displace:1},{size:.83,tx:"bell",intensity:.2,displace:.8},{size:.4,tx:"ring",intensity:.1,displace:.6},{size:.3,tx:"bell",intensity:.1,displace:.4},{size:.6,tx:"bell",intensity:.1,displace:.3},{size:.3,tx:"dot",intensity:.1,displace:.15},{size:.22,tx:"ring",intensity:.03,displace:-.25},{size:.36,tx:"dot",intensity:.05,displace:-.5},{size:.8,tx:"ring",intensity:.1,displace:-.8},{size:.86,tx:"bell",intensity:.2,displace:-1.1},{size:1.3,tx:"ring",intensity:.05,displace:-1.5}],c.bounds=new l(c.entity.transformComponent.sync().worldTransform.translation,0)}function g(){c(r),r=[]}function i(a,d){if(d.bounds.center.copy(d.entity.transformComponent.sync().worldTransform.translation),d.activeCameraEntity.cameraComponent.camera.contains(d.bounds)){q.updateFrameGeometry(j,d.activeCameraEntity),m||(r=b(n,o,a.scale,a.edgeDampen,a.edgeScaling),m=!0);for(var e=0;e<r.length;e++)r[e].updatePosition(q)}else m&&(c(r),m=!1)}var j,k,m,n,o,p,q,r=[],s=64,t={},u={splash:{trailStartRadius:25,trailEndRadius:0},ring:[{fraction:0,value:0},{fraction:.7,value:0},{fraction:.92,value:1},{fraction:.98,value:0}],dot:[{fraction:0,value:1},{fraction:.3,value:.75},{fraction:.5,value:.45},{fraction:.65,value:.21},{fraction:.75,value:.1},{fraction:.98,value:0}],bell:[{fraction:0,value:1},{fraction:.15,value:.75},{fraction:.3,value:.5},{fraction:.4,value:.25},{fraction:.75,value:.05},{fraction:.98,value:0}],none:[{fraction:0,value:1},{fraction:1,value:0}]};return{setup:d,lateUpdate:i,cleanup:g}}function e(a){this.camRot=null,this.distance=0,this.offset=0,this.centerRatio=0,this.positionVector=new g,this.distanceVector=new g,this.centerVector=new g,this.displacementVector=new g,this.edgeRelevance=a}function f(a,b,c,d,e,f,h,l,m,n){this.sizeVector=new g(d,d,d),this.sizeVector.scale(f),this.positionVector=new g,this.flareVector=new g,this.intensity=e,this.displace=c,this.color=[a[0]*e,a[1]*e,a[2]*e,1],this.edgeDampen=h,this.edgeScaling=l;var o=new i(j.uber,"flareShader");o.uniforms.materialEmissive=this.color,o.uniforms.materialDiffuse=[0,0,0,1],o.uniforms.materialAmbient=[0,0,0,1],o.uniforms.materialSpecular=[0,0,0,1];var p=m[b];o.setTexture("DIFFUSE_MAP",p),o.setTexture("EMISSIVE_MAP",p),o.blendState.blending="AdditiveBlending",o.blendState.blendEquation="AddEquation",o.blendState.blendSrc="OneFactor",o.blendState.blendDst="OneFactor",o.depthState.enabled=!1,o.depthState.write=!1,o.cullState.enabled=!1;var q=new k(1,1),r=n.createEntity(q,o);r.meshRendererComponent.cullMode="Never",r.addToWorld(),this.material=o,this.quad=r}var g=c(8),h=c(210),i=c(30),j=c(46),k=c(28),l=c(13);d.externals={key:"LensFlareScript",name:"Lens Flare Script",description:"Makes an entity shine with some lensflare effect.",parameters:[{key:"scale",name:"Scale",type:"float",description:"Scale of flare quads",control:"slider","default":1,min:.01,max:2},{key:"intensity",name:"Intensity",type:"float",description:"Intensity of Effect",control:"slider","default":1,min:.01,max:2},{key:"edgeRelevance",name:"Edge Relevance",type:"float",description:"How much the effect cares about being centered or not",control:"slider","default":0,min:0,max:2},{key:"edgeDampen",name:"Edge Dampening",type:"float",description:"Intensity adjustment by distance from center",control:"slider","default":.2,min:0,max:1},{key:"edgeScaling",name:"Edge Scaling",type:"float",description:"Scale adjustment by distance from center",control:"slider","default":0,min:-2,max:2},{key:"color",name:"Color",type:"vec3",description:"Effect Color",control:"color","default":[.8,.75,.7]},{key:"highRes",name:"High Resolution",type:"boolean",description:"Intensity of Effect",control:"checkbox","default":!1}]},e.prototype.updateFrameGeometry=function(a,b){this.camRot=b.transformComponent.sync().transform.rotation,this.centerVector.set(b.transformComponent.sync().worldTransform.translation),this.displacementVector.set(a.transformComponent.sync().worldTransform.translation),this.displacementVector.sub(this.centerVector),this.distance=this.displacementVector.length(),this.distanceVector.setDirect(0,0,-this.distance),this.distanceVector.applyPost(this.camRot),this.centerVector.add(this.distanceVector),this.positionVector.set(this.centerVector),this.displacementVector.set(a.transformComponent.sync().worldTransform.translation),this.displacementVector.sub(this.positionVector),this.offset=this.displacementVector.length();var c=this.positionVector.length();c?this.centerRatio=1-this.offset*this.edgeRelevance/this.positionVector.length():this.centerRatio=1-this.offset*this.edgeRelevance,this.centerRatio=Math.max(0,this.centerRatio)},f.prototype.updatePosition=function(a){this.flareVector.set(a.displacementVector),this.positionVector.set(a.positionVector),this.flareVector.scale(this.displace),this.positionVector.add(this.flareVector),this.material.uniforms.materialEmissive=[this.color[0]*a.centerRatio*this.edgeDampen,this.color[1]*a.centerRatio*this.edgeDampen,this.color[2]*a.centerRatio*this.edgeDampen,1];var b=a.distance+a.distance*a.centerRatio*this.edgeScaling,c=this.quad.transformComponent.transform;c.scale.set(this.sizeVector),c.scale.scale(b),c.rotation.set(a.camRot),c.translation.set(this.positionVector),this.quad.transformComponent.setUpdated()},a.exports=d},487:function(a,b,c){function d(){function a(a,b,c){a.touchMode="Double",h.setup(a,b,c),i.setup(a,b,c)}function b(a,b,c){i.update(a,b,c),h.update(a,b,c)}function c(a,b,c){i.cleanup(a,b,c),h.cleanup(a,b,c)}function d(a,b,c){i.argsUpdated(a,b,c),h.argsUpdated(a,b,c)}var h=e.create(f),i=e.create(g);return{setup:a,cleanup:c,update:b,argsUpdated:d}}for(var e=c(4),f=c(365),g=c(488),h=c(6),i=f.externals.parameters,j=g.externals.parameters,k=h.deepClone(i.concat(j.slice(1))),l=k.length-1;l>=0;l--){var m=k[l];("panSpeed"===m.key||"touchMode"===m.key)&&k.splice(l,1)}for(var l=0;l<k.length;l++){var m=k[l];switch(m.key){case"dragButton":m["default"]="Left";break;case"panButton":m["default"]="Right";break;case"panSpeed":m["default"]=1;break;case"touchMode":m["default"]="Double"}}d.externals={key:"OrbitNPanControlScript",name:"Orbit and Pan Control",description:"This is a combo of orbitcamcontrolscript and pancamcontrolscript",parameters:k},a.exports=d},488:function(a,b,c){function d(){function a(a){var b=0,c=0,d=a[0].clientX,e=a[0].clientY;if(a.length>=2){var f=a[1].clientX,g=a[1].clientY;b=(d+f)/2,c=(e+g)/2}else b=d,c=e;return[b,c]}function b(b,c){i(b,c),n=c.goingToLookAt,j=e.UNIT_Y.clone(),k=e.UNIT_X.clone().negate(),l=new e,m=new e,c.translation=c.entity.transformComponent.transform.translation.clone();
var d=c.world.gooRunner.renderer;c.devicePixelRatio=d._useDevicePixelRatio&&window.devicePixelRatio?window.devicePixelRatio/d.svg.currentScale:1,o={x:0,y:0,ox:0,oy:0,dx:0,dy:0,down:!1},p={mousedown:function(a){if(!b.whenUsed||c.entity===c.activeCameraEntity){var d=a.button;if(0===d&&(a.altKey?d=2:a.shiftKey&&(d=1)),d===c.panButton||-1===c.panButton){o.down=!0;var e=void 0!==a.offsetX?a.offsetX:a.layerX,f=void 0!==a.offsetY?a.offsetY:a.layerY;o.ox=o.x=e,o.oy=o.y=f}}},mouseup:function(a){var b=a.button;0===b&&(a.altKey?b=2:a.shiftKey&&(b=1)),o.down=!1,o.dx=o.dy=0},mousemove:function(a){if((!b.whenUsed||c.entity===c.activeCameraEntity)&&o.down){var d=void 0!==a.offsetX?a.offsetX:a.layerX,e=void 0!==a.offsetY?a.offsetY:a.layerY;o.x=d,o.y=e,c.dirty=!0}},mouseleave:function(){o.down=!1,o.ox=o.x,o.oy=o.y},touchstart:function(d){if(!b.whenUsed||c.entity===c.activeCameraEntity){if(o.down="Any"===b.touchMode||"Single"===b.touchMode&&1===d.targetTouches.length||"Double"===b.touchMode&&2===d.targetTouches.length,!o.down)return;var e=a(d.targetTouches);o.ox=o.x=e[0],o.oy=o.y=e[1]}},touchmove:function(d){if(!b.whenUsed||c.entity===c.activeCameraEntity){if(!o.down)return;var e=a(d.targetTouches);o.x=e[0],o.y=e[1],c.dirty=!0}},touchend:function(){o.down=!1,o.ox=o.x,o.oy=o.y}};for(var f in p)c.domElement.addEventListener(f,p[f]);c.dirty=!0}function c(a,b){if(b.dirty){if(o.dx=o.x-o.ox,o.dy=o.y-o.oy,0===o.dx&&0===o.dy&&!q)return void(b.dirty=!!b.lookAtPoint);q=!1,a.invertX&&(o.dx=-o.dx),a.invertY&&(o.dy=-o.dy),o.ox=o.x,o.oy=o.y;var c=f.mainCamera,d=b.entity,e=d.transformComponent.transform,i=d.cameraComponent.camera;if(n&&c){if(n.equals(c.translation))return;var p=b.viewportWidth/b.devicePixelRatio,r=b.viewportHeight/b.devicePixelRatio;c.getScreenCoordinates(n,p,r,l),l.subDirect(o.dx,o.dy,0),c.getWorldCoordinates(l.x,l.y,p,r,l.z,l),n.set(l)}else{if(l.set(j).scale(o.dy),m.set(k).scale(o.dx),d.cameraComponent&&d.cameraComponent.camera){var i=d.cameraComponent.camera;l.scale((i._frustumTop-i._frustumBottom)/b.viewportHeight),m.scale((i._frustumRight-i._frustumLeft)/b.viewportWidth)}l.add(m),l.applyPost(e.rotation),i.projectionMode===h.Perspective?l.scale(20*a.panSpeed):l.scale(a.panSpeed),b.translation.add(l),d.transformComponent.setTranslation(b.translation),b.dirty=!1}g.emit("goo.cameraPositionChanged",{translation:e.translation.toArray(),lookAtPoint:n?n.toArray():null,id:d.id})}}function d(a,b){for(var c in p)b.domElement.removeEventListener(c,p[c])}function i(a,b){b.panButton=["Any","Left","Middle","Right"].indexOf(a.panButton)-1,b.panButton<-1&&(b.panButton=-1),b.dirty=!0,q=!0}var j,k,l,m,n,o,p,q=!1;return{setup:b,update:c,cleanup:d,argsUpdated:i}}var e=c(8),f=c(123),g=c(44),h=c(120);d.externals={key:"PanCamControlScript",name:"PanCamera Control",description:"Enables camera to pan around a point in 3D space using the mouse",parameters:[{key:"whenUsed",type:"boolean",name:"When Camera Used",description:"Script only runs when the camera to which it is added is being used.","default":!0},{key:"panButton",name:"Pan button",description:"Only pan with this button",type:"string",control:"select","default":"Any",options:["Any","Left","Middle","Right"]},{key:"touchMode",description:"Number of fingers needed to trigger panning.",type:"string",control:"select","default":"Double",options:["Any","Single","Double"]},{key:"panSpeed",type:"float","default":1,scale:.01}]},a.exports=d},489:function(a,b){function c(){function a(a){var b=a.button;return 0===b&&(a.altKey?b=2:a.shiftKey&&(b=1)),b}function b(b){if(!m.disable){var d=a(b.domEvent);d!==n.dragButton&&-1!==n.dragButton||!b.entity||(l=!1,b.entity.traverseUp(function(a){return a===n.entity?(l=!0,!1):void 0}),l&&c(b))}}function c(a){o.x=a.x,o.y=a.y,o.oldX=o.x,o.oldY=o.y,o.down=!0}function d(a){if(o.oldX=o.x,o.oldY=o.y,o.x=a.clientX||a.touches[0].clientX,o.y=a.clientY||a.touches[0].clientY,l&&o.down){var b=o.x-o.oldX,c=o.y-o.oldY;o.ax+=b,o.ay+=c,e()}}function e(){n.entity.transformComponent.transform.rotation.setIdentity(),n.entity.transformComponent.transform.rotation.rotateX(o.ay/300*m.yMultiplier),n.entity.transformComponent.transform.rotation.rotateY(o.ax/200*m.xMultiplier),n.entity.transformComponent.setUpdated()}function f(){o.down=!1}function g(a,b){m=a,n=b,n.dragButton=["Any","Left","Middle","Right"].indexOf(m.dragButton)-1,n.dragButton<-1&&(n.dragButton=-1),e()}function h(a,c){k=c.world.gooRunner,k.addEventListener("mousedown",b),k.addEventListener("touchstart",b),k.renderer.domElement.addEventListener("mousemove",d),k.renderer.domElement.addEventListener("touchmove",d),k.renderer.domElement.addEventListener("mouseup",f),k.renderer.domElement.addEventListener("touchend",f),o={down:!1,x:0,y:0,oldX:0,oldY:0,ax:0,ay:0},g(a,c)}function i(){}function j(a,c){c.domElement.removeEventListener("mousemove",d),c.domElement.removeEventListener("touchmove",d),c.domElement.removeEventListener("mouseup",f),c.domElement.removeEventListener("touchend",f),k.removeEventListener("mousedown",b),k.removeEventListener("touchstart",b)}var k,l,m,n,o;return{setup:h,update:i,cleanup:j,argsUpdated:g}}c.externals={key:"PickAndRotateScript",name:"Pick and Rotate",description:"Enables pick-drag-rotating entities",parameters:[{key:"disable",description:"Prevent rotation. For preventing this script programmatically.",type:"boolean","default":!1},{key:"dragButton",description:"Button to enable dragging","default":"Any",options:["Any","Left","Middle","Right"],type:"string",control:"select"},{key:"xMultiplier",description:"Horizontal rotation multiplier","default":1,type:"float",control:"slider",min:-4,max:4},{key:"yMultiplier",description:"Vertical rotation multiplier","default":1,type:"float",control:"slider",min:-4,max:4}]},a.exports=c},490:function(a,b){function c(a){this.collidables=a||[]}c.prototype.addCollidable=function(a){this.collidables.push(a)},c.prototype.removeAllAt=function(a,b,c){this.collidables=this.collidables.filter(function(d){return d.bottom<=c&&d.top>=c?!window.PolyK.ContainsPoint(d.poly,a,b):void 0})},c.prototype.inside=function(a,b,c){for(var d=0;d<this.collidables.length;d++){var e=this.collidables[d];if(e.bottom<=b&&e.top>=b&&window.PolyK.ContainsPoint(e.poly,a,c))return window.PolyK.ClosestEdge(e.poly,a,c)}},c.prototype.run=function(a){for(var b=a.transformComponent,c=b.transform.translation,d=0;d<this.collidables.length;d++){var e=this.collidables[d];if(e.bottom<=c.y&&e.top>=c.y&&window.PolyK.ContainsPoint(e.poly,c.x,c.z)){var f=window.PolyK.ClosestEdge(e.poly,c.x,c.z);return c.x=f.point.x,c.z=f.point.y,void b.setUpdated()}}},a.exports=c},491:function(a,b){function c(){function a(a,b){e={x:0,y:0},f={x:0,y:0},g=b.entity,document.addEventListener("mousemove",c)}function b(a){f.x+=(e.x-f.x)*a.fraction,f.y+=(e.y-f.y)*a.fraction,g.setRotation(f.y/200,f.x/200,0)}function c(a){e.x=a.x,e.y=a.y}function d(){document.removeEventListener("mousemove",c)}var e,f,g;return{setup:a,update:b,cleanup:d}}c.externals={key:"RotationScript",name:"Mouse Rotation",description:"",parameters:[{key:"fraction",name:"Speed","default":.01,type:"float",control:"slider",min:.01,max:1}]},a.exports=c},492:function(a,b,c){function d(){e.apply(this,arguments),this._type="ScriptComponent"}var e=c(88),f=c(353),g=c(55),h=c(6),i=c(54),j=c(44),k=c(4),l=c(5);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,e._registerClass("script",d),d.ENGINE_SCRIPT_PREFIX="GOO_ENGINE_SCRIPTS/",d.prototype._prepare=function(){},d.prototype._create=function(){return new f},d.prototype.update=function(a,b,c){var d=this;return e.prototype.update.call(this,a,b,c).then(function(a){return a?g.all(h.map(b.scripts,function(b){return d._updateScriptInstance(a,b,c)},null,"sortValue")).then(function(b){return a.scripts=b,a}):void 0})},d.prototype._updateScriptInstance=function(a,b,c){var d=this;return this._createOrLoadScript(a,b).then(function(a){var e=b.options||{};a.parameters&&h.defaults(e,a.parameters),a.externals&&a.externals.parameters&&l.fillDefaultValues(e,a.externals.parameters);var f=null;if(a.context)if(f=a,f.parameters)for(var g=Object.keys(f.parameters),i=0;i<g.length;i++)delete f.parameters[g[i]];else f.parameters={};else f=Object.create(a),f.instanceId=b.id,f.parameters={},f.enabled=!1;return d._setParameters(f.parameters,e,a.externals,c).then(function(){f.argsUpdated&&f.context&&f.argsUpdated(f.parameters,f.context,window.goo)}).then(h.constant(f))})},d.prototype._createOrLoadScript=function(a,b){var c=b.scriptRef,e=0===c.indexOf(d.ENGINE_SCRIPT_PREFIX);return e?this._createOrLoadEngineScript(a,b):this._createOrLoadCustomScript(a,b)},d.prototype._createOrLoadEngineScript=function(a,b){var c=this._findScriptInstance(a,b.id),e=d.ENGINE_SCRIPT_PREFIX;return c?i.resolve(c):this._createEngineScript(b.scriptRef.slice(e.length))},d.prototype._createOrLoadCustomScript=function(a,b){var c=this,d=b.scriptRef;return this._load(d).then(function(e){var f=c._findScriptInstance(a,b.id);return f&&f.body===e.body?f:c._load(d,{reload:!0})})},d.prototype._findScriptInstance=function(a,b){return h.find(a.scripts,function(a){return a.instanceId===b})},d.prototype._createEngineScript=function(a){var b=k.create(a);if(!b)throw new Error("Unrecognized script name");return b.id=d.ENGINE_SCRIPT_PREFIX+a,b.enabled=!1,j.emit("goo.scriptExternals",{id:b.id,externals:b.externals}),i.resolve(b)},d.prototype._setParameters=function(a,b,c,d){var e=this;if(!c||!c.parameters)return i.resolve();var f=c.parameters.map(function(c){return e._setParameter(a,b[c.key],c,d)});return a.enabled=b.enabled!==!1,g.all(f)},d.prototype._setParameter=function(a,b,c,d){function e(b){return a[k]=b,i.resolve()}function f(){return void 0===c["default"]?h.deepClone(l.DEFAULTS_BY_TYPE[m]):h.deepClone(c["default"])}function g(){if(!b||b.enabled===!1)return e(null);var a=b[m+"Ref"]||b;return j._load(a,d).then(e)}var j=this,k=c.key,m=c.type;return l.TYPE_VALIDATORS[m](b)?"entity"===m?(g(),i.resolve()):l.isRefType(m)?g():e(h.clone(b)):e(f())},a.exports=d},493:function(a,b,c){function d(){o.apply(this,arguments),this._scriptElementsByURL=new Map,this._bodyCache={},this._dependencyPromises={},this._currentScriptLoading=null,this._addGlobalErrorListener()}function e(a,b){if(!a.scriptRefs)return void(a.scriptRefs=[b]);var c=a.scriptRefs.indexOf(b);-1===c&&a.scriptRefs.push(b)}function f(a,b){a.scriptRefs&&s.remove(a.scriptRefs,b)}function g(a){return a.scriptRefs&&a.scriptRefs.length>0}function h(a,b){return a.scriptRefs&&a.scriptRefs.indexOf(b)>-1}function i(a){for(var b=[],c=document.querySelectorAll("script"),d=0;d<c.length;++d){var e=c[d];h(e,a)&&b.push(e)}return b}function j(a){return Boolean(a.className)}function k(a){return!j(a)&&void 0!==a.body}function l(){for(var a=document.querySelectorAll("script"),b=0;b<a.length;++b){var c=a[b];c.isDependency&&!g(c)&&c.parentNode&&c.parentNode.removeChild(c)}}function m(a,b,c){return q.createPromise(function(d){function e(e){var f={message:e,file:c};n(a,f),b.parentNode&&b.parentNode.removeChild(b),d()}var f,g=!1;b.onload=function(){d(),f&&clearTimeout(f)},b.onerror=function(a){g=!0,f&&clearTimeout(f),console.error(a),e("Could not load dependency "+c)},g||(g=!0,f=setTimeout(function(){e("Loading dependency "+c+" failed (time out)")},w))})}function n(a,b){if(b.file){var c=b.message;b.line&&(c+=" - on line "+b.line),a.dependencyErrors=a.dependencyErrors||{},a.dependencyErrors[b.file]=b}else{a.errors=a.errors||[];var c=b.message;b.line&&(c+=" - on line "+b.line),a.errors.push(b),a.setup=null,a.update=null,a.fixedUpdate=null,a.lateUpdate=null,a.run=null,a.cleanup=null,a.argsUpdated=null,a.enter=null,a.exit=null,a.parameters={},a.enabled=!1}}var o=c(85),p=c(55),q=c(54),r=c(6),s=c(86),t=c(44),u=c(5),v=c(4),w=6e3;d.prototype=Object.create(o.prototype),d.prototype.constructor=d,o._registerClass("script",d),d.prototype._create=function(){return{externals:{},setup:null,fixedUpdate:null,lateUpdate:null,update:null,run:null,cleanup:null,parameters:{},argsUpdated:null,name:null}},d.prototype._remove=function(a){var b=this._objects.get(a);if(b&&b.cleanup&&b.context)try{b.cleanup(b.parameters,b.context,window.goo)}catch(c){}this._objects["delete"](a),delete this._bodyCache[a]};var x=1;d.prototype._updateFromCustom=function(a,b){if(this._bodyCache[b.id]===b.body)return a;delete a.errors,this._bodyCache[b.id]=b.body;var c=document.getElementById(d.DOM_ID_PREFIX+b.id);c&&c.parentNode.removeChild(c),window._gooScriptFactories||(window._gooScriptFactories={});var e=["//# sourceURL=goo://goo-custom-scripts/"+encodeURIComponent(b.name.replace(" ","_"))+".js?v="+x++,"","// "+b.name,"","// <![CDATA[","window._gooScriptFactories['"+b.id+"'] = function () {",b.body," var obj = {","  externals: {}"," };",' if (typeof parameters !== "undefined") {',"  obj.externals.parameters = parameters;"," }",' if (typeof argsUpdated !== "undefined") {',"  obj.argsUpdated = argsUpdated;"," }",' if (typeof setup !== "undefined") {',"  obj.setup = setup;"," }",' if (typeof cleanup !== "undefined") {',"  obj.cleanup = cleanup;"," }",' if (typeof update !== "undefined") {',"  obj.update = update;"," }",' if (typeof fixedUpdate !== "undefined") {',"  obj.fixedUpdate = fixedUpdate;"," }",' if (typeof lateUpdate !== "undefined") {',"  obj.lateUpdate = lateUpdate;"," }",' if (typeof enter !== "undefined") {',"  obj.enter = enter;"," }",' if (typeof exit !== "undefined") {',"  obj.exit = exit;"," }"," return obj;","};","// ]]>"].join("\n"),f=document.createElement("script");f.id=d.DOM_ID_PREFIX+b.id,f.innerHTML=e,f.async=!1,this._currentScriptLoading=b.id;var g=this.world.gooRunner.renderer.domElement.parentElement||document.body;g.appendChild(f);var h=window._gooScriptFactories[b.id];if(h){try{var i=h();a.id=b.id,d.validateParameters(i,a),a.setup=i.setup,a.update=i.update,a.fixedUpdate=i.fixedUpdate,a.lateUpdate=i.lateUpdate,a.cleanup=i.cleanup,a.enter=i.enter,a.exit=i.exit,a.argsUpdated=i.argsUpdated,a.parameters={},a.enabled=!1,a.body=b.body}catch(j){var k={message:j.toString()};if(j instanceof Error){var l=j.stack.split("\n")[1].match(/(\d+):\d+\)$/);l&&(k.line=parseInt(l[1],10)-1)}n(a,k)}this._currentScriptLoading=null}return a.externals&&u.fillDefaultNames(a.externals.parameters),a},d.prototype._updateFromClass=function(a,b){if(!a.externals||a.externals.name!==b.className){var c=v.create(b.className);if(!c)throw new Error("Unrecognized script name");a.id=b.id,a.externals=c.externals,a.setup=c.setup,a.update=c.update,a.fixedUpdate=c.fixedUpdate,a.lateUpdate=c.lateUpdate,a.run=c.run,a.cleanup=c.cleanup,a.argsUpdated=c.argsUpdated,a.enter=c.enter,a.exit=c.exit,a.parameters=c.parameters||{},a.enabled=!1,u.fillDefaultNames(a.externals.parameters)}return a},d.prototype._addDependency=function(a,b,c){var d=this,f=document.querySelector('script[src="'+b+'"]');if(f)return e(f,c),this._dependencyPromises[b]||q.resolve();f=document.createElement("script"),f.src=b,f.setAttribute("data-script-id",c),f.isDependency=!0,f.async=!1,this._scriptElementsByURL.set(b,f),e(f,c);var g=m(a,f,b).then(function(){delete d._dependencyPromises[b]});return this._dependencyPromises[b]=g,g},d.prototype._update=function(a,b,c){var d=this;return o.prototype._update.call(this,a,b,c).then(function(e){if(e){var g=[];if(k(b)&&b.dependencies){delete e.dependencyErrors;var h=i(b.id);r.forEach(b.dependencies,function(a){var c=a.url,f=s.find(h,function(a){return a.src===c});f&&s.remove(h,f),g.push(d._addDependency(e,c,b.id))},null,"sortValue"),r.forEach(h,function(a){f(a,b.id)})}var m=d.world.gooRunner.renderer.domElement.parentElement||document.body;return r.forEach(b.dependencies,function(a){var b=d._scriptElementsByURL.get(a.url);b&&m.appendChild(b)},null,"sortValue"),p.all(g).then(function(){return j(b)?d._updateFromClass(e,b,c):k(b)&&d._updateFromCustom(e,b,c),b.body&&t.emit("goo.scriptExternals",{id:b.id,externals:e.externals}),e.name=b.name,e.errors||e.dependencyErrors?(t.emit("goo.scriptError",{id:a,errors:e.errors,dependencyErrors:e.dependencyErrors}),e):(t.emit("goo.scriptError",{id:a,errors:null}),r.extend(e.parameters,b.options),l(),e)})}})},d.prototype._addGlobalErrorListener=function(){var a=this;window.addEventListener("error",function(b){if(b.filename){var c=document.querySelector('script[src="'+b.filename+'"]');if(c){var e=c.getAttribute("data-script-id"),f=a._objects.get(e);if(f){var g={message:b.message,line:b.lineno,file:b.filename};n(f,g)}c.parentNode.removeChild(c)}}if(a._currentScriptLoading){var h=document.getElementById(d.DOM_ID_PREFIX+a._currentScriptLoading);h&&h.parentNode.removeChild(h),delete window._gooScriptFactories[a._currentScriptLoading];var f=a._objects.get(a._currentScriptLoading),g={message:b.message,line:b.lineno-1};n(f,g),a._currentScriptLoading=null}})},d.validateParameter=function(a){for(var b=0;b<u.PROPERTY_TYPES.length;++b){var c=u.PROPERTY_TYPES[b],d=a[c.prop],e="undefined"!=typeof d,f='Property "'+c.prop+'" must be ';if(c.mustBeDefined||e){var g=u.TYPE_VALIDATORS[c.type],h=c.getAllowedValues?c.getAllowedValues(a):null;if(e&&c.minLength&&d.length<c.minLength)return{message:f+"longer than "+(c.minLength-1)};if(h&&-1===h.indexOf(d))return{message:f+"one of: "+h.join(", ")};if(!g(d))return{message:f+"of type "+c.type}}}},d.validateParameters=function(a,b){var c=a.errors||[];if("object"!=typeof a.externals)return void(b.externals={});var e=a.externals;if(!e.parameters||e.parameters instanceof Array||c.push("externals.parameters must be an array"),c.length)return void(b.errors=c);if(b.externals.parameters=[],e.parameters){for(var f={},g=0;g<e.parameters.length;g++){var h=e.parameters[g],i=d.validateParameter(h);i&&c.push(i),(null===h["default"]||void 0===h["default"])&&(h["default"]=u.DEFAULTS_BY_TYPE[h.type]),h.key&&f[h.key]&&c.push({message:'Duplicate parameter key: "'+h.key+'"'}),f[h.key]=!0,b.externals.parameters.push(h)}c.length&&(b.errors=c)}},d.DOM_ID_PREFIX="_script_",a.exports=d},494:function(a,b,c){c(493),c(492)},495:function(a,b,c){var d=c(4),e={OrbitCamControlScript:c(365),OrbitNPanControlScript:c(487),FlyControlScript:c(481),AxisAlignedCamControlScript:c(477),PanCamScript:c(488),MouseLookControlScript:c(483),WasdControlScript:c(482),ButtonScript:c(479),PickAndRotateScript:c(489),LensFlareScript:c(486)};for(var f in e)d.register(e[f])},496:function(a,b){function c(a){this.elevationData=a}c.prototype.getClosest=function(a,b){for(var c=Number.MAX_VALUE,d=-1,e=0;e<this.elevationData.length;e+=3){var f=Math.pow(this.elevationData[e+0]-a,2)+Math.pow(this.elevationData[e+2]-b,2);c>f&&(c=f,d=e)}return this.elevationData[d+1]},c.prototype.run=function(a){var b=a.transformComponent.transform.translation,c=this.getClosest(b.x,b.z),d=b.y-c;b.y-=.1*d},a.exports=c},497:function(a,b,c){function d(a,b){if(a.minX>a.maxX)throw new Error({name:"Terrain Exception",message:"minX is larger than maxX"});if(a.minY>a.maxY)throw new Error({name:"Terrain Exception",message:"minY is larger than maxY"});if(a.minZ>a.maxZ)throw new Error({name:"Terrain Exception",message:"minZ is larger than maxZ"});if(!b)throw new Error({name:"Terrain Exception",message:"No heightmap data specified"});if(b.length!==b[0].length)throw new Error({name:"Terrain Exception",message:"Heightmap data is not a square"});return!0}function e(a,b,c){b=b||k,d(b,a,c);var e={dimensions:b,sideQuadCount:a.length-1,script:new g(a)};return e}function f(){this.heightMapData=[],this.yMargin=1}var g=c(485),h=c(8),i=new h,j=new h,k={minX:0,maxX:100,minY:0,maxY:50,minZ:0,maxZ:100};f.prototype.addHeightData=function(a,b){var c=e(a,b,this.heightMapData);return this.heightMapData.push(c),c},f.prototype.getHeightDataForPosition=function(a){for(var b=0;b<this.heightMapData.length;b++){var c=this.heightMapData[b].dimensions;if(a.x<=c.maxX&&a.x>=c.minX&&a.y<c.maxY+this.yMargin&&a.y>c.minY-this.yMargin&&a.z<=c.maxZ&&a.z>=c.minZ)return this.heightMapData[b]}return null},f.prototype.displaceAxisDimensions=function(a,b,c,d){var e=a-b;return d*e/(c-b)},f.prototype.returnToWorldDimensions=function(a,b,c,d){var e=(c-b)/d,f=a*e;return b+f},f.prototype.getTerrainHeightAt=function(a){var b=this.getHeightDataForPosition(a);if(null===b)return null;var c=b.dimensions,d=this.displaceAxisDimensions(a.x,c.minX,c.maxX,b.sideQuadCount),e=this.displaceAxisDimensions(a.z,c.minZ,c.maxZ,b.sideQuadCount),f=b.script.getPreciseHeight(d,e);return f*(c.maxY-c.minY)+c.minY},f.prototype.getTerrainNormalAt=function(a){var b=this.getHeightDataForPosition(a);if(!b)return null;for(var c=b.dimensions,d=this.displaceAxisDimensions(a.x,c.minX,c.maxX,b.sideQuadCount),e=this.displaceAxisDimensions(a.z,c.minZ,c.maxZ,b.sideQuadCount),f=b.script.getTriangleAt(d,e),g=0;g<f.length;g++)f[g].x=this.returnToWorldDimensions(f[g].x,c.minX,c.maxX,b.sideQuadCount),f[g].z=this.returnToWorldDimensions(f[g].z,c.minY,c.maxY,1),f[g].y=this.returnToWorldDimensions(f[g].y,c.minZ,c.maxZ,b.sideQuadCount);return i.setDirect(f[1].x-f[0].x,f[1].z-f[0].z,f[1].y-f[0].y),j.setDirect(f[2].x-f[0].x,f[2].z-f[0].z,f[2].y-f[0].y),i.cross(j),i.y<0&&i.scale(-1),i.normalize(),i},a.exports=f}});