webpackJsonp([15],{0:function(a,b,c){a.exports=c(445)},445:function(a,b,c){if(a.exports={BoxCollider:c(446),Collider:c(447),CylinderCollider:c(448),MeshCollider:c(449),PlaneCollider:c(450),SphereCollider:c(451),AbstractColliderComponent:c(452),AbstractRigidBodyComponent:c(453),ColliderComponent:c(454),RigidBodyComponent:c(455),ColliderComponentHandler:c(459),RigidBodyComponentHandler:c(461),BallJoint:c(456),HingeJoint:c(458),PhysicsJoint:c(457),PhysicsMaterial:c(460),RaycastResult:c(462),PhysicsBoxDebugShape:c(463),PhysicsCylinderDebugShape:c(464),PhysicsPlaneDebugShape:c(465),PhysicsSphereDebugShape:c(466),AbstractPhysicsSystem:c(467),ColliderSystem:c(468),PhysicsDebugRenderSystem:c(469),PhysicsSystem:c(471),Pool:c(470)},"undefined"!=typeof window)for(var d in a.exports)window.goo[d]=a.exports[d]},446:function(a,b,c){function d(a){a=a||{},this.halfExtents=a.halfExtents?new e(a.halfExtents):new e(.5,.5,.5),f.call(this)}var e=c(8),f=c(447);d.prototype=Object.create(f.prototype),d.prototype.constructor=d,d.prototype.transform=function(a,b){b.halfExtents.set(a.scale).mul(this.halfExtents)},d.prototype.clone=function(){return new d({halfExtents:this.halfExtents})},a.exports=d},447:function(a,b){function c(){}c.prototype.clone=function(){return new c},c.prototype.transform=function(){},a.exports=c},448:function(a,b,c){function d(a){a=a||{},this.radius=void 0!==a.radius?a.radius:.5,this.height=void 0!==a.height?a.height:1,e.call(this)}var e=c(447);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.transform=function(a,b){var c=a.scale;b.radius=Math.max(c.x,c.y)*this.radius,b.height=c.z*this.height},d.prototype.clone=function(){return new d({radius:this.radius,height:this.height})},a.exports=d},449:function(a,b,c){function d(a){a=a||{},this.meshData=a.meshData,this.scale=void 0!==a.scale?new f(a.scale):new f(1,1,1),e.call(this)}var e=c(447),f=c(8);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.transform=function(a,b){b.scale.set(this.scale).mul(a.scale)},d.prototype.clone=function(){return new d({meshData:this.meshData,scale:this.scale})},a.exports=d},450:function(a,b,c){function d(){e.call(this)}var e=c(447);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.transform=function(){},d.prototype.clone=function(){return new d},a.exports=d},451:function(a,b,c){function d(a){a=a||{},this.radius=void 0!==a.radius?a.radius:.5,e.call(this)}var e=c(447);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.transform=function(a,b){var c=a.scale;b.radius=this.radius*Math.max(Math.abs(c.x),Math.abs(c.y),Math.abs(c.z))},d.prototype.clone=function(){return new d({radius:this.radius})},a.exports=d},452:function(a,b,c){function d(a){e.apply(this),a=a||{},this.entity=null,this.collider=a.collider||null,this.worldCollider=this.collider?this.collider.clone():null,this.isTrigger=void 0!==a.isTrigger?a.isTrigger:!1,this.bodyEntity=null,this.material=void 0!==a.material?a.material:null}var e=c(20),f=c(447);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.getBodyEntity=function(){var a;return this.entity.traverseUp(function(b){return b.rigidBodyComponent?(a=b,!1):void 0}),a},d.prototype.updateWorldCollider=function(){this.collider.transform(this.entity.transformComponent.sync().worldTransform,this.worldCollider)},d.prototype.attached=function(a){this.entity=a,this.system=a._world.getSystem("PhysicsSystem")},d.prototype.detached=function(){this.entity=null},d.applyOnEntity=function(a,b){return a instanceof f?(b.setComponent(new d({collider:a})),!0):void 0},d.prototype.api={},a.exports=d},453:function(a,b,c){function d(){e.call(this,arguments),this.joints=[]}var e=c(20),f=c(23),g=c(41),h=c(44),i=new f;d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.addJoint=function(a){this.joints.push(a)},d.prototype.removeJoint=function(a){var b=this.joints,c=b.indexOf(a);-1!==c&&b.splice(c,1)},d.initializedEvent={entity:null},d.prototype.emitInitialized=function(a){var b=d.initializedEvent;b.entity=a,h.emit("goo.physics.initialized",b),b.entity=null},d.prototype.initialize=function(){},d.prototype.destroy=function(){},d.prototype.initializeJoint=function(){},d.prototype.destroyJoint=function(){};var j=new g,k=new g,l=new g;d.prototype.traverseColliders=function(a,b){var c=a.transformComponent.sync().worldTransform;j.copy(c),j.invert(j);for(var d=[a];d.length;){var e=d.pop(),f=e.colliderComponent;if(f){e.transformComponent.sync(),k.copy(e.transformComponent.worldTransform),g.combine(j,k,l);var h=l.translation,m=l.rotation;i.fromRotationMatrix(m),b.call(this,e,f.collider,h,i)}for(var n=e.transformComponent.children,o=0;o<n.length;o++){var p=n[o].entity;p.rigidBodyComponent||d.push(p)}}},d.prototype.attached=function(){},d.prototype.attached=function(a){this._entity=a,this._system=a._world.getSystem("PhysicsSystem")},d.prototype.detached=function(){this._entity=null,this._system=null},a.exports=d},454:function(a,b,c){function d(a){e.apply(this,arguments),this.type="ColliderComponent",a=a||{},this.cannonBody=null,this.cannonShape=null}var e=c(452),f=c(446),g=c(451),h=c(449),i=c(450),j=c(448),k=c(447),l=c(8),m=c(23),n=new m;d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.type="ColliderComponent",d.prototype.initialize=function(){var a=null;this.material&&(a=new CANNON.Material,a.friction=this.material.friction,a.restitution=this.material.restitution),this.updateWorldCollider();var b=this.cannonShape=d.getCannonShape(this.worldCollider);b.material=a,b.collisionResponse=!this.isTrigger;var c=this.entity,e=c.transformComponent.sync().worldTransform,i=new CANNON.Vec3,j=new CANNON.Quaternion;i.copy(e.translation),n.fromRotationMatrix(e.rotation),j.copy(n);var k=new CANNON.Body({mass:0,position:i,quaternion:j});this.system.cannonWorld.addBody(k),this.cannonBody=k,this.system._shapeIdToColliderEntityMap.set(b.id,c);var l=this.worldCollider;if(l instanceof g)b.radius=l.radius;else if(l instanceof f)b.halfExtents.copy(l.halfExtents),b.updateConvexPolyhedronRepresentation();else if(l instanceof h){var m=new CANNON.Vec3;m.copy(l.scale),b.setScale(m)}b.updateBoundingSphereRadius(),k.computeAABB(),k.addShape(b),k.aabbNeedsUpdate=!0},d.prototype.destroy=function(){var a=this.cannonBody;a.shapes.forEach(function(a){this.system._shapeIdToColliderEntityMap["delete"](a.id)}.bind(this)),this.system.cannonWorld.removeBody(a),this.cannonBody=null,this.cannonShape=null},d.numCylinderSegments=10,d.getCannonShape=function(a){var b;if(a instanceof f){var c=new CANNON.Vec3;c.copy(a.halfExtents),b=new CANNON.Box(c)}else if(a instanceof g)b=new CANNON.Sphere(a.radius);else if(a instanceof i)b=new CANNON.Plane;else if(a instanceof j){b=new CANNON.Cylinder(a.radius,a.radius,a.height,d.numCylinderSegments);var e=new CANNON.Quaternion;e.setFromAxisAngle(new l(0,0,1),-Math.PI/2),b.transformAllPoints(new l,e),b.computeEdges(),b.updateBoundingSphereRadius()}else if(a instanceof h){if("Triangles"!==a.meshData.indexModes[0])throw new Error("MeshCollider data must be a triangle mesh!");b=new CANNON.Trimesh(a.meshData.getAttributeBuffer("POSITION"),a.meshData.getIndexBuffer())}else console.warn("Unhandled collider: ",a);return b},d.applyOnEntity=function(a,b){return a instanceof k?(b.setComponent(new d({collider:a})),!0):void 0},a.exports=d},455:function(a,b,c){function d(a){a=a||{},g.apply(this,arguments),this.type="RigidBodyComponent",this.cannonBody=null,this._dirty=!0,this._isKinematic=!!a.isKinematic,this._mass=void 0!==a.mass?a.mass:1,this._isKinematic?this._mass=0:0===this._mass&&(this._isKinematic=!0),this._initialized=!1,this._velocity=a.velocity?a.velocity.clone():new h,this._angularVelocity=a.angularVelocity?a.angularVelocity.clone():new h,this._linearDamping=void 0!==a.linearDamping?a.linearDamping:.01,this._angularDamping=void 0!==a.angularDamping?a.angularDamping:.05,this._sleepingThreshold=void 0!==a.sleepingThreshold?a.sleepingThreshold:.2,this._sleepingTimeLimit=void 0!==a.sleepingTimeLimit?a.sleepingTimeLimit:1,e||(e=new CANNON.Vec3,f=new CANNON.Vec3),this._colliderEntities=[],this.interpolation=d.INTERPOLATE,this._constraints=d.FREEZE_NONE}var e,f,g=c(453),h=c(8),i=c(23),j=c(446),k=c(451),l=c(449),m=c(456),n=c(458),o=c(454),p=c(9),q=new i;d.prototype=Object.create(g.prototype),d.prototype.constructor=d,d.type="RigidBodyComponent",d.FREEZE_NONE=0,d.FREEZE_POSITION_X=1,d.FREEZE_POSITION_Y=2,d.FREEZE_POSITION_Z=4,d.FREEZE_ROTATION_X=8,d.FREEZE_ROTATION_Y=16,d.FREEZE_ROTATION_Z=32,d.FREEZE_POSITION=d.FREEZE_POSITION_X|d.FREEZE_POSITION_Y|d.FREEZE_POSITION_Z,d.FREEZE_ROTATION=d.FREEZE_ROTATION_X|d.FREEZE_ROTATION_Y|d.FREEZE_ROTATION_Z,d.FREEZE_ALL=d.FREEZE_POSITION|d.FREEZE_ROTATION,d.NONE=1,d.INTERPOLATE=2,d.numCylinderSegments=10,d.prototype.setTransformFromEntity=function(a){var b=a.transformComponent.sync().worldTransform,c=this.cannonBody;c.position.copy(b.translation),c.previousPosition.copy(b.translation),c.interpolatedPosition.copy(b.translation),q.fromRotationMatrix(b.rotation),c.quaternion.copy(q),c.previousQuaternion.copy(q),c.interpolatedQuaternion.copy(q)},d.prototype.applyForceWorld=function(a,b){var c=e;c.copy(a);var d=f;d.copy(b),d.vsub(this.cannonBody.position,d),this.cannonBody.applyForce(c,d)},d.prototype.applyForceLocal=function(a,b){var c=e;c.copy(a);var d=CANNON.Vec3.ZERO;b&&(d=f,d.copy(b));var g=this.cannonBody;g.vectorToWorldFrame(c,c),g.vectorToWorldFrame(d,d),g.applyForce(c,d)},d.prototype.applyForce=function(a,b){var c=e;c.copy(a);var d=CANNON.Vec3.ZERO;b&&(d=f,d.copy(b)),this.cannonBody.applyForce(c,d)},d.prototype.applyTorque=function(a){e.copy(a),this.cannonBody.torque.vadd(e,this.cannonBody.torque)},d.prototype.applyTorqueLocal=function(a){var b=e;b.copy(a),this.cannonBody.vectorToWorldFrame(b,b),this.cannonBody.torque.vadd(b,this.cannonBody.torque)},d.prototype.applyImpulse=function(a,b){e.copy(a),f.copy(b),this.cannonBody.applyImpulse(e,f)},d.prototype.applyImpulseLocal=function(a,b){e.copy(a),f.copy(b),this.cannonBody.applyLocalImpulse(e,f)},d.prototype.setVelocity=function(a){this.cannonBody&&this.cannonBody.velocity.copy(a),this._velocity.set(a)},d.prototype.getVelocity=function(a){var b=this.cannonBody,c=b?b.velocity:this._velocity;a.setDirect(c.x,c.y,c.z)},d.prototype.setAngularVelocity=function(a){this.cannonBody&&this.cannonBody.angularVelocity.copy(a),this._angularVelocity.set(a)},d.prototype.getAngularVelocity=function(a){var b=this.cannonBody,c=b?b.angularVelocity:this._angularVelocity;a.setDirect(c.x,c.y,c.z)},d.prototype.setPosition=function(a){this.cannonBody&&this.cannonBody.position.copy(a)},d.prototype.getPosition=function(a){if(this.cannonBody){var b=this.cannonBody.position;a.setDirect(b.x,b.y,b.z)}},d.prototype.getInterpolatedPosition=function(a){if(this.cannonBody){var b=this.cannonBody.previousPosition,c=this.cannonBody.position,d=this._system.world.interpolationTime;a.setDirect(p.lerp(d,b.x,c.x),p.lerp(d,b.y,c.y),p.lerp(d,b.z,c.z))}},d.prototype.setQuaternion=function(a){this.cannonBody&&this.cannonBody.quaternion.copy(a)},d.prototype.getQuaternion=function(a){if(this.cannonBody){var b=this.cannonBody.quaternion;a.setDirect(b.x,b.y,b.z,b.w)}},d.prototype.getInterpolatedQuaternion=function(a){if(this.cannonBody){var b=this.cannonBody.previousQuaternion,c=this.cannonBody.quaternion,d=this._system.world.interpolationTime;a.setDirect(p.lerp(d,b.x,c.x),p.lerp(d,b.y,c.y),p.lerp(d,b.z,c.z),p.lerp(d,b.w,c.w))}},Object.defineProperties(d.prototype,{linearDamping:{get:function(){return this._linearDamping},set:function(a){this.cannonBody&&(this.cannonBody.linearDamping=a),this._linearDamping=a}},angularDamping:{get:function(){return this._angularDamping},set:function(a){this.cannonBody&&(this.cannonBody.angularDamping=a),this._angularDamping=a}},isKinematic:{get:function(){return this._isKinematic},set:function(a){this._isKinematic=a,this.cannonBody&&(this.cannonBody.type=a?CANNON.Body.KINEMATIC:CANNON.Body.DYNAMIC,this.cannonBody.updateMassProperties())}},sleepingThreshold:{get:function(){return this._sleepingThreshold},set:function(a){this._sleepingThreshold=a,this.cannonBody&&(this.cannonBody.sleepSpeedLimit=a)}},mass:{get:function(){return this._mass},set:function(a){this._mass=a,this.cannonBody&&(this.cannonBody.mass=a,this.cannonBody.updateMassProperties())}},sleepingTimeLimit:{get:function(){return this._sleepingTimeLimit},set:function(a){this._sleepingTimeLimit=a,this.cannonBody&&(this.cannonBody.sleepTimeLimit=a)}},constraints:{get:function(){return this._constraints},set:function(a){this._constraints=a;var b=this.cannonBody;b&&d.constraintsToCannonFactors(a,b.linearFactor,b.angularFactor)}}}),d.prototype.destroy=function(){var a=this.cannonBody;a&&(a.world.removeBody(a),delete this._system._entities[a.id],a.shapes.forEach(function(a){this._system._shapeIdToColliderEntityMap["delete"](a.id)}.bind(this)),this.cannonBody=null);for(var b=0;b<this._colliderEntities.length;b++)this._colliderEntities[b].bodyEntity=null;this._colliderEntities.length=0},d.constraintsToCannonFactors=function(a,b,c){b.set(a&d.FREEZE_POSITION_X?0:1,a&d.FREEZE_POSITION_Y?0:1,a&d.FREEZE_POSITION_Z?0:1),c.set(a&d.FREEZE_ROTATION_X?0:1,a&d.FREEZE_ROTATION_Y?0:1,a&d.FREEZE_ROTATION_Z?0:1)},d.prototype.initialize=function(){this.destroy();var a=this.cannonBody=new CANNON.Body({mass:this._mass,linearDamping:this._linearDamping,angularDamping:this._angularDamping,sleepSpeedLimit:this._sleepingThreshold,sleepTimeLimit:this._sleepingTimeLimit});d.constraintsToCannonFactors(this.constraints,a.linearFactor,a.angularFactor),this._system.cannonWorld.addBody(a),this._system._entities[a.id]=this._entity,this._initialized||(a.velocity.copy(this._velocity),a.angularVelocity.copy(this._angularVelocity)),this.traverseColliders(this._entity,function(a,b,c,d){this.addCollider(a,c,d),a.colliderComponent.bodyEntity=this._entity}),this._isKinematic&&(a.type=CANNON.Body.KINEMATIC),this.setTransformFromEntity(this._entity),a.aabbNeedsUpdate=!0,this.emitInitialized(this._entity)},d.prototype.initializeJoint=function(a){var b,c=this.cannonBody,d=(a.connectedEntity.rigidBodyComponent||a.connectedEntity.colliderComponent).cannonBody;if(a instanceof m){var e=a.localPivot.clone();e.mul(this._entity.transformComponent.transform.scale);var f=new CANNON.Vec3,g=new CANNON.Vec3;if(f.copy(e),a.autoConfigureConnectedPivot)c.pointToWorldFrame(f,g),d.pointToLocalFrame(g,g);else{var h=a.connectedLocalPivot.clone();h.mul(a.connectedEntity.transformComponent.transform.scale),g.copy(h)}b=new CANNON.PointToPointConstraint(c,f,d,g)}else if(a instanceof n){var f=new CANNON.Vec3,g=new CANNON.Vec3,i=new CANNON.Vec3,j=new CANNON.Vec3,e=a.localPivot.clone();if(e.mul(this._entity.transformComponent.transform.scale),f.copy(e),i.copy(a.localAxis),a.autoConfigureConnectedPivot)c.pointToWorldFrame(f,g),d.pointToLocalFrame(g,g);else{var h=a.connectedLocalPivot.clone();h.mul(a.connectedEntity.transformComponent.transform.scale),g.copy(h)}j.copy(a.localAxis),c.vectorToWorldFrame(a.localAxis,j),d.vectorToLocalFrame(j,j),b=new CANNON.HingeConstraint(c,d,{pivotA:f,pivotB:g,axisA:i,axisB:j,collideConnected:a.collideConnected})}else console.warn("Unhandled joint: ",a);b&&(c.world.addConstraint(b),a.cannonJoint=b)},d.copyScaleFromColliderToCannonShape=function(a,b){if(b instanceof k)a.radius=b.radius;else if(b instanceof j)a.halfExtents.copy(b.halfExtents),a.updateConvexPolyhedronRepresentation(),a.updateBoundingSphereRadius();else if(b instanceof l){var c;e||(e=new CANNON.Vec3),c=e,c.copy(b.scale),a.setScale(c)}a.updateBoundingSphereRadius()},d.prototype.destroyJoint=function(a){var b=this.cannonBody;b&&a.cannonJoint&&(b.world.removeConstraint(a.cannonJoint),a.cannonJoint=null)},d.prototype.addCollider=function(a,b,c){var d=this.cannonBody,e=a.colliderComponent;e.updateWorldCollider(!0);var f=e.worldCollider,g=e.cannonShape=o.getCannonShape(f);this._system._shapeIdToColliderEntityMap.set(g.id,a);var h=new CANNON.Material;h.friction=e.material?e.material.friction:-1,h.restitution=e.material?e.material.restitution:-1,g.material=h,g.collisionResponse=!e.isTrigger;var i=new CANNON.Vec3;b&&i.copy(b);var j=new CANNON.Quaternion;b&&j.copy(c),d.addShape(g,i,j),this._colliderEntities.push(a)},d.prototype.clone=function(){return new d({isKinematic:this._isKinematic,mass:this._mass,velocity:this._velocity,angularVelocity:this._angularVelocity,linearDamping:this._linearDamping,angularDamping:this._angularDamping,sleepingThreshold:this._sleepingThreshold,sleepingTimeLimit:this._sleepingTimeLimit})},d.prototype.api={},a.exports=d},456:function(a,b,c){function d(a){a=a||{},e.call(this,a),this.localPivot=a.localPivot?f.fromAny(a.localPivot):new f(0,.5,0),this.autoConfigureConnectedPivot=a.autoConfigureConnectedPivot?a.autoConfigureConnectedPivot:!0,this.connectedLocalPivot=a.connectedLocalPivot?f.fromAny(a.connectedLocalPivot):new f(0,.5,0)}var e=c(457),f=c(8);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,a.exports=d},457:function(a,b){function c(a){a=a||{},this.connectedEntity=a.connectedEntity||null,this.collideConnected=void 0!==a.collideConnected?a.collideConnected:!1}a.exports=c},458:function(a,b,c){function d(a){a=a||{},e.call(this,a),this.localPivot=a.localPivot?new f(a.localPivot):new f(0,.5,0),this.autoConfigureConnectedPivot=a.autoConfigureConnectedPivot?a.autoConfigureConnectedPivot:!0,this.connectedLocalPivot=a.connectedLocalPivot?new f(a.connectedLocalPivot):new f,this.localAxis=a.localAxis?new f(a.localAxis):new f(1,0,0)}var e=c(457),f=c(8);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,a.exports=d},459:function(a,b,c){function d(){e.apply(this,arguments),this._type="ColliderComponent"}var e=c(88),f=c(454),g=c(6),h=c(451),i=c(446),j=c(450),k=c(448),l=c(460);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,e._registerClass("collider",d),d.prototype._prepare=function(a){return g.defaults(a,{shape:"Box",shapeOptions:{halfExtents:[1,1,1],radius:.5,height:1},isTrigger:!1,friction:.3,restitution:0})},d.prototype._create=function(){return new f({material:new l})},d.prototype._remove=function(a){a.clearComponent("ColliderComponent")},d.prototype.update=function(a,b,c){return e.prototype.update.call(this,a,b,c).then(function(a){if(a){switch(b.shape){default:case"Box":a.collider=new i(b.shapeOptions),a.worldCollider=new i;break;case"Sphere":a.collider=new h(b.shapeOptions),a.worldCollider=new h;break;case"Plane":a.collider=new j,a.worldCollider=new j;break;case"Cylinder":a.collider=new k(b.shapeOptions),a.worldCollider=new k}return a.material.friction=b.friction,a.material.restitution=b.restitution,a.isTrigger=b.isTrigger,a}})},a.exports=d},460:function(a,b){function c(a){a=a||{},this.friction=void 0!==a.friction?a.friction:.3,this.restitution=void 0!==a.restitution?a.restitution:0}a.exports=c},461:function(a,b,c){function d(){e.apply(this,arguments),this._type="RigidBodyComponent"}var e=c(88),f=c(455),g=c(6),h=c(8);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,e._registerClass("rigidBody",d),d.prototype._prepare=function(a){return g.defaults(a,{mass:1,isKinematic:!1,velocity:[0,0,0],angularVelocity:[0,0,0],linearDrag:0,angularDrag:0,freezePositionX:!1,freezePositionY:!1,freezePositionZ:!1,freezeRotationX:!1,freezeRotationY:!1,freezeRotationZ:!1})},d.prototype._create=function(){return new f},d.prototype._remove=function(a){a.clearComponent("RigidBodyComponent")},d.prototype.update=function(a,b,c){return e.prototype.update.call(this,a,b,c).then(function(a){return a?(a.mass=b.mass,a.isKinematic=b.isKinematic,a.setVelocity(new h(b.velocity)),a.setAngularVelocity(new h(b.angularVelocity)),a.linearDamping=b.linearDrag,a.angularDamping=b.angularDrag,a.constraints=(b.freezePositionX?f.FREEZE_POSITION_X:0)|(b.freezePositionY?f.FREEZE_POSITION_Y:0)|(b.freezePositionZ?f.FREEZE_POSITION_Z:0)|(b.freezeRotationX?f.FREEZE_ROTATION_X:0)|(b.freezeRotationY?f.FREEZE_ROTATION_Y:0)|(b.freezeRotationZ?f.FREEZE_ROTATION_Z:0),a):void 0})},a.exports=d},462:function(a,b,c){function d(a){a=a||{},this.point=a.point?new e(a.point):new e,this.normal=a.normal?new e(a.normal):new e,this.entity=a.entity||null,this.distance=a.distance||-1}var e=c(8);d.prototype.reset=function(){this.entity=null,this.distance=-1},a.exports=d},463:function(a,b,c){function d(){var a=e.defaultMap([e.POSITION]);e.call(this,a,24,24),this.indexModes[0]="Lines",this.rebuild()}var e=c(14);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.buildWireframeData=function(){return new d},d.prototype.rebuild=function(){var a=[],b=[];return a.push(-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,-.5,.5,-.5,-.5,.5,-.5,.5,.5,.5,.5,.5,.5,-.5),b.push(0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7),this.getAttributeBuffer(e.POSITION).set(a),this.getIndexBuffer().set(b),this},a.exports=d},464:function(a,b,c){function d(a){a=a||32;var b=e.defaultMap([e.POSITION]);this.numSegments=a,e.call(this,b,6*a+24,4*a+16),this.indexModes[0]="Lines",this.rebuild()}var e=c(14);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.buildWireframeData=function(){return new d},d.prototype.rebuild=function(){for(var a=[],b=[],c=this.numSegments,d=0;c>d;d++)a.push(Math.cos(2*Math.PI*d/c),Math.sin(2*Math.PI*d/c),.5),b.push(d,(d+1)%c);for(var d=0;c>d;d++)a.push(Math.cos(2*Math.PI*d/c),Math.sin(2*Math.PI*d/c),-.5),b.push(c+d,c+(d+1)%c);return a.push(Math.cos(1*Math.PI/2),Math.sin(1*Math.PI/2),-.5,Math.cos(1*Math.PI/2),Math.sin(1*Math.PI/2),.5,Math.cos(2*Math.PI/2),Math.sin(2*Math.PI/2),-.5,Math.cos(2*Math.PI/2),Math.sin(2*Math.PI/2),.5,Math.cos(3*Math.PI/2),Math.sin(3*Math.PI/2),-.5,Math.cos(3*Math.PI/2),Math.sin(3*Math.PI/2),.5,Math.cos(4*Math.PI/2),Math.sin(4*Math.PI/2),-.5,Math.cos(4*Math.PI/2),Math.sin(4*Math.PI/2),.5),b.push(2*c+0,2*c+1,2*c+2,2*c+3,2*c+4,2*c+5,2*c+6,2*c+7),this.getAttributeBuffer(e.POSITION).set(a),this.getIndexBuffer().set(b),this},a.exports=d},465:function(a,b,c){function d(){var a=e.defaultMap([e.POSITION]);e.call(this,a,10,14),this.indexModes[0]="Lines",this.rebuild()}var e=c(14);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.buildWireframeData=function(){return new d},d.prototype.rebuild=function(){var a=[],b=[];return a.push(-1,-1,0,1,-1,0,1,1,0,-1,1,0,-2,0,0,2,0,0,0,-2,0,0,2,0,0,0,0,0,0,1),b.push(0,1,1,2,2,3,3,0,4,5,6,7,8,9),this.getAttributeBuffer(e.POSITION).set(a),this.getIndexBuffer().set(b),this},a.exports=d},466:function(a,b,c){function d(a){a=a||32;var b=e.defaultMap([e.POSITION]);this.numSegments=a,e.call(this,b,9*a,6*a),this.indexModes[0]="Lines",this.rebuild()}var e=c(14);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.buildWireframeData=function(){return new d},d.prototype.rebuild=function(){for(var a=[],b=[],c=this.numSegments,d=0;c>d;d++)a.push(0,Math.cos(2*Math.PI*d/c),Math.sin(2*Math.PI*d/c)),b.push(d,(d+1)%c);for(var d=0;c>d;d++)a.push(Math.cos(2*Math.PI*d/c),0,Math.sin(2*Math.PI*d/c)),b.push(c+d,c+(d+1)%c);for(var d=0;c>d;d++)a.push(Math.cos(2*Math.PI*d/c),Math.sin(2*Math.PI*d/c),0),b.push(2*c+d,2*c+(d+1)%c);return this.getAttributeBuffer(e.POSITION).set(a),this.getIndexBuffer().set(b),this},a.exports=d},467:function(a,b,c){function d(){e.apply(this,arguments),this.priority=-1,this._activeColliderEntities=[],this._colliderInsertedListener=function(a){this._activeColliderEntities.push(a.entity),this._colliderInserted(a.entity)}.bind(this),this._colliderDeletedListener=function(a){var b=this._activeColliderEntities,c=b.indexOf(a.entity);-1!==c&&this._activeColliderEntities.splice(c,1),this._colliderDeleted(a.entity)}.bind(this),this._colliderDeletedComponentListener=function(a){this._colliderDeletedComponent(a.entity,a.component)}.bind(this),f.addListener("goo.collider.inserted",this._colliderInsertedListener),f.addListener("goo.collider.deleted",this._colliderDeletedListener),f.addListener("goo.collider.deletedComponent",this._colliderDeletedComponentListener)}var e=c(42),f=c(44);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.setGravity=function(){};var g={entityA:null,entityB:null};d.prototype.emitSubStepEvent=function(){f.emit("goo.physics.substep")},d.prototype.emitBeginContact=function(a,b){this._emitEvent("goo.physics.beginContact",a,b)},d.prototype.emitDuringContact=function(a,b){this._emitEvent("goo.physics.duringContact",a,b)},d.prototype.emitEndContact=function(a,b){this._emitEvent("goo.physics.endContact",a,b)},d.prototype.emitTriggerEnter=function(a,b){this._emitEvent("goo.physics.triggerEnter",a,b)},d.prototype.emitTriggerStay=function(a,b){this._emitEvent("goo.physics.triggerStay",a,b)},d.prototype.emitTriggerExit=function(a,b){this._emitEvent("goo.physics.triggerExit",a,b)},d.prototype._emitEvent=function(a,b,c){g.entityA=b,g.entityB=c,f.emit(a,g),g.entityA=null,g.entityB=null},d.prototype._colliderInserted=function(){},d.prototype._colliderDeleted=function(){},d.prototype._colliderDeletedComponent=function(){},a.exports=d},468:function(a,b,c){function d(){e.call(this,"ColliderSystem",["ColliderComponent","TransformComponent"]),this.priority=1}var e=c(42),f=c(44);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.process=function(){},d.prototype.inserted=function(a){f.emit("goo.collider.inserted",{entity:a})},d.prototype.deleted=function(a){f.emit("goo.collider.deleted",{entity:a})},d.prototype.removedComponent=function(a,b){f.emit("goo.collider.deletedComponent",{entity:a,component:b})},a.exports=d},469:function(a,b,c){function d(){f.call(this,"PhysicsDebugRenderSystem",["TransformComponent"]),this.priority=3,this.renderList=[],this.camera=null,g.addListener("goo.setCurrentCamera",function(a){this.camera=a.camera}.bind(this)),this.renderAll=!0,this.selection=new e,this.sphereMeshData=new j(32),this.boxMeshData=new k,this.cylinderMeshData=new i(32),this.planeMeshData=new h,this.material=new r(s.simpleColored),this.material.uniforms.color=[0,1,0],this.material.wireframe=!0,this.renderablePool=new t({create:function(){return{meshData:null,transform:new q,materials:[]}},init:function(a,b){this.meshData=a,this.materials[0]=b},destroy:function(a){a.meshData=null,a.materials.length=0}})}var e=c(21),f=c(42),g=c(44),h=c(465),i=c(464),j=c(466),k=c(463),l=c(451),m=c(446),n=c(448),o=c(450),p=c(449),q=c(41),r=c(30),s=c(46),t=c(470);d.prototype=Object.create(f.prototype),d.prototype.constructor=d,d.prototype.process=function(a){if(this.clear(),!this.passive)for(var b=0,c=a.length;b!==c;b++){var d=a[b];if((this.renderAll||this.selection.contains(d))&&d.colliderComponent){d.colliderComponent.updateWorldCollider();var e=d.colliderComponent.worldCollider,f=this.getMeshData(e),g=this.renderablePool.get(f,this.material);this.getWorldTransform(d,e,g.transform),g.transform.update(),this.renderList.push(g)}}},d.prototype.getWorldTransform=function(a,b,c){if(c.copy(a.transformComponent.sync().worldTransform),b instanceof l){var d=b.radius;c.scale.set(d,d,d)}else b instanceof m?c.scale.copy(b.halfExtents).scale(2):b instanceof n?c.scale.set(b.radius,b.radius,b.height):b instanceof o?c.scale.set(1,1,1):b instanceof p&&c.scale.set(b.scale)},d.prototype.getMeshData=function(a){var b;return a instanceof l?b=this.sphereMeshData:a instanceof m?b=this.boxMeshData:a instanceof n?b=this.cylinderMeshData:a instanceof o?b=this.planeMeshData:a instanceof p&&(b=a.meshData),b},d.prototype.render=function(a){a.checkResize(this.camera),this.camera&&a.render(this.renderList,this.camera,null,null,!1)},d.prototype.clear=function(){for(var a=0,b=this.renderList.length;a!==b;a++)this.renderablePool.release(this.renderList[a]);this.renderList.length=0},d.prototype.cleanup=function(){this.clear()},a.exports=d},470:function(a,b){function c(a){a=a||{},this._objects=[],this._init=a.init||function(){},this._create=a.create||function(){},this._destroy=a.destroy||function(){}}c.prototype.resize=function(a){for(var b=this._objects;b.length>a;)this._destroy(b.pop());for(;b.length<a;)b.push(this._create());return this},c.prototype.get=function(){var a=this._objects,b=a.length?a.pop():this._create();return this._init.apply(b,arguments),b},c.prototype.release=function(a){return this._destroy(a),this._objects.push(a),this},a.exports=c},471:function(a,b,c){function d(a){a=a||{},this.cannonWorld=new CANNON.World({broadphase:new CANNON.SAPBroadphase}),this.cannonWorld.addEventListener("beginShapeContact",function(a){var b=this._shapeIdToColliderEntityMap,c=b.get(a.shapeA.id),d=b.get(a.shapeB.id);if(c&&d){var e=c.colliderComponent,f=d.colliderComponent;e.isTrigger||f.isTrigger?(this.emitTriggerEnter(c,d),this._stayingEntities.push(c,d)):(e.getBodyEntity()&&!e.getBodyEntity().rigidBodyComponent.isKinematic||f.getBodyEntity()&&!f.getBodyEntity().rigidBodyComponent.isKinematic)&&(this.emitBeginContact(c,d),this._stayingEntities.push(c,d))}}.bind(this)),this.cannonWorld.addEventListener("endShapeContact",function(a){for(var b=this._shapeIdToColliderEntityMap,c=b.get(a.shapeA.id),d=b.get(a.shapeB.id),e=this._stayingEntities,f=0;f<e.length;f+=2)if(e[f]===c&&e[f+1]===d||e[f]===d&&e[f+1]===c){e.splice(f,2);break}c.colliderComponent&&c.colliderComponent.isTrigger||d.colliderComponent&&d.colliderComponent.isTrigger?this.emitTriggerExit(c,d):this.emitEndContact(c,d)}.bind(this)),this.cannonWorld.addEventListener("postStep",function(){this.emitSubStepEvent();for(var a=this._stayingEntities,b=0;b<a.length;b+=2){var c=a[b],d=a[b+1];c.colliderComponent&&c.colliderComponent.isTrigger||d.colliderComponent&&d.colliderComponent.isTrigger?this.emitTriggerStay(c,d):this.emitDuringContact(c,d)}}.bind(this)),this._stayingEntities=[],this._entities={},this._shapeIdToColliderEntityMap=new Map,e||(e=new CANNON.Vec3,f=new CANNON.Vec3,g=new CANNON.RaycastResult),this.setGravity(a.gravity||new k(0,-10,0)),this.initialized=!1,h.call(this,"PhysicsSystem",["RigidBodyComponent"])}var e,f,g,h=c(467),i=c(462),j=c(455),k=c(8),l=c(23),m=c(41),n=new l,o=new k,p=new m;d.prototype=Object.create(h.prototype),d.prototype.constructor=d,d.prototype.setGravity=function(a){this.cannonWorld.gravity.copy(a)},d.prototype.getGravity=function(a){var b=this.cannonWorld.gravity;a.x=b.x,a.y=b.y,a.z=b.z},d.prototype.step=function(a){var b=this.cannonWorld;b.step(a)};var q={};d.prototype._getCannonRaycastOptions=function(a){return q.collisionFilterMask=void 0!==a.collisionMask?a.collisionMask:-1,q.collisionFilterGroup=void 0!==a.collisionGroup?a.collisionGroup:-1,q.skipBackfaces=void 0!==a.skipBackfaces?a.skipBackfaces:!0,q},d.prototype._copyCannonRaycastResultToGoo=function(a,b,c){if(a.hasHit){b.entity=this._shapeIdToColliderEntityMap.get(a.shape.id);var d=a.hitPointWorld,e=a.hitNormalWorld;b.point.setDirect(d.x,d.y,d.z),b.normal.setDirect(e.x,e.y,e.z),b.distance=c.distance(b.point)}return a.hasHit},d.prototype._getCannonStartEnd=function(a,b,c,d,e){d.copy(a),e.copy(b),e.scale(c,e),e.vadd(a,e)},d.prototype.raycastAny=function(a,b,c,d,h){d instanceof i&&(h=d,d={}),d=d||{},h=h||new i;var j=e,k=f;return this._getCannonStartEnd(a,b,c,j,k),this.cannonWorld.raycastAny(j,k,this._getCannonRaycastOptions(d),g),this._copyCannonRaycastResultToGoo(g,h,a)},d.prototype.raycastClosest=function(a,b,c,d,h){d instanceof i&&(h=d,d={}),d=d||{},h=h||new i;var j=e,k=f;return this._getCannonStartEnd(a,b,c,j,k),this.cannonWorld.raycastClosest(j,k,this._getCannonRaycastOptions(d),g),this._copyCannonRaycastResultToGoo(g,h,a)};var r=new i;d.prototype.raycastAll=function(a,b,c,d,g){"function"==typeof d&&(g=d,d={}),g=g||function(){};var h=e,i=f;this._getCannonStartEnd(a,b,c,h,i);var j=this,k=!1;return this.cannonWorld.raycastAll(h,i,this._getCannonRaycastOptions(d),function(b){var c=j._copyCannonRaycastResultToGoo(b,r,a);c&&(k=!0),g(r)===!1&&b.abort()}),k},d.prototype.play=function(){this.passive=!1,this.initialize()},d.prototype.pause=function(){this.passive=!0},d.prototype.resume=function(){this.passive=!1},d.prototype.stop=function(){this.pause(),this.destroy()},d.prototype.initialize=function(a){
a=a||this._activeEntities;for(var b=a.length,c=0;c!==b;c++){var d=a[c],e=d.rigidBodyComponent;e.initialize()}for(var f=this._activeColliderEntities,c=0;c!==f.length;c++){var g=f[c];g.colliderComponent&&(g.colliderComponent.getBodyEntity()||g.colliderComponent.cannonBody||g.colliderComponent.initialize())}for(var c=0;c!==b;c++)for(var d=a[c],h=d.rigidBodyComponent.joints,i=0;i<h.length;i++){var j=h[i];d.rigidBodyComponent.initializeJoint(j,d,this)}this.initialized=!0},d.prototype.destroy=function(a){a=a||this._activeEntities;var b=a.length;this._shapeIdToColliderEntityMap.forEach(function(a){this._shapeIdToColliderEntityMap["delete"](a)}.bind(this)),this._stayingEntities.length=0;for(var c=0;c!==b;c++)for(var d=a[c],e=d.rigidBodyComponent.joints,f=0;f<e.length;f++){var g=e[f];d.rigidBodyComponent.destroyJoint(g,d,this)}for(var c=0;c!==this._activeColliderEntities.length;c++){var h=this._activeColliderEntities[c];h.colliderComponent&&h.colliderComponent.cannonBody&&h.colliderComponent.destroy()}for(var c=0;c!==b;c++){var d=a[c],i=d.rigidBodyComponent;i.destroy()}this.initialized=!1},d.prototype.fixedUpdate=function(a,b){this.initialized||this.initialize(),0!==a.length&&this.step(b)},d.prototype.process=function(a){this.initialized||this.initialize(),0!==a.length&&this.syncTransforms(a)},d.prototype.syncTransforms=function(a){for(var b=a.length,c=[],d=0;d!==b;d++){var e=a[d],f=e.rigidBodyComponent;f._updated=!1,e.transformComponent.parent?c.unshift(e):c.push(e)}for(;c.length;){var e=c.pop(),f=e.rigidBodyComponent,g=e.transformComponent,h=g.transform;if(!f._updated){f._updated=!0,f.interpolation===j.INTERPOLATE?(f.getInterpolatedPosition(o),f.getInterpolatedQuaternion(n)):(f.getPosition(o),f.getQuaternion(n)),h.translation.set(o),h.rotation.copyQuaternion(n);var i=g.parent;i&&(i.entity.transformComponent.sync().worldTransform.invert(p),m.combine(p,h,p),h.rotation.copy(p.rotation),h.translation.copy(p.translation)),g.setUpdated()}}},a.exports=d}});